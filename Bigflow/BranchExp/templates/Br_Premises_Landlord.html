{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %} Add Landlord  {% endblock %}
{% block content %}
{% csrf_token %}
{% verbatim %}
<div class="maincontent">
    <div ng-app="App_maker_summary" ng-controller="Ctrl_amc_maker" class="container container1">
        <div class="row">
            <div class="row-header col-lg-12 col-sm-12">
                <h4>Landlord for {{Premises_Property_Name}} Property </h4>
            </div>
        </div>
        <form name="landlord_form" novalidate>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-4">
                        <md-input-container class="md-block inputcontainer">
                            <label>Landlord Name</label>
                            <input ng-model="all_data.landlord_name"
                                   maxlength="255" required/>
                        </md-input-container>
                    </div>

                    <div class="col-md-4">
                        <md-input-container class="md-block inputcontainer">
                            <label> PAN Number</label>
                            <input ng-model="all_data.landlord_panno"
                                   maxlength="255" required/>
                        </md-input-container>
                    </div>

                    <div class="col-md-4">
                        <md-input-container class="md-block inputcontainer">
                            <label> GST Number</label>
                            <input ng-model="all_data.landlord_gstno"
                                   maxlength="255" required/>
                        </md-input-container>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-4">
                        <md-autocomplete md-clear-button="true"
                                         md-floating-label="Entity Type"
                                         md-item-text="item.dropdowndetails_name"
                                         md-items="item in get_landlord_constitution(search_landlord_constitution)"
                                         md-menu-class="md-virtual-repeat-container"
                                         md-min-length=0
                                         md-no-cache="true"
                                         md-search-text="search_landlord_constitution"
                                         md-selected-item="all_data.landlord_constitution"
                                         md-selected-item-change="landlord_constitution_changed(item.dropdowndetails_gid)">
                            <md-item-template>
                                <span md-highlight-text="search_landlord_constitution"> {{item.dropdowndetails_name}}</span>
                            </md-item-template>
                            <md-not-found>
                                No Data matching "{{search_landlord_constitution}}" were found.
                            </md-not-found>
                        </md-autocomplete>

                    </div>
                    <div class="col-md-4">
                        <md-autocomplete md-clear-button="true"
                                         md-floating-label="TDS Section"
                                         md-item-text="item.dropdowndetails_name"
                                         md-items="item in get_tds_type(search_eb)"
                                         md-menu-class="md-virtual-repeat-container"
                                         md-min-length=0
                                         md-no-cache="true"
                                         md-search-text="search_eb"
                                         md-selected-item="all_data.tdstype"
                                         md-selected-item-change="tds_type_changed(item.dropdowndetails_gid)">
                            <md-item-template>
                                <span md-highlight-text="search_eb"> {{item.dropdowndetails_name}}</span>
                            </md-item-template>
                            <md-not-found>
                                No Data matching "{{search_eb}}" were found.
                            </md-not-found>
                        </md-autocomplete>
                    </div>
                    <div class="col-md-4">
                        <md-input-container class="md-block inputcontainer">
                            <label> TDS Rate Applicable</label>
                            <input ng-model="all_data.landlord_tdsrate" valid-number only-numbers
                                   maxlength="255" required/>
                        </md-input-container>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">

                    <div class="col-md-4">
                        <md-input-container class="md-block inputcontainer">
                            <label>Lower Deduction Certificate Details</label>
                            <input ng-model="all_data.tds_concession"
                                   maxlength="255" required/>
                        </md-input-container>
                    </div>

                    <div class="col-md-4">
                        <md-input-container class="md-block inputcontainer">
                            <label> Mobile Number</label>
                            <input ng-model="all_data.landlord_mobileno" valid-number only-numbers
                                   maxlength="10" required/>
                        </md-input-container>
                    </div>
                    <div class="col-md-4">
                        <md-input-container class="md-block inputcontainer">
                            <label> Email</label>
                            <input type="email" ng-model="all_data.landlord_emailid"
                                   maxlength="55" required/>
                        </md-input-container>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">

                    <div class="col-md-4">
                        NRI:
                        <md-input-container class="md-block inputcontainer">
                            <md-radio-group layout="row" ng-change=""
                                            ng-model="all_data.landlord_nri" ng-required="true">
                                <md-radio-button value="Y"> 'YES'</md-radio-button>
                                <md-radio-button value="N"> 'NO'</md-radio-button>
                                </md-radio-button>
                            </md-radio-group>
                        </md-input-container>
                    </div>
                    <div class="col-md-4" ng-disabled="all_data.landlord_nri=='N'">
                        <md-input-container class="md-block inputcontainer">
                            <label> NRI Local Contact</label>
                            <input ng-model="all_data.landlord_localcontact"
                                   maxlength="255"/>
                        </md-input-container>
                    </div>
                    <div class="col-md-4">
                        NRO:
                        <md-input-container class="md-block inputcontainer">
                            <md-radio-group layout="row" ng-change=""
                                            ng-model="all_data.landlord_nro" ng-required="true">
                                <md-radio-button value="Y"> 'YES'</md-radio-button>
                                <md-radio-button value="N"> 'NO'</md-radio-button>
                                </md-radio-button>
                            </md-radio-group>
                        </md-input-container>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-4">
                        <md-input-container class="md-block inputcontainer">
                            <label> Power of Attorney details</label>
                            <input ng-model="all_data.poa_account"
                                   maxlength="255" required/>
                        </md-input-container>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div ng-include="'empadrs'"></div>
                </div>
            </div>
            <br/>
            <div class="row">
                <div class="col-md-offset-5">
                    <div class="col-md-3">
                        <md-button class="md-raised custbutton" value="submit"
                                   ng-disabled="landlord_form.$invalid"
                                   ng-hide="edit_landlord=='Y' || Page_Name=='Premises_Approval_Summary'"
                                   ng-click="save_details('LANDLORD','NEW')">
                            Save
                        </md-button>

                        <md-button class="md-raised " value="submit"
                                   ng-disabled="landlord_form.$invalid"
                                   ng-hide="edit_landlord=='N' || Page_Name=='Premises_Approval_Summary'"
                                   ng-click="save_details('LANDLORD','UPDATE')">
                            Update
                        </md-button>
                    </div>
                    <div class="col-md-1">
                        <a href="BranchExp/Br_Premises_Property_Details">
                            <md-button class="md-raised md-warn" value="close" data-dismiss="modal"
                                       aria-label="Close">Cancel
                            </md-button>
                        </a>
                    </div>
                </div>
            </div>
        </form>
        <br/>
        <div class="row table-responsive">
            <div class="col-md-12 col-lg-12 col-sm-12">
                <div class="row table-responsive">
                    <div class="col-md-12 col-lg-12 col-sm-12">
                        <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                               md-progress="deferred">
                            <thead class="header">
                            <tr>
                                <th>S.No</th>
                                <th> Name</th>
                                <th> Mobile Number</th>
                                <th> Email</th>
                                <th> PAN Number</th>
                                <th> GST Number</th>
                                <th>Edit</th>
                                <th>Add Bank Account Details</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr align="center"
                                ng-repeat="land in landlord_summary.slice(((currentPage-1)*itemsPerPage),((currentPage)*itemsPerPage)) | filter:search:strict">
                                <td>
                                    <center>
                                        {{((currentPage-1)*itemsPerPage)+$index+1}}
                                    </center>
                                </td>
                                <td>{{land.landlord_name}}</td>
                                <td>{{land.landlord_mobileno}}</td>
                                <td>{{land.landlord_emailid}}</td>
                                <td>{{land.landlord_panno}}</td>
                                <td>{{land.landlord_gstno}}</td>
                                <td align="center">
                                    <a><i class="material-icons"
                                          ng-click="edit_landlord_data(land)">
                                        edit
                                    </i></a>
                                </td>
                                <td>
                                    <span class="editlink material-icons"
                                          ng-click="add_bank_details(land)">arrow_upward
                                </span>
                                </td>

                            </tr>
                            <tr ng-show="landlord_summary.length == 0">
                                <td class="warning" colspan="11">
                                    No Records Found.
                                </td>
                            </tr>
                            </tbody>
                            <tfoot>
                            <tr align="center">
                                <td colspan="7">
                                    <ul uib-pagination
                                        total-items="landlord_summary.length"
                                        ng-model="currentPage"
                                        max-size="maxSize"
                                        class="pagination-sm"
                                        boundary-links="true"
                                        items-per-page="itemsPerPage"></ul>
                                </td>
                                <td colspan="2">
                                    Total Records:{{landlord_summary.length}}
                                </td>
                            </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="landlord_accout_popup" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document" style="width:90%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabels2">
                            Add Account Details
                            <button type="button" class="close" data-dismiss="modal"
                                    ng-click=""
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="body">
                        <br/>
                        <form name="bank_form" novalidate>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-3">
                                        Is KVB Bank:
                                        <md-input-container class="md-block inputcontainer">
                                            <md-radio-group layout="row" ng-change="bank_check(all_data)"
                                                            ng-model="all_data.is_kvb" ng-required="true">
                                                <md-radio-button value="Y"> KVB 'YES'</md-radio-button>
                                                <md-radio-button value="N">KVB 'NO'</md-radio-button>
                                                </md-radio-button>
                                            </md-radio-group>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-3">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Bank Name</label>
                                            <input ng-model="all_data.bank_name"
                                                   ng-disabled="other_bank"
                                                   maxlength="60" required/>
                                        </md-input-container>
                                    </div>

                                    <div class="col-md-3">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Branch Name</label>
                                            <input ng-model="all_data.branch_name"
                                                   ng-disabled="other_bank"
                                                   maxlength="60" required/>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-3">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Branch IFSC Code</label>
                                            <input ng-model="all_data.ifsc_code"
                                                   maxlength="60" required/>
                                        </md-input-container>
                                    </div>


                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-3">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Account Type</label>
                                            <md-select md-container-class="popup_select"
                                                       ng-required="true"
                                                       ng-model="all_data.acount_type">
                                                <md-option ng-repeat="y in account_type_data" ng-value="y.id">
                                                    {{y.data}}
                                                </md-option>
                                            </md-select>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-3">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Account Number</label>
                                            <input ng-model="all_data.account_number" valid-number only-numbers
                                                   maxlength="20" required/>
                                        </md-input-container>
                                    </div>

                                    <div class="col-md-4">
                                        <md-button class="md-raised custbutton" value="submit"
                                                   ng-disabled="bank_form.$invalid"
                                                   ng-hide="edit_bank=='Y' || Page_Name=='Premises_Approval_Summary'"
                                                   ng-click="save_details('BANK_DETAILS','NEW')">
                                            Save
                                        </md-button>

                                        <md-button class="md-raised" value="submit"
                                                   ng-disabled="bank_form.$invalid"
                                                   ng-hide="edit_bank=='N' || Page_Name=='Premises_Approval_Summary'"
                                                   ng-click="save_details('BANK_DETAILS','UPDATE')">
                                            Update
                                        </md-button>

                                        <md-button class="md-raised md-warn" value="close" data-dismiss="modal"
                                                   aria-label="Close">Cancel
                                        </md-button>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <div class="col-md-12">
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div class="row table-responsive">
                                        <div class="col-md-12 col-lg-12 col-sm-12">
                                            <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                                   md-progress="deferred">
                                                <thead class="header">
                                                <tr>
                                                    <th>S.No</th>
                                                    <th>Bank Name</th>
                                                    <th>Branch Name</th>
                                                    <th>Account Type</th>
                                                    <th>IFSC Code</th>
                                                    <th>Account Number</th>
                                                    <th>Edit</th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr align="center"
                                                    ng-repeat="bank in account_details.slice(((bank_currentPage-1)*bank_itemsPerPage),((bank_currentPage)*bank_itemsPerPage)) | filter:search:strict">
                                                    <td>
                                                        <center>
                                                            {{((bank_currentPage-1)*bank_itemsPerPage)+$index+1}}
                                                        </center>
                                                    </td>
                                                    <td>{{bank.account_bankname}}</td>
                                                    <td>{{bank.account_branch}}</td>
                                                    <td>{{bank.account_type}}</td>
                                                    <td>{{bank.account_ifsccode}}</td>
                                                    <td>{{bank.account_no}}</td>
                                                    <td>
                                                        <span class="editlink material-icons"
                                                              ng-click="edit_account_data(bank)">edit
                                                        </span>
                                                    </td>

                                                </tr>
                                                <tr ng-show="account_details.length == 0">
                                                    <td class="warning" colspan="11">
                                                        No Records Found.
                                                    </td>
                                                </tr>
                                                </tbody>
                                                <tfoot>
                                                <tr align="center">
                                                    <td colspan="5">
                                                        <ul uib-pagination
                                                            total-items="account_details.length"
                                                            ng-model="bank_currentPage"
                                                            max-size="bank_maxSize"
                                                            class="pagination-sm"
                                                            boundary-links="true"
                                                            items-per-page="ibank_temsPerPage"></ul>
                                                    </td>
                                                    <td colspan="2">
                                                        Total Records:{{account_details.length}}
                                                    </td>
                                                </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-offset-6">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endverbatim %}
<script>
var myApp = angular.module('App_maker_summary', ['ngMaterial','ui.bootstrap','ngMessages','AppCommon']).config(function($httpProvider) {
    $httpProvider.defaults.xsrfCookieName = 'csrftoken';
    $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
});

myApp.run(function($mdDateLocale, $filter) {
    $mdDateLocale.formatDate = function(date) {
        return $filter('date')(date, "dd-MMM-yyyy");
    };
})

myApp.controller('Ctrl_amc_maker', ['$scope','premises_service','$mdDialog','$window','$filter','$http',
function($scope,premises_service,$mdDialog,$window,$filter,$http) {
    $scope.currentPage=1;
    $scope.maxSize=3;
    $scope.itemsPerPage=10;

    $scope.bank_currentPage=1;
    $scope.bank_maxSize=3;
    $scope.bank_itemsPerPage=10;

    $scope.all_data={};
    $scope.Premises_Property_Gid=0;
    $scope.landlord_gid=0;
    $scope.edit_landlord="N";
    $scope.edit_bank="N";
    $scope.bank_account_gid=0;

    $scope.loading = function() {
        $mdDialog.show({
            templateUrl: 'loaderSpinner',
            parent: angular.element(document.body),
            clickOutsideToClose: false
        });
    };

    $scope.loading_bank = function() {
            $mdDialog.show({
                templateUrl: 'loaderSpinner',
                parent: angular.element(document.getElementById('landlord_accout_popup')),
                clickOutsideToClose: false
            });
    };


    $scope.endloading = function() {
        $mdDialog.hide();
    };

    var datas={"group":"PREMISES","action":"GET","type":"PREMISES_COMMON_DROPDOWN",
                    "filter":{"dropdown_name": "TDS Type"}};

    var get_tds_datas = premises_service.premises_process_get(datas);
    get_tds_datas.then(function(result) {
        var res=result.data;
        $scope.tds_type_data=res;
        console.log($scope.tds_type_data);
    }, function(err) {
      alert('No Data');
    }).finally($scope.endloading);



    $scope.get_landlord_constitution = function(query) {
        var unit_ownership2 = {
            "group":"PREMISES",
            "action":"GET",
            "type":"PREMISES_COMMON_DROPDOWN",
            "filter":{
                "dropdown_name": "Entity Type"
            }
        }
        return $http.post(Appname + '/Get_premises/' , unit_ownership2).then(function(data) {
                var final_values=data.data;
                return final_values;
              });
    };

    $scope.landlord_constitution_changed=function(constitution){
        if(constitution!=undefined){
            $scope.landlord_constitution_gid=constitution;
        }
    }

    $scope.get_tds_type= change_tds;
        function change_tds(query) {
            var result = $filter('filter')($scope.tds_type_data, {
            'dropdowndetails_name':query,
        });
        return result;
   }

   $scope.tds_type_changed=function(tds_tye_values){
        if(tds_tye_values!=undefined){
            $scope.tdstype_gid=tds_tye_values;
        }
   }

    $scope.get_Premises_Data = function(){
    debugger;
        var datas = {"action":"GET","type":"BRANCH_EXPENSE_GID",
        "filter": {"Branch_Premises_Gid":"","Premises_Property_Gid":"","Branch_Premises_Page":""}}

        var setcolumndata = premises_service.get_session_expense(datas);
            setcolumndata.then(function(result) {
            $scope.Branch_Premises_Gid=result.data.Branch_Premises_Gid;
            $scope.Premises_Property_Gid=result.data.Premises_Property_Gid;
            $scope.Premises_Property_Name=result.data.Premises_Property_Name;
            $scope.Page_Name=result.data.Branch_Premises_Page;
            console.log(result.data);
            if($scope.Premises_Property_Gid!=0){
                $scope.execute_premises=1;
                $scope.get_landlord();
            }
            else{
                alert("No Premises");
            }
        },
       function(err) {
            alert("No Premises Gid");
       }).finally($scope.endloading);
    }
    $scope.get_Premises_Data();

    $scope.get_landlord=function(){
         var datas={"group":"PREMISES","action":"GET","type":"PREMISES_LANDLORD",
                "filter":{"propertygid":$scope.Premises_Property_Gid}};
         $scope.loading();
        var premises_summary = premises_service.premises_process_get(datas);
        premises_summary.then(function(result) {
            var res=result.data;
            $scope.landlord_summary=res;
            console.log($scope.landlord_summary);
        }, function(err) {
          alert('No Data');
        }).finally($scope.endloading);

    }


    $scope.add = [];
    $scope.pinchange = function(pincode, type) {
        var pincd = premises_service.getpincodeall(pincode)
        pincd.then(function(result) {
                if (type == 'address') {
                    var apincde = [];
                    apincde = JSON.parse(result.data);
                    $scope.add.addselectedstate = apincde[0].city_state_gid;
                    $scope.state_clk($scope.add.addselectedstate, 'address');
                    $scope.add.addselecteddistrict = apincde[0].pincode_district_gid;
                    $scope.district_clk($scope.add.addselecteddistrict, 'address');
                    $scope.add.addselectedcity = apincde[0].pincode_City_gid;
                    $scope.add.pincode1 = apincde[0].pincode_no;

                }
            }),
            function() {
                alert('No data!.');
            };
    };
    $scope.state_clk = function(state_gid, type) {
        debugger;
        var distddl = premises_service.getdistddl(state_gid)
        distddl.then(function(result) {
                if (type == 'address') {
                    $scope.adistrictddl = [];
                    $scope.adistrictddl = JSON.parse(result.data);
                } else {
                    $scope.distritddl = [];
                    $scope.distritddl = JSON.parse(result.data);
                }
            }),
            function() {
                alert('No data!.');
            };
    };
    $scope.district_clk = function(district_gid, type) {
        var ctyddl = premises_service.getcityddl(district_gid)
        ctyddl.then(function(result) {
                if (type == 'address') {
                    $scope.acity1 = [];
                    $scope.acity1 = JSON.parse(result.data);
                } else {
                    $scope.city1 = [];
                    $scope.city1 = JSON.parse(result.data);
                }
            }),
            function() {
                alert('No data!.');
            };
    };
    $scope.city_clk = function(city_gid, type) {
        var pincd = premises_service.getpincode(city_gid)
        pincd.then(function(result) {
                if (type == 'address') {
                    var apincde = [];
                    apincde = JSON.parse(result.data);
                    $scope.add.pincode1 = apincde[0].pincode_no;
                } else {
                    var pincde = [];
                    pincde = JSON.parse(result.data);
                    $scope.pcode = pincde[0].pincode_no;
                }
            }),
            function() {
                alert('No data!.');
            };
    };

    var sttddl = premises_service.getstateddl()
    sttddl.then(function(result) {
        $scope.stateddl = [];
        $scope.stateddl = JSON.parse(result.data);
        $scope.locstate = JSON.parse(result.data);
      }),
    function() {
        alert('no data');
    };

    $scope.getemployee_srch= function(searchText) {
            var datas = {
                params: {
                    "Group": "GET_EMP_DATA",
                    "Limit" : 0 + "," + 30,
                    "Type": "EMPLOYEE",
                    "Sub_Type": "EMPLOYEE_ALL",
                    "json" : {
                        "Params": {
                                "FILTER": {
                                    "Employee_name":searchText,
                                },
                            }
                        }
                    }
                }
            return $http.post(Appname + '/employee_mst_data/' , datas).then(function(data) {
                return data.data.DATA;
              });
        };

    var branchdata = premises_service.getbranch();
     branchdata.then(function(result) {
            $scope.branch_data_all = result.data.DATA;
      }, function(err) {
      alert(res);
    });

    $scope.bank_check = function(e){
        if(e.is_kvb == 'Y'){
            e.bank_name = "KVB";
            e.branch_name = "KVB";
            $scope.other_bank = true;
        }
        else{
             e.bank_name = "";
             e.branch_name = "";
             $scope.other_bank = false;
        }
    }

    $scope.controll_office = gotocity;
        function gotocity(query) {
            var result = $filter('filter')($scope.branch_data_all, {
                'branch_name': query
            });
            return result;
    }

    $scope.account_type_data = [{
        id: 'Saving Account',
        data: 'Saving Account'
    }, {
        id: 'Current Account',
        data: 'Current Account'
    },{
        id: 'Non Residend Indian(NRI)',
        data: 'Non Residend Indian(NRI)'
    },
    {
        id: 'Non Residend Ordinary(NRO)',
        data: 'Non Residend Ordinary(NRO)'
    },
    {
        id: 'Hindu undivided Family(HUF)',
        data: 'Hindu undivided Family(HUF)'
    }];

    $scope.edit_landlord_data=function(landlord){
        debugger;
        $scope.edit_landlord="Y";
        $scope.landlord_gid=landlord.landlord_gid;
        $scope.all_data.landlord_name=landlord.landlord_name;
        $scope.all_data.landlord_panno=landlord.landlord_panno;
        $scope.all_data.landlord_gstno=landlord.landlord_gstno;
        $scope.landlord_constitution_gid=landlord.landlord_constitution;
        $scope.all_data.landlord_constitution=landlord.landlord_constitution_name;
        $scope.all_data.landlord_mobileno=landlord.landlord_mobileno;
        $scope.tdstype_gid=landlord.landlord_tdstype;
        $scope.all_data.tdstype=landlord.landlord_tdstype_name;
        $scope.all_data.tds_concession=landlord.landlord_tds_concession;
        $scope.all_data.poa_account=landlord.landlord_poa_account;
        $scope.all_data.landlord_nro=landlord.landlord_nro;
        $scope.all_data.landlord_nri=landlord.landlord_nri;
        $scope.all_data.landlord_localcontact=landlord.landlord_localcontact;
        $scope.all_data.landlord_emailid=landlord.landlord_emailid;
        $scope.all_data.landlord_tdsrate=landlord.landlord_tdsrate;

        $scope.add.addline=landlord.address_1;
        $scope.add.addline2=landlord.address_2;
        $scope.add.addline3=landlord.address_3;
        $scope.add.addselectedstate = landlord.address_state_gid;
        $scope.state_clk($scope.add.addselectedstate, 'address');
        $scope.add.addselecteddistrict = landlord.address_district_gid;
        $scope.district_clk($scope.add.addselecteddistrict, 'address');
        $scope.add.addselectedcity = landlord.address_city_gid;
        $scope.add.pincode1 = landlord.address_pincode;

    }

    $scope.edit_account_data=function(bank_data){
        $scope.edit_bank="Y";
        $scope.all_data.is_kvb=bank_data.account_kvbbank;
        $scope.all_data.bank_name=bank_data.account_bankname;
        $scope.all_data.branch_name=bank_data.account_branch;
        $scope.all_data.ifsc_code=bank_data.account_ifsccode;
        $scope.all_data.acount_type=bank_data.account_type;
        $scope.all_data.account_number=bank_data.account_no;
        $scope.bank_account_gid=bank_data.account_gid;

    }


    $scope.all_data.landlord_localcontact=="";
    $scope.save_details=function(type,action){
        debugger;
        $scope.execute=1;
        if(type=="LANDLORD" && action=="NEW"){
            if($scope.all_data.landlord_nri=="N"){
                $scope.all_data.landlord_localcontact="null"
            }
            else if($scope.all_data.landlord_nri=="Y"){
                if($scope.all_data.landlord_localcontact==undefined ){
                    alert("Give Local Contact");
                    $scope.execute=0;
                }
            }

            var datas={"group":"PREMISES","action":"ANY","type":"PREMISES_LANDLORD",
            "filter":{"propertygid": $scope.Premises_Property_Gid,"landlord_name": $scope.all_data.landlord_name,
            "landlord_panno": $scope.all_data.landlord_panno,
            "landlord_gstno":$scope.all_data.landlord_gstno,
            "landlord_constitution":$scope.landlord_constitution_gid,
            "tdstype": $scope.tdstype_gid,
            "landlord_tdsrate": $scope.all_data.landlord_tdsrate,
            "tds_concession": $scope.all_data.tds_concession,
            "landlord_mobileno":$scope.all_data.landlord_mobileno,
            "landlord_emailid":$scope.all_data.landlord_emailid,
            "landlord_nri": $scope.all_data.landlord_nri,
            "landlord_localcontact": $scope.all_data.landlord_localcontact,
            "landlord_nro":$scope.all_data.landlord_nro,"poa_account": $scope.all_data.poa_account,
            "landlord_address":[{
                    "address1":$scope.add.addline,
                    "address2":$scope.add.addline2,
                    "address3":$scope.add.addline3,
                    "pincode":$scope.add.pincode1,
                    "district_gid":$scope.add.addselecteddistrict,
                    "city_gid":$scope.add.addselectedcity,
                    "state_gid":$scope.add.addselectedstate}]}};
        }

        if(type=="LANDLORD" && action=="UPDATE"){
            if($scope.all_data.landlord_nri=="N"){
                $scope.all_data.landlord_localcontact="null"
            }
            else if($scope.all_data.landlord_nri=="Y"){
                if($scope.all_data.landlord_localcontact==undefined ){
                    alert("Give Local Contact");
                    $scope.execute=0;
                }
            }

            var datas={"group":"PREMISES","action":"ANY","type":"PREMISES_LANDLORD",
            "filter":{"landlord_gid": $scope.landlord_gid,
            "landlord_name": $scope.all_data.landlord_name,
            "landlord_panno": $scope.all_data.landlord_panno,
            "landlord_gstno":$scope.all_data.landlord_gstno,
            "landlord_constitution":$scope.landlord_constitution_gid,
            "tdstype": $scope.tdstype_gid,
            "landlord_tdsrate": $scope.all_data.landlord_tdsrate,
            "tds_concession": $scope.all_data.tds_concession,
            "landlord_mobileno":$scope.all_data.landlord_mobileno,
            "landlord_emailid":$scope.all_data.landlord_emailid,
            "landlord_nri": $scope.all_data.landlord_nri,
            "landlord_localcontact": $scope.all_data.landlord_localcontact,
            "landlord_nro":$scope.all_data.landlord_nro,"poa_account": $scope.all_data.poa_account,
            "landlord_address":[{
                    "address1":$scope.add.addline,
                    "address2":$scope.add.addline2,
                    "address3":$scope.add.addline3,
                    "pincode":$scope.add.pincode1,
                    "district_gid":$scope.add.addselecteddistrict,
                    "city_gid":$scope.add.addselectedcity,
                    "state_gid":$scope.add.addselectedstate}]}};
        }

        else if(type=="BANK_DETAILS" && action=="NEW"){
            if($scope.landlord_gid!=0){
                var datas={"group":"PREMISES","action":"ANY","type":"PREMISES_LANDLORD_ACCOUNT",
                "filter":{"landlordgid": $scope.landlord_gid,"kvbbank": $scope.all_data.is_kvb,
                "bankname": $scope.all_data.bank_name,"ifsccode": $scope.all_data.ifsc_code,
                "branch": $scope.all_data.branch_name,"account_type":$scope.all_data.acount_type,
                "account_no": $scope.all_data.account_number}};
            }
            else{
                alert("No Landlord");
            }
        }

         else if(type=="BANK_DETAILS" && action=="UPDATE"){
            if($scope.bank_account_gid!=0){
                var datas={"group":"PREMISES","action":"ANY","type":"PREMISES_LANDLORD_ACCOUNT",
                "filter":{"account_gid": $scope.bank_account_gid,"kvbbank": $scope.all_data.is_kvb,
                "bankname": $scope.all_data.bank_name,"ifsccode": $scope.all_data.ifsc_code,
                "branch": $scope.all_data.branch_name,"account_type":$scope.all_data.acount_type,
                "account_no": $scope.all_data.account_number}};
            }
            else{
                alert("No Bank Gid");
            }
        }

        if(type=="LANDLORD"){$scope.loading();}
        else if(type=="BANK_DETAILS"){$scope.loading_bank();}

        if($scope.execute==1){
            var popup_data = premises_service.premises_process_set(datas);
            popup_data.then(function(result) {
                var res=result.data.MESSAGE;
                 if (res=== "SUCCESS") {
                    $scope.all_data={};
                    alert("SUCCESS");
                    if(type=="LANDLORD"){
                        $scope.edit_landlord="N";
                        $scope.all_data={};
                        $scope.add={};
                        $scope.get_landlord();
                    }
                    else if(type=="BANK_DETAILS"){
                        $scope.edit_bank="N";
                        $scope.add_bank_details($scope.landlord_data);
                    }

                 } else
                 {
                    alert(JSON.stringify(result.data));
                 }
            }, function(err) {
              alert('Data Not Inserted');
            }).finally($scope.endloading);
        }

    }
    $scope.account_details=[];
    $scope.add_bank_details=function(landlord){
        debugger
        $scope.account_details=[];
        $scope.edit_bank="N";
        $scope.all_data={};
        $scope.landlord_data=landlord;
        $scope.landlord_gid=landlord.landlord_gid;

         var datas={"group":"PREMISES","action":"GET","type":"PREMISES_LANDLORD_ACCOUNT",
                "filter":{"landlordgid":$scope.landlord_gid}};
         $scope.loading_bank();
        var get_landlord = premises_service.premises_process_get(datas);
        get_landlord.then(function(result) {
            $scope.endloading();
            var res=result.data;
            $scope.account_details=res;
            console.log($scope.account_details);
        }, function(err) {
            $scope.endloading();
          alert('No Data');
        }).finally($scope.endloading);
        modalshow('landlord_accout_popup');

    }




}]);
myApp.service("premises_service", function ($http) {
    this.getpincodeall = function(pincode) {
        var response = $http.get(Appname + "/allpinget/", {
            params: {
                "pincode": pincode
            }
        });
        return response;
    }

    this.getdistddl = function(state_gid) {
        var response = $http.get(Appname + "/districtddl/", {
            params: {
                "state_gid": state_gid
            }
        });
        return response;
    }

    this.getcityddl = function(district_gid) {
        var response = $http.get(Appname + "/cityddl/", {
            params: {
                "district_gid": district_gid
            }
        });
        return response;
    }

    this.getpincode = function(city_gid) {
        var response = $http.get(Appname + "/pincode/", {
            params: {
                "city_gid": city_gid
            }
        });
        return response;
    }

    this.getstateddl = function(d) {
        var response = $http.get(Appname + "/stateddl/");
        return response;
    }

    this.premises_process_set=function (data) {
        var response=$http.post(Appname+"/Set_premises/",data);
        return response;
    }
    this.get_session_expense = function (data) {
        var response=$http.post(Appname+"/Session_Get_Expnese_Data/",data);
        return response;
    }

    this.premises_process_get=function (data) {
        var response=$http.post(Appname+"/Get_premises/",data);
        return response;
    }

    this.getbranch = function () {
        var response=$http.post(Appname+"/get_branch_data/");
        return response;
    }

 });

















































</script>
<style>
    .app-modal-window .modal-dialog {
    width: 1000px;
}

.md-virtual-repeat-container.md-autocomplete-suggestions-container {
     width:500px !important;
}


.C{
 background-color: #B3FFC1 !important;
}

.D{
 background-color: #FFBDF3 !important;
}


















































</style>
{% endblock %}