{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %} Premises Occupancy Details {% endblock %}
{% block content %}
{% csrf_token %}
{% verbatim %}
<div class="maincontent">
    <div ng-app="branch_exp" ng-controller="premises" class="container container1">
        <div class="row">
            <div class="row-header col-lg-12 col-sm-12">
                <h4>Premises Occupancy Details </h4>
            </div>
        </div>
        <form name="premises_form" novalidate>
            <div class="row">
                <div class="col-md-12">

                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer" ng-show="pro_no == 0">
                            <label>Occupancy ID</label>
                            <input disabled value="NEW"

                                   type="text"/>
                        </md-input-container>
                        <md-input-container class="md-block inputcontainer" ng-show="pro_no != 0">
                            <label>Occupancy ID</label>
                            <input disabled ng-model="unit_no"
                                   maxlength="60"/>
                        </md-input-container>

                    </div>
                    <div class="col-md-3">
                        <md-autocomplete md-clear-button="true"
                                         md-floating-label="Occupancy Usage"
                                         md-item-text="item1.dropdowndetails_name"
                                         md-items="item1 in unit_occupancyusage(search_unit_usage)"
                                         md-menu-class="md-virtual-repeat-container"
                                         md-min-length=0
                                         md-no-cache="true"
                                         md-search-text="search_unit_usage"
                                         md-selected-item="unit_usage"
                                         md-selected-item-change="unit_occupancyusage_change(item1.dropdowndetails_gid)">
                            <md-item-template>
                                <span md-highlight-text="search_unit_usage"> {{item1.dropdowndetails_name}}</span>
                            </md-item-template>
                            <md-not-found>
                                No Employee matching "{{search_unit_usage}}" were found.
                            </md-not-found>
                        </md-autocomplete>
                    </div>
                    <div class="col-md-3">
                        <md-autocomplete md-clear-button="true"
                                         md-floating-label="Ownership"
                                         md-item-text="item2.dropdowndetails_name"
                                         md-items="item2 in unit_ownershipdata(search_unit_ownership)"
                                         md-menu-class="md-virtual-repeat-container"
                                         md-min-length=0
                                         md-no-cache="true"
                                         md-search-text="search_unit_ownership"
                                         md-selected-item="unit_ownership"
                                         md-selected-item-change="unit_ownership_changed(item2.dropdowndetails_gid)">
                            <md-item-template>
                                <span md-highlight-text="search_unit_ownership"> {{item2.dropdowndetails_name}}</span>
                            </md-item-template>
                            <md-not-found>
                                No Employee matching "{{search_unit_ownership}}" were found.
                            </md-not-found>
                        </md-autocomplete>
                    </div>

                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Floor/s located</label>
                            <input ng-model="unit_floor"
                                   ng-change="" maxlength="60"/>
                        </md-input-container>
                    </div>
                </div>
            </div>


            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Area Occupied Usagewise</label>
                            <input ng-model="unit_area_occupied_usage" valid-number only-numbers
                                   ng-change="" maxlength="60"/>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-autocomplete md-clear-button="true"
                                         md-floating-label="Branch Classification"
                                         md-item-text="item3.dropdowndetails_name"
                                         md-items="item3 in unit_branchclassification(search_branchclassification)"
                                         md-menu-class="md-virtual-repeat-container"
                                         md-min-length=0
                                         md-no-cache="true"
                                         md-search-text="search_branchclassification"
                                         md-selected-item="branchclassification"
                                         md-selected-item-change="unit_branchclassification_changed(item3.dropdowndetails_gid)">
                            <md-item-template>
                                <span md-highlight-text="search_control_office"> {{item3.dropdowndetails_name}}</span>
                            </md-item-template>
                            <md-not-found>
                                No Employee matching "{{search_branchclassification}}" were found.
                            </md-not-found>
                        </md-autocomplete>

                    </div>

                    <div class="col-md-3">
                        <md-autocomplete md-clear-button="true"
                                         md-floating-label="Branch Window Type"
                                         md-item-text="item4.dropdowndetails_name"
                                         md-items="item4 in unit_branchwindowtype(search_branchwindowtype)"
                                         md-menu-class="md-virtual-repeat-container"
                                         md-min-length=0
                                         md-no-cache="true"
                                         md-selected-item="branchwindowtype"
                                         md-search-text="search_branchwindowtype"
                                         md-selected-item-change="unit_branchwindowtype_changed(item4.dropdowndetails_gid)">
                            <md-item-template>
                                <span md-highlight-text="search_control_office"> {{item4.dropdowndetails_name}}</span>
                            </md-item-template>
                            <md-not-found>
                                No Employee matching "{{search_branchwindowtype}}" were found.
                            </md-not-found>
                        </md-autocomplete>
                    </div>
                    <div class="col-md-3">
                        <md-autocomplete md-clear-button="true"
                                         md-floating-label="Branch Location Other Than Regular"
                                         md-item-text="item5.dropdowndetails_name"
                                         md-items="item5 in unit_branchlocation(search_branchlocation)"
                                         md-menu-class="md-virtual-repeat-container"
                                         md-min-length=0
                                         md-no-cache="true"
                                         md-search-text="search_branchlocation"
                                         md-selected-item="branchlocation"
                                         md-selected-item-change="unit_branchlocation_changed(item5.dropdowndetails_gid)">
                            <md-item-template>
                                <span md-highlight-text="search_control_office"> {{item5.dropdowndetails_name}}</span>
                            </md-item-template>
                            <md-not-found>
                                No Employee matching "{{search_branchlocation}}" were found.
                            </md-not-found>
                        </md-autocomplete>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-3">
                        <md-autocomplete md-clear-button="true"
                                         md-floating-label="Strong Room As Per RBI Norms"
                                         md-item-text="item6.dropdowndetails_name"
                                         md-items="item6 in unit_strongroom_rbinorms(search_strongroom_rbinorms)"
                                         md-menu-class="md-virtual-repeat-container"
                                         md-min-length=0
                                         md-no-cache="true"
                                         md-search-text="search_strongroom_rbinorms"
                                         md-selected-item="strongroom_rbinorms"
                                         md-selected-item-change="unit_strongroom_rbinorms_changed(item6.dropdowndetails_gid)">
                            <md-item-template>
                                <span md-highlight-text="search_strongroom_rbinorms"> {{item6.dropdowndetails_name}}</span>
                            </md-item-template>
                            <md-not-found>
                                No Employee matching "{{search_strongroom_rbinorms}}" were found.
                            </md-not-found>
                        </md-autocomplete>
                    </div>
                    <div class="col-md-3">
                        <md-autocomplete md-clear-button="true"
                                         md-floating-label="Safe Room Partion"
                                         md-item-text="item7.dropdowndetails_name"
                                         md-items="item7 in unit_saferoom_partion(search_saferoom_partion)"
                                         md-menu-class="md-virtual-repeat-container"
                                         md-min-length=0
                                         md-no-cache="true"
                                         md-search-text="search_saferoom_partion"
                                         md-selected-item="saferoom_partion"
                                         md-selected-item-change="unit_saferoom_partion_changed(item7.dropdowndetails_gid)">
                            <md-item-template>
                                <span md-highlight-text="search_saferoom_partion"> {{item7.dropdowndetails_name}}</span>
                            </md-item-template>
                            <md-not-found>
                                No Employee matching "{{search_saferoom_partion}}" were found.
                            </md-not-found>
                        </md-autocomplete>
                    </div>

                    <div class="col-md-3">
                        <md-autocomplete md-clear-button="true"
                                         md-floating-label="Risk Category"
                                         md-item-text="item9.dropdowndetails_name"
                                         md-items="item9 in unit_ristcategory(search_ristcategory)"
                                         md-menu-class="md-virtual-repeat-container"
                                         md-min-length=0
                                         md-no-cache="true"
                                         md-search-text="search_ristcategory"
                                         md-selected-item="ristcategory"
                                         md-selected-item-change="unit_ristcategory_changed(item9.dropdowndetails_gid)">
                            <md-item-template>
                                <span md-highlight-text="search_ristcategory"> {{item9.dropdowndetails_name}}</span>
                            </md-item-template>
                            <md-not-found>
                                No DATA matching "{{search_ristcategory}}" were found.
                            </md-not-found>
                        </md-autocomplete>
                    </div>
                    <div class="col-md-3" ng-show="unit_no != 0">
                        <md-button class="md-raised custbutton" value="submit"
                                   ng-click="add_aminites_popup()">
                            Add Amenities
                        </md-button>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div ng-include="'empadrs'"></div>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-md-12 text-center">
                    <md-button class="btn btn-info custbutton"
                               ng-hide="unit_no != 0 || Page_Name=='Premises_Approval_Summary'"
                               ng-click="submit_data('NEW')"
                               ng-disabled="premises_form.$invalid">
                        Submit
                        <md-tooltip>Submit</md-tooltip>
                    </md-button>
                    <md-button class="md-raised"
                               ng-hide="unit_no == 0 || Page_Name=='Premises_Approval_Summary'"
                               ng-click="submit_data('UPDATE')"
                               ng-disabled="premises_form.$invalid">
                        Update
                    </md-button>
                    <md-button class="md-raised" ng-href="BranchExp/Br_Premises_Create"
                               type="button">Back
                    </md-button>
                </div>
            </div>
        </form>
        <div class="modal fade" id="aminites_popup" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-sm" role="document" style="width:90%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabels4">
                            Amenities & Infrastructure
                            <button type="button" class="close" data-dismiss="modal"
                                    ng-click=""
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="body">
                        <br/>
                        <form name="amenities_form" novalidate>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-3">
                                        <md-autocomplete md-clear-button="true"
                                                         md-floating-label="Amenities Name"
                                                         md-item-text="item8.dropdowndetails_name"
                                                         md-items="item8 in unit_amenities_name(search_amenities_name)"
                                                         md-menu-class="md-virtual-repeat-container"
                                                         md-min-length=0
                                                         md-no-cache="true"
                                                         ng-required="true"
                                                         md-search-text="search_amenities_name"
                                                         md-selected-item="all_data.amenities_name"
                                                         md-selected-item-change="unit_ameniteis_changge(item8.dropdowndetails_gid)">
                                            <md-item-template>
                                                <span md-highlight-text="search_amenities_name"> {{item8.dropdowndetails_name}}</span>
                                            </md-item-template>
                                            <md-not-found>
                                                No DATA matching "{{search_amenities_name}}" were found.
                                            </md-not-found>
                                        </md-autocomplete>
                                    </div>
                                    <div class="col-md-3">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Remarks</label>
                                            <input ng-model="all_data.amenities_remarks" required
                                                   maxlength="30"/>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-5">
                                        <md-button class="md-raised custbutton" value="submit"
                                                   ng-disabled="amenities_form.$invalid"
                                                   ng-hide="edit_amenities=='Y' || Page_Name=='Premises_Approval_Summary'"
                                                   ng-click="save_data('AMENITIES','NEW')">
                                            Save
                                        </md-button>

                                        <md-button class="md-raised" value="submit"
                                                   ng-disabled="amenities_form.$invalid"
                                                   ng-hide="edit_amenities=='N' || Page_Name=='Premises_Approval_Summary'"
                                                   ng-click="save_data('AMENITIES','UPDATE')">
                                            Update
                                        </md-button>

                                        <md-button class="md-raised md-warn" value="close" data-dismiss="modal"
                                                   aria-label="Close">Cancel
                                        </md-button>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <div class="row table-responsive">
                            <div class="col-md-12 col-lg-12 col-sm-12">
                                <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                       md-progress="deferred">
                                    <thead class="header">
                                    <tr>
                                        <th>S.No</th>
                                        <th>Amenities Name</th>
                                        <th>Amenities Remark</th>
                                        <th>Edit</th>
                                    </tr>
                                    <tr ng-show="amenities_details.length == 0">
                                        <td class="warning" colspan="10">
                                            No Records Found.
                                        </td>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr align="center"
                                        ng-repeat="amenities in amenities_details.slice(((arrear_currentPage-1)*arrear_itemsPerPage),((arrear_currentPage)*arrear_itemsPerPage)) | filter:search:strict">
                                        <td>
                                            <center>
                                                {{((arrear_currentPage-1)*arrear_itemsPerPage)+$index+1}}
                                            </center>
                                        </td>
                                        <td>{{amenities.amenities_name}}</td>
                                        <td>{{amenities.amenities_remarks}}</td>
                                        <td>
                                            <span class="editlink material-icons"
                                                  ng-click="edit_amenities_data(amenities)">edit
                                        </span>
                                        </td>
                                    </tr>
                                    </tbody>
                                    <tfoot>
                                    <tr align="center">
                                        <td colspan="3">
                                            <ul uib-pagination
                                                total-items="amenities_details.length"
                                                ng-model="arrear_currentPage"
                                                max-size="arrear_maxSize"
                                                class="pagination-sm"
                                                boundary-links="true"
                                                items-per-page="arrear_itemsPerPage"></ul>
                                        </td>
                                        <td colspan="1">
                                            Total Records:{{amenities_details.length}}
                                        </td>
                                    </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endverbatim %}
<script>
var myApp = angular.module('branch_exp', ['ngMaterial','ui.bootstrap','ngMessages','AppCommon']).config(function($httpProvider) {
    $httpProvider.defaults.xsrfCookieName = 'csrftoken';
    $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
});

myApp.run(function($mdDateLocale, $filter) {
    $mdDateLocale.formatDate = function(date) {
        return $filter('date')(date, "dd-MMM-yyyy");
    };
})

myApp.controller('premises', ['$scope','premises_service','$mdDialog','$window','$filter','$http',
function($scope,premises_service,$mdDialog,$window,$filter,$http) {
    $scope.currentPage=1;
    $scope.maxSize=3;
    $scope.itemsPerPage=10;
    $scope.Unit= [];
    $scope.Premises_Unit_Gid=0;
    $scope.Branch_Premises_Gid=0;
    $scope.unit_no=0;

    $scope.arrear_currentPage=1;
    $scope.arrear_maxSize=3;
    $scope.arrear_itemsPerPage=10;

    $scope.unit_gid =0;
    $scope.unit_usage_gid=0;
    $scope.unit_ownership_gid =0;
    $scope.branchclassification_gid =0;
    $scope.branchwindowtype_gid =0;
    $scope.branchlocation_gid =0;
    $scope.strongroom_rbinorms_gid =0;
    $scope.saferoom_partion_gid =0;
    $scope.ristcategory_gid =0;
    $scope.all_data={};


    $scope.loading = function() {
        $mdDialog.show({
            templateUrl: 'loaderSpinner',
            parent: angular.element(document.body),
            clickOutsideToClose: false
        });
    };

    $scope.loading_aminites = function() {
        $mdDialog.show({
            templateUrl: 'loaderSpinner',
            parent: angular.element(document.getElementById('aminites_popup')),
            clickOutsideToClose: false
        });
    };

    $scope.endloading = function() {
        $mdDialog.hide();
    };

    $scope.get_Premises_Data = function(){
    debugger;
        var datas = {"action":"GET","type":"BRANCH_EXPENSE_GID",
        "filter": {"Premises_Unit_Gid":"","Branch_Premises_Gid":"","Branch_Premises_Page":""}}

        var setcolumndata = premises_service.get_session_expense(datas);
            setcolumndata.then(function(result) {
            $scope.Branch_Premises_Gid=result.data.Branch_Premises_Gid;
            $scope.Premises_Unit_Gid=result.data.Premises_Unit_Gid;
            $scope.Page_Name=result.data.Branch_Premises_Page;
            console.log(result.data);
            if($scope.Branch_Premises_Gid!=0){
                $scope.execute_premises=1;
                if($scope.Premises_Unit_Gid!=0){
                     $scope.get_Unit_Data();
                }

            }
            else{
                alert("No Premises");
            }
        },
       function(err) {
            alert("No Premises Gid");
       }).finally($scope.endloading);
    }
    $scope.get_Premises_Data();

    $scope.get_Unit_Data=function(){
            $scope.loading();
             var datas={"group":"PREMISES","action":"GET","type":"PREMISES_UNIT_DTL",
                    "filter":{"unitgid":$scope.Premises_Unit_Gid}};
            var property_data= premises_service.premises_process_get(datas);
            property_data.then(function(result) {
                var res=result.data[0];
                    $scope.unit_gid = res.unit_gid;
                    console.log(res);
                    $scope.property_gid = res.property_gid;
                    $scope.unit_floor = res.unit_floor;

                    $scope.unit_usage = res.occupancy_usage;
                    $scope.unit_usage_gid=res.unit_usage;

                    $scope.unit_no = res.unit_no;
                    $scope.add.addline=res.address_1;
                    $scope.add.addline2=res.address_2;
                    $scope.add.addline3=res.address_3;
                    $scope.add.addselectedstate = res.address_state_gid;
                    $scope.state_clk($scope.add.addselectedstate, 'address');
                    $scope.add.addselecteddistrict = res.address_district_gid;
                    $scope.district_clk($scope.add.addselecteddistrict, 'address');
                    $scope.add.addselectedcity = res.address_city_gid;
                    $scope.add.pincode1 = res.address_pincode;

                    $scope.unit_ownership = res.occupancy_ownership;
                    $scope.unit_ownership_gid = res.unit_ownership;

                    $scope.unit_area_occupied_usage = res.unit_area;

                    $scope.branchclassification = res.branchclassification;
                    $scope.branchclassification_gid = res.unit_branchclassification;

                    $scope.branchwindowtype = res.branchwindowtype;
                    $scope.branchwindowtype_gid = res.unit_branchwindowtype;

                    $scope.branchlocation = res.branchlocation;
                    $scope.branchlocation_gid = res.unit_branchlocation;

                    $scope.strongroom_rbinorms = res.strongroom_rbinorms;
                    $scope.strongroom_rbinorms_gid = res.unit_strongroom_rbinorms;

                    $scope.saferoom_partion = res.saferoom_partion;
                    $scope.saferoom_partion_gid = res.unit_saferoom_partion;

                    $scope.ristcategory = res.riskcategory;
                    $scope.ristcategory_gid = res.unit_riskcategory;
            }, function(err) {
              alert('No Data');
            }).finally($scope.endloading);
    }

    $scope.submit_data = function(type){
        if(type=="NEW"){
            var data = {
                "group":"PREMISES",
                "action":"INSERT",
                "type":"PREMISES_UNIT",
                 "filter":{
                        "premisesgid":$scope.Branch_Premises_Gid,
                        "unit_usage":$scope.unit_usage_gid,
                        "ownership":$scope.unit_ownership_gid,
                        "unit_floor":$scope.unit_floor,
                        "unit_area":$scope.unit_area_occupied_usage,
                        "unit_address":[{
                            "address1":$scope.add.addline,
                            "address2":$scope.add.addline2,
                                "address3":$scope.add.addline3,
                            "pincode":$scope.add.pincode1,
                            "district_gid":$scope.add.addselecteddistrict,
                            "city_gid":$scope.add.addselectedcity,
                            "state_gid":$scope.add.addselectedstate}],
                        "branchclassification":$scope.branchclassification_gid,
                        "branchwindowtype":$scope.branchwindowtype_gid,
                        "branchlocation":$scope.branchlocation_gid,
                        "strongroom_rbinorms":$scope.strongroom_rbinorms_gid,
                        "saferoom_partion":$scope.saferoom_partion_gid,
                        "riskcategory":$scope.ristcategory_gid
                 }
            }
        }
        else if(type=="UPDATE"){
            var data = {
                "group":"PREMISES",
                "action":"INSERT",
                "type":"PREMISES_UNIT",
                 "filter":{
                        "unit_gid":$scope.unit_gid,
                        "unit_usage":$scope.unit_usage_gid,
                        "ownership":$scope.unit_ownership_gid,
                        "unit_floor":$scope.unit_floor,
                        "unit_area":$scope.unit_area_occupied_usage,
                        "unit_address":[{
                            "address1":$scope.add.addline,
                            "address2":$scope.add.addline2,
                                "address3":$scope.add.addline3,
                            "pincode":$scope.add.pincode1,
                            "district_gid":$scope.add.addselecteddistrict,
                            "city_gid":$scope.add.addselectedcity,
                            "state_gid":$scope.add.addselectedstate}],
                        "branchclassification":$scope.branchclassification_gid,
                        "branchwindowtype":$scope.branchwindowtype_gid,
                        "branchlocation":$scope.branchlocation_gid,
                        "strongroom_rbinorms":$scope.strongroom_rbinorms_gid,
                        "saferoom_partion":$scope.saferoom_partion_gid,
                        "riskcategory":$scope.ristcategory_gid
                 }
            }
        }

        $scope.loading();
        var unit_set = premises_service.premises_process_set(data);
        unit_set.then(function(result) {
        var res=result.data.MESSAGE;
            if (res=== "SUCCESS") {
                 alert("SUCCESS");
                 $window.location.href = "BranchExp/Br_Premises_Create";
            } else {
                alert(JSON.stringify(result.data));
            }
        }, function(err) {
          alert('Data Not Inserted');
        }).finally($scope.endloading);
    };



    $scope.add = [];
    $scope.pinchange = function(pincode, type) {
        var pincd = premises_service.getpincodeall(pincode)
        pincd.then(function(result) {
                if (type == 'address') {
                    var apincde = [];
                    apincde = JSON.parse(result.data);
                    $scope.add.addselectedstate = apincde[0].city_state_gid;
                    $scope.state_clk($scope.add.addselectedstate, 'address');
                    $scope.add.addselecteddistrict = apincde[0].pincode_district_gid;
                    $scope.district_clk($scope.add.addselecteddistrict, 'address');
                    $scope.add.addselectedcity = apincde[0].pincode_City_gid;
                    $scope.add.pincode1 = apincde[0].pincode_no;

                }
            }),
            function() {
                alert('No data!.');
            };
    };
    $scope.state_clk = function(state_gid, type) {
        debugger;
        var distddl = premises_service.getdistddl(state_gid)
        distddl.then(function(result) {
                if (type == 'address') {
                    $scope.adistrictddl = [];
                    $scope.adistrictddl = JSON.parse(result.data);
                } else {
                    $scope.distritddl = [];
                    $scope.distritddl = JSON.parse(result.data);
                }
            }),
            function() {
                alert('No data!.');
            };
    };
    $scope.district_clk = function(district_gid, type) {
        var ctyddl = premises_service.getcityddl(district_gid)
        ctyddl.then(function(result) {
                if (type == 'address') {
                    $scope.acity1 = [];
                    $scope.acity1 = JSON.parse(result.data);
                } else {
                    $scope.city1 = [];
                    $scope.city1 = JSON.parse(result.data);
                }
            }),
            function() {
                alert('No data!.');
            };
    };
    $scope.city_clk = function(city_gid, type) {
        var pincd = premises_service.getpincode(city_gid)
        pincd.then(function(result) {
                if (type == 'address') {
                    var apincde = [];
                    apincde = JSON.parse(result.data);
                    $scope.add.pincode1 = apincde[0].pincode_no;
                } else {
                    var pincde = [];
                    pincde = JSON.parse(result.data);
                    $scope.pcode = pincde[0].pincode_no;
                }
            }),
            function() {
                alert('No data!.');
            };
    };

    var sttddl = premises_service.getstateddl()
    sttddl.then(function(result) {
        $scope.stateddl = [];
        $scope.stateddl = JSON.parse(result.data);
        $scope.locstate = JSON.parse(result.data);
      }),
    function() {
        alert('no data');
    };


    $scope.unit_branchclassification = function(query) {
        var branch_classification = {
            "group":"PREMISES",
            "action":"GET",
            "type":"PREMISES_COMMON_DROPDOWN",
            "filter":{
                "dropdown_name": "Branch Classification"
            }
        }
        return $http.post(Appname + '/Get_premises/' , branch_classification).then(function(data) {
            var final_values=data.data;
            return final_values;
          });
    };

    $scope.unit_branchclassification_changed=function(branch_class_data){
        if(branch_class_data!=undefined){
            $scope.branchclassification_gid=branch_class_data;

        }
    }

    $scope.unit_branchwindowtype = function(query) {
        var branch_windowtype = {
            "group":"PREMISES",
            "action":"GET",
            "type":"PREMISES_COMMON_DROPDOWN",
            "filter":{
                "dropdown_name": "Branch Window Type"
            }
        }
        return $http.post(Appname + '/Get_premises/' , branch_windowtype).then(function(data) {
                var final_values=data.data;
                return final_values;
              });
    };

    $scope.unit_branchwindowtype_changed=function(window){
        if(window!=undefined){
            $scope.branchwindowtype_gid=window;
        }
    }

    $scope.unit_branchlocation = function(query) {
    var branch_location = {
        "group":"PREMISES",
        "action":"GET",
        "type":"PREMISES_COMMON_DROPDOWN",
        "filter":{
            "dropdown_name": "Branch Location"
        }
    }
    return $http.post(Appname + '/Get_premises/' , branch_location).then(function(data) {
                var final_values=data.data;
                return final_values;
              });
    };

    $scope.unit_branchlocation_changed=function(branch_locaiton){
        if(branch_locaiton!=undefined){
            $scope.branchlocation_gid=branch_locaiton;
        }

    }

    $scope.unit_occupancyusage = function(query) {
        var unit_occupancyusage = {
            "group":"PREMISES",
            "action":"GET",
            "type":"PREMISES_COMMON_DROPDOWN",
            "filter":{
                "dropdown_name": "Occupancy Usage"
            }
        }
        return $http.post(Appname + '/Get_premises/' , unit_occupancyusage).then(function(data) {
                var final_values=data.data;
                return final_values;
              });
    };

    $scope.unit_occupancyusage_change=function(unit){
        debugger;
        if(unit!=undefined){
            $scope.unit_usage_gid=unit;

        }
    }

    $scope.unit_ownershipdata = function(query) {
        var unit_ownership2 = {
            "group":"PREMISES",
            "action":"GET",
            "type":"PREMISES_COMMON_DROPDOWN",
            "filter":{
                "dropdown_name": "Ownership"
            }
        }
        return $http.post(Appname + '/Get_premises/' , unit_ownership2).then(function(data) {
                var final_values=data.data;
                return final_values;
              });
    };
    $scope.unit_ownership_changed=function(owner_ship_data){
        if(owner_ship_data!=undefined){
            $scope.unit_ownership_gid=owner_ship_data;
        }
    }

    $scope.unit_strongroom_rbinorms = function(query) {
        var unit_ownership2 = {
            "group":"PREMISES",
            "action":"GET",
            "type":"PREMISES_COMMON_DROPDOWN",
            "filter":{
                "dropdown_name": "Strong Room as per RBI norms"
            }
        }
        return $http.post(Appname + '/Get_premises/' , unit_ownership2).then(function(data) {
                var final_values=data.data;
                return final_values;
              });
    };

    $scope.unit_strongroom_rbinorms_changed=function(strong_rbinorms){
        if(strong_rbinorms!=undefined){
            $scope.strongroom_rbinorms_gid=strong_rbinorms;
        }
    }

    $scope.unit_saferoom_partion = function(query) {
        var unit_ownership2 = {
            "group":"PREMISES",
            "action":"GET",
            "type":"PREMISES_COMMON_DROPDOWN",
            "filter":{
                "dropdown_name": "Safe Room Partion"
            }
        }
        return $http.post(Appname + '/Get_premises/' , unit_ownership2).then(function(data) {
                var final_values=data.data;
                return final_values;
              });
    };

    $scope.unit_saferoom_partion_changed=function(saferoom){
        if(saferoom!=undefined){
            $scope.saferoom_partion_gid=saferoom;
        }

    }

    $scope.unit_ristcategory = function(query) {
        var unit_ownership2 = {
            "group":"PREMISES",
            "action":"GET",
            "type":"PREMISES_COMMON_DROPDOWN",
            "filter":{
                "dropdown_name": "Risk Category"
            }
        }
        return $http.post(Appname + '/Get_premises/' , unit_ownership2).then(function(data) {
                var final_values=data.data;
                return final_values;
              });
    };
    $scope.unit_ristcategory_changed=function(risk){
        if(risk!=undefined){
            $scope.ristcategory_gid=risk;
        }
    }

    $scope.unit_amenities_name = function(query) {
        var amenities_name = {
            "group":"PREMISES",
            "action":"GET",
            "type":"PREMISES_COMMON_DROPDOWN",
            "filter":{
                "dropdown_name": "Amenities"
            }
        }
        return $http.post(Appname + '/Get_premises/' , amenities_name).then(function(data) {
                var final_values=data.data;
                return final_values;
              });
    };

    $scope.unit_ameniteis_changge=function(amenities){
        if(amenities!=undefined){
            $scope.amenities_name_gid=amenities;
        }

    }

    $scope.add_aminites_popup = function(){
        $scope.amenities_details=[];
        $scope.edit_amenities="N";
         var datas={"group":"PREMISES","action":"GET","type":"AMENITIES_DETAIL",
                "filter":{"unitgid":$scope.unit_gid}};
         $scope.loading_aminites();
        var get_aminites = premises_service.premises_process_get(datas);
        get_aminites.then(function(result) {
            $scope.endloading();
            var res=result.data;
            $scope.amenities_details=res;
            console.log( $scope.amenities_details);
        }, function(err) {
            $scope.endloading();
          alert('No Data');
        }).finally($scope.endloading);
        modalshow('aminites_popup');
    }

    $scope.edit_amenities_data=function(amenities){
        $scope.edit_amenities="Y";
        $scope.amenities_gid=amenities.amenities_gid;
        $scope.amenities_name_gid=amenities.amenities_name_gid;
        $scope.all_data.amenities_name=amenities.amenities_name;
        $scope.all_data.amenities_remarks=amenities.amenities_remarks;

    }

    $scope.save_data=function(type,action){
        if(type=="AMENITIES" && action=="NEW"){
            if($scope.agreement_gid!=0){
                var datas={"group":"PREMISES","action":"ANY","type":"PREMISES_AMENITIES",
                           "filter":{"amenities_unitgid": $scope.unit_gid,
                            "amenities_name":$scope.amenities_name_gid,
                            "amenities_remarks":$scope.all_data.amenities_remarks}};
            }
            else{
                alert("No Agreement Data");
            }
        }
        else if(type=="AMENITIES" && action=="UPDATE"){
            if($scope.agreement_gid!=0){
                var datas={"group":"PREMISES","action":"ANY","type":"PREMISES_AMENITIES",
                           "filter":{"amenities_gid": $scope.amenities_gid,
                            "amenities_name":$scope.amenities_name_gid,
                            "amenities_remarks":$scope.all_data.amenities_remarks}};
            }
            else{
                alert("No Agreement Data");
            }
        }

        if(type=="AMENITIES"){$scope.loading_aminites();}
        var premises_creation = premises_service.premises_process_set(datas);
        premises_creation.then(function(result) {
            var res=result.data.MESSAGE;
             if (res=== "SUCCESS") {
                $scope.all_data={};
                 alert("SUCCESS");
                 if(type=="AMENITIES"){
                    $scope.add_aminites_popup();
                 }
             }
             else
             {
                alert(JSON.stringify(result.data));
             }
        }, function(err) {
          alert('Data Not Inserted');
        }).finally($scope.endloading);
    }

}]);
myApp.service("premises_service", function ($http) {
    this.getpincodeall = function(pincode) {
        var response = $http.get(Appname + "/allpinget/", {
            params: {
                "pincode": pincode
            }
        });
        return response;
    }

    this.getdistddl = function(state_gid) {
        var response = $http.get(Appname + "/districtddl/", {
            params: {
                "state_gid": state_gid
            }
        });
        return response;
    }

    this.getcityddl = function(district_gid) {
        var response = $http.get(Appname + "/cityddl/", {
            params: {
                "district_gid": district_gid
            }
        });
        return response;
    }

    this.getpincode = function(city_gid) {
        var response = $http.get(Appname + "/pincode/", {
            params: {
                "city_gid": city_gid
            }
        });
        return response;
    }

    this.getstateddl = function(d) {
        var response = $http.get(Appname + "/stateddl/");
        return response;
    }

    this.premises_process_set=function (data) {
        var response=$http.post(Appname+"/Set_premises/",data);
        return response;
    }

    this.premises_process_get=function (data) {
        var response=$http.post(Appname+"/Get_premises/",data);
        return response;
    }

    this.get_session_expense = function (data) {
        var response=$http.post(Appname+"/Session_Get_Expnese_Data/",data);
        return response;
    }
 });














</script>
<style>
.app-modal-window .modal-dialog {
    width: 1000px;
}
.C{
 background-color: #B3FFC1 !important;
}

.D{
 background-color: #FFBDF3 !important;
}














</style>
{% endblock %}