{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %} Budget Reviewer{% endblock %}
{% block content %}
{% csrf_token %}
{% verbatim %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<style>
    #tablediv {
        width: 100%;
        overflow-x: scroll;
        margin: 0;
        overflow-y: visible;
        padding: 0;
    }

    #td_left {
        text-align: left;
        font-weight: bolder;
        /* background-color: black; */
    }

    td {
        text-align: right;
        /* font-weight: bolder; */
        width: 500px;
    }

    #td_right {
        text-align: right;
    }

    #input_Table {
        width: 75px;
        border: none;
        border-bottom: 2px solid white;
        text-align: right;
    }
</style>

<body ng-app="PPR_report" ng-controller="myCtrl">
    <div class="maincontent">
        <div class="container container1">
            <div class="row">
                <div class="row-header col-lg-12 col-sm-12">
                    <h4>Budget Reviewer</h4>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-3 col-sm-3">
                    <md-input-container class="md-block inputcontainer md-input-has-placeholder md-input-has-value">
                        <form>
                            <div class="process">
                                <md-autocomplete md-clear-button="true" md-floating-label="Fin-Year"
                                    ng-disabled="finalBTN" md-input-maxlength="126"
                                    md-item-text="item.pprbudgetrequest_prev_finyear"
                                    md-items="item in fin_year | filter:finText" md-min-length="0" md-no-cache="true"
                                    md-search-text="finText" md-selected-item="fin_SelectedText"
                                    md-selected-item-change="" required="" md-has-not-found="true" tabindex="-1"
                                    class="ng-isolate-scope">
                                    <span md-highlight-text="finText"
                                        md-highlight-flags="^i">{{item.pprbudgetrequest_prev_finyear}}</span>
                                    <md-not-found>
                                        Not found.
                                    </md-not-found>
                                </md-autocomplete>
                            </div>
                            <div>
                                <div class="md-errors-spacer"></div>
                            </div>
                        </form>
                    </md-input-container>
                </div>
                <!-- BS -->
                <div class="col-lg-3 col-sm-3">
                    <md-input-container class="md-block inputcontainer md-input-has-placeholder md-input-has-value">
                        <form>
                            <div class="process">
                                <md-autocomplete md-clear-button="true" md-floating-label="BS" ng-disabled="BS_btn"
                                    md-input-maxlength="126" md-item-text="item.tbs_name"
                                    md-items="item in BS_item | filter:BS_text" md-min-length="0" md-no-cache="true"
                                    md-search-text="BS_text" md-selected-item="BS_selected" md-selected-item-change=""
                                    required="" md-has-not-found="true" tabindex="-1" class="ng-isolate-scope">
                                    <span md-highlight-text="BS_text" md-highlight-flags="^i">{{item.tbs_name}}</span>
                                    <md-not-found>
                                        Not found.
                                    </md-not-found>
                                </md-autocomplete>
                            </div>
                            <div>
                                <div class="md-errors-spacer"></div>
                            </div>
                        </form>
                    </md-input-container>
                </div>
                <!-- CC -->
                <div class="col-lg-3 col-sm-3">
                    <md-input-container class="md-block inputcontainer md-input-has-placeholder md-input-has-value">
                        <form>
                            <div class="process">
                                <md-autocomplete md-clear-button="true" md-floating-label="CC" ng-disabled="CC_btn"
                                    md-input-maxlength="126" md-item-text="item.tcc_name"
                                    md-items="item in CC_item | filter:CC_text" md-min-length="0" md-no-cache="true"
                                    md-search-text="CC_text" md-selected-item="CC_selected" md-selected-item-change=""
                                    required="" md-has-not-found="true" tabindex="-1" class="ng-isolate-scope">
                                    <span md-highlight-text="CC_text" md-highlight-flags="^i">{{item.tcc_name}}</span>
                                    <md-not-found>
                                        Not found.
                                    </md-not-found>
                                </md-autocomplete>
                            </div>
                            <div>
                                <div class="md-errors-spacer"></div>
                            </div>
                        </form>
                    </md-input-container>
                </div>
                <div class="col-md-1" style="margin-top:12px">
                    <button class="md-fab md-mini md-primary custbutton md-button md-ink-ripple" type="button"
                        ng-click="show_table()" aria-label="Search" md-labeled-by-tooltip="md-tooltip-3">
                        <md-icon class="ng-scope material-icons" role="img" aria-label="search">search</md-icon>
                    </button>
                </div>
            </div>

            <div class="row" style="padding: 10px;">

                <div class="col-lg-12 col-sm-12">
                    <div class="col-lg-6 col-sm-6" style="text-align: left;color: blue;">
                        <h4>{{future_Fin_year}}</h4>
                    </div>
                    <div class="col-lg-6 col-sm-6" style="text-align: right;color: blue;">
                        <h4>{{Amount_info}}</h4>
                    </div>


                </div>
            </div>

            <div class="row" id="tablediv" ng-hide="Monthly_table">
                <div class="col-md-12 col-lg-12 col-sm-12" style="padding: 0%;">
                    <div class="table-responsive" style="width: 3000px;">
                        <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                            md-progress="deferred">
                            <thead>
                                <!--  style="text-align: right;" -->
                                <tr>
                                    <th class="header">Direct Cost</th>
                                    <th class="header">YTD
                                        <div>
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td style="text-align: center;">
                                                            Bgt-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Act-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Bgt {{futur_start_endYear}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </th>
                                    <th class="header">Apr
                                        <div>
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td style="text-align: center;">
                                                            Bgt-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Act-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Bgt-{{future_fromYear}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </th>
                                    <th class="header">May
                                        <div>
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td style="text-align: center;">
                                                            Bgt-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Act-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Bgt-{{future_fromYear}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </th>
                                    <th class="header">Jun
                                        <div>
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td style="text-align: center;">
                                                            Bgt-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Act-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Bgt-{{future_fromYear}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </th>
                                    <th class="header">Jul
                                        <div>
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td style="text-align: center;">
                                                            Bgt-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Act-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Bgt-{{future_fromYear}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </th>
                                    <th class="header">Aug
                                        <div>
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td style="text-align: center;">
                                                            Bgt-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Act-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Bgt-{{future_fromYear}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </th>
                                    <th class="header">Sep
                                        <div>
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td style="text-align: center;">
                                                            Bgt-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Act-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Bgt-{{future_fromYear}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </th>
                                    <th class="header">Oct
                                        <div>
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td style="text-align: center;">
                                                            Bgt-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Act-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Bgt-{{future_fromYear}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </th>
                                    <th class="header">Nov
                                        <div>
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td style="text-align: center;">
                                                            Bgt-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Act-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Bgt-{{future_fromYear}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </th>
                                    <th class="header">Dec
                                        <div>
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td style="text-align: center;">
                                                            Bgt-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Act-{{start_year}}</td>
                                                        <td style="text-align: center;">
                                                            Bgt-{{future_fromYear}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </th>
                                    <th class="header">Jan
                                        <div>
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td style="text-align: center;">
                                                            Bgt-{{end_year}}</td>
                                                        <td style="text-align: center;">
                                                            Act-{{end_year}}</td>
                                                        <td style="text-align: center;">
                                                            Bgt-{{future_toYear}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </th>
                                    <th class="header">Feb
                                        <div>
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td style="text-align: center;">
                                                            Bgt-{{end_year}}</td>
                                                        <td style="text-align: center;">
                                                            Act-{{end_year}}</td>
                                                        <td style="text-align: center;">
                                                            Bgt-{{future_toYear}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </th>
                                    <th class="header">Mar
                                        <div>
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td style="text-align: center;">
                                                            Bgt-{{end_year}}</td>
                                                        <td style="text-align: center;">
                                                            Act-{{end_year}}</td>
                                                        <td style="text-align: center;">
                                                            Bgt-{{future_toYear}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody ng-repeat="x in Monthly_table_body">
                                <tr style="text-align: left" ng-model="row_index" ng-init="row_index=$index">
                                    <td id="td_left" ng-style="{'padding-left':{{x.Padding}}}">

                                        {{x['Direct Cost']}}
                                    </td>
                                    <td>
                                        <div>
                                            <!-- <div>{{x['YTD']}}</div> -->
                                            <div>
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                {{amount_money_convert(x['YTD'][0])}}
                                                            </td>
                                                            <td>
                                                                {{amount_money_convert(x['YTD'][1])}}
                                                            </td>

                                                            <td ng-if="x['reviewerIN'] == true">
                                                                <div>
                                                                    <input type="text" id="input_Table"
                                                                        ng-model="x['YTD'][2]"
                                                                        ng-blur="YTD_fun(x['YTD'][2],row_index)">
                                                                </div>
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] != true">
                                                                <div style="width: 75px;">

                                                                </div>
                                                            </td>

                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div>
                                            <div>
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                {{amount_money_convert(x['Apr-'.concat(start_year)][0])}}
                                                            </td>
                                                            <td>
                                                                {{amount_money_convert(x['Apr-'.concat(start_year)][1])}}
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] == true">
                                                                <div>
                                                                    <input type="text" id="input_Table"
                                                                        ng-model="x['Apr-'.concat(start_year)][2]"
                                                                        ng-blur="AddSum_checkSupplier(x['Apr-'.concat(start_year)][2],row_index)">
                                                                </div>
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] != true">
                                                                <div style="width: 75px;">

                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div>
                                            <!-- <div>{{x['May-'.concat(start_year)]}}</div> -->
                                            <div>
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                {{amount_money_convert(x['May-'.concat(start_year)][0])}}
                                                            </td>
                                                            <td>
                                                                {{amount_money_convert(x['May-'.concat(start_year)][1])}}
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] == true">
                                                                <div>
                                                                    <input type="text" id="input_Table"
                                                                        ng-model="x['May-'.concat(start_year)][2]"
                                                                        ng-blur="AddSum_checkSupplier(x['May-'.concat(start_year)][2],row_index)">
                                                                </div>
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] != true">
                                                                <div style="width: 75px;">

                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div>
                                            <!-- <div>{{x['Jun-'.concat(start_year)]}}</div> -->
                                            <div>
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                {{amount_money_convert(x['Jun-'.concat(start_year)][0])}}
                                                            </td>
                                                            <td>
                                                                {{amount_money_convert(x['Jun-'.concat(start_year)][1])}}
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] == true">
                                                                <div>
                                                                    <input type="text" id="input_Table"
                                                                        ng-model="x['Jun-'.concat(start_year)][2]"
                                                                        ng-blur="AddSum_checkSupplier(x['Jun-'.concat(start_year)][2],row_index)">
                                                                </div>
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] != true">
                                                                <div style="width: 75px;">

                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div>
                                            <div>
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                {{amount_money_convert(x['Jul-'.concat(start_year)][0])}}
                                                            </td>
                                                            <td>
                                                                {{amount_money_convert(x['Jul-'.concat(start_year)][1])}}
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] == true">
                                                                <div>
                                                                    <input type="text" id="input_Table"
                                                                        ng-model="x['Jul-'.concat(start_year)][2]"
                                                                        ng-blur="AddSum_checkSupplier(x['Jul-'.concat(start_year)][2],row_index)">
                                                                </div>
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] != true">
                                                                <div style="width: 75px;">

                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div>
                                            <!-- <div>{{x['Aug-'.concat(start_year)]}}</div> -->
                                            <div>
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                {{amount_money_convert(x['Aug-'.concat(start_year)][0])}}
                                                            </td>
                                                            <td>
                                                                {{amount_money_convert(x['Aug-'.concat(start_year)][1])}}
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] == true">
                                                                <div>
                                                                    <input type="text" id="input_Table"
                                                                        ng-model="x['Aug-'.concat(start_year)][2]"
                                                                        ng-blur="AddSum_checkSupplier(x['Aug-'.concat(start_year)][2],row_index)">
                                                                </div>
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] != true">
                                                                <div style="width: 75px;">

                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div>
                                            <!-- <div>{{x['Sep-'.concat(start_year)]}}</div> -->
                                            <div>
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                {{amount_money_convert(x['Sep-'.concat(start_year)][0])}}
                                                            </td>
                                                            <td>
                                                                {{amount_money_convert(x['Sep-'.concat(start_year)][1])}}
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] == true">
                                                                <div>
                                                                    <input type="text" id="input_Table"
                                                                        ng-model="x['Sep-'.concat(start_year)][2]"
                                                                        ng-blur="AddSum_checkSupplier(x['Sep-'.concat(start_year)][2],row_index)">
                                                                </div>
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] != true">
                                                                <div style="width: 75px;">

                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div>
                                            <!-- <div>{{x['Oct-'.concat(start_year)]}}</div> -->
                                            <div>
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                {{amount_money_convert(x['Oct-'.concat(start_year)][0])}}
                                                            </td>
                                                            <td>
                                                                {{amount_money_convert(x['Oct-'.concat(start_year)][1])}}
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] == true">
                                                                <div>
                                                                    <input type="text" id="input_Table"
                                                                        ng-model="x['Oct-'.concat(start_year)][2]"
                                                                        ng-blur="AddSum_checkSupplier(x['Oct-'.concat(start_year)][2],row_index)">
                                                                </div>
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] != true">
                                                                <div style="width: 75px;">

                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div>
                                            <!-- <div>{{x['Nov-'.concat(start_year)]}}</div> -->
                                            <div>
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                {{amount_money_convert(x['Nov-'.concat(start_year)][0])}}
                                                            </td>
                                                            <td>
                                                                {{amount_money_convert(x['Nov-'.concat(start_year)][1])}}
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] == true">
                                                                <div>
                                                                    <input type="text" id="input_Table"
                                                                        ng-model="x['Nov-'.concat(start_year)][2]"
                                                                        ng-blur="AddSum_checkSupplier(x['Nov-'.concat(start_year)][2],row_index)">
                                                                </div>
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] != true">
                                                                <div style="width: 75px;">

                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div>
                                            <!-- <div>{{x['Dec-'.concat(start_year)]}}</div> -->
                                            <div>
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                {{amount_money_convert(x['Dec-'.concat(start_year)][0])}}
                                                            </td>
                                                            <td>
                                                                {{amount_money_convert(x['Dec-'.concat(start_year)][1])}}
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] == true">
                                                                <div>
                                                                    <input type="text" id="input_Table"
                                                                        ng-model="x['Dec-'.concat(start_year)][2]"
                                                                        ng-blur="AddSum_checkSupplier(x['Dec-'.concat(start_year)][2],row_index)">
                                                                </div>
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] != true">
                                                                <div style="width: 75px;">

                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div>
                                            <!-- <div>{{x['Jan-'.concat(end_year)]}}</div> -->
                                            <div>
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                {{amount_money_convert(x['Jan-'.concat(end_year)][0])}}
                                                            </td>
                                                            <td>
                                                                {{amount_money_convert(x['Jan-'.concat(end_year)][1])}}
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] == true">
                                                                <div>
                                                                    <input type="text" id="input_Table"
                                                                        ng-model="x['Jan-'.concat(end_year)][2]"
                                                                        ng-blur="AddSum_checkSupplier(x['Jan-'.concat(end_year)][2],row_index)">
                                                                </div>
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] != true">
                                                                <div style="width: 75px;">

                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>

                                    </td>
                                    <td>
                                        <div>
                                            <!-- <div>{{x['Feb-'.concat(end_year)]}}</div> -->
                                            <div>
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                {{amount_money_convert(x['Feb-'.concat(end_year)][0])}}
                                                            </td>
                                                            <td>
                                                                {{amount_money_convert(x['Feb-'.concat(end_year)][1])}}
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] == true">
                                                                <div>
                                                                    <input type="text" id="input_Table"
                                                                        ng-model="x['Feb-'.concat(end_year)][2]"
                                                                        ng-blur="AddSum_checkSupplier(x['Feb-'.concat(end_year)][2],row_index)">
                                                                </div>
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] != true">
                                                                <div style="width: 75px;">

                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>

                                    </td>
                                    <td>
                                        <div>
                                            <!-- <div>{{x['Mar-'.concat(end_year)]}}</div> -->
                                            <div>
                                                <table>
                                                    <tbody>
                                                        <tr>
                                                            <td>
                                                                {{amount_money_convert(x['Mar-'.concat(end_year)][0])}}
                                                            </td>
                                                            <td>
                                                                {{amount_money_convert(x['Mar-'.concat(end_year)][1])}}
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] == true">
                                                                <div>
                                                                    <input type="text" id="input_Table"
                                                                        ng-model="x['Mar-'.concat(end_year)][2]"
                                                                        ng-blur="AddSum_checkSupplier(x['Mar-'.concat(end_year)][2],row_index)">
                                                                </div>
                                                            </td>
                                                            <td ng-if="x['reviewerIN'] != true">
                                                                <div style="width: 75px;">

                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>

                                    </td>
                                </tr>
                            </tbody>


                        </table>
                    </div>
                </div>
            </div>

            <div class="row" ng-hide="submitBtn">
                <div class="col-md-12 col-lg-12 col-sm-12" style="padding-top: 20px;" class="">
                    <div class="col-md-4 "></div>
                    <div class="col-md-2 ">
                        <button class="md-raised md-warn md-button md-ink-ripple" type="button" aria-label="Submit"
                            md-labeled-by-tooltip="md-tooltip-10" ng-click="Submit_fun()">Submit
                        </button>
                    </div>
                    <div class="col-md-2">
                        <button class="md-raised md-button md-ink-ripple" type="button"
                            ng-click="redirect_page_BudgetSum()" aria-label="Cancel"
                            md-labeled-by-tooltip="md-tooltip-10">Cancel
                        </button>
                    </div>
                    <div class="col-md-4 "></div>
                </div>
            </div>



        </div>
    </div>

    {% endverbatim %}
    <script>
        var app = angular.module('PPR_report', ['ngMaterial', 'ui.bootstrap'], function ($httpProvider)
        {
            $httpProvider.defaults.xsrfCookieName = 'csrftoken';
            $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
        });
        app.directive('numbersOnly', function ()
        {
            return {
                require: 'ngModel',
                link: function (scope, element, attr, ngModelCtrl)
                {
                    function fromUser(text)
                    {
                        if (text)
                        {
                            var transformedInput = text.replace(/[^0-9.]/g, '');
                            if (transformedInput !== text)
                            {
                                ngModelCtrl.$setViewValue(transformedInput);
                                ngModelCtrl.$render();
                            }
                            return transformedInput;
                        }
                        return undefined;
                    }
                    ngModelCtrl.$parsers.push(fromUser);
                }
            };
        });
        app.run(function ($rootScope)
        {
            $rootScope.sectorID = '';
            $rootScope.sectorName = '';
            $rootScope.bussinessID = '';
            $rootScope.bussinessName = '';
            $rootScope.expenceID = '';
            $rootScope.expenceNAME = '';
            $rootScope.subcatGID = "";
            $rootScope.table_api = '';
            $rootScope.popup_item_data = '';
            $rootScope.popup_item_date = '';
            $rootScope.popup_item_amount = '';
            $rootScope.row_index_num = 0;
            $rootScope.row_index_list = [];
            $rootScope.selected_tabs = '';
            $rootScope.selected_tabs_changed = '';
            $rootScope.tran_month = '';
            $rootScope.bizname = '';
            $rootScope.apexpenceID = '';
            $rootScope.apsubcatGID = '';
            $rootScope.supplier_gid = '';
            $rootScope.branchGID = '';
            $rootScope.amount_L_K = '';
            $rootScope.fin_year_selected = '';
            $rootScope.future_Fin_year = '';
        });
        app.controller('myCtrl', function ($scope, $filter, $http, $rootScope, $mdDialog, $mdToast, $log,
            PPR_service, $sce)
        {
            $scope.amount_money_convert = function (value)
            {
                if (value != "")
                {
                    var value = (Number(value)).toLocaleString(
                        undefined, {
                        minimumFractionDigits: 2
                    }
                    );
                }

                return value
            }
            $scope.submitBtn = true;
            $scope.Monthly_table = true;
            var detail = JSON.parse(sessionStorage.getItem('today'));
            employgid = detail.employee_gid;
            entitygid = detail.entity_gid;
            $scope.employgid = employgid;
            $scope.entitygid = entitygid;

            //loader spinner start
            $scope.loading = function ()
            {
                $mdDialog.show({
                    templateUrl: 'loaderSpinner',
                    parent: angular.element(document.body),
                    clickOutsideToClose: false
                });
            };
            $scope.loading_popup = function ()
            {
                $mdDialog.show({
                    templateUrl: 'loaderSpinner',
                    parent: angular.element(document.getElementById('view_pop_up')),
                    clickOutsideToClose: false
                });
            };
            $scope.endloading = function ()
            {
                $mdDialog.hide();
            };
            //loader spinner ends
            $scope.dropdownjsonccbs = [{
                "Table_name": "ap_mst_tbs",
                "Column_1": "tbs_name,tbs_gid",
                "Column_2": "",
                "Where_Common": "tbs",
                "Where_Primary": "",
                "Primary_Value": "",
                "Order_by": "name"
            }, {
                "Table_name": "ap_mst_tcc",
                "Column_1": "tcc_name,tcc_gid",
                "Column_2": "",
                "Where_Common": "tcc",
                "Where_Primary": "",
                "Primary_Value": "",
                "Order_by": "name"
            }];

            function BS_Fun()
            {
                var api = PPR_service.gettablevalue($scope.dropdownjsonccbs[0])
                api.then(function (result)
                {

                    $scope.BS_item = result.data
                })
            }
            function CC_Fun()
            {
                var api = PPR_service.gettablevalue($scope.dropdownjsonccbs[1])
                api.then(function (result)
                {

                    $scope.CC_item = result.data
                })
            }
            BS_Fun()
            CC_Fun()
            function FinYear()
            {
                var _data = {
                    "Params": {},
                    "Classification": {
                        "Entity_Gid": entitygid,
                        "Create_By": employgid
                    }
                }
                var _send_data = {
                    'Group': 'Reviewer_Get',
                    'Action': "FinYear_Fetch",
                    'data': _data
                }

                var API = PPR_service.BudgetReviewer_Data_Get_Set(_send_data)
                API.then(function (response)
                {
                    console.log(response.data.DATA)
                    $scope.fin_year = response.data.DATA;
                })
            }

            FinYear()


            $scope.show_table = function ()
            {
                var _data = {
                    "Params": {
                        "fin_year": check_null_undefind($scope.fin_SelectedText, 'pprbudgetrequest_prev_finyear'),
                        "pprdata_bsname": check_null_undefind($scope.BS_selected, 'tbs_name'),
                        "pprdata_ccname": check_null_undefind($scope.CC_selected, 'tcc_name')
                    },
                    "Classification": {
                        "Entity_Gid": entitygid,
                        "Create_By": employgid
                    }
                }
                var _send_data = {
                    'Group': 'Reviewer_Get',
                    'Action': "Reviewer_Get",
                    'data': _data
                }

                var API = PPR_service.BudgetReviewer_Data_Get_Set(_send_data)
                API.then(function (response)
                {
                    try
                    {
                        $scope.loading();
                        table_api = response.data
                        if (table_api.DATA.length > 0)
                        {
                            var _convertfuture_Fin_year = table_api.DATA[0].pprdata_finyear
                            var start_year = _convertfuture_Fin_year.replace('FY', "").split("-")[0];
                            var end_year = _convertfuture_Fin_year.replace('FY', "").split("-")[1];
                            $scope.start_year = start_year
                            $scope.end_year = end_year
                            var from_year = Number(_convertfuture_Fin_year.replace('FY', "").split("-")[0]) + 1
                            var to_year = Number(_convertfuture_Fin_year.replace('FY', "").split("-")[1]) + 1
                            $rootScope.future_Fin_year = 'FY' + from_year + "-" + to_year
                            $scope.futur_start_endYear = from_year + "-" + to_year
                            $scope.future_fromYear = from_year
                            $scope.future_toYear = to_year

                            var month = new Array();
                            month[0] = "Jan-";
                            month[1] = "Feb-";
                            month[2] = "Mar-";
                            month[3] = "Apr-";
                            month[4] = "May-";
                            month[5] = "Jun-";
                            month[6] = "Jul-";
                            month[7] = "Aug-";
                            month[8] = "Sep-";
                            month[9] = "Oct-";
                            month[10] = "Nov-";
                            month[11] = "Dec-";
                            var unique_month_Year = ["Apr-".concat(start_year), "May-".concat(
                                start_year), "Jun-"
                                    .concat(start_year), "Jul-".concat(start_year), "Aug-"
                                        .concat(start_year),
                            "Sep-".concat(start_year), "Oct-".concat(start_year), "Nov-"
                                .concat(start_year), "Dec-"
                                    .concat(start_year), "Jan-".concat(end_year), "Feb-".concat(
                                        end_year), "Mar-".concat(end_year)
                            ]

                            var out_expGRPname_arr = table_api.DATA.map(myFunctionEXP_grp_name);
                            function myFunctionEXP_grp_name(value, index, array)
                            {
                                return value.expensegrp_name;
                            }
                            function removeDuplicateExpname(data)
                            {
                                return data.filter((value, index) => data.indexOf(value) ===
                                    index);
                            }
                            var Expense_Grp_name = removeDuplicateExpname(out_expGRPname_arr);

                            output_data = []
                            for (exp_grp = 0; exp_grp < Expense_Grp_name.length; exp_grp++)
                            {
                                let temp_EXP_GRP = {}
                                temp_EXP_GRP["Direct Cost"] = Expense_Grp_name[exp_grp]
                                for (m_y = 0; m_y < unique_month_Year.length; m_y++)
                                {
                                    temp_EXP_GRP[unique_month_Year[m_y]] = ["", "", ""];
                                }
                                temp_EXP_GRP["YTD"] = ["", "", ""]
                                temp_EXP_GRP["Padding"] = 10
                                output_data.push(temp_EXP_GRP)
                                Exp_name_arr = []
                                for (nafi = 0; nafi < table_api.DATA.length; nafi++)
                                {
                                    if (table_api.DATA[nafi].expensegrp_name ==
                                        Expense_Grp_name[exp_grp])
                                        Exp_name_arr.push(table_api.DATA[nafi].expense_name)
                                }
                                function removeDuplicateEXPname_arr(data)
                                {
                                    return data.filter((value, index) => data.indexOf(value) ===
                                        index);
                                }
                                let Expence_name = removeDuplicateEXPname_arr(Exp_name_arr)
                                for (exp = 0; exp < Expence_name.length; exp++)
                                {
                                    let temp_data = {};
                                    temp_data["Direct Cost"] = Expence_name[exp];
                                    for (m_y = 0; m_y < unique_month_Year.length; m_y++)
                                    {
                                        temp_data[unique_month_Year[m_y]] = ["", "", ""];
                                    }
                                    temp_data["YTD"] = ["", "", ""]
                                    temp_data["Padding"] = 20
                                    output_data.push(temp_data)
                                    name_arr = [];
                                    for (nafi = 0; nafi < table_api.DATA.length; nafi++)
                                    {
                                        if (table_api.DATA[nafi].expense_name == Expence_name[
                                            exp])
                                            name_arr.push(table_api.DATA[nafi].subcategory_name)
                                    }
                                    function removeDuplicatename_arr(data)
                                    {
                                        return data.filter((value, index) => data.indexOf(
                                            value) ===
                                            index);
                                    }
                                    for (n = 0; n < removeDuplicatename_arr(name_arr)
                                        .length; n++)
                                    {
                                        let temp_row = {};
                                        temp_row["Direct Cost"] = removeDuplicatename_arr(
                                            name_arr)[n];
                                        Total_of_amount = [];
                                        for (m_y = 0; m_y < unique_month_Year.length; m_y++)
                                        {
                                            temp_row[unique_month_Year[m_y]] = ["0.00", "0.00", 0];
                                        }
                                        for (api = 0; api < table_api.DATA.length; api++)
                                        {
                                            var d = new Date(table_api.DATA[api]
                                                .pprdata_transactiondate)
                                            if (Expence_name[exp] == table_api.DATA[api]
                                                .expense_name)
                                            {
                                                if (removeDuplicatename_arr(name_arr)[n] ==
                                                    table_api
                                                        .DATA[
                                                        api]
                                                        .subcategory_name)
                                                {
                                                    if (unique_month_Year.includes(month[d
                                                        .getMonth()].concat(d
                                                            .getFullYear().toString()
                                                            .substr(-2))))
                                                    {
                                                        Total_of_amount.push([parseFloat(
                                                            parseFloat(
                                                                table_api
                                                                    .DATA[api]
                                                                    .pprdatatotamount).toFixed(2)
                                                        ), parseFloat(
                                                            parseFloat(
                                                                table_api
                                                                    .DATA[api]
                                                                    .pprdatatotamount).toFixed(2)
                                                        ), parseFloat(
                                                            parseFloat(
                                                                table_api
                                                                    .DATA[api]
                                                                    .pprbudgetrequestamount).toFixed(2)
                                                        )]);

                                                        temp_row[month[d.getMonth()].concat(d
                                                            .getFullYear().toString()
                                                            .substr(-2))] = [parseFloat(
                                                                parseFloat(
                                                                    table_api
                                                                        .DATA[api]
                                                                        .pprdatatotamount).toFixed(2)
                                                            ), parseFloat(
                                                                parseFloat(
                                                                    table_api
                                                                        .DATA[api]
                                                                        .pprdatatotamount).toFixed(2)
                                                            ), table_api
                                                                .DATA[api]
                                                                .pprbudgetrequestamount];
                                                        temp_row["TranYear"] = ""
                                                        temp_row["TranDate"] = ""
                                                        temp_row["Prev_finYear"] = table_api.DATA[api].pprdata_finyear
                                                        temp_row["Sector"] = table_api.DATA[api].pprdata_sectorname
                                                        temp_row["Bizz"] = table_api.DATA[api].pprdata_bizname
                                                        temp_row["BS"] = table_api.DATA[api].pprdata_bsname
                                                        temp_row["CC"] = table_api.DATA[api].pprdata_ccname
                                                        temp_row["subcat"] = table_api.DATA[api].pprdata_apsubcatgid
                                                        temp_row["reviewerIN"] = true;
                                                    }
                                                }
                                            }
                                        }
                                        ytd_totalARR = []
                                        for (index of [0, 1, 2])
                                        {
                                            total_Amount = 0
                                            for (total = 0; total < Total_of_amount
                                                .length; total++)
                                            {
                                                total_Amount = total_Amount + Total_of_amount[total][index]
                                            }
                                            ytd_totalARR[index] = total_Amount;
                                        }

                                        temp_row["YTD"] = [Number(ytd_totalARR[0]), Number(ytd_totalARR[1]), Number(ytd_totalARR[2])]
                                        if (total_Amount == 0)
                                        {
                                            temp_row["YTD"] = ["0.00", "0.00", 0]
                                        }
                                        temp_row["Padding"] = 30
                                        temp_row["FinYear"] = $rootScope.future_Fin_year
                                        output_data.push(temp_row)
                                        Total_of_amount = []

                                    }

                                }
                            }
                            //final overall total row code start
                            var sum_Total_dict_keys = Object.keys(output_data[0]).splice(1)
                            sum_Total_dict_keys.splice(13)
                            var over_all_row_all = {}
                            over_all_row_all["Direct Cost"] = 'Total : ';
                            for (row_keys = 0; row_keys < sum_Total_dict_keys
                                .length; row_keys++)
                            {
                                over_all_row_all[sum_Total_dict_keys[row_keys]] = [column_total(0, output_data, sum_Total_dict_keys[row_keys]), column_total(1, output_data, sum_Total_dict_keys[row_keys]), column_total(2, output_data, sum_Total_dict_keys[row_keys])]
                            }

                            over_all_row_all["Padding"] = 30
                            output_data.push(over_all_row_all)
                            // final overall total row code end
                            $scope.endloading();
                            $scope.Monthly_table_body = output_data;
                            $scope.Monthly_table = false;
                            $scope.submitBtn = false;

                        } else
                        {
                            alert("DATA NOT FOUND")
                            $scope.endloading();
                        }

                    }
                    catch (err)
                    {
                        alert("DATA NOT FOUND")
                        $scope.endloading();
                    }

                })

            }
            $scope.show_table()
            function check_null_undefind(data, key)
            {
                if (data == undefined || data == null || data == '')
                {
                    return data = String("")
                }
                return data[key]
            }
            function column_total(index, Array, key)
            {
                total = 0
                for (row_add = 0; row_add < Array.length; row_add++)
                {
                    if (Array[row_add][key][index] !=
                        '' || Array[row_add][key][index] != undefined)
                    {
                        if (typeof (Array[row_add][
                            key
                        ][index]) == 'string')
                        {
                            total = total + Number(Array[row_add][
                                key
                            ][index])
                        } else if (typeof (Array[row_add][
                            key
                        ][index]) == 'number')
                        {
                            total = total + Number(Array[row_add][
                                key
                            ][index])
                        }
                    }
                }
                if (total == 0)
                {
                    return "0.00"
                }
                return total.toFixed(
                    2)

            }
            $scope.YTD_fun = function (value, row_index)
            {
                if (value != '' && value != null)
                {
                    var table_data = $scope.Monthly_table_body[row_index]
                    var total = value / 12
                    table_data["YTD"][2] = Number(value)
                    table_data["Apr-".concat($scope.start_year)][2] = total
                    table_data["May-".concat($scope.start_year)][2] = total
                    table_data["Jun-".concat($scope.start_year)][2] = total
                    table_data["Jul-".concat($scope.start_year)][2] = total
                    table_data["Aug-".concat($scope.start_year)][2] = total
                    table_data["Sep-".concat($scope.start_year)][2] = total
                    table_data["Oct-".concat($scope.start_year)][2] = total
                    table_data["Nov-".concat($scope.start_year)][2] = total
                    table_data["Dec-".concat($scope.start_year)][2] = total
                    table_data["Jan-".concat($scope.end_year)][2] = total
                    table_data["Feb-".concat($scope.end_year)][2] = total
                    table_data["Mar-".concat($scope.end_year)][2] = total
                }

            }
            $scope.AddSum_checkSupplier = function (value, row_index)
            {
                if (value != '' && value != null)
                {
                    var totalSum = $scope.Monthly_table_body[row_index]
                    var total = Number(totalSum["Apr-".concat($scope.start_year)][2]) + Number(totalSum["May-".concat($scope.start_year)][2]) + Number(totalSum["Jun-".concat($scope.start_year)][2]) +
                        Number(totalSum["Jul-".concat($scope.start_year)][2]) + Number(totalSum["Aug-".concat($scope.start_year)][2]) + Number(totalSum["Sep-".concat($scope.start_year)][2]) + Number(totalSum["Oct-".concat($scope.start_year)][2]) +
                        Number(totalSum["Nov-".concat($scope.start_year)][2]) + Number(totalSum["Dec-".concat($scope.start_year)][2]) + Number(totalSum["Jan-".concat($scope.end_year)][2]) + Number(totalSum["Feb-".concat($scope.end_year)][2]) +
                        Number(totalSum["Mar-".concat($scope.end_year)][2])
                    totalSum["YTD"][2] = Number(total)
                }


            }
            $scope.Submit_fun = function ()
            {

                tableBody = $scope.Monthly_table_body
                send_api_arr = []
                for (rowi = 0; rowi < tableBody.length - 1; rowi++)
                {
                    if (typeof tableBody[rowi]['YTD'][2] == 'number')
                    {
                        row = tableBody[rowi]
                        temp_row = {}
                        temp_row["Prev_finYear"] = row["Prev_finYear"]
                        temp_row["FinYear"] = row["FinYear"]
                        temp_row["subcat"] = row["subcat"]
                        temp_row["CC"] = row["CC"]
                        temp_row["BS"] = row["BS"]
                        temp_row["Bizz"] = row["Bizz"]
                        temp_row["Sector"] = row["Sector"]
                        temp_row["TranDate"] = row["TranDate"]
                        temp_row["TranYear"] = row["TranYear"]
                        temp_row["Amt_L_K"] = $rootScope.amount_L_K;
                        temp_row["Branch"] = 259
                        sub_data = []

                        YTD = row['YTD'][2]
                        var total = Number(row["Apr-".concat($scope.start_year)][2]) + Number(row["May-".concat($scope.start_year)][2]) + Number(row["Jun-".concat($scope.start_year)][2]) +
                            Number(row["Jul-".concat($scope.start_year)][2]) + Number(row["Aug-".concat($scope.start_year)][2]) + Number(row["Sep-".concat($scope.start_year)][2]) + Number(row["Oct-".concat($scope.start_year)][2]) +
                            Number(row["Nov-".concat($scope.start_year)][2]) + Number(row["Dec-".concat($scope.start_year)][2]) + Number(row["Jan-".concat($scope.end_year)][2]) + Number(row["Feb-".concat($scope.end_year)][2]) +
                            Number(row["Mar-".concat($scope.end_year)][2])

                        if (Number(total) == Number(YTD))
                        {
                            monthAmount = [{ "TranMonth": 'Apr', "Amount": row["Apr-".concat($scope.start_year)][2] },
                            { "TranMonth": 'May', "Amount": row["May-".concat($scope.start_year)][2] },
                            { "TranMonth": 'Jun', "Amount": row["Jun-".concat($scope.start_year)][2] },
                            { "TranMonth": 'Jul', "Amount": row["Jul-".concat($scope.start_year)][2] },
                            { "TranMonth": 'Aug', "Amount": row["Aug-".concat($scope.start_year)][2] },
                            { "TranMonth": 'Sep', "Amount": row["Sep-".concat($scope.start_year)][2] },
                            { "TranMonth": 'Oct', "Amount": row["Oct-".concat($scope.start_year)][2] },
                            { "TranMonth": 'Nov', "Amount": row["Nov-".concat($scope.start_year)][2] },
                            { "TranMonth": 'Dec', "Amount": row["Dec-".concat($scope.start_year)][2] },
                            { "TranMonth": 'Jan', "Amount": row["Jan-".concat($scope.end_year)][2] },
                            { "TranMonth": 'Feb', "Amount": row["Feb-".concat($scope.end_year)][2] },
                            { "TranMonth": 'Mar', "Amount": row["Mar-".concat($scope.end_year)][2] }]

                            sub_data.push({ "Direct Cost": row["Direct Cost"], "supplier_id": 0, "months": monthAmount })
                            temp_row["sub_data"] = sub_data
                            send_api_arr.push(temp_row)
                        }
                        else if (YTD != Number(total))
                        {
                            alert("Total is Mis-Match in " + row["Direct Cost"])
                        }

                    }



                }



                if (send_api_arr.length > 0)
                {
                    var Data = {
                        "Params": { "Budget_data": send_api_arr },
                        "Classification": {
                            "Entity_Gid": entitygid,
                            "Create_By": employgid
                        }
                    }

                    var send_api = { "Group": "Reviewer_Insert", "Action": "INSERT_BUDGETREVIEWER", "data": Data }
                    var Api = PPR_service.BudgetReviewer_Data_Get_Set(send_api)
                    Api.then(function (response)
                    {

                        if (response.data.MESSAGE == "SUCCESS")
                        {
                            success_toast()
                        }
                        else
                        {

                            error_toast('', time_toast);
                        }
                    })
                }



            }
        });
        app.service('PPR_service', function ($http)
        {

            this.BudgetReviewer_Data_Get_Set = function (data)
            {
                var response = $http.post(Appname + "/PPR_Buget_XL_Set/", data);
                return response;
            }
            this.gettablevalue = function (json)
            {
                var response = $http.post(Appname + "/tablevalue/", { params: { "tablevalue": json } });
                return response;
            }
        });

    </script>
</body>
{% endblock %}

</html>