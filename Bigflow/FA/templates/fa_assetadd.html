{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %} Asset Maker {% endblock %}
{% block content %}
{% csrf_token %}
{% verbatim %}
<style xmlns:>
.modal-lg{
    width:1000px
    }
.md-virtual-repeat-container {
    width: 400px;
    }
img {
  cursor: -webkit-zoom-in;
  cursor: -moz-zoom-in;
}
.container3 {
    font-size: 12px;
    background-color: white;
    box-shadow: 0px 0px 10px 5px #c1d4dc;
    padding-bottom: 15px;
    height:100%;
}







</style>
<link href="https://cdn.rawgit.com/tonystar/bootstrap-float-label/v4.0.2/bootstrap-float-label.min.css"
      rel="stylesheet"/>
<div class="maincontent">
    <!--    <div class="container3"-->
    <!--         style="width:1100px;height:500px;padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto;"-->
    <!--         ng-app="dateapp" ng-cloak ng-controller="datectrl">-->
    <div class="container container1" ng-app="dateapp" ng-cloak ng-controller="datectrl">
        <div class="row">
            <div class="row-header col-lg-12 col-sm-12">
                <div class="col-md-3">
                    <h4>Asset Maker </h4>
                </div>
                <div class="col-md-3">
                </div>
                <div class="col-md-3">
                </div>

            </div>
        </div>
        <div></div>
        <div class="row" class="col-md-12">
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-3">
                        <label class="has-float-label">
                            <input class="form-control"
                                   maxlength="30"
                                   ng-change=""
                                   ng-model="invoiceno"
                                   placeholder="Invoice No"
                                   type="text"/>
                            <span>Invoice No</span>
                        </label>
                    </div>
                    <div class="col-md-3">
                        <label class="has-float-label">
                            <md-datepicker class="form-control" md-hide-icons="calendar" md-max-date="maxDate"
                                           md-open-on-focus
                                           ng-change="selectdate()"
                                           ng-model="invoice_date"
                            >
                            </md-datepicker>
                            <span>Invoice Date</span>
                        </label>
                    </div>
                    <div class="col-md-3">
                        <label class="has-float-label">
                            <input class="form-control"
                                   ng-change="" ng-model="supplier_name" placeholder="Supplier Name"
                                   type="text"
                            />
                            <span>Supplier Name</span>
                        </label>
                    </div>
                     <div class="col-md-3">
                        <label class="has-float-label">
                            <input class="form-control"
                                   maxlength="30"
                                   ng-change=""
                                   ng-model="faclr_crno"
                                   placeholder="CR No"
                                   type="text"/>
                            <span>CR No</span>
                        </label>
                    </div>
                </div>

            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-4">
                        <md-input-container class="md-block inputcontainer">

                            <md-radio-group layout="row" ng-change="mode_make(selected)" ng-init="mode_make(selected)"
                                            ng-model="selected">

                                <md-radio-button aria-label="{{item.label}}" ng-repeat="item in items"
                                                 ng-value="item.value">
                                    {{ item.label }}
                                </md-radio-button>
                            </md-radio-group>

                        </md-input-container>
                    </div>
                    <div class="col-md-4">
                    </div>
                    <div class="col-md-3">
                        <md-button class="md-fab md-mini md-primary custbutton" ng-click="search()">
                            <md-icon>search</md-icon>
                            <md-tooltip>Search</md-tooltip>
                        </md-button>
                    </div>
                </div>
            </div>
        </div>
        <div ng-cloak>
            <md-content>
                <md-tabs md-center-tabs md-dynamic-height md-stretch-tabs>
                    <md-tab label="Without-Bucket" md-on-select="TabClickNonG()">
                        <md-content class="md-padding">
                            <h5 class="md-display-0">Non-Group Data's</h5>
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <table class="table table-striped table-bordered table-condensed table-hover md-primary">
                                        <thead class="header">
                                        <th class="text-center" scope="col">S.No</th>
                                        <th class="text-center">Invoice Type</th>
                                        <th class="text-center" scope="col"><a
                                                ng-click="orderByField='asset_id'; reverseSort = !reverseSort"
                                                style="color:white">Invoice No
                                            <span ng-show="orderByField == 'asset_id'"><span></span></span>
                                        </a></th>
                                        <th class="text-center" scope="col">Invoice Date</th>
                                        <th class="text-center" scope="col">Supplier Name</th>
                                        <th class="text-center" scope="col">Tax Amount</th>
                                        <th class="text-center" scope="col">Inv Amount</th>
                                        <th class="text-center" scope="col">Inv Tot</th>
                                        <th class="text-center" scope="col">Capitalized Amount</th>
                                        <th class="text-center" scope="col">Balance Amount</th>
                                        <th class="text-center" scope="col">Action</th>
                                        <th class="text-center" scope="col">Select</th>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat=" ins in asset_invoice.slice(((currentPage-1)*itemsPerPage), ((currentPage)*itemsPerPage)) | orderBy:orderByField:reverseSort">
                                            <td class="text-center">
                                                <center>{{((currentPage-1)*itemsPerPage)+$index+1}}</center>
                                            </td>
                                            <td class="text-center">{{ins.faclringheader_assettype}}</td>
                                            <td class="text-center">{{ins.faclringdetails_invoiceno}}</td>
                                            <td class="text-center" style="width:100px;">
                                                {{ins.faclringdetails_invoicedate}}
                                            </td>
                                            <td class="text-left" style="width:200px;">
                                                {{ins.supplier_name}}
                                            </td>
                                            <td class="text-right" style="width:150px;">
                                                {{ins.faclringheader_tottaxamount}}
                                            </td>
                                            <td class="text-right">{{ins.faclringheader_totamount | number :
                                                fractionSize}}
                                            </td>
                                            <td class="text-right">{{ins.faclringheader_totinvamount | number :
                                                fractionSize}}
                                            </td>
                                            <td class="text-right">{{ins.faclringheader_captalizedamount | number :
                                                fractionSize}}
                                            </td>
                                            <td class="text-right">{{ins.faclringheader_balanceamount | number :
                                                fractionSize}}
                                            </td>
                                            <td class="text-center" ><span class="editlink" ng-hide="{{(ins.assetdebit_status == '0' || ins.assetdebit_status == 'APPROVED' || ins.assetdebit_status =='REJECTED') ? false : true }}"
                                                                          ng-click="viewdet(ins)">View</span></td>
                                            <td class="text-center" style="..."><input
                                                    ng-change="selectcheckbox($index)"
                                                    ng-checked="isChecked"
                                                        ng-click="select_checkbox()"
                                                    ng-model="ins.isChecked"
                                                    type="checkbox"
                                            ></td>
                                        </tr>
                                        <tr ng-show="asset_invoice.length ==  0">
                                            <td class="warning" colspan="15">
                                                No Records Found.
                                            </td>
                                        </tr>
                                        </tbody>
                                        <tfoot>
                                        <tr>
                                            <td colspan="11">
                                                <ul boundary-links="true" class="pagination-sm cust_pagination"
                                                    items-per-page="itemsPerPage"
                                                    max-size="maxSize"
                                                    ng-model="currentPage" total-items="asset_invoice.length"
                                                    uib-pagination></ul>
                                            </td>
                                            <td class="text-left" colspan="2">
                                                <span>Total Count:<br/> <b
                                                        class="text-centre"> {{asset_invoice.length}}</b></span>
                                            </td>
                                        </tr>
                                        </tfoot>
                                    </table>
                                    <div class="row">
                                        <div ng-show="ddl_cwipgrp">
                                            <div class="col-md-3" style="margin-top:12px">
                                                <md-autocomplete
                                                        md-clear-button="true"
                                                        md-input-maxlength=126
                                                        md-item-text="item.cwipgroup_name"
                                                        md-items="item in querySearchgrp(searchgrp)"
                                                        md-min-length=0
                                                        md-no-cache="true"
                                                        md-search-text="searchgrp"
                                                        md-selected-item="selectedgrp"
                                                        md-selected-item-change="cwipddl_selectchange(item)"
                                                        placeholder="Bucket Name">
                                                    <md-item-template>
                                                        <span md-highlight-text="searchTe"> {{item.cwipgroup_name}} </span>
                                                    </md-item-template>
                                                    <md-not-found>
                                                        No Bucket Name matching "{{searchTe}}" were
                                                        found.
                                                    </md-not-found>
                                                </md-autocomplete>
                                            </div>
                                            <div class="col-md-3" ng-show="ddl_cwipgrp">
                                                <md-button class="md-fab md-mini md-primary custbutton"
                                                           ng-click="add_cwipgrp()">
                                                    <md-icon class="material-icons editlink">add</md-icon>
                                                    <md-tooltip>Bucket add</md-tooltip>
                                                </md-button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xs-12 text-center">
                                            <md-button class="btn btn-info custbutton" ng-click="btn_clk_move2grp(emp)"
                                                       ng-disabled="btn_makegrp_ed">Move To Bucket
                                                <md-tooltip>Move to Bucket</md-tooltip>
                                            </md-button>
                                            <md-button class="md-raised" data-dismiss="modal" ng-href="fa_summary">Back
                                                <md-tooltip>close</md-tooltip>
                                            </md-button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </md-content>

                    </md-tab>

                    <md-tab label="Bucket" md-on-select="TabClickG()">
                        <md-content class="md-padding">
                            <h5 class="md-display-0">Group Data's</h5>
                            <div class="col-md-12 col-lg-12 col-sm-12">
                                <table class="table table-striped table-bordered table-condensed table-hover md-primary">
                                    <thead class="header">
                                    <th class="text-center" scope="col">S.No</th>
                                    <th class="text-center">Bucket Name</th>
                                    <th class="text-center">Invoice Type</th>
                                    <th class="text-center" scope="col">Invoice Count</th>
                                    <th class="text-center" scope="col">Inv Amount</th>
                                    <th class="text-center" scope="col">Tax Amount</th>
                                    <th class="text-center" scope="col">Inv Tot</th>
                                    <th class="text-center" scope="col">Capitalized Amount</th>
                                    <th class="text-center" scope="col">Balance Amount</th>
                                    <th class="text-center" scope="col">Action</th>
                                    </thead>
                                    <tbody>
                                    <tr ng-repeat=" ins in asset_invoice.slice(((currentPage-1)*itemsPerPage), ((currentPage)*itemsPerPage)) | orderBy:orderByField:reverseSort">
                                        <td class="text-center">
                                            <center>{{((currentPage-1)*itemsPerPage)+$index+1}}</center>
                                        </td>
                                        <td class="text-center">{{ins.faclringheader_groupno}}</td>
                                        <td class="text-center">{{ins.faclringheader_assettype}}</td>
                                        <td class="text-center" style="width:100px;">{{ins.faclringheader_invcount}}
                                        </td>
                                        <td class="text-right">{{ins.faclringheader_totamount | number :
                                            fractionSize}}
                                        </td>
                                        <td class="text-right" style="width:150px;">{{ins.faclringheader_tottaxamount}}
                                        </td>
                                        <td class="text-right">{{ins.faclringheader_totinvamount | number :
                                            fractionSize}}
                                        </td>
                                        <td class="text-right">{{ins.faclringheader_captalizedamount | number :
                                            fractionSize}}
                                        </td>
                                        <td class="text-right">{{ins.faclringheader_balanceamount | number :
                                            fractionSize}}
                                        </td>
                                        <td class="text-center"><span class="editlink"
                                                                      ng-click="viewdet(ins)">View</span></td>
                                    </tr>
                                    <tr ng-show="asset_invoice.length ==  0">
                                        <td class="warning" colspan="15">
                                            No Records Found.
                                        </td>
                                    </tr>
                                    </tbody>
                                    <tfoot>
                                    <tr>
                                        <td colspan="6">
                                            <ul boundary-links="true" class="pagination-sm cust_pagination"
                                                items-per-page="itemsPerPage"
                                                max-size="maxSize"
                                                ng-model="currentPage" total-items="asset_invoice.length"
                                                uib-pagination></ul>
                                        </td>
                                        <td class="text-left" colspan="3">
                                            <span>Total Count:<br/> <b class="text-centre"> {{asset_invoice.length}}</b></span>
                                        </td>
                                    </tr>
                                    </tfoot>
                                </table>
                                <div class="row">
                                    <div class="col-xs-12 text-center">
                                        <md-button class="md-raised" data-dismiss="modal" ng-href="fa_summary">Back
                                            <md-tooltip>close</md-tooltip>
                                        </md-button>
                                    </div>
                                </div>
                            </div>
                        </md-content>

                    </md-tab>
                </md-tabs>
            </md-content>

        </div>

        <!--popup page start-->
        <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" data-backdrop="static"
             data-keyboard="false"
             id="viewmodal" role="dialog"
             tabindex="-1">

            <!--            <div aria-hidden="true"  aria-labelledby="exampleModalLabel" class="modal-dialog modal-lg modal-style"  data-backdrop="static"-->
            <!--             data-keyboard="false"-->
            <!--             id="viewmodal" role="dialog"-->
            <!--             style="height:auto;width:1200%" tabindex="-1">-->

            <div class="modal-dialog modal-lg modal-style" role="document" style="width:1200px">
                <div class="modal-content">
                    <div class="header">
                        <div class="modal-header popup-header">
                            <h5 class="modal-title" id="exampleModalLabel">
                                <strong>Asset Add For {{ invoice_supplier }}</strong>
                                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </h5>
                        </div>
                    </div>
                    <md-content>
                        <md-tabs md-border-bottom md-dynamic-height ng-init="label ='Invoice'">
                            <md-tab label="Invoice">
                                <md-content class="md-padding">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <md-subheader class="md-accent">Invoice Details</md-subheader>
                                        </div>
                                    </div>
                                    <md-card style="background-color:#8dbed6;">
                                        <md-card-content>
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="col-md-3" ng-show="hide">
                                                        <b>Invoice Tax Amt : &#8377; {{invoice_taxamt | number : 0}}</b>
                                                    </div>
                                                    <div class="col-md-3" >
                                                        <b>Total Amt for Captalize :
                                                            <span>&#8377; {{ invoice_totalamt | number : 0}} </span></b>
                                                    </div>
                                                    <div class="col-md-3" >
                                                        <b>Already Capitalize Amt :
                                                            <span>&#8377; {{ faclringheader_captalizedamount | number : 0}} </span></b>
                                                    </div>
                                                    <div class="col-md-3" >
                                                        <b>Balance Amt for Capitalize:
                                                            <span>&#8377; {{ faclringheader_balanceamount | number : 0}} </span></b>
                                                    </div>
                                                    <div class="col-md-2" ng-show="cwip_data">
                                                        <md-checkbox aria-label="Single Asset " ng-model="singleasset">
                                                            Single Asset : {{ singleasset }}
                                                        </md-checkbox>
                                                    </div>
                                                    <div ng-show="regular_location">
                                                        <div class="col-md-1">
                                                            <md-button class="md-fab md-mini md-primary custbutton"
                                                                       ng-click="location_pop()">
                                                                <md-icon class="material-icons editlink">location_on
                                                                </md-icon>
                                                                <md-tooltip>location add</md-tooltip>
                                                            </md-button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <div class="col-md-3" ng-show="hide">
                                                        <md-input-container class="md-block inputcontainer"
                                                                            ng-show="invoice">
                                                            <md-radio-group layout="row" ng-change="mode_choose()"
                                                                            ng-init="option_mode = 'Regular'"
                                                                            ng-model="option_mode"
                                                                            ng-show="hide">
                                                                <md-radio-button checked ng-selected="true"
                                                                                 value="Regular">
                                                                    Regular
                                                                </md-radio-button>
                                                                <md-radio-button ng-show="hide" value="CWIP">CWIP
                                                                </md-radio-button>
                                                            </md-radio-group>
                                                        </md-input-container>
                                                    </div>

                                                    <div ng-show="hide">
                                                        <md-input-container class="md-block inputcontainer">
                                                            <md-radio-group layout="row" ng-change=""
                                                                            ng-init="option_radio = 'Without_Tax'"
                                                                            ng-model="option_radio">
                                                                <md-radio-button value="Tax">WithTax
                                                                </md-radio-button>
                                                                <md-radio-button checked ng-selected="true"
                                                                                 value="Without_Tax">
                                                                    Without
                                                                    Tax
                                                                </md-radio-button>
                                                            </md-radio-group>
                                                        </md-input-container>
                                                    </div>
                                                    <div class="col-md-3" ng-show="enable_regular"
                                                         style="margin-top:12px">
                                                        <md-autocomplete
                                                                md-clear-button="true"
                                                                md-floating-label="BS"
                                                                md-input-maxlength=126
                                                                md-item-text="item.bs_name"
                                                                md-items="item in querySearchbs(search_bs)"
                                                                md-min-length=0
                                                                md-no-cache="true"
                                                                md-search-text="search_bs"
                                                                md-selected-item="selectedbs"
                                                                md-selected-item-change="bschange(item)"
                                                                placeholder="Select BS">
                                                            <md-item-template>
                                                                <span md-highlight-text="searchTe">{{item.bs_name}} - {{item.bs_code}}</span>
                                                            </md-item-template>
                                                            <md-not-found>
                                                                No BS matching "{{searchTe}}" were found.
                                                            </md-not-found>
                                                        </md-autocomplete>
                                                    </div>
                                                    <div class="col-md-3" ng-show="enable_regular"
                                                         style="margin-top:12px">
                                                        <md-autocomplete
                                                                md-clear-button="true"
                                                                md-floating-label="CC"
                                                                md-input-maxlength=126
                                                                md-item-text="item.cc_name"
                                                                md-items="item in querySearchcc(search_cc)"
                                                                md-min-length=0
                                                                md-no-cache="true"
                                                                md-search-text="search_cc"
                                                                md-selected-item="selectedcc"
                                                                md-selected-item-change="ACselectchange(item)"
                                                                ng-disabled="no_ccdata"
                                                                placeholder="Select CC">
                                                            <md-item-template>
                                                                <span md-highlight-text="searchTe">{{item.cc_name}} - {{item.cc_code}} </span>
                                                            </md-item-template>
                                                            <md-not-found>
                                                                No CC matching "{{searchTe}}" were found.
                                                            </md-not-found>
                                                        </md-autocomplete>
                                                    </div>
                                                    <div class="col-md-3" style="margin-top:12px">
                                                        <md-autocomplete
                                                                md-clear-button="true"
                                                                md-floating-label="Branch Name"
                                                                md-input-maxlength=126
                                                                md-item-text="item.branch_name"
                                                                md-items="item in querySearchs_br(searchbr)"
                                                                md-min-length=0
                                                                md-no-cache="true"
                                                                md-search-text="searchbr"
                                                                md-selected-item="selectedbr"
                                                                md-selected-item-change="branch_change_capitalize(item)"
                                                                placeholder="Branch">
                                                            <md-item-template>
                                                                <span md-highlight-text="searchTe"> {{item.branch_name}} - {{item.branch_code}} </span>
                                                            </md-item-template>
                                                            <md-not-found>
                                                                No Branch matching "{{searchTe}}" were found.
                                                            </md-not-found>

                                                        </md-autocomplete>
                                                    </div>
                                                    <div ng-show="regular_location">
                                                        <div class="col-md-3" style="margin-top:12px">
                                                            <md-autocomplete
                                                                    md-clear-button="true"
                                                                    md-floating-label="Location Name"
                                                                    md-input-maxlength=126
                                                                    md-item-text="item.assetlocation_name"
                                                                    md-items="item in querySearch(searchTe)"
                                                                    md-min-length=0
                                                                    md-no-cache="true"
                                                                    md-search-text="searchTe"
                                                                    md-selected-item="selectedloc"
                                                                    md-selected-item-change="ACselectchangez(item)"
                                                                    placeholder="Location">
                                                                <md-item-template>
                                                                    <span md-highlight-text="searchTe"> {{item.assetlocation_name}} </span>
                                                                </md-item-template>
                                                                <md-not-found>
                                                                    No Location matching "{{searchTe}}" were found.
                                                                </md-not-found>
                                                            </md-autocomplete>
                                                        </div>
                                                    </div>
                                                    <div ng-show="ddl_asset_subsequent">
                                                        <div class="col-md-3" style="margin-top:12px">
                                                            <md-autocomplete
                                                                    md-clear-button="true"
                                                                    md-floating-label="Subsequent Capitilisation"
                                                                    md-input-maxlength=126
                                                                    md-item-text="item.label"
                                                                    md-items="item in assetsubsequent_search(searchtxt_subsequent)"
                                                                    md-min-length=0
                                                                    md-no-cache="true"
                                                                    md-search-text="searchtxt_subsequent"
                                                                    md-selected-item="selected_subsequent"
                                                                    md-selected-item-change="subsequent_change(item)"
                                                                    placeholder="Subsequent Capitilisation"
                                                                    required>
                                                                <md-item-template>
                                                                    <span md-highlight-text="searchtxt_subsequent"> {{item.label}} </span>
                                                                </md-item-template>
                                                                <md-not-found>
                                                                    No matching "{{searchtxt_subsequent}}" were found.
                                                                </md-not-found>
                                                            </md-autocomplete>
                                                        </div>
                                                    </div>
                                                    <div ng-show="ddl_asset_group">
                                                        <div class="col-md-3" style="margin-top:12px">
                                                            <!--                                                            <label>Asset Group</label>-->
                                                            <md-autocomplete
                                                                    md-clear-button="true"
                                                                    md-floating-label="Asset Group"
                                                                    md-input-maxlength=126
                                                                    md-item-text="item.assetgroup_no"
                                                                    md-items="item in assetgroup_search(searchtxt_assetgrp)"
                                                                    md-min-length=0
                                                                    md-no-cache="true"
                                                                    md-search-text="searchtxt_assetgrp"
                                                                    md-selected-item="selected_assetgroup"
                                                                    md-selected-item-change="asset_grp_change(item)"
                                                                    placeholder="Asset Group">
                                                                <md-item-template>
                                                                    <span md-highlight-text="searchtxt_assetgrp"> {{item.assetgroup_no}} </span>
                                                                </md-item-template>
                                                                <md-not-found>
                                                                    No Asset Group matching "{{searchtxt_assetgrp}}"
                                                                    were found.
                                                                </md-not-found>
                                                            </md-autocomplete>
                                                        </div>
                                                    </div>
                                                    <div ng-show="ddl_asset_group">
                                                        <div class="col-md-3" style="margin-top:12px">
                                                            <!--                                                            <label>Asset ID'S </label>-->
                                                            <md-autocomplete
                                                                    md-clear-button="true"
                                                                    md-floating-label="Asset ID'S"
                                                                    md-input-maxlength=126
                                                                    md-item-text="item.assetdetails_id"
                                                                    md-items="item in assetid_search(searchtxt_assetid)"
                                                                    md-min-length=0
                                                                    md-no-cache="true"
                                                                    md-search-text="searchtxt_assetid"
                                                                    md-selected-item="selected_assetid"
                                                                    md-selected-item-change="asset_id_change(item)"
                                                                    placeholder="Asset ID'S">
                                                                <md-item-template>
                                                                    <span md-highlight-text="searchtxt_assetid"> {{item.assetdetails_id}} </span>
                                                                </md-item-template>
                                                                <md-not-found>
                                                                    No Asset ID matching "{{searchtxt_assetid}}"
                                                                    were found.
                                                                </md-not-found>
                                                            </md-autocomplete>
                                                        </div>
                                                    </div>
                                                    <div ng-show="ddl_asset_subsequent_">
                                                        <div class="col-md-3" style="margin-top:0px">
                                                            <label>Capitalize Amt </label>
                                                            <input class="form-control"
                                                                   maxlength="16"
                                                                   ng-blur="tot_amountvalid(finalamt,$index)"
                                                                   ng-disabled="captilize_amt_disable"
                                                                   ng-model="finalamt"
                                                                   ng-pattern="/^[123456789][.0-9]{0,10}$/"
                                                                   placeholder="BUC Capitalize Amt"
                                                                   step="0.01"
                                                                   step="0.01"
                                                                   style="width:180px;font-weight:bold;"

                                                                   type="text"
                                                            />
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-10">
                                                            <div>
                                                                <div class="col-md-3">
                                                                    <!--                                                <label>AP Category </label>-->
                                                                    <md-autocomplete
                                                                            md-clear-button="true"
                                                                            md-floating-label="AP Category"
                                                                            md-item-text="item.category_name"
                                                                            md-items="item in apcatsearch_capitalize(searchapcat_capitalize)"
                                                                            md-min-length=0
                                                                            md-no-cache="true"
                                                                            md-search-text="searchapcat_capitalize"
                                                                            ng-disabled="cat_selected"
                                                                            md-selected-item="selectedapcat_capitalize"
                                                                            md-selected-item-change="apcatchange_capitalize(item)"
                                                                            placeholder="AP Category">
                                                                        <md-item-template>
                                                                            <span md-highlight-text="searchText"> {{item.category_name}} </span>
                                                                        </md-item-template>
                                                                        <md-not-found>
                                                                            No Category matching
                                                                            "{{searchapcat_capitalize}}" were
                                                                            found.
                                                                        </md-not-found>
                                                                    </md-autocomplete>
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <div class="col-md-3">
                                                                    <!--                                                <label>AP SubCategory </label>-->
                                                                    <md-autocomplete
                                                                            md-clear-button="true"
                                                                            md-floating-label="AP SubCategory"
                                                                            md-item-text="item.subcategory_name"
                                                                            md-items="item in apsubcatsearch(searchsubcat_capitalize)"
                                                                            md-min-length=0
                                                                            md-no-cache="true"
                                                                            md-search-text="searchsubcat_capitalize"
                                                                            ng-disabled="cat_selected"
                                                                            md-selected-item="selectedsubcat_capitalize"
                                                                            md-selected-item-change="apsubcatchange_capitalize(item)"
                                                                            ng-disable="nodata_subcat"
                                                                            placeholder="AP SubCategory">
                                                                        <md-item-template>
                                                                            <span md-highlight-text="searchsubcat_capitalize"> {{item.subcategory_name}} </span>
                                                                        </md-item-template>
                                                                        <md-not-found>
                                                                            No SubCategory matching
                                                                            "{{searchsubcat_capitalize}}" were
                                                                            found.
                                                                        </md-not-found>
                                                                    </md-autocomplete>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div ng-show="cwip_grp">
                                                        <div class="col-md-3" style="margin-top:12px">
                                                            <md-autocomplete
                                                                    md-clear-button="true"
                                                                    md-floating-label="CWIP Group"
                                                                    md-input-maxlength=126
                                                                    md-item-text="item.cwipgroup_name"
                                                                    md-items="item in querySearchgrp(searchgrp)"
                                                                    md-min-length=0
                                                                    md-no-cache="true"
                                                                    md-search-text="searchgrp"
                                                                    md-selected-item="selectedgrp"
                                                                    md-selected-item-change="ACselectchange(item)"
                                                                    placeholder="CWIP Group">
                                                                <md-item-template>
                                                                    <span md-highlight-text="searchTe"> {{item.cwipgroup_name}} </span>
                                                                </md-item-template>
                                                                <md-not-found>
                                                                    No CWIP Group matching "{{searchTe}}" were
                                                                    found.
                                                                </md-not-found>
                                                            </md-autocomplete>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3" ng-show="cwip_grp">
                                                        <md-button class="md-fab md-mini md-primary custbutton"
                                                                   ng-click="add_cwipgrp()">
                                                            <md-icon class="material-icons editlink">add</md-icon>
                                                            <md-tooltip>CWIP Group add</md-tooltip>
                                                        </md-button>
                                                    </div>
                                                </div>
                                            </div>
                                        </md-card-content>
                                    </md-card>
                                    <md-card>
                                        <md-card-content>
                                            <div class="body">
                                                <div class="modal-body popup-body">
                                                    <div class="row">
                                                        <div class="col-lg-12 col-sm-12" ng-show="enable_regular">
                                                            <div class="row table-responsive">
                                                                <div class="col-md-12 col-lg-12 col-sm-12">
                                                                    <form name="demoForm">
                                                                        <table class="table table-striped table-bordered table-condensed table-hover md-primary">
                                                                            <thead class="header">
                                                                            <th class="text-center" scope="col">S.No
                                                                            </th>
                                                                            <th class="text-center" scope="col">Product
                                                                                Classification
                                                                            </th>
                                                                            <th class="text-center" scope="col">Product
                                                                                Name
                                                                            </th>
                                                                            <th class="text-center" scope="col">
                                                                                Quantity
                                                                            </th>
                                                                            <th class="text-center" scope="col">Asset
                                                                                Value
                                                                            </th>
                                                                            <th class="text-center"
                                                                                ng-show="includemarkup_ratio_show"
                                                                                scope="col">
                                                                                MarkedUp
                                                                                Ratio
                                                                            </th>
                                                                            <th class="text-center"
                                                                                ng-show="includemarkup_ratio_show"
                                                                                scope="col">
                                                                                Revised Asset
                                                                                Value
                                                                            </th>
                                                                            <!--                                                    <th scope="col" class="text-center">Adjusted Quantity</th>-->
                                                                            <th class="text-center"
                                                                                scope="col">Tot
                                                                                Value
                                                                            </th>
                                                                            <th class="text-center" ng-show="invoice"
                                                                                scope="col">Branch
                                                                            </th>
                                                                            <th class="text-center" ng-show="cwip_data"
                                                                                scope="col">
                                                                                Group
                                                                                Name
                                                                            </th>
                                                                            <th class="text-center" scope="col">
                                                                                Asset
                                                                                Category
                                                                            </th>
                                                                            <th class="text-center" scope="col"
                                                                                title="Only Allow PNG,JPG,JPEG,PDF">
                                                                                <!--                                                        <a title="Only Allow PNG,JPG,JPEG,PDF">Image Upload</a>-->
                                                                                Image Upload
                                                                            </th>
                                                                            <th class="text-center" scope="col">Put To
                                                                                Use
                                                                                Date
                                                                            </th>
                                                                            <th class="text-center" scope="col"> Select
                                                                                <!--                                                                                <input ng-checked="checkall" ng-click="selectall()"-->
                                                                                <!--                                                                                       ng-model="checkall" ype="checkbox">-->
                                                                            </th>
                                                                            <th class="text-center" scope="col>" ng-hide="ddl_asset_subsequent">
                                                                                Apportioned
                                                                            </th>
                                                                            </thead>
                                                                            <tbody>
                                                                            <tr ng-class="(ast.is_strike =='YES')?'strikeout':''"
                                                                                ng-repeat="ast in invoice_asset"
                                                                                ng-show="ast.showhide"
                                                                                style="border-bottom: 1px solid #111;border-collapse: collapse;">
                                                                                <td class="text-center" showhide
                                                                                    style="width:20px;">
                                                                                    <center>
                                                                                        {{((Assetcrntpge-1)*Assetitmpge)+$index+1}}
                                                                                    </center>
                                                                                </td>
                                                                                <td class="text-left"
                                                                                    style="width:20px;">
                                                                                    <md-autocomplete
                                                                                            md-clear-button="true"
                                                                                            md-floating-label="Product Classification"
                                                                                            md-item-text="item.prod_cat_data"
                                                                                            md-items="item in prodsearch(ast.searchTex1)"
                                                                                            md-min-length=0
                                                                                            md-no-cache="true"
                                                                                            md-search-text="ast.searchTex1"
                                                                                            md-selected-item="ast.selectedcat"
                                                                                            md-selected-item-change="ast.prodservicetype(item)"
                                                                                            required>
                                                                                        <md-item-template>
                                                                                            <span md-highlight-text="ast.searchTex1"> {{item.prod_cat_data}} </span>
                                                                                        </md-item-template>
                                                                                        <md-not-found>
                                                                                            No Product Main Category
                                                                                            matching
                                                                                            "{{ast.searchTex1}}" were
                                                                                            found.
                                                                                        </md-not-found>
                                                                                    </md-autocomplete>
                                                                                </td>
                                                                                <td class="text-center"
                                                                                    style="width:1000px;">
                                                                                    <md-autocomplete
                                                                                            md-clear-button="true"
                                                                                            md-item-text="item.product_name"
                                                                                            md-items="item in product_search(ast.selected_product_name)"
                                                                                            md-min-length=0
                                                                                            md-no-cache="true"
                                                                                            md-search-text="ast.selected_product_name"
                                                                                            md-selected-item="ast.select_product_name"
                                                                                            md-selected-item-change="selectchange_prod(item,$index)"
                                                                                            ng-disabled="ast.product_disable">
                                                                                        <md-item-template>
                                                                                            <span md-highlight-text="ast.selected_product_name"> {{item.product_name}} </span>
                                                                                        </md-item-template>
                                                                                        <md-not-found>
                                                                                            No Product matching
                                                                                            "{{ast.selected_product_name}}"
                                                                                            were
                                                                                            found.
                                                                                        </md-not-found>
                                                                                    </md-autocomplete>
                                                                                </td>
                                                                                <td class="text-right"
                                                                                    style="width:20px;">
                                                                                    {{ast.faclringdetails_qty}}
                                                                                    <md-icon
                                                                                            ng-click="qtypop(ast,$index)"
                                                                                            ng-disabled="ast.product_disable"
                                                                                            ng-model="ast.color"
                                                                                            ng-show="invoice"
                                                                                            ng-style="{ color: ast.color }">
                                                                                        call_split
                                                                                    </md-icon>
                                                                                </td>
                                                                                <td class="text-right"
                                                                                    style="width:100px;">
                                                                                    <input class="form-control"
                                                                                           maxlength="16"
                                                                                           ng-blur="tot_amountvalid(ast,$index)"
                                                                                           ng-disabled="ast.unitprice_disable"
                                                                                           ng-model="ast.invoicedetails_unitprice"
                                                                                           ng-pattern="/^[123456789][.0-9]{0,10}$/"
                                                                                           step="0.01"
                                                                                           step="0.01"
                                                                                           style="width:100px;font-weight:bold;"
                                                                                           type="text"
                                                                                           valid-number
                                                                                    />
                                                                                </td>
                                                                                <td class="text-right"
                                                                                    ng-show="includemarkup_ratio_show"
                                                                                    style="width:20px;">
                                                                                    {{ast.faclringdetails_markedup_ratio}}
                                                                                </td>

                                                                                <td class="text-right"
                                                                                    ng-show="includemarkup_ratio_show"
                                                                                    style="width:100px;">
                                                                                    <input class="form-control"
                                                                                           maxlength="16"
                                                                                           ng-disabled="true"
                                                                                           ng-model="ast.invoicedetails_Revised_unitprice"
                                                                                           ng-pattern="/^[123456789][.0-9]{0,10}$/"
                                                                                           step="0.01"
                                                                                           step="0.01"
                                                                                           style="width:100px;font-weight:bold;"
                                                                                           type="text"
                                                                                           valid-number
                                                                                    />
                                                                                </td>
                                                                                <td class="text-right"
                                                                                    style="width:20px;">
                                                                                    {{ast.new_tot_value}}
                                                                                </td>

                                                                                <td class="text-left"
                                                                                    ng-show="cwip_data"
                                                                                    style="width:40px;">
                                                                                    {{ast.cwipgroup_name}}
                                                                                </td>
                                                                                <td class="text-left" ng-show="invoice"
                                                                                    style="width:40px;">
                                                                                    {{ast.branch_name}}
                                                                                </td>
                                                                                <td class="text-center"
                                                                                    style="width:1000px;">
                                                                                    <md-autocomplete
                                                                                            md-clear-button="true"
                                                                                            md-item-text="item.assetcat_subcatname"
                                                                                            md-items="item in querySearchs(ast.searchcat)"
                                                                                            md-min-length=0
                                                                                            md-no-cache="true"
                                                                                            md-search-text="ast.searchcat"
                                                                                            md-selected-item="ast.selectedItem"
                                                                                            md-selected-item-change="selectchange(item)"
                                                                                            ng-disabled="ast.product_disable">
                                                                                        <md-item-template>
                                                                                            <span md-highlight-text="searchText"> {{item.assetcat_subcatname}} </span>
                                                                                        </md-item-template>
                                                                                        <md-not-found>
                                                                                            No Asset Category matching
                                                                                            "{{searchText}}" were
                                                                                            found.
                                                                                        </md-not-found>
                                                                                    </md-autocomplete>
                                                                                </td>
                                                                                <td class="text-center"
                                                                                    style="width:80px;">
                                                                                    <div id="uploadFile"
                                                                                         style="width:100px;height:0px;">
                                                                                        <input accept="image/*, .zip"
                                                                                               base-sixty-four-input
                                                                                               file-model="files"
                                                                                               id="file{{$index}}"
                                                                                               minnum="2"
                                                                                               minsize="500" multiple
                                                                                               name="files"
                                                                                               ng-disabled="ast.product_disable"
                                                                                               ng-model="ast.fileinput"
                                                                                               onchange="angular.element(this).scope().imageUpload(event)"
                                                                                               required
                                                                                               style="width:140px;"
                                                                                               type="file"/>
                                                                                        <!--                                                                <input type="file" file-model="files"  accept=".PDF,.pdf,.png,jpeg`"fileinput="file" id="file" multiple  required/>-->
                                                                                    </div>


                                                                                    <div class="text-right"
                                                                                         style="width:170px;height:5px;">
                                                                                        <button aria-label="Close"
                                                                                                class="btn"
                                                                                                onclick="clearFileInputField('uploadFile')"
                                                                                                style="width:10px;height:20px;">
                                                                                            X
                                                                                        </button>
                                                                                    </div>
                                                                                    &nbsp;
                                                                                    <div ng-repeat="name in ast.filenames">
                                                                                        <a ng-click="viewimage($index)">{{name}}</a>
                                                                                    </div>
                                                                                </td>

                                                                                <td class="text-center"
                                                                                    style="width:100px;">
                                                                                    <md-datepicker formatDate
                                                                                                   md-hide-icons="calendar"
                                                                                                   md-max-date="maxDate"
                                                                                                   md-min-date="minDate"
                                                                                                   md-open-on-focus
                                                                                                   ng-disabled="ast.product_disable"
                                                                                                   ng-init="option_radio = dbdate"
                                                                                                   ng-model="ast.cap_date"
                                                                                                   ng-required="true"></md-datepicker>
                                                                                </td>
                                                                                <td class="text-center"
                                                                                    style="width:10px;">
                                                                                    <input
                                                                                            ng-change="select_capitilize_check($index)"
                                                                                            ng-checked="isChecked"
                                                                                            ng-click="selectEntity()"
                                                                                            ng-model="ast.isChecked"
                                                                                            ng-show="ast.capitalize_checkbox_show"
                                                                                            type="checkbox"
                                                                                    >
                                                                                </td>
                                                                                <td class="text-center" style="..." ng-hide="ddl_asset_subsequent">
                                                                                    <input
                                                                                            ng-change="select_apportion($index)"
                                                                                            ng-checked="isChecked_apportion"
                                                                                            ng-model="ast.isChecked_apportion"
                                                                                            ng-show="ast.apportion_checkbox_show"
                                                                                            type="checkbox"
                                                                                    >

                                                                                </td>
                                                                            </tr>
                                                                            <tr ng-show="invoice_asset.length ==  0">
                                                                                <td class="warning" colspan="15">
                                                                                    No Records Found.
                                                                                </td>
                                                                            </tr>
                                                                            </tbody>
                                                                            <tfoot>
                                                                            <tr>
                                                                                <td colspan="6" ng-show="false" >
                                                                                    <ul boundary-link-numbers="3"
                                                                                        class="pagination-sm cust_pagination"
                                                                                        items-per-page="Assetitmpge"
                                                                                        max-size="AssetmaxSize"
                                                                                        ng-change="paggination()"
                                                                                        ng-model="Assetcrntpge"
                                                                                        total-items="pageLength"
                                                                                        uib-pagination></ul>
                                                                                </td>
                                                                                <td colspan="1" ng-show="false">
                                                                                    <label>Page Count:</label>
                                                                                    <select class="form-control"
                                                                                            ng-model="Assetitmpge"
                                                                                            placeholder="count"
                                                                                            style="width:100px;"
                                                                                            type="text">
                                                                                        <option ng-value="10">10
                                                                                        </option>
                                                                                        <option ng-value="20">20
                                                                                        </option>
                                                                                        <option ng-value="50">50
                                                                                        </option>
                                                                                        <option ng-value="100">100
                                                                                        </option>
                                                                                        <option ng-value="150">150
                                                                                        </option>
                                                                                        <option ng-value="200">200
                                                                                        </option>
                                                                                        <option ng-value="500">500
                                                                                        </option>
                                                                                        <option ng-value="1000">1000
                                                                                        </option>
                                                                                        <option ng-value="2000">2000
                                                                                        </option>
                                                                                        <option ng-value="5000">5000
                                                                                        </option>
                                                                                    </select>
                                                                                </td>
                                                                                <td colspan="12" align="right" >
                                                                                    <p>
                                                                                        <span class="text-right">Amt Capitalised <br/> <b>  &#8377; {{finalamt | number : 0}}</b></span>
                                                                                    </p>
                                                                                </td>
                                                                                <td class="text-right" colspan="4"
                                                                                    ng-show="false">
                                                                                    <span>Total Count:<br/> <b> {{pageLength}}</b></span>
                                                                                </td>
                                                                            </tr>
                                                                            </tfoot>
                                                                        </table>
                                                                    </form>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-lg-12 col-sm-12" ng-show="enable_cwip">
                                                            <div class="row table-responsive">
                                                                <div class="col-md-12 col-lg-12 col-sm-12">
                                                                    <form name="demoForm">
                                                                        <table class="table table-striped table-bordered table-condensed table-hover md-primary">
                                                                            <thead class="header">
                                                                            <th class="text-center" scope="col">S.No
                                                                            </th>
                                                                            <th class="text-center" scope="col">Product
                                                                                Name
                                                                            </th>
                                                                            <th class="text-center" scope="col">
                                                                                Quantity
                                                                            </th>
                                                                            <th class="text-center" scope="col">Unit
                                                                                Price
                                                                            </th>
                                                                            <!--                                                    <th scope="col" class="text-center">Adjusted Quantity</th>-->
                                                                            <th class="text-center" ng-show="invoice"
                                                                                scope="col">Branch
                                                                            </th>
                                                                            <th class="text-center" ng-show="cwip_data"
                                                                                scope="col">
                                                                                Group
                                                                                Name
                                                                            </th>
                                                                            <th class="text-center" scope="col">
                                                                                Category
                                                                            </th>
                                                                            <th class="text-center" scope="col"
                                                                                title="Only Allow PNG,JPG,JPEG,PDF">
                                                                                Image Upload
                                                                            </th>
                                                                            <th class="text-center" scope="col">Invoice
                                                                                Date
                                                                            </th>
                                                                            <th class="text-center" scope="col"> Select
                                                                                <input ng-checked="checkall"
                                                                                       ng-click="selectall()"
                                                                                       ng-model="checkall"
                                                                                       type="checkbox">
                                                                            </th>
                                                                            </thead>
                                                                            <tbody>
                                                                            <tr ng-repeat="ast in invoice_asset">
                                                                                <td class="text-center"
                                                                                    style="width:20px;">
                                                                                    <center>
                                                                                        {{((Assetcrntpge-1)*Assetitmpge)+$index+1}}
                                                                                    </center>
                                                                                </td>
                                                                                <td class="text-left"
                                                                                    style="width:100px;">
                                                                                    {{ast.product_name}}
                                                                                </td>
                                                                                <td class="text-right"
                                                                                    style="width:20px;">
                                                                                    {{ast.invoicedetail_qty}}
                                                                                    <md-icon
                                                                                            ng-click="qtypop(ast,$index)"
                                                                                            ng-model="ast.color"
                                                                                            ng-show="invoice"
                                                                                            ng-style="{ color: ast.color }">
                                                                                        call_split
                                                                                    </md-icon>
                                                                                </td>
                                                                                <td class="text-right"
                                                                                    style="width:100px;">
                                                                                    <input class="form-control"
                                                                                           maxlength="10"
                                                                                           ng-blur="tot_amountvalid(ast,$index)"
                                                                                           ng-model="ast.invoicedetails_unitpricezzzz"
                                                                                           style="width:70px;"
                                                                                           type="text"/>
                                                                                </td>
                                                                                <!--                                                        <td class="text-right" style="width:20px;">-->
                                                                                <!--                                                            <input type="text" style="width:75px;" numbers-only-->
                                                                                <!--                                                                   required-->
                                                                                <!--                                                                   class="form-control" maxlength="3"-->
                                                                                <!--                                                                   ng-model="emp.grninwarddetails_qty">-->
                                                                                <!--                                                        </td>-->
                                                                                <!--                                                        <td class="col-md-3" style="width:20px;">-->
                                                                                <!--                                                            <input type="text" style="width:100px;" numbers-only-->
                                                                                <!--                                                                   required-->
                                                                                <!--                                                                   class="form-control" min="10"-->
                                                                                <!--                                                                   ng-model="emp.assetdetails_value"></td>-->
                                                                                <td class="text-left"
                                                                                    ng-show="cwip_data"
                                                                                    style="width:40px;">
                                                                                    {{ast.cwipgroup_name}}
                                                                                </td>
                                                                                <td class="text-left" ng-show="invoice"
                                                                                    style="width:40px;">
                                                                                    {{ast.branch_name}}
                                                                                    /
                                                                                    {{ast.ap_branch}}
                                                                                </td>
                                                                                <td class="text-center"
                                                                                    style="width:100px;">
                                                                                    <md-autocomplete
                                                                                            md-clear-button="true"
                                                                                            md-item-text="item.assetcat_subcatname"
                                                                                            md-items="item in querySearchs(ast.searchcat)"
                                                                                            md-min-length=0
                                                                                            md-no-cache="true"
                                                                                            md-search-text="ast.searchcat"
                                                                                            md-selected-item="ast.selectedItem"
                                                                                            md-selected-item-change="selectchange(item)">
                                                                                        <md-item-template>
                                                                                            <span md-highlight-text="searchText"> {{item.assetcat_subcatname}} </span>
                                                                                        </md-item-template>
                                                                                        <md-not-found>
                                                                                            No Category matching
                                                                                            "{{searchText}}" were
                                                                                            found.
                                                                                        </md-not-found>
                                                                                    </md-autocomplete>

                                                                                </td>
                                                                                <td class="text-center"
                                                                                    style="width:100px;">
                                                                                    <div id="file_cwips"
                                                                                         style="width:100px;height:0px;">
                                                                                        <input base-sixty-four-input
                                                                                               id="file_cwip{{$index}}"
                                                                                               minsize="500"
                                                                                               multiple
                                                                                               name="files"
                                                                                               ng-change="file_namechg($index)"
                                                                                               ng-model="ast.fileinput"
                                                                                               onchange="angular.element(this).scope().imageUpload(event)"
                                                                                               style="width:140px;"
                                                                                               type="file"/>
                                                                                    </div>
                                                                                    <div class="text-right"
                                                                                         style="width:170px;height:5px;">
                                                                                        <button class="btn"
                                                                                                onclick="clearFileInputField('file_cwips')"
                                                                                                style="width:7px;height:20px;">
                                                                                            X
                                                                                        </button>
                                                                                    </div>
                                                                                    &nbsp;
                                                                                    <div ng-repeat="name in ast.filenames">
                                                                                        <a ng-click="viewimage($index)">{{name}}</a>
                                                                                    </div>

                                                                                </td>
                                                                                <td class="text-center"
                                                                                    style="width:100px;">
                                                                                    <md-datepicker formatDate
                                                                                                   md-hide-icons="calendar"
                                                                                                   md-max-date="maxDate"
                                                                                                   md-min-date="minDate"
                                                                                                   md-open-on-focus
                                                                                                   ng-init="option_radio = dbdate"
                                                                                                   ng-model="ast.cap_date"
                                                                                                   ng-required="true"></md-datepicker>
                                                                                </td>
                                                                                <td class="text-center"
                                                                                    style="width:10px;">
                                                                                    <input
                                                                                            ng-change="selectcheck($index)"
                                                                                            ng-checked="isChecked"
                                                                                            ng-click="selectEntity()"
                                                                                            ng-model="ast.isChecked"
                                                                                            type="checkbox">
                                                                                </td>
                                                                            </tr>
                                                                            <tr ng-show="invoice_asset.length ==  0">
                                                                                <td class="warning" colspan="15">
                                                                                    No Records Found.
                                                                                </td>
                                                                            </tr>
                                                                            </tbody>
                                                                            <tfoot>
                                                                            <tr>
                                                                                <td colspan="7">
                                                                                    <ul boundary-link-numbers="3"
                                                                                        class="pagination-sm cust_pagination"
                                                                                        items-per-page="Assetitmpge"
                                                                                        max-size="AssetmaxSize"
                                                                                        ng-change="paggination()"
                                                                                        ng-model="Assetcrntpge"
                                                                                        total-items="pageLength"
                                                                                        uib-pagination></ul>
                                                                                </td>
                                                                                <td colspan="1">
                                                                                    <p>
                                                                                        <span class="text-right">Amt Capitalised <br/> <b>  &#8377; {{finalamt | number : 0}}</b></span>
                                                                                    </p>
                                                                                </td>
                                                                                <td class="text-left" colspan="1">
                                                                                    <span>Total Count:<br/> <b> {{pageLength}}</b></span>
                                                                                </td>
                                                                            </tr>
                                                                            </tfoot>
                                                                        </table>
                                                                    </form>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </md-card-content>
                                    </md-card>
                                    <div class="row">
                                        <div class="col-md-12 text-center">
                                            <md-button class="btn btn-info custbutton" ng-click="Save(emp)"
                                                       ng-disabled="enable_update">Submit
                                                <md-tooltip>Save</md-tooltip>
                                            </md-button>
                                            <md-button class="md-raised" data-dismiss="modal">Back
                                                <md-tooltip>close</md-tooltip>
                                            </md-button>
                                        </div>
                                    </div>
                                </md-content>
                            </md-tab>
                            <md-tab label="Expense">
                                <md-content class="md-padding">
                                    <div class="col-md-3">
                                        <b>Invoice Total Amount :
                                            <span>&#8377; {{ invoice_totalamt | number : 0}} </span></b>
                                    </div>
                                    <div class="col-md-3">
                                        <b>Balance Amount For Capitalize :
                                            <span>&#8377; {{ faclringheader_balanceamount | number : 0}} </span></b>
                                    </div>



                                    <div class="row">
                                        <div class="col-md-12">
<!--                                            <div class="col-md-3">-->
<!--                                                <md-input-container class="md-block inputcontainer">-->
<!--                                                    <label>Invoice Expense Amount</label>-->
<!--                                                    <input maxlength="10"-->
<!--                                                           ng-blur="invoice_amtchange(invoice_totalamts)"-->
<!--                                                           ng-model="invoice_totalamts"-->
<!--                                                           numbers-only-->
<!--                                                           type="text"/>-->
<!--                                                </md-input-container>-->
<!--                                            </div>-->
<!--                                            <div class="col-md-3" ng-show="invoice_amtext">-->
<!--                                                <md-input-container class="md-block inputcontainer">-->
<!--                                                    <label>Invoice Remaining Amount</label>-->
<!--                                                    <input disabled-->
<!--                                                           maxlength="10"-->
<!--                                                           ng-blur=""-->
<!--                                                           ng-model="invoice_remainamt"-->
<!--                                                           numbers-only-->
<!--                                                           type="text"/>-->
<!--                                                </md-input-container>-->
<!--                                            </div>-->
                                        </div>
                                    </div>
                                    <div class="body">
                        <div class="modal-body popup-body">
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <table
                                            class="table table-striped table-bordered table-condensed table-hover md-primary"
                                            md-progress="deferred">
                                        <thead class="header">
                                        <tr>
                                            <td>
                                                S.No
                                            </td>
                                            <td>Product Name</td>
                                            <td>Expense Amount</td>
                                            <td>Branch Name</td>
                                            <td>Invoice Category</td>
                                            <td>Invoice Subcategory</td>
                                            <td>Invoice GL</td>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr ng-repeat="obj in newary">
                                            <td>
                                                <center>{{$index+1}}</center>
                                            </td>
                                            <td class="text-center">
                                                {{obj.faclringdetails_productname}}
                                            </td>
                                            <td class="text-center">
                                                {{obj.differ_amount}}
                                            </td>
                                            <td class="text-center">
                                                {{obj.branch_name}}
                                            </td>
                                            <td class="text-center">
                                                      <md-autocomplete
                                                        md-clear-button="true"
                                                        md-item-text="item.category_name"
                                                        md-items="item in apcatsearch_exp(obj.searchapcat)"
                                                        md-min-length=0
                                                        md-no-cache="true"
                                                        md-search-text="obj.searchapcat"
                                                        md-selected-item="obj.selectedapcat"
                                                        md-selected-item-change="apcatchange_exp(item,$index)"
                                                        placeholder="Invoice Category">
                                                    <md-item-template>
                                                        <span md-highlight-text="obj.searchapcat"> {{item.category_name}} </span>
                                                    </md-item-template>
                                                    <md-not-found>
                                                        No Category matching
                                                        "{{obj.searchapcat}}" were
                                                        found.
                                                    </md-not-found>
                                                </md-autocomplete>
                                            </td>
                                            <td class="text-center">
                                                          <md-autocomplete
                                                        md-clear-button="true"
                                                        md-item-text="item.subcategory_name"
                                                        md-items="item in apsubcatsearch_exp(obj.searchsubcat)"
                                                        md-min-length=0
                                                        md-no-cache="true"
                                                        md-search-text="obj.searchsubcat"
                                                        md-selected-item="obj.selectedsubcat"
                                                        md-selected-item-change="apsubcatchange_exp(item,$index)"
                                                        ng-disable="nodata_subcat"
                                                        placeholder="Invoice SubCategory">
                                                    <md-item-template>
                                                        <span md-highlight-text="obj.searchsubcat"> {{item.subcategory_name}} </span>
                                                    </md-item-template>
                                                    <md-not-found>
                                                        No SubCategory matching
                                                        "{{obj.searchsubcat}}" were
                                                        found.
                                                    </md-not-found>
                                                </md-autocomplete>
                                            </td>
                                            <td>
                                                 <md-input-container class="md-block inputcontainer">
                                                    <label>Invoice GL </label>
                                                    <input disabled
                                                           maxlength="15"
                                                           ng-blur=""
                                                           ng-model="obj.GL_No"
                                                           type="text"/>
                                                </md-input-container>
                                            </td>

                                        </tr>
                                        </tbody>
                                        <tfoot>
                                        <tr>
                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
<!--                                    <div class="row">-->
<!--                                        <div class="col-md-12">-->
<!--                                            <md-subheader class="md-accent">Invoice Category,SubCategory and Gl-->
<!--                                            </md-subheader>-->
<!--                                            <div class="col-md-3">-->
<!--                                                <label>Invoice Category </label>-->
<!--                                                <md-autocomplete-->
<!--                                                        md-clear-button="true"-->
<!--                                                        md-item-text="item.category_name"-->
<!--                                                        md-items="item in apcatsearch_exp(searchapcat)"-->
<!--                                                        md-min-length=0-->
<!--                                                        md-no-cache="true"-->
<!--                                                        md-search-text="searchapcat"-->
<!--                                                        md-selected-item="selectedapcat"-->
<!--                                                        md-selected-item-change="apcatchange_exp(item)"-->
<!--                                                        placeholder="Invoice Category">-->
<!--                                                    <md-item-template>-->
<!--                                                        <span md-highlight-text="searchText"> {{item.category_name}} </span>-->
<!--                                                    </md-item-template>-->
<!--                                                    <md-not-found>-->
<!--                                                        No Category matching-->
<!--                                                        "{{searchapcat}}" were-->
<!--                                                        found.-->
<!--                                                    </md-not-found>-->
<!--                                                </md-autocomplete>-->
<!--                                            </div>-->
<!--                                            <div class="col-md-3">-->
<!--                                                <label>Invoice SubCategory </label>-->
<!--                                                <md-autocomplete-->
<!--                                                        md-clear-button="true"-->
<!--                                                        md-item-text="item.subcategory_name"-->
<!--                                                        md-items="item in apsubcatsearch_exp(searchsubcat)"-->
<!--                                                        md-min-length=0-->
<!--                                                        md-no-cache="true"-->
<!--                                                        md-search-text="searchsubcat"-->
<!--                                                        md-selected-item="selectedsubcat"-->
<!--                                                        md-selected-item-change="apsubcatchange_exp(item)"-->
<!--                                                        ng-disable="nodata_subcat"-->
<!--                                                        placeholder="Invoice SubCategory">-->
<!--                                                    <md-item-template>-->
<!--                                                        <span md-highlight-text="searchsubcat"> {{item.subcategory_name}} </span>-->
<!--                                                    </md-item-template>-->
<!--                                                    <md-not-found>-->
<!--                                                        No SubCategory matching-->
<!--                                                        "{{searchsubcat}}" were-->
<!--                                                        found.-->
<!--                                                    </md-not-found>-->
<!--                                                </md-autocomplete>-->
<!--                                            </div>-->
<!--                                            <div class="col-md-3">-->
<!--                                                <md-input-container class="md-block inputcontainer">-->
<!--                                                    <label>Invoice GL </label>-->
<!--                                                    <input disabled-->
<!--                                                           maxlength="15"-->
<!--                                                           ng-blur=""-->
<!--                                                           ng-model="glno"-->
<!--                                                           type="text"/>-->
<!--                                                </md-input-container>-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->
                                </md-content>
                            </md-tab>
                        </md-tabs>
                    </md-content>
                </div>
            </div>
        </div>
        <!--        popup page End-->
        <!--        quantity popup-->
        <div aria-hidden="true" aria-labelledby="" class="modal fade" data-backdrop="static"
             data-keyboard="false"
             id="quantitymodal" role="dialog"
             style="height:auto;width:100%" tabindex="-5">
            <div class="modal-dialog modal-lg modal-style" role="document">
                <div class="modal-content">
                    <div class="header">
                        <div class="modal-header popup-header">
                            <h5 class="modal-title" id="ModalLabel">
                                <strong>Split Quantity with Location- {{ Product_name }}</strong>
                                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </h5>
                        </div>
                    </div>
                    <div class="row">
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="col-md-2">
                                <b>Asset Quantity : {{total_qty}}</b>
                            </div>
                            <div class="col-md-2">
                                <b>Product Name : {{Product_name}}</b>
                            </div>
                            <div class="col-md-2">
                                <b>Unit Price : &#8377;{{Unit_price}}</b>
                            </div>
                            <div class="col-md-3">
                                <md-button class="md-fab md-mini md-primary custbutton" ng-click="location_pop()">
                                    <md-icon class="material-icons editlink">location_on</md-icon>
                                    <md-tooltip>location add</md-tooltip>
                                </md-button>
                            </div>
                            <div class="col-md-3" ng-show="cwip_grp">
                                <md-button class="md-fab md-mini md-primary custbutton" ng-click="add_cwipgrp()">
                                    <md-icon class="material-icons editlink">add</md-icon>
                                    <md-tooltip>CWIP Group add</md-tooltip>
                                </md-button>
                            </div>
                        </div>
                    </div>
                    <div class="body">
                        <div class="modal-body popup-body">
                            <div class="row ">
                                <div class="col-lg-12 col-sm-12">
                                    <div class="row table-responsive">
                                        <div class="col-md-12 col-lg-12 col-sm-12">
                                            <fieldset data-ng-repeat="choice in choices">
                                                <div class="row">
                                                    <div class="col-md-2">
                                                        <md-input-container class="md-block inputcontainer">
                                                            <label>Adjusted Quantity</label>
                                                            <input maxlength="4"
                                                                   name=""
                                                                   ng-change="value_check(choice,$index)"
                                                                   ng-model="choice.grninwarddetails_qty"
                                                                   numbers-only
                                                                   placeholder="Enter Quantity" type="text">
                                                        </md-input-container>
                                                    </div>
                                                    <div class="col-md-3" style="margin-top:12px">
                                                        <md-autocomplete
                                                                md-clear-button="true"
                                                                md-floating-label="Branch Name"
                                                                md-input-maxlength=126
                                                                md-item-text="item.branch_name"
                                                                md-items="item in querySearchs_br_split(searchsbr)"
                                                                md-min-length=0
                                                                md-no-cache="true"
                                                                md-search-text="searchsbr"
                                                                md-selected-item="choice.selectedbr"
                                                                md-selected-item-change="branch_change_split(choice,item)"
                                                                placeholder="Branch">
                                                            <md-item-template>
                                                                <span md-highlight-text="searchTe"> {{item.branch_name}} - {{item.branch_code}} </span>
                                                            </md-item-template>
                                                            <md-not-found>
                                                                No Branch matching "{{searchTe}}" were found.
                                                            </md-not-found>

                                                        </md-autocomplete>
                                                    </div>
                                                    <div ng-show="choice.reg_loc">
                                                        <div class="col-md-3" style="margin-top:12px">
                                                            <md-autocomplete
                                                                    md-clear-button="true"
                                                                    md-floating-label="Location Name"
                                                                    md-input-id="show_loc{{$index}}"
                                                                    md-input-maxlength=126
                                                                    md-item-text="item.assetlocation_name"
                                                                    md-items="item in querySearch(searchlocation)"
                                                                    md-min-length=0
                                                                    md-no-cache="true"
                                                                    md-search-text="searchlocation"
                                                                    md-selected-item="choice.location_name"
                                                                    md-selected-item-change="extra_qty($index)"
                                                                    placeholder="Location">
                                                                <md-item-template>
                                                                    <span md-highlight-text="searchlocation"> {{item.assetlocation_name}} </span>
                                                                </md-item-template>
                                                                <md-not-found>
                                                                    No Location matching "{{searchlocation}}" were
                                                                    found.
                                                                </md-not-found>
                                                            </md-autocomplete>
                                                        </div>
                                                    </div>
                                                    <div ng-show="choice.cwip_grp">
                                                        <div class="col-md-3" style="margin-top:12px">
                                                            <md-autocomplete
                                                                    md-clear-button="true"
                                                                    md-input-id="show_cwipgrp{{$index}}"
                                                                    md-input-maxlength=126
                                                                    md-item-text="item.cwipgroup_name"
                                                                    md-items="item in querySearchgrp(searchcwipgrp)"
                                                                    md-min-length=0
                                                                    md-no-cache="true"
                                                                    md-search-text="searchcwipgrp"
                                                                    md-selected-item="choice.cwip_group"
                                                                    md-selected-item-change="extra_qty($index)"
                                                                    placeholder="CWIP Group">
                                                                <md-item-template>
                                                                    <span md-highlight-text="searchTe"> {{item.cwipgroup_name}} </span>
                                                                </md-item-template>
                                                                <md-not-found>
                                                                    No CWIP Group matching "{{searchcwipgrp}}" were
                                                                    found.
                                                                </md-not-found>
                                                            </md-autocomplete>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-3" ng-show="choice.ccbs_show"
                                                         style="margin-top:12px">
                                                        <md-autocomplete
                                                                md-clear-button="true"
                                                                md-floating-label="BS Name"
                                                                md-input-id="show_bs{{$index}}"
                                                                md-input-maxlength=126
                                                                md-item-text="item.bs_name"
                                                                md-items="item in querySearchbs(searchbs)"
                                                                md-min-length=0
                                                                md-no-cache="true"
                                                                md-search-text="searchbs"
                                                                md-selected-item="choice.bs"
                                                                md-selected-item-change="bschange_split(choice,item)"
                                                                placeholder="Select BS">
                                                            <md-item-template>
                                                                <span md-highlight-text="searchTe">{{item.bs_name}} - {{item.bs_code}} </span>
                                                            </md-item-template>
                                                            <md-not-found>
                                                                No BS matching "{{searchTe}}" were found.
                                                            </md-not-found>
                                                        </md-autocomplete>
                                                    </div>
                                                    <div class="col-md-3" ng-show="choice.ccbs_show"
                                                         style="margin-top:12px">
                                                        <md-autocomplete
                                                                md-clear-button="true"
                                                                md-floating-label="CC Name"
                                                                md-input-id="show_cc{{$index}}"
                                                                md-input-maxlength=126
                                                                md-item-text="item.cc_name"
                                                                md-items="item in querySearchcc_split(searchcc)"
                                                                md-min-length=0
                                                                md-no-cache="true"
                                                                md-search-text="searchcc"
                                                                md-selected-item="choice.cc"
                                                                md-selected-item-change="extra_qty($index)"
                                                                placeholder="Select CC">
                                                            <md-item-template>
                                                                <span md-highlight-text="searchTe"> {{item.cc_name}} - {{item.cc_code}} </span>
                                                            </md-item-template>
                                                            <md-not-found>
                                                                No CC matching "{{searchTe}}" were found.
                                                            </md-not-found>
                                                        </md-autocomplete>
                                                    </div>
                                                    <div class="col-md-1">
                                                        <md-checkbox
                                                                ng-change="cwip_checked()"
                                                                ng-checked="isChecked"
                                                                ng-model="choice.cwipck"
                                                                ng-show="cwip_check"
                                                                type="checkbox">
                                                            CWIP
                                                        </md-checkbox>
                                                        <md-icon
                                                                ng-click="assetid_pop($index)"
                                                                ng-model="ast.color"
                                                                ng-show="invoice"
                                                                ng-style="{ color: ast.color }">
                                                            call_split
                                                        </md-icon>
                                                        <md-button class="md-fab md-mini md-primary custbutton"
                                                                   ng-click="removeChoice()"
                                                                   ng-show="$last">
                                                            <md-icon>close</md-icon>
                                                            <md-tooltip>Remove</md-tooltip>
                                                        </md-button>
                                                    </div>
                                                </div>
                                            </fieldset>
                                        </div>
                                    </div>
                                </div>
                                <md-button class="md-fab md-mini md-primary custbutton" ng-click="addNewChoice()"
                                           ng-disabled="add_asset">
                                    <md-icon>add</md-icon>
                                    <md-tooltip>Create Asset</md-tooltip>
                                </md-button>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <md-button class="btn btn-info custbutton" ng-click="Sve()"
                                       ng-disabled="enable_Qty">Add
                                <md-tooltip>Save</md-tooltip>
                            </md-button>
                            <md-button class="md-raised" data-dismiss="modal" ng-click="qty_check()">Back
                                <md-tooltip>close</md-tooltip>
                            </md-button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--                quantity popup ends-->
        <!--        location popup-->
        <div aria-hidden="" aria-labelledby="exampleModalLabel" class="modal fade" data-backdrop="" data-keyboard=""
             id="locationpopup"
             role="dialog" tabindex="-1">
            <div class="modal-dialog modal-sm" role="document" style="height:auto;width:50%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleLabel">
                            Asset Location Details
                            <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="modal-body popup-body">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-3">
                                    <label>Branch</label>
                                    <md-autocomplete
                                            md-clear-button="true"
                                            md-input-maxlength=126
                                            md-item-text="item.branch_name"
                                            md-items="item in querySearchbr(searchbr)"
                                            md-min-length=0
                                            md-no-cache="true"
                                            md-search-text="searchbr"
                                            md-selected-item="as_brch"
                                            md-selected-item-change="branch_change(item)"
                                            placeholder="Branch">
                                        <md-item-template>
                                            <span md-highlight-text="searchTe"> {{item.branch_name}} - {{item.branch_code}} </span>
                                        </md-item-template>
                                        <md-not-found>
                                            No Branch matching "{{searchTe}}" were found.
                                        </md-not-found>
                                    </md-autocomplete>
                                </div>
                                <div class="col-md-1"></div>
                                <div class="col-md-3">
                                    <md-input-container class="md-block inputcontainer">
                                        <label>Location Name</label>
                                        <input ng-change="myfunc()" ng-model="as_loc"
                                               type="text"/>
                                    </md-input-container>
                                </div>
                                <div class="col-md-2">
                                    <md-input-container class="md-block inputcontainer">
                                        <label>Floor</label>
                                        <input ng-change="myfunc()" ng-model="as_flr"
                                               type="text"/>
                                    </md-input-container>
                                </div>
                                <div class="col-md-3">
                                    <md-input-container class="md-block inputcontainer">
                                        <label>Remarks</label>
                                        <input ng-change="myfunc()" ng-model="as_rmks"
                                               type="text"/>
                                    </md-input-container>
                                </div>
                            </div>
                        </div>
                        <!--                                    <div class="col-md-3">-->
                        <!--                                        <md-input-container class="md-block inputcontainer">-->
                        <!--                                            <label>Floor </label>-->
                        <!--                                            <md-select type="text" maxlength="30" ng-model="location.floor">-->
                        <!--                                                <md-option ng-repeat="item in location.drop_location">{{item.assetlocation_floor}}</md-option>-->
                        <!--                                            </md-select>-->
                        <!--                                        </md-input-container>-->
                        <!--                                    </div>-->
                        <!--                                    <div class="col-md-3">-->
                        <!--                                        <md-input-container class="md-block inputcontainer">-->
                        <!--                                            <label>Block </label>-->
                        <!--                                            <md-select type="text" maxlength="30" ng-model="location.block">-->
                        <!--                                                <md-option ng-repeat="item in location.drop_location">{{item.remarks}}</md-option>-->
                        <!--                                            </md-select>-->
                        <!--                                        </md-input-container>-->
                        <!--                                    </div>-->
                        <!--                                </div>-->
                        <div class="row">
                            <div class="col-xs-12 text-center">
                                <md-button class="btn btn-info custbutton" ng-click="update(location)">Save
                                    <md-tooltip>Save</md-tooltip>
                                </md-button>
                                <md-button class="md-raised" data-dismiss="modal">Back
                                    <md-tooltip>close</md-tooltip>
                                </md-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--        location popup ends-->

        <!--        Asset ID Choose Pop Up 2020 Starts-->
        <div aria-hidden="true" aria-labelledby="" class="modal fade" data-backdrop="static"
             data-keyboard="false"
             id="quantitymodal_assetid" role="dialog"
             style="height:auto;width:100%" tabindex="-5">
            <div class="modal-dialog modal-lg modal-style" role="document">
                <div class="modal-content">
                    <div class="header">
                        <div class="modal-header popup-header">
                            <h5 class="modal-title" id="ModalLabel_assetid">
                                <strong>Split Quantity with Asset ID- {{ Product_name }}</strong>
                                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </h5>
                        </div>
                    </div>
                    <div class="row">
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="col-md-4">
                                <b>Total Quantity : {{total_qty}}</b>
                            </div>
                            <div class="col-md-4">
                                <b>Adjusted Quantity : {{adjusted_qty_pop}}</b>
                            </div>
                            <div class="col-md-4">
                                <b>Product Name : {{Product_name}}</b>
                            </div>

                        </div>
                    </div>
                    <div class="body" style="width:1000px; height:400px; overflow: auto;">
                        <div class="modal-body popup-body">
                            <div class="row">
                                <div class="col-lg-12 col-sm-12">
                                    <div class="row table-responsive">
                                        <div class="col-md-12 col-lg-12 col-sm-12">
                                            <form name="form_assetid">
                                                <table class="table table-striped table-bordered table-condensed table-hover md-primary">
                                                    <thead class="header">
                                                    <th class="text-center">
                                                        S.No
                                                    </th>
                                                    <th class="text-center">
                                                        Asset ID
                                                    </th>
                                                    <th class="text-center">
                                                        Select
                                                    </th>
                                                    </thead>
                                                    <tbody>
                                                    <tr ng-repeat="ast_id in asset_id_adjusted">
                                                        <td class="text-center"
                                                            style="width:20px;">
                                                            <center>
                                                                {{((Assetcrntpge-1)*Assetitmpge)+$index+1}}
                                                            </center>
                                                        </td>
                                                        <td class="text-left"
                                                            style="width:20px;">
                                                            {{ast_id.assetid_assetid}}
                                                        </td>
                                                        <td class="text-center"
                                                            style="width:10px;">
                                                            <input
                                                                    ng-change="select_ast_id($index)"
                                                                    ng-checked="ast_id.astid_ischecked"
                                                                    ng-disabled="ast_id.astid_disabled"
                                                                    ng-model="ast_id.astid_ischecked"
                                                                    type="checkbox"
                                                            >
                                                            <label>{{ast_id.checkbox_txt}}</label>
                                                        </td>
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <md-button class="btn btn-info custbutton" ng-click="Save_asset_id_selection()"
                                       ng-disabled="enable_asset_id_qty">Add
                                <md-tooltip>Save</md-tooltip>
                            </md-button>
                            <md-button class="md-raised" data-dismiss="modal">Back
                                <md-tooltip>close</md-tooltip>
                            </md-button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--        Asset ID Choose Pop Up Ends -->

        <!--Image start-->
        <div aria-hidden="" aria-labelledby="exampleModalLabel"
             class="modal fade"
             data-backdrop="" data-keyboard="false"
             id="cwip_grp_popup">
            <div class="modal-dialog modal-md modal-style" role="document">
                <div class="modal-content">
                    <div class="header">
                        <div class="modal-header popup-header">
                            <h5 class="modal-title" id="exampleModalLabels">
                                <strong>Bucket Add</strong>
                                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </h5>
                        </div>
                    </div>
                    <div class="body">
                        <div class="modal-body popup-body">
                            <div class="row">
                                <div class="col-lg-12 col-sm-12">
                                    <div class="col-md-4">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Bucket Name</label>
                                            <input maxlength="30" ng-model="cwip_name"
                                                   placeholder="Bucket Name"
                                                   type="text"/>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-4" ng-show="false">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Bucket GL</label>
                                            <input maxlength="30" ng-model="cwip_gl"
                                                   placeholder="Bucket GL"
                                                   type="text"/>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-4">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>Type</label>
                                            <md-select md-container-class="popup_select"
                                                       ng-model="selected_cwiptype_ddl"
                                                       ng-model-options="{trackBy: '$value.value'}"
                                                       placeholder="Select Bucket Type">
                                                <md-option ng-click="cwiptype_click(x.value)"
                                                           ng-repeat="x in Cwiptypeddl"
                                                           ng-value="x">{{ x.label }}
                                                </md-option>
                                            </md-select>
                                        </md-input-container>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-12 col-sm-12">
                                    <div class="col-md-3">
                                    </div>
                                    <div class="col-md-3">
                                        <md-button class="btn btn-info custbutton" ng-click="save_cwip()"
                                                   ng-disabled="enable_cwip_grp">Add
                                            <md-tooltip>Save</md-tooltip>
                                        </md-button>
                                    </div>
                                    <div class="col-md-3">
                                        <md-button class="md-raised" data-dismiss="modal">Back
                                            <md-tooltip>close</md-tooltip>
                                        </md-button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--Image start-->
        <div aria-hidden="" aria-labelledby="exampleModalLabel"
             class="modal fade"
             data-backdrop="" data-keyboard="false"
             id="imdiate_view">
            <div class="modal-dialog modal-lg modal-style" role="document">
                <div class="modal-content">
                    <div class="header">
                        <div class="modal-header popup-header">
                            <h5 class="modal-title" id="exampleModalLabel2">
                                <strong>eClaim Expense Attachment View</strong>
                                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </h5>
                        </div>
                    </div>
                    <div class="body">
                        <div class="modal-body popup-body">
                            <div class="row">
                                <div class="col-lg-12 col-sm-12">
                                    <img src="{{file_path }}" style="width:870px;height:500px"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endverbatim %}
<style>
.btn-file {
    position: relative;
    overflow: hidden;
}
.btn-file input[type=file] {
    position: absolute;
    top: 0;
    right: 0;
    min-width: 100%;
    min-height: 100%;
    font-size: 100px;
    text-align: right;
    filter: alpha(opacity=0);
    opacity: 0;
    outline: none;
    background: white;
    cursor: inherit;
    display: block;




</style>
<script>
function clearFileInputField(tagId) {
    document.getElementById(tagId).innerHTML =
        document.getElementById(tagId).innerHTML;
    }











</script>
<script>
var app = angular.module('dateapp', ['ngMaterial', 'ui.bootstrap', 'AppCommon', 'ngMessages'])
    .config(function($httpProvider) {
        $httpProvider.defaults.xsrfCookieName = 'csrftoken';
        $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
    });
<!--app.controller('datectrl', function($scope, newservice, $window, $mdToast, $interval, SerCommon, $element, $http, $mdDateLocale, $mdDialog, $filter,$q, $rootScope) {-->
app.controller('datectrl', ['$scope', '$filter', '$mdDateLocale', 'newservice', '$window', '$mdDialog','$rootScope','$element','$http','$q',
    function($scope, $filter, $mdDateLocale,newservice,$window,$mdDialog,$rootScope, $element, $http, $q) {

    $mdDateLocale.formatDate = function(date) {
        return $filter('date')(date, "dd-MMM-yyyy");
    };
    var detail = JSON.parse(sessionStorage.getItem('today'));
    var td = detail.date;
    var employgid = detail.employee_gid;
    $scope.entity_gid = detail.entity_gid;
    $scope.dbdate = convertdate(td);
    $scope.orderByField = '';
    $scope.itemsPerPage = 10;
    $scope.currentPage = 1;
    $scope.maxSize = 5;
    $scope.invoice_asset = [];
    $scope.get_drop_data = [];
    $scope.asset_invoice = [];
    $scope.Details = "";
    $scope.files = "";
    $scope.imagebase = [];
    $scope.final_amt = [];
    $scope.enable_update = true;   <!--This not usee-->
    $scope.btn_makegrp_ed = true;
    $scope.ddl_cwipgrp = false;
    $scope.enable_regular = false;
    $scope.enable_cwip = false;
    $scope.regular_location = false;
    $scope.enable_Qty = true;
    $scope.cwip_check = false;
    $scope.drop_data = [];
    $scope.drop_location = [];
    $scope.get_drop_location = [];
<!--    $scope.get_asset_group = [];-->
    $scope.get_floor = [];
    $scope.set_branch = [];
    $scope.quantity = [];
    $scope.grninwarddetails_qty = '';
    $scope.location_name = '';
    $scope.add_asset = false;
    $scope.enable_check = true;
    $scope.Assetcrntpge = 1;
    $scope.AssetmaxSize = 5;
    $scope.Assetitmpge = 10;
    $scope.pageLength ='';
    $scope.singleasset = false;
    $scope.radio_item = 'REGULAR';
    $scope.split_qty_full = [];
    $scope.split_data = [];
    $scope.ddl_asset_group = false;
    $scope.includemarkup_ratio_show = false;
    $scope.all_asst_ids = [];
    $scope.set_branch = [];
    var isany_apportion_checked = 'N';
    $scope.captilize_amt_disable = true;
    $scope.expense_amount_calc_initial = 0;

    $scope.loading = function() {
        $mdDialog.show({
            templateUrl: 'loaderSpinner',
            parent: angular.element(document.body),
            clickOutsideToClose: false
        });
    };
   $scope.loading_popup_cwip = function() {
        $mdDialog.show({
            templateUrl: 'loaderSpinner',
            parent: angular.element(document.getElementById('cwip_grp_popup')),
            clickOutsideToClose: false
        });
    };
    $scope.loading_popup = function() {
        $mdDialog.show({
            templateUrl: 'loaderSpinner',
            parent: angular.element(document.getElementById('viewmodal')),
            clickOutsideToClose: false
        });
    };
    $scope.quantitymodal = function() {
        $mdDialog.show({
            templateUrl: 'loaderSpinner',
            parent: angular.element(document.getElementById('quantitymodal')),
            clickOutsideToClose: false
        });
    };
    $scope.endloading = function() {
        $mdDialog.hide();
    };
    $scope.cwip_total = '';
    $scope.paggination = function(){
        if ($scope.option_make == "Regular") {
            $scope.page_dataput =[];
            $scope.page_dataput.push({"invoiceheader_gid":$scope.invoice_no,"cwip_count":$scope.cwip_total});
            $scope.viewdet($scope.page_dataput[0]);
        } else{
            $scope.page_dataput =[];
            $scope.page_dataput.push({"cwipgroup_gid":$scope.cwipgroupgid,"cwip_count":$scope.cwip_total});
            $scope.viewcwip($scope.page_dataput[0]);
         }
    }
    $scope.invoice_branchgid = "";
    $scope.viewcwip = function(e) {
    $scope.loading();
        $scope.invoice_asset =[];
        $scope.cwipgroupgid = e.cwipgroup_gid;
        $scope.cwip_total = e.cwip_count;
        $scope.invoice_supplier = e.cwipgroup_name;
        $scope.invoice_branchgid = e.cwipasset_branchgid;
        var data = {
            "Params": {
                "FILTER": {
                    "CWIP_Group_Gids": $scope.cwipgroupgid,
                     "Page_Index":$scope.Assetcrntpge,
                     "Page_Size":$scope.Assetitmpge,
                },
            }
        };
        var get_insasset = newservice.cwip_filter(data)
        $scope.invoice_asset =[];
        get_insasset.then(function(result) {

            $scope.main = result.data.DATA;

            if(result.data.MESSAGE == 'ERROR_OCCURED' ){
              alert('Error Occured.');
            }

            $scope.invoice_asset_base = [];
            $scope.invoice_asset_base = $scope.main;
            $scope.invoice_asset = $scope.main;
            $scope.debit_gid = $scope.invoice_asset[0].debit_gid;
            for (i = 0; i < $scope.invoice_asset.length; i++) {
<!--                $scope.invoice_asset[i].drop_data = $scope.get_drop_data;-->
                alert('Here Alert');
                $scope.invoice_asset[i].cap_date = new Date();
<!--                $scope.maxDate = new Date($scope.invoice_asset[i].cap_date.getFullYear(), $scope.invoice_asset[i].cap_date.getMonth(), $scope.invoice_asset[i].cap_date.getDate() + 7);-->
<!--                $scope.minDate = new Date($scope.invoice_asset[i].cap_date.getFullYear(), $scope.invoice_asset[i].cap_date.getMonth() - 1, $scope.invoice_asset[i].cap_date.getDate());-->
                $scope.invoice_asset[i].color = "green";
                for (k = 0; k < $scope.get_drop_data.length; k++) {
                    if ($scope.invoice_asset[i].asset_cat_gid == $scope.get_drop_data[k].assetcat_gid){
                        $scope.invoice_asset[i].searchcat = $scope.get_drop_data[k].assetcat_subcatname;
                        $scope.invoice_asset[i].selectedItem = $scope.get_drop_data[k];
                    }
                }
            };
            $scope.invoice_taxamt = $scope.invoice_asset[0].invoicedetails_taxamt;
            $scope.invoice_totalamt = $scope.invoice_asset[0].invoicedetails_totalamt;
            $scope.invoice_totalamts = $scope.invoice_totalamt;
            $scope.invoice_supplier = $scope.invoice_asset[0].supplier_name;
            $scope.Totalpages = Math.ceil($scope.cwip_total/ $scope.Assetitmpge);
            $scope.pageLength = $scope.cwip_total;
            for (var i = 0; i < $scope.invoice_asset.length; i++) {
                $scope.invoice_asset[i].cap_date = convertdate(td);
            }
            locpop(e);
            $scope.mode_choose();
            var model = modalshow('viewmodal');
        }).finally($scope.endloading);
    }
    $scope.get_cwip_data = [];
    $scope.viewdet = function(e) {
    $scope.loading();
        $scope.newary = [];
        $scope.invoice_asset =[];
        $scope.search_bs = '';
        $scope.search_cc = '';
        $scope.selectedbr = '';
        $scope.no_ccdata = true;
        $scope.get_cc =[];
        $scope.searchTe = '';
        $scope.invoice_no = e.faclringheader_gid;
<!--        $scope.invoice_supplier = e.faclringdetails_suppliergid;-->
        $scope.invoice_supplier = e.supplier_name;
        $scope.invoice_branchgid = e.faclringdetails_branchgid;
        var data = {
            "Params": {
                "FILTER": {
                    "FAClearance_HeaderGid": $scope.invoice_no
                },
            }
        };


<!-- Adjusted qty asset id function-->

      $scope.qty_asst = function fn_adjusted_asset_id(asst_id_pono) {
          var data = {
            "Params": {
                "FILTER": {
                    "PO_No": asst_id_pono
                },
            }
        };

       var get_assetid_adjusted = newservice.adjusted_asset_id(data)
        get_assetid_adjusted.then(function(result) {
          $scope.main = result.data.DATA;
          $scope.asset_id_adjusted = $scope.main;

          if ($scope.all_asst_ids.length != 0){

              for (var i=0; i < $scope.asset_id_adjusted.length;i++){
                var id_exists_check = $scope.asset_id_adjusted[i].assetid_gid;

                if ($scope.all_asst_ids.indexOf(id_exists_check) != -1 ){
                      $scope.asset_id_adjusted[i].astid_disabled = true;
                      $scope.asset_id_adjusted[i].checkbox_txt = 'Already Selected';

                 }
                 else {
                   $scope.asset_id_adjusted[i].astid_disabled = false;
                   $scope.asset_id_adjusted[i].checkbox_txt = '';
                 }

              }




          }

        });
      }

<!--pop summary 2020-->
        var get_insasset = newservice.invoice_filter(data)
        $scope.invoice_asset = [];
        $scope.invtot = 0 ;
        $scope.finalamt = 0;
        $scope.aryy = []
        $scope.faclringheader_balanceamount = 0;
        get_insasset.then(function(result) {
            $scope.main = result.data.DATA;
            $scope.invoice_asset_base = [];
            $scope.invoice_asset_base = $scope.main;
            $scope.invoice_asset = $scope.main;
<!--            $scope.debit_gid = $scope.invoice_asset[0].debit_gid;-->
              var total = 0;
            for (i = 0; i < $scope.invoice_asset.length; i++) {
<!--                alert($scope.invoice_asset[i].invoicedetails_totalamt);-->
<!--                       alert($scope.invoice_asset[i].faclringheader_expenseamount);-->
                total +=  $scope.invoice_asset[i].invoicedetails_totalamt;

                    var d = new Date();
<!--                   var daynow = d.getDate();-->
                   var monthnow = d.getMonth()+1;
                   var yearnow = d.getFullYear();
<!--                   daynow = daynow -1;-->

                    if (monthnow >12 || monthnow < 4){
                        yearnow = yearnow -1;
                    }
                      var one = new Date(yearnow,03,01);
                      var two = new Date(d.getFullYear(), d.getMonth(), d.getDate());


                      daynow = Math.round((two-one)/(1000*60*60*24)) ;



<!--                $scope.invoice_asset[i].drop_data = $scope.get_drop_data;-->
                $scope.invoice_asset[i].cap_date = new Date();
                $scope.maxDate = new Date($scope.invoice_asset[i].cap_date.getFullYear(), $scope.invoice_asset[i].cap_date.getMonth(), $scope.invoice_asset[i].cap_date.getDate());
                $scope.minDate = new Date($scope.invoice_asset[i].cap_date.getFullYear(), $scope.invoice_asset[i].cap_date.getMonth(), $scope.invoice_asset[i].cap_date.getDate() - daynow);
                $scope.invoice_asset[i].color = "green";
                $scope.invoice_asset[i].invoicedetails_unitprice = ($scope.invoice_asset[i].invoicedetails_totalamt / $scope.invoice_asset[i].faclringdetails_qty) ;
                $scope.invoice_asset[i].invoicedetails_unitprice = parseFloat($scope.invoice_asset[i].invoicedetails_unitprice).toFixed(2)
                $scope.invoice_asset[i].invoicedetails_unitprice_duplicate = parseFloat($scope.invoice_asset[i].invoicedetails_unitprice).toFixed(2)
                $scope.invoice_asset[i].selected_product_name = $scope.invoice_asset[i].faclringdetails_productname;
                $scope.invoice_asset[i].selected_product_gid = $scope.invoice_asset[i].faclringdetails_productgid;

                if($scope.invoice_asset[i].faclringdetails_productgid > 0){

                var maindtata = {
                    "Params": {
                        "FILTER": {
                        "Prod_Gid":$scope.invoice_asset[i].faclringdetails_productgid
                        },
                        "CLASSIFICATION": {
                            "Entity_Gid": $scope.entity_gid
                        }
                    }
                }
                var p_s = {
                    Group: "GET_ALL_PRODUCT",
                    Type: "PRODUCT_CLASSIFICATION",
                    Sub_Type: "DDL",
                    data: maindtata
                }
                  var get_category = newservice.productorservices(p_s)
                  get_category.then(function(result) {
                    prodcatgory = result.data.DATA;
                    $scope.aryy.push(prodcatgory[0].Pdct_Classification);
                    for(i=0;i<$scope.invoice_asset.length;i++){
                    if($scope.invoice_asset[i].faclringdetails_productgid > 0){
                    $scope.invoice_asset[i].searchTex1 = $scope.aryy[i]
                    }
                    }
                }, function(err) {
                    alert('No data!.');
                }).finally();


                }

                if ($scope.invoice_asset[i].faclringdetails_productgid == 0){
                 $scope.invoice_asset[i].faclringdetails_pdctclassification = 'Service' ;
                }
                else {
                 $scope.invoice_asset[i].faclringdetails_pdctclassification = 'Goods' ;
                }


                $scope.invoice_asset[i].apportion_checkbox_show = true;
                $scope.invoice_asset[i].capitalize_checkbox_show = true;
                $scope.invoice_asset[i].unitprice_disable = true;

<!--                $scope.selected_product = $scope.invoice_asset[i].faclringdetails_productgid;-->

<!--                for (k = 0; k < $scope.get_drop_data.length; k++) {-->
<!--                    if ($scope.invoice_asset[i].asset_cat_gid == $scope.get_drop_data[k].assetcat_gid){-->
<!--                        $scope.invoice_asset[i].searchcat = $scope.get_drop_data[k].assetcat_subcatname;-->
<!--                        $scope.invoice_asset[i].selectedItem = $scope.get_drop_data[k];-->
<!--                    }-->
<!--                }-->


                if ($scope.selected == 'BUC' || ($scope.selected == 'CWIP') ){
                 $scope.invoice_asset[i].faclringdetails_qty = 1;
                 }
                  $scope.invoice_asset[i].showhide = true;
                if ($scope.radio_item == 'BUC' || ($scope.radio_item == 'CWIP') ){
                      if (i != 0){
                         $scope.invoice_asset[i].showhide = false;
                      }
                      $scope.invoice_asset[i].apportion_checkbox_show = false;

                }

            };
<!--            For Loop ends above-->

                $scope.invoice_taxamt = $scope.invoice_asset[0].faclringheader_tottaxamount;

<!--                 total += $scope.invoice_asset[0].faclringheader_expenseamount;-->
                $scope.invoice_totalamt = total;

                if ($scope.radio_item == 'BUC' ||  ($scope.radio_item == 'CWIP')  ){



                   $scope.faclringheader_captalizedamount = $scope.invoice_asset[0].faclringheader_captalizedamount;

                   if ($scope.faclringheader_captalizedamount == 0){
                     $scope.faclringheader_balanceamount = $scope.invoice_totalamt;
                     $scope.invoice_asset[0].invoicedetails_unitprice = $scope.invoice_totalamt;
                   }
                   else {
                     $scope.faclringheader_balanceamount = $scope.invoice_asset[0].faclringheader_balanceamount;
                     $scope.invoice_totalamt = $scope.faclringheader_balanceamount + $scope.faclringheader_captalizedamount ;
                      $scope.invoice_totalamt += $scope.invoice_asset[0].faclringheader_expenseamount;
                     $scope.invoice_asset[0].invoicedetails_unitprice = $scope.invoice_asset[0].faclringheader_balanceamount;
                   }
                }
                else {
                   $scope.faclringheader_balanceamount = $scope.invoice_asset[0].faclringheader_balanceamount;


                }

<!--            $scope.invoice_supplier = $scope.invoice_asset[0].supplier_name;-->
<!--            $scope.Totalpages = Math.ceil($scope.invoice_asset.length / $scope.Assetitmpge);-->
<!--            $scope.pageLength = $scope.invoice_asset.length;-->
<!--            for (var i = 0; i < $scope.invoice_asset.length; i++) {-->
<!--                $scope.invoice_asset[i].cap_date = convertdate(td);-->
<!--            }-->

            locpop(e);
<!--            cwip_group_data();-->
            $scope.mode_choose();
            var model = modalshow('viewmodal');
        }).finally($scope.endloading);
    }

    function cwip_group_data(selected_radio){
    var get_cwip = newservice.cwipgrp_data(selected_radio)
        get_cwip.then(function(result) {
            $scope.main = result.data.DATA;
            $scope.get_cwip_data = $scope.main;
        });
    }

    $scope.selectdate = function() {
        $scope.invoicedate = $filter('date')(new Date($scope.invoice_date),'yyyy-MM-dd');
    }

    $scope.search = function() {
        $scope.mode_make();
    }
    $scope.invoice_amtext = false;
    $scope.invoice_totalamts = $scope.invoice_totalamt;



<!--AP Sub Cat Change-->
 $scope.apsubcatchange_capitalize = function(item){
     var get_drop = newservice.asset_cat_buc(item.subcategory_gid)
        get_drop.then(function(result) {
            $scope.main = result.data.DATA;
            $scope.get_drop_data = $scope.main;

            if (result.data.MESSAGE == 'NOT_FOUND'){
               error_toast(not_found_asstcat,time_toast);
            }
            else{
                angular.forEach($scope.invoice_asset, function(item1) {
                    item1.searchcat = $scope.get_drop_data[0].assetcat_subcatname;
                    item1.selectedItem = $scope.get_drop_data[0];
                });
            }

        });
 }


	   var unique = function(origArr) {
        var newArr = [],
            origLen = origArr.length,
            found, x, y;
        for (x = 0; x < origLen; x++) {
            found = undefined;
            for (y = 0; y < newArr.length; y++) {
                if (origArr[x] === newArr[y]) {
                    found = true;
                    break;
                }
            }
            if (!found) {
                newArr.push(origArr[x]);
            }
        }
        return newArr;
}

<!--  This is called when unit price changed Manually-->
$scope.newary = [];
    $scope.tot_amountvalid = function(e,i){

if ($scope.radio_item == 'BUC' || $scope.radio_item == 'CWIP' ){
if(e > 0){
$scope.invoice_asset[0].new_tot_value = e;
$scope.invoice_asset[0].invoicedetails_unitprice = '';
}
 $scope.invoice_asset[i].invoicedetails_unitprice = e.invoicedetails_unitprice;
        $scope.invoice_totalamts = e.invoicedetails_unitprice * e.faclringdetails_qty;
        $scope.invoice_totaloriginalamnt = e.new_tot_value;
        $scope.invoice_amtchange($scope.invoice_totalamts);

        $scope.invoice_asset[i].differ_amount = parseFloat(parseFloat($scope.invoice_totaloriginalamnt).toFixed(2) - parseFloat($scope.invoice_totalamts).toFixed(2)).toFixed(2);
        if($scope.invoice_asset[i].differ_amount > 0){
        if($scope.newary.length != 0){
        for(k=0;k<$scope.invoice_asset.length;k++){
        for(j=0;j<$scope.newary.length;j++){
        if($scope.newary[j].faclringdetails_gid  == $scope.invoice_asset[k].faclringdetails_gid){
        $scope.newary[j].differ_amount  = $scope.invoice_asset[k].differ_amount
        }
         else{
        $scope.newary.push($scope.invoice_asset[i]);
        return false;
        }
        }
        }}
         else{
        $scope.newary.push($scope.invoice_asset[i]);
        }

        }
        return false;
}
        $scope.invoice_asset[i].invoicedetails_unitprice = e.invoicedetails_unitprice;
        $scope.invoice_totalamts = e.invoicedetails_unitprice * e.faclringdetails_qty;
        $scope.invoice_totaloriginalamnt = e.invoicedetails_unitprice_duplicate * e.faclringdetails_qty;

        $scope.invoice_amtchange($scope.invoice_totalamts);

        $scope.invoice_asset[i].expense_changed_amount = $scope.invoice_asset[i].capitalized_amount - $scope.invoice_totalamts ;
        $scope.invoice_asset[i].differ_amount = parseFloat(parseFloat($scope.invoice_totaloriginalamnt).toFixed(2) - parseFloat($scope.invoice_totalamts).toFixed(2)).toFixed(2);
        if($scope.invoice_asset[i].differ_amount > 0){
        if($scope.newary.length != 0){
        for(k=0;k<$scope.invoice_asset.length;k++){
        for(j=0;j<$scope.newary.length;j++){
        if($scope.newary[j].faclringdetails_gid  == $scope.invoice_asset[k].faclringdetails_gid){
        $scope.newary[j].differ_amount  = $scope.invoice_asset[k].differ_amount
        }
         else{
        $scope.newary.push($scope.invoice_asset[i]);
        return false;
        }
        }
        }}
         else{
        $scope.newary.push($scope.invoice_asset[i]);
        }

        }
        if($scope.invoice_asset[i].differ_amount < 0){

        for(j=0;j<$scope.newary.length;j++){
        if($scope.newary[j].faclringdetails_gid  == $scope.invoice_asset[i].faclringdetails_gid){
        $scope.newary.splice(j, 1);
        }
        }}
        if($scope.invoice_asset[i].differ_amount == 0){

        for(j=0;j<$scope.newary.length;j++){
        if($scope.newary[j].faclringdetails_gid  == $scope.invoice_asset[i].faclringdetails_gid){
        $scope.newary.splice(j, 1);
        }
        }}

         var tot_amt_expense_changed=0;
         for (var i=0;i < $scope.invoice_asset.length;i++){

             if ($scope.invoice_asset[i].expense_changed_amount != undefined){
                tot_amt_expense_changed += $scope.invoice_asset[i].expense_changed_amount;
             }

         }
            $scope.invoice_totalamts = tot_amt_expense_changed;
            $scope.invoice_remainamt = $scope.invoice_totalamt - tot_amt_expense_changed;

            if ($scope.invoice_remainamt < 0){
              alert('Negative Amount Not Allowed');
              $scope.invoice_totalamts = 0;
              $scope.invoice_remainamt = 0;
              location.reload(true);
            }

            if (tot_amt_expense_changed < 0){
              alert('Amount Higher Than Invoice Amount.');
            }
    }

    $scope.invoice_amtchange = function(e) {

            $scope.expense_amount_calc_initial = e;


       if ($scope.radio_item == 'BUC' || $scope.radio_item == 'CWIP' ){
           $scope.invoice_remainamt = ($scope.faclringheader_balanceamount - (parseFloat(e)+parseFloat($scope.finalamt)));

<!--            if ($scope.invoice_remainamt < 0){-->
<!--              alert('Negative Amount Not Allowed');-->
<!--              $scope.invoice_totalamts = 0;-->
<!--              $scope.invoice_remainamt = 0;-->

<!--               location.reload(true);-->
<!--            }-->

           $scope.invoice_amtext = true;
           return;
       }
       if(e < $scope.invoice_totalamt ){
            $scope.invoice_amtext = true;
            $scope.invoice_remainamt = $scope.invoice_totalamt - e;

            if ($scope.invoice_remainamt < 0){
              alert('Negative Amount Not Allowed');
              $scope.invoice_totalamts = 0;
              $scope.invoice_remainamt = 0;

              location.reload(true);
            }
       }
       else if(e > $scope.invoice_totalamt ){
            $scope.invoice_amtext = false;
            $scope.invoice_totalamts = $scope.invoice_totalamt;
       }
       else{
            $scope.invoice_amtext = false;
       }

                   capitilization_calc(0);
<!--        fun call added later for reg expense not used-->


    };

    $scope.invoice_remaincalc = function(e) {
       var tott = e + $scope.invoice_totalamts;
       if(tott < $scope.invoice_totalamt ){
            alert("Not Equal");
            $scope.invoice_remainamt = "";
       }
       else if(tott > $scope.invoice_totalamt ){
           alert("Not Equal");
           $scope.invoice_remainamt = "";
       }
       else{
            Alert("Equal");
       }
    };
    $scope.add_cwipgrp = function(){
         var model = modalshow('cwip_grp_popup');
         load_cwiptype($scope.radio_item);
    }
    $scope.save_cwip = function(){
    if($scope.cwip_name != undefined){
        $scope.cwip_gl = '888';

        if($scope.cwip_gl != undefined){
            var data = {
                 "Params": {
                     "DETAILS": {
                        "CWIP_Name":$scope.cwip_name,
                        "CWIP_Gl":$scope.cwip_gl,
                        "CWIP_Type":$scope.ddl_cwiptype
                      },
                 }
            }
            var params = {
                "Group": "FA_CATEGORY_SET",
                "Type": "CWIP_GROUP",
                "Sub_Type": "",
                "Action": "INSERT",
                "Employee_Gid": employgid,
                "json": data,
            }
            var set_cwip_grp = newservice.cwip_set_grp(params)
            $scope.loading_popup_cwip();
            set_cwip_grp.then(function(result) {

            $scope.set_update = result.data.MESSAGE;
                if($scope.set_update == 'SUCCESS' ){
                      success_toast();
                      modalhide('cwip_grp_popup');
<!--                      alert('here');-->
                      cwip_group_data($scope.radio_item);
                }
                else{
                    alert($scope.set_update);
                }
            }).finally($scope.endloading);
        }
        else{
            error_toast(no_cwip_gl,time_toast);
        }
    }
    else{
        error_toast(no_cwip_name,time_toast);
    }
    }

<!--    To Save the Move to Group-->

       $scope.btn_clk_move2grp = function(){

         $scope.Clearance_HeaderGids = [];

         for (i=0;i<$scope.asset_invoice.length;i++){
            if ($scope.asset_invoice[i].isChecked){
               var clrid = $scope.asset_invoice[i].faclringheader_gid;
               $scope.Clearance_HeaderGids.push(clrid);
             }
         }

           var save_data = {
            "Params": {
                "DETAILS": {
                        "Clearance_HeaderGids":$scope.Clearance_HeaderGids,
                        "Group_Name":$scope.selectedgrp.cwipgroup_name,
                        "Doc_Type": $scope.radio_item
                      },
                "CHANGE": {},
                "STATUS": {},
            }
           };

            var set_move2grp = newservice.set_move2grp(save_data,employgid)
            $scope.loading_popup_cwip();
            set_move2grp.then(function(result) {

            $scope.set_update = result.data.MESSAGE;
                if($scope.set_update == 'SUCCESS' ){
                      success_toast();
                      loaddata();
                }
                else{
                    alert($scope.set_update);
                }
            }).finally($scope.endloading);
        }




    load_radio();
    function load_radio(){
       $scope.items = [{"value": "REG",
					     "label":"REGULAR",
					    },
					    {"value": "CWIP",
					     "label":"CWIP",
					    },
					    {"value": "BUC",
					     "label":"BUC",
					    },
					    ]}
	 $scope.selected = 'REG';
					    ;

<!--		loaddata();-->
<!--&lt;!&ndash;		Load the Summary Data&ndash;&gt;-->

<!--	load_cwiptype();-->
	function load_cwiptype(radio_item){

	 $scope.Cwiptypeddl = [
	         {
	         "value":"REG",
	         "label":"REGULAR",

	         },
	         {"value":"CWIP",
              "label":"CWIP",
	          },
	          {
	          "value":"BUC",
              "label":"BUC",
	          },
	          ];
	          $scope.ddl_cwiptype = radio_item;
	          $scope.selected_cwiptype_ddl = {"value":radio_item,
	         "label":radio_item};
	          }



    ;




    function loaddata() {
      $scope.radio_item = $scope.selected;
    $scope.loading();
        var data = {
            "Params": {
                "FILTER": {
                    "Invoice_No": $scope.invoiceno,
					"Invoice_Date":$scope.invoicedate,
					"Supplier_Name":$scope.supplier_name,
					"FA_Clrance_CrNo":$scope.faclr_crno,
					"Doc_Type":$scope.radio_item,
					"Is_Grp":$scope.tab_selected,
                },
            }
        };
        var get_asset = newservice.asset_detail(data)
        get_asset.then(function(result) {
            $scope.invoice = true;
            $scope.main = result.data.DATA;
            $scope.asset_invoice = $scope.main;
            $scope.pageLength = $scope.asset_invoice.length;
            $scope.Totalpages = Math.ceil($scope.asset_invoice.length / $scope.itemsPerPage);
            $scope.pageLength = $scope.asset_invoice.length;
            for (i = 0; i < $scope.asset_invoice.length; i++) {
                $scope.po_no_split = $scope.asset_invoice[i].po_nos;
                    $scope.po_no_split =$scope.po_no_split.split(',')
                        for (j = 0; j < $scope.po_no_split.length; j++) {
                            $scope.po_no_split[j] = $scope.po_no_split[j]+"\n";
                        }
                    $scope.multiple_pos = $scope.po_no_split.join('');
                    $scope.asset_invoice[i].po_nos = $scope.multiple_pos;
            }
            $scope.endloading();
        });


        var get_drop = newservice.drop_data($scope.entity_gid)
        get_drop.then(function(result) {
            $scope.main = result.data.DATA;
            $scope.get_drop_data = $scope.main;
             $scope.endloading();
        });


        var get_bs_data = newservice.drop_bs($scope.entity_gid)
        get_bs_data.then(function(result) {
            $scope.main = result.data.DATA;
            $scope.get_bs = $scope.main;
            $scope.endloading();
        });


    }

    function loadcwip() {
<!--        $scope.loading();-->
<!--Jul 18 2020 - ramesh-->
        var data = {
            "Params": {
                "FILTER": {
                    "Invoice_No": $scope.invoiceno,
					"Invoice_Date":$scope.invoicedate,
					"Supplier_Name":$scope.supplier_name
                },
            }

        };

        var get_asset = newservice.cwip_detail(data)
        get_asset.then(function(result) {
            $scope.loading();
            $scope.trails = [];
            $scope.main = result.data.DATA;
            $scope.trails = $scope.main;
            if($scope.trails[0].cwip_count == 0){
                $scope.asset_invoice = [];
            }
            else{
                $scope.asset_invoice = $scope.main;
            }
            $scope.pageLength = $scope.asset_invoice.length;
            $scope.Totalpages = Math.ceil($scope.asset_invoice.length / $scope.itemsPerPage);
            $scope.pageLength = $scope.asset_invoice.length;
        }).finally($scope.endloading);
    }
        $scope.querySearchcc = gotocc;
        function gotocc(query) {
            var result = $filter('filter')($scope.get_cc, {
                'cc_name': query
            });
            return result;
        }

         $scope.querySearchcc_split = gotocc_split;
        function gotocc_split(query) {
            var result = $filter('filter')($scope.get_ccsplit, {
                'cc_name': query
            });
            return result;
        }



        $scope.querySearchgrp = gotogrp;
        function gotogrp(query) {
            var result = $filter('filter')($scope.get_cwip_data, {
                'cwipgroup_name': query
            });
            return result;
        }





        $scope.querySearchbs = gotobs;
        function gotobs(query) {
            var result = $filter('filter')($scope.get_bs, {
                'bs_name': query
            });
            return result;
        }
        $scope.get_cc = [];
        $scope.bschange = function(bs){

        $scope.loading_popup();
        if(bs != undefined){
        $scope.cmp_bs = bs.bs_gid;
            var get_cc_data = newservice.drop_cc($scope.entity_gid,$scope.cmp_bs)
            get_cc_data.then(function(result) {
                $scope.main = result.data.DATA;
                $scope.get_cc = $scope.main;
                $scope.no_ccdata = false;
            })
            $scope.endloading();
            }
            if(bs == undefined){
            $scope.selectedcc = '';
            $scope.get_cc = '';
            $scope.endloading();
            }

        }


        $scope.get_ccsplit = [];
        $scope.bschange_split = function(e,bs){

        $scope.quantitymodal();
        if(bs != undefined){
        $scope.cmp_bs = bs.bs_gid;
            var get_cc_data = newservice.drop_cc($scope.entity_gid,$scope.cmp_bs)
            get_cc_data.then(function(result) {
                $scope.main_split = result.data.DATA;
                $scope.get_ccsplit = $scope.main_split;
                $scope.no_ccdata = false;
            })
            $scope.endloading();
            }
            if(bs == undefined){
            e.cc = '';
            $scope.get_ccsplit = '';
            $scope.endloading();
            }

        }

        $scope.querySearch = gotoexe;
        function gotoexe(query) {
            var result = $filter('filter')($scope.get_drop_location, {
                'assetlocation_name': query
            });
            return result;
        }

        $scope.querySearchs = gotocat;
        function gotocat(query) {
            var result = $filter('filter')($scope.get_drop_data, {
                'assetcat_subcatname': query,
            });
            return result;
        }


    function loadexcl(excl) {
<!--    alert('radio-3');-->

        $scope.loading();
        var overalldtl = newservice.excelgen(excl);
        overalldtl.then(function(res) {
            var hosmr = [];
<!--            $scope.hosmr = res.data.MESSAGE;-->
            $scope.hosmr = res.final;
        }).finally($scope.endloading);
    }


    $scope.selectall = function() {
        if ($scope.checkall == true) {
             var inv_tot = 0;
            for (var i = 0; i < $scope.invoice_asset.length; i++) {
                var d = getSelectedText(i);
<!--                withtaxaction(i);-->
                    var final_amt = withtaxaction(i);
                    inv_tot +=  final_amt;

                if ($scope.option_mode == "Regular") {
                    var g = getbranch(i);
                }
                else{
                    var g = false ;
                }

                if(d == false && g == false){
                    $scope.invoice_asset[i].isChecked = true;
                    $scope.enable_update = false;

                }
            }

            $scope.finalamt = inv_tot;

        } else if ($scope.checkall == false) {
            for (var i = 0; i < $scope.invoice_asset.length; i++) {
                $scope.invoice_asset[i].isChecked = false;
            }
            $scope.enable_update = true;
        }
    };

<!--Trigger-->


<!--Below Function is Trigered when row check box clicked in Asset maker capitilize summary-->
    $scope.select_capitilize_check = function(id) {
        enable_disable_pop_summary(id);
        validate_selection_capitalize(id);
        if ($scope.radio_item != 'BUC'){
         capitilization_calc(id);
        }
        else{
        $scope.finalamt = $scope.faclringheader_balanceamount;
        }


        var cap_total = 0;

        img_index = [];
        for (var i = 0; i < $scope.invoice_asset.length; i++) {
            if ($scope.invoice_asset[i].isChecked == true) {
                $scope.enable_update = false;
                getbranch(id);
                return false;
            }

            else if ($scope.invoice_asset[i].isChecked == false) {
               $scope.enable_update = true;
               $scope.checkall = false;

            }

        }
    };

  $scope.select_apportion = function(id) {
      enable_disable_pop_summary(id);
      capitilization_calc(id);
  };

<!--   Called when asset id from adjusted check box-->
  $scope.select_ast_id = function(id) {
    $scope.enable_asset_id_qty = false;
  };

<!--caplitization calculation-->

  function capitilization_calc(id){
     var pdct_total = 0;
     var all_total = 0;
     var markup_ratio = 0;
     var each_value_pdct = 0;
<!--     var isany_apportion_checked = 'N';-->

     var tot_amt_capitalized = 0;

     for (var i=0;i < $scope.invoice_asset.length;i++){
       if ($scope.invoice_asset[i].isChecked == true) {

                  pdct_total +=  $scope.invoice_asset[i].invoicedetails_totalamt;
                  all_total += $scope.invoice_asset[i].invoicedetails_totalamt;
             }
       if ($scope.invoice_asset[i].isChecked_apportion == true){
            all_total += $scope.invoice_asset[i].invoicedetails_totalamt;
            isany_apportion_checked = 'Y';

            }
     }

     all_total = all_total - $scope.expense_amount_calc_initial;

       markup_ratio = all_total / pdct_total;


<!--      Again loop for assetvalue -->
       for (var i=0;i < $scope.invoice_asset.length;i++){
        if ($scope.invoice_asset[i].isChecked == true) {
                  each_value_pdct = $scope.invoice_asset[i].invoicedetails_totalamt / $scope.invoice_asset[i].faclringdetails_qty;

                  if (isany_apportion_checked == 'Y'){
                    $scope.invoice_asset[i].invoicedetails_Revised_unitprice =  parseFloat(markup_ratio * each_value_pdct).toFixed(2);
                    $scope.invoice_asset[i].capitalized_amount = $scope.invoice_asset[i].invoicedetails_Revised_unitprice * $scope.invoice_asset[i].faclringdetails_qty;

                    $scope.invoice_asset[i].new_tot_value = parseFloat($scope.invoice_asset[i].capitalized_amount).toFixed(2);

                  }
                  else if(isany_apportion_checked == 'N'){
                    $scope.invoice_asset[i].invoicedetails_Revised_unitprice = 0;
                    $scope.invoice_asset[i].capitalized_amount = $scope.invoice_asset[i].invoicedetails_unitprice * $scope.invoice_asset[i].faclringdetails_qty;
                    $scope.invoice_asset[i].new_tot_value = parseFloat($scope.invoice_asset[i].capitalized_amount).toFixed(2);
                  }

<!--                this is used to Tot Amount Captalized-->

                    tot_amt_capitalized += $scope.invoice_asset[i].capitalized_amount;

<!--                  Markup ratio Column data-->
                    $scope.invoice_asset[i].faclringdetails_markedup_ratio = parseFloat(markup_ratio).toFixed(2);
             }
             else {
             $scope.invoice_asset[i].capitalized_amount = 0;
             $scope.invoice_asset[i].invoicedetails_Revised_unitprice = 0;

             }
     }

     $scope.finalamt = tot_amt_capitalized;

<!--     this is displayed under the summary-->
   };


   function enable_disable_pop_summary(id){

       var isanyapportion_checked = 'N';
      for (var i=0;i < $scope.invoice_asset.length;i++){
        if ($scope.invoice_asset[i].isChecked == true) {

                $scope.invoice_asset[i].apportion_checkbox_show = false;
                $scope.invoice_asset[i].isChecked_apportion = false;
                $scope.invoice_asset[i].unitprice_disable = false;
             }
             else {
             $scope.invoice_asset[i].apportion_checkbox_show = true;
             $scope.invoice_asset[i].unitprice_disable = true;
             }

        if ($scope.invoice_asset[i].isChecked_apportion == true){
          $scope.invoice_asset[i].capitalize_checkbox_show = false;
          $scope.invoice_asset[i].isChecked = false;
          $scope.includemarkup_ratio_show = true;
          isanyapportion_checked = 'Y';
<!--          Below Disable ful line-->
           $scope.invoice_asset[i].is_strike = 'YES';
           $scope.invoice_asset[i].product_disable = true;

        }
        else{
         $scope.invoice_asset[i].capitalize_checkbox_show = true;
         $scope.invoice_asset[i].product_disable = false;
         $scope.invoice_asset[i].is_strike = 'NO';
        }

      if (i == 0 && $scope.invoice_asset[i].isChecked == true ){
             $scope.captilize_amt_disable = false;

         } else if (i == 0 && $scope.invoice_asset[i].isChecked == false) {
             $scope.captilize_amt_disable = true;

         }

     }

       if (isanyapportion_checked == 'N'){
          $scope.includemarkup_ratio_show = false;
       }

   };

    function check_radio(i) {
        if ($scope.option_radio == "Tax") {
            $scope.invoice_tax = $scope.invoice_asset[i].invoicedetails_taxamt / $scope.invoice_asset[i].grninwarddetails_qty;
            $scope.finalamt = $scope.invoice_tax + $scope.invoice_asset[i].invoicedetails_unitprice;
            return $scope.finalamt;
        } else if ($scope.option_radio == "Without_Tax") {
            $scope.finalamt = $scope.invoice_asset[i].invoicedetails_unitprice;
            return $scope.finalamt;
        } else if ($scope.option_radio == "OtherTax") {
            alert("Other Expence")
        }
    };
     $scope.mode_make = function(rad_item){
     $scope.newary = [];
      $scope.radio_item = rad_item;
      loaddata();
      $scope.btn_makegrp_ed = true;
      $scope.ddl_cwipgrp = false;
      $scope.cat_selected = false;

      if (rad_item == 'BUC' || rad_item == 'CWIP' ){
        $scope.ddl_asset_subsequent = true;
        load_assetgroup();
        load_assetsubsequent();
      }
      else{
        $scope.ddl_asset_group = false;
        $scope.ddl_asset_subsequent = false;
      }



<!--     if ($scope.option_make == "Regular") {-->
<!--            $scope.cwip_data = false;-->
<!--            $scope.invoice = true;-->
<!--            loaddata();-->

<!--        } else{-->
<!--            $scope.cwip_data = true;-->
<!--            $scope.invoice = false;-->
<!--            loadcwip();-->
<!--         }-->
     }

     $scope.TabClickNonG = function(){
      $scope.tab_selected = 'N';
      loaddata();
      $scope.btn_makegrp_ed = true;
    $scope.ddl_cwipgrp = false;
     }

     $scope.TabClickG = function(){
      $scope.tab_selected = 'Y';
      loaddata();
      $scope.btn_makegrp_ed = true;
      $scope.ddl_cwipgrp = false;
     }

     $scope.cwiptype_click = function(ddl_cwiptype){
      $scope.ddl_cwiptype = ddl_cwiptype;
     }


<!--On Branch Change in Capitalize-->

 $scope.branch_change_capitalize = function(selected_br) {
    $scope.loading_popup();
    if (selected_br != undefined){
      $scope.invoice_branchgid = selected_br.branch_gid ;
      locpop();
      for (i = 0; i < $scope.invoice_asset.length; i++) {
        $scope.invoice_asset[i].branch_name = selected_br.branch_name;
        $scope.invoice_asset[i].branch_gid = selected_br.branch_gid;
      }
      $scope.endloading();
    }
    if(selected_br == undefined){
        $scope.selectedloc = '';
        $scope.get_drop_location = '';
        $scope.endloading();
     }


 }

<!--On Branch Change Split-->

$scope.branch_change_split = function(e,selected_br_split){

$scope.quantitymodal();
  if (selected_br_split != undefined){
    $scope.invoice_branchgid = selected_br_split.branch_gid;
     locpop_split();
     $scope.endloading();
  }
  if(selected_br_split == undefined){
  e.location_name = '';
  $scope.get_drop_location = '';
  $scope.endloading();
  }
$scope.endloading();

}


     $scope.selectcheckbox = function(){
<!--       alert('ng click');-->
     }



     $scope.select_checkbox = function(){
<!--       alert('ng select');-->

       $scope.btn_makegrp_ed = true;
       $scope.ddl_cwipgrp = false;
       for (var i = 0 ;i < $scope.asset_invoice.length;i++){
        if ($scope.asset_invoice[i].isChecked){


           $scope.btn_makegrp_ed = false;
           $scope.ddl_cwipgrp = true;
           cwip_group_data($scope.radio_item);
        }
       }
     }



 $scope.selectchange_prod = function(pdct_change,id){
<!--        alert(pdct_change.product_gid);-->
<!--            alert(id);-->
        if (pdct_change != undefined){
          $scope.invoice_asset[id].selected_product_gid = pdct_change.product_gid;
          $scope.invoice_asset[id].product_gid = pdct_change.product_gid;
<!--          data = {"Params": {"FILTER": {"Product_Gid":pdct_change.product_gid}}};-->
<!--          var get_drop = newservice.drop_data_cat(data)-->
<!--          get_drop.then(function(result) {-->
<!--            $scope.main = result.data.DATA;-->
<!--            $scope.get_drop_data = $scope.main;-->
<!--             $scope.endloading();-->
<!--            });-->
        }
       }

<!--    Subsequent ddl Change-->
     $scope.subsequent_change = function(subsequent_choice){
        $scope.ddl_asset_subsequent_ = true;
        if (subsequent_choice.value == 'E') {
           $scope.ddl_asset_group = true;
        }
        else{
           $scope.ddl_asset_group = false;
        }
     }


<!--asst grp change-->
  $scope.asset_grp_change = function(ast_grp){

    if (ast_grp != undefined) {
      load_assetid(ast_grp.assetgroup_gid);
    }
    else if (ast_grp == undefined) {
      $scope.get_asset_id = '[]';
    }


  }

<!--iChange-->

<!--   On Bucket Grp Change - ToCheck for Regular already Capitilized  -->

 $scope.cwipddl_selectchange = function(bucket_selected){
    if ($scope.radio_item == "REGULAR") {
       if (bucket_selected.cwipgroup_name != undefined){
         var get_check_bucket_capitalize = newservice.check_bucket_capitalize(bucket_selected.cwipgroup_name)
             get_check_bucket_capitalize.then(function(result) {
              $scope.main = result.data.MESSAGE;
               if($scope.main == 'FOUND'){
                 alert('The Selected Bucket Data Already Capitalized,Not Able To Add Additional Invoice');
                 $scope.selectedgrp = '';
               }
             })


       }




    }

 }

<!--   Dont Use Mode_Choose-->

    $scope.mode_choose = function(details_id){
        if ($scope.option_mode == "Regular") {
            $scope.enable_regular = true;
            $scope.enable_cwip = false;
            $scope.regular_location = true;
            $scope.cwip_check = false;
            $scope.reg_loc = true;
            $scope.cwip_grp = false;
            $scope.stepsModel = [];
            $scope.filenames = [];

        } else{
            $scope.enable_cwip = true;
            $scope.enable_regular = false;
            $scope.regular_location = false;
            $scope.cwip_check = true;
            $scope.reg_loc = true;
            $scope.cwip_grp =true;
            $scope.stepsModel = [];
            $scope.filenames = [];
        }
    }
    $scope.cwip_checked = function(){
    for (var i = 0; i < $scope.choices.length; i++) {
            if ($scope.choices[i].cwipck == true) {
                $scope.choices[i].reg_loc = false;
                $scope.choices[i].cwip_grp = true;
                $scope.choices[i].ccbs_show = false;
<!--                $scope.choices = [{reg_loc : false,cwip_grp : true,invoicedetails_gid:details_id,grninwarddetails_qty: '',location_name: ''}];-->
            }
            else if($scope.choices[i].cwipck == false) {
                $scope.choices[i].reg_loc = true;
                $scope.choices[i].cwip_grp = false;
                $scope.choices[i].cwipck = false;
                $scope.choices[i].ccbs_show = true;
<!--                $scope.choices = [{reg_loc :"true",cwipck:"false",cwip_grp :"false",invoicedetails_gid:details_id,grninwarddetails_qty: '',location_name: ''}];-->
            }
        }
    }
    function withtaxaction(i) {
        if ($scope.option_radio == "Tax") {
            $scope.finalamt = $scope.invoice_asset[i].invoicedetails_taxamt + $scope.invoice_asset[i].invoicedetails_totalamt;
            return $scope.finalamt;
        } else if ($scope.option_radio == "Without_Tax") {
            $scope.finalamt = $scope.invoice_asset[i].invoicedetails_totalamt;
<!--            alert($scope.invoice_asset[i].isChecked);-->
            return $scope.finalamt;
        }
    };


<!--new code -->
function getbranch(f){
   $scope.enable_update = false;
                return false;
}
<!--  old code-->
    function getbranchz(f) {
        if($scope.choices.length == 0){
            if ($scope.selectedloc == "" || $scope.selectedloc == undefined ) {
                error_toast(not_enter_location,time_toast);
                $scope.invoice_asset[f].isChecked = false;
                $scope.checkall = false;
                $scope.enable_update = true;
                return true;
            }
            else{
                $scope.enable_update = false;
                return false;
            }
        }
        else{
                return false;
            }
    }

    function getSelectedText(e) {
        var selt = $scope.invoice_asset[e].selectedItem;
        if (selt == undefined) {
            error_toast(not_enter_category,time_toast);
            $scope.invoice_asset[e].isChecked = false;
            $scope.checkall = false;
            return true;
        } else {
            var f = valid_qty(e)
            return f;
        }
    };

    function validate_selection_capitalize(e) {
         if ($scope.invoice_asset[e].selectedItem == undefined) {
            error_toast(not_enter_category,time_toast);
            $scope.invoice_asset[e].isChecked = false;
            $scope.checkall = false;  <!-- This Need to Remove-->
            return true;
         }

         if ($scope.invoice_asset[e].split_data == undefined){
            if ($scope.selectedloc == undefined){
                        error_toast(not_enter_location,time_toast);
                        $scope.invoice_asset[e].isChecked = false;
                        $scope.checkall = false;
                        return true;
            }

            if ($scope.selectedbs == undefined){
                        warning_toast(not_enter_bs,time_toast);
                        $scope.invoice_asset[e].isChecked = false;
                        $scope.checkall = false;
                        return true;
            }

            if ($scope.selectedcc == undefined){
                        warning_toast(not_enter_cc,time_toast);
                        $scope.invoice_asset[e].isChecked = false;
                        $scope.checkall = false;
                        return true;
            }

            if ($scope.invoice_asset[e].product_gid == undefined) {
                        warning_toast(not_enter_product,time_toast);
                        $scope.invoice_asset[e].isChecked = false;
                        $scope.checkall = false;
                        return true;
            }

         }

    };

    $scope.strsubstring = "";
    function file_change(e){
    var file_img = document.getElementById('file' + e).files[0];
        if (file_img == undefined) {
            $scope.rmv = false;
        }
        else if (file_img !== undefined) {
            $scope.rmv = true;
        }
    }
    $scope.remove_file = function(e){
         document.getElementById(e).innerHTML = document.getElementById(e).innerHTML;
    }
    $scope.imgs = new FormData();
    $scope.loaddatas = function(e,v) {
        var d = $scope.invoice_asset[v].invoicedetails_gid;
        var file_img_length = document.getElementById(e).files.length;
        if(file_img_length!=0){
            for(l=0;l<file_img_length;l++){
                var no = l.toString()+"_"+d.toString()
                var file_img = document.getElementById(e).files[l];
                var file_name=file_img.name;
                $scope.imgs.append('file'+no, file_img);
                $scope.imgs.append('name', file_name);
            }
        }
    };

    $scope.stepsModel = [];
    $scope.filenames = [];

    $scope.file_namechg = function(e){
        $scope.invoice_asset[e].filenames = $scope.filenames;
    }

    $scope.imageUpload = function(event){
        $scope.stepsModel = [];
        $scope.filenames = [];
         var files = event.target.files; //FileList object
         var e = event.target.id;
         var t = e.slice(-1);
         for (var i = 0; i < files.length; i++) {
             var file = files[i];
                 var reader = new FileReader();
                 reader.onload = $scope.imageIsLoaded;
                 reader.readAsDataURL(file);
                 $scope.filenames.push(file.name);
         }
        $scope.invoice_asset[t].filenames = $scope.filenames;

    }

    $scope.imageIsLoaded = function(e){
        $scope.$apply(function() {
            $scope.stepsModel.push(e.target.result);
        });
    }
    $scope.viewimage = function(e){
        $scope.file_path = $scope.stepsModel[e];
        var model = modalshow('imdiate_view');
    }


    function baseimg(e) {

        if ($scope.option_mode == "Regular") {
            var idname = 'file' + e;
            $scope.loaddatas(idname,e);
            return false;
        }
        else if ($scope.option_mode == "CWIP") {
            var idname = 'file_cwip' + e;
            $scope.loaddatas(idname,e);
        }
    };

     function valid_qty(e) {
         if($scope.choices.length != 0){
            for (i = 0; i < $scope.invoice_asset.length; i++) {
               if($scope.choices[i].faclringdetails_gid != $scope.invoice_asset[e].faclringdetails_gid){
                    $scope.multiple_qty.push("");

                   if ($scope.selectedloc) {
                     $scope.location_name = $scope.selectedloc.assetlocation_gid;
                          if ($scope.selectedbs) {
                          $scope.bs_no = $scope.selectedbs.bs_no;
                              if ($scope.selectedcc) {
                              $scope.cc_no = $scope.selectedcc.cc_no;
                                  return false;
                              }
                              else {
                                    warning_toast(not_enter_cc,time_toast);
                                    $scope.invoice_asset[e].isChecked = false;
                                    $scope.checkall = false;
                                    return true;
                              }
                          }
                          else {
                            warning_toast(not_enter_bs,time_toast);
                            $scope.invoice_asset[e].isChecked = false;
                            $scope.checkall = false;
                            return true;
                          }
                     }
                    else {
                        error_toast(not_enter_location,time_toast);
                        $scope.invoice_asset[e].isChecked = false;
                        $scope.checkall = false;
                        return true;
                   }
                }
                else if($scope.choices[i].invoicedetails_gid == $scope.invoice_asset[e].invoicedetails_gid) {
                      return false;
                }
            }
         }
         else if($scope.choices.length == 0){
              if ($scope.option_mode == "Regular") {
                   if ($scope.selectedloc) {
                   $scope.location_name = $scope.selectedloc.assetlocation_gid;
                      if ($scope.selectedbs) {
                          $scope.bs_no = $scope.selectedbs.bs_no;
                              if ($scope.selectedcc) {
                                  $scope.cc_no = $scope.selectedcc.cc_no;
                                      return false;
                                  }
                              else {
                                    warning_toast(not_enter_cc,time_toast);
                                    $scope.invoice_asset[e].isChecked = false;
                                    $scope.checkall = false;
                                    return true;
                              }
                      }
                      else {
                        warning_toast(not_enter_bs,time_toast);
                        $scope.invoice_asset[e].isChecked = false;
                        $scope.checkall = false;
                        return true;
                      }
                    }
                    else {
                        error_toast(not_enter_location,time_toast);
                        $scope.invoice_asset[e].isChecked = false;
                        $scope.checkall = false;
                        return true;
                   }
              }
              else{
                if ($scope.selectedgrp) {
                   $scope.cwip_group_id = $scope.selectedgrp.cwipgroup_gid;
                   return false;
                 }
                else {
                        error_toast(not_enter_cwipgrp,time_toast);
                        $scope.invoice_asset[e].isChecked = false;
                        $scope.checkall = false;
                        return true;
                 }

              }
         }
     }

<!--     2020 new split qty-->
<!--     $scope.choices=[];-->
     $scope.qtypop = function(asttosplit,e){
         $scope.split_indexdata = e;
         $scope.total_qty=asttosplit.faclringdetails_qty;
         $scope.Product_name = asttosplit.product_name;
         $scope.faclringdetails_gid = asttosplit.faclringdetails_gid;
         $scope.Unit_price = asttosplit.invoicedetails_unitprice;

         $scope.asst_id_pono = asttosplit.faclringdetails_ponum;

     $scope.choices = [{reg_loc : true,ccbs_show:true,cwipck: false,faclringdetails_gid:$scope.faclringdetails_gid,split_qty: '',location_name:''}];
     $scope.model_qty = modalshow('quantitymodal');

     }

     $scope.assetid_pop = function(id){
<!--       below id used to index the data while saving the asst id qty selection-->
        $scope.asst_id_qty_index = id;
        $scope.qty_asst($scope.asst_id_pono);
      modalshow('quantitymodal_assetid');
     }

<!--     Old One-->
     $scope.choices=[];
     $scope.multiple_qty=[];
     $scope.qtypopz = function(emp,e) {
     $scope.enable_Qty = true;
     $scope.color_var = e;
         $scope.choices=[];
         $scope.total_qty=emp.faclringdetails_qty;
         $scope.Product_name = emp.product_name;
         $scope.faclringdetails_gid = emp.faclringdetails_gid;
         $scope.Unit_price = emp.invoicedetails_unitprice;
         if($scope.option_mode == "Regular") {
            $scope.choices = [{reg_loc : true,ccbs_show:true,cwipck: false,faclringdetails_gid:$scope.faclringdetails_gid,split_qty: '',location_name:''}];

        } else{
            $scope.choices = [{reg_loc : true,ccbs_show:true,cwipck: false,invoicedetails_gid:$scope.invoicedetails_gid,split_qty: '',cwip_group:''}];
        }
         $scope.mode_choose($scope.invoicedetails_gid);
            if($scope.multiple_qty.length == 0){
                   $scope.multiple_qty=[{invoicedetails_gid:$scope.invoicedetails_gid,source:$scope.choices}];
                }
            else if($scope.multiple_qty.length != 0){
                var qty_len = $scope.multiple_qty.length -1;
                   if($scope.multiple_qty[qty_len].invoicedetails_gid != $scope.invoicedetails_gid){
                        $scope.multiple_qty.push({invoicedetails_gid:$scope.invoicedetails_gid,source:$scope.choices});
                    }
                }
         $scope.model_qty = modalshow('quantitymodal');
      }

<!--        2020 new code-->
       $scope.addNewChoice = function() {
         $scope.choices.push({reg_loc : true,ccbs_show:true,cwipck : false,faclringdetails_gid:$scope.faclringdetails_gid,split_qty: '',location_name:''});
       }
<!--       Old Code -->
       $scope.grninwarddetails_qty = '';
       $scope.location_name = '';
       $scope.addNewChoicez = function() {

        var sum =parseInt(0);
        for (i = 0; i < $scope.choices.length; i++) {
            sum = parseInt(sum) + parseInt($scope.choices[i].grninwarddetails_qty);
        }
            if (sum > $scope.total_qty){
                $scope.add_asset = true;
                warning_toast(not_matched,time_toast);
            }
            else if(sum < $scope.total_qty){
                var tot = $scope.choices.length -1;
                if ($scope.option_mode == "Regular") {
                    if($scope.choices[tot].location_name != ""){
                        if ($scope.choices[tot].bs != null) {
                              if ($scope.choices[tot].cc != null) {
<!--                                  alert(JSON.stringify($scope.choices));-->
                                  $scope.choices.push({reg_loc : true,ccbs_show:true,cwipck : false,faclringdetails_gid:$scope.faclringdetails_gid,split_qty: '',location_name:''});
<!--                                  alert(JSON.stringify($scope.choices));-->
                                  }
                              else {
                                    warning_toast(not_enter_cc,time_toast);
                                    $scope.enable_Qty = true;
                              }
                        }
                        else {
                            warning_toast(not_enter_bs,time_toast);
                            $scope.enable_Qty = true;
                        }
                    }
                    else{
                        warning_toast(not_enter_location,time_toast);
                        $scope.enable_Qty = true;
                    }
                }
                else{
<!--                   alert('Bug here');-->
                    $scope.choices.push({reg_loc : true,ccbs_show:true,cwipck : false,invoicedetails_gid:$scope.invoicedetails_gid,grninwarddetails_qty: '',cwip_group:''});
                }
            }
            else if(sum == $scope.total_qty){
                var tot = $scope.choices.length -1;
                $scope.extra_qty(tot);

            }
            else {
               error_toast(no_data,time_toast);
            }
    };
    $scope.removeChoice = function() {
        var lastItem = $scope.choices.length-1;
        $scope.choices.splice(lastItem);
        $scope.add_asset = false;
    };

   $scope.extra_qty = function(tot){
      $scope.enable_Qty = false;
<!--      New One for Temp-->

       if ($scope.option_mode == "Regular") {
            if($scope.choices[tot].location_name != ""){
                if ($scope.choices[tot].bs != null) {
                      if ($scope.choices[tot].cc != null) {
                              var sum =parseInt(0);
                              for (i = 0; i < $scope.choices.length; i++) {
                                sum = parseInt(sum) + parseInt($scope.choices[i].grninwarddetails_qty);
                              }
                              if(sum == $scope.total_qty){
                                $scope.enable_Qty = false;
                              }
                              else if(sum < $scope.total_qty){
                                $scope.add_asset = false;

                              }
                          }
                      else {
                            setTimeout(function() {
                                document.querySelector('#show_cc'+tot).focus();
                            }, 0);
                            $scope.enable_Qty = true;
                      }
                }
                else {
                    setTimeout(function() {
                        document.querySelector('#show_bs'+tot).focus();
                    }, 0);
                    $scope.enable_Qty = true;
                }
            }
            else{
                setTimeout(function() {
                    document.querySelector('#show_loc'+tot).focus();
                }, 0);
                $scope.enable_Qty = true;
            }
       }
       else if ($scope.option_mode == "CWIP") {
           if ($scope.choices[tot].cwipck == false || $scope.choices[tot].cwipck == undefined) {
                if($scope.choices[tot].location_name != null){
                    if ($scope.choices[tot].bs != null) {
                          if ($scope.choices[tot].cc != null) {
                             var sum =parseInt(0);
                              for (i = 0; i < $scope.choices.length; i++) {
                                sum = parseInt(sum) + parseInt($scope.choices[i].grninwarddetails_qty);
                              }
                              if(sum == $scope.total_qty){
                                $scope.enable_Qty = false;
                              }
                              else if(sum < $scope.total_qty){
                                $scope.add_asset = false;
                              }
                              }
                          else {
                                setTimeout(function() {
                                document.querySelector('#show_cc'+tot).focus();
                                }, 0);
                                $scope.enable_Qty = true;
                          }
                    }
                    else {
                        setTimeout(function() {
                        document.querySelector('#show_bs'+tot).focus();
                        }, 0);
                        $scope.enable_Qty = true;
                    }
                }
                else{
                   setTimeout(function() {
                    document.querySelector('#show_loc'+tot).focus();
                    }, 0);
                    $scope.enable_Qty = true;
                }
           }
           else if ($scope.choices[tot].cwipck == true) {
                if($scope.choices[tot].cwip_group != null){
                      var sum =parseInt(0);
                      for (i = 0; i < $scope.choices.length; i++) {
                        sum = parseInt(sum) + parseInt($scope.choices[i].grninwarddetails_qty);
                      }
                      if(sum == $scope.total_qty){
                        $scope.enable_Qty = false;
                      }
                      else if(sum < $scope.total_qty){
                        $scope.add_asset = false;
                      }
                }
                else{
                    setTimeout(function() {
                        document.querySelector('#show_cwipgrp'+tot).focus();
                    }, 0);
                    $scope.enable_Qty = true;
                }
           }
       }

   }

    $scope.value_check = function(e,id) {
        var sum =parseInt(0);

        $scope.adjusted_qty_pop = $scope.choices[id].grninwarddetails_qty;
        $scope.adjusted_qty_pop = $scope.choices[id].grninwarddetails_qty;

        for (i = 0; i < $scope.choices.length; i++) {
            sum = parseInt(sum) + parseInt($scope.choices[i].grninwarddetails_qty);
            var tot = i;
        }
        if(sum == $scope.total_qty){
                $scope.add_asset = true;
<!--            if($scope.split_date != undefined){-->
<!--               $scope.enable_update = false;-->
<!--            }-->
                $scope.extra_qty(tot);
            }
        else if(sum < $scope.total_qty){
            $scope.enable_Qty = true;
        }
        else if(sum > $scope.total_qty){
                $scope.add_asset = true;
                $scope.enable_Qty = true;
                warning_toast(not_matched,time_toast);
                var len = $scope.choices.length - 1;
                $scope.choices[len].grninwarddetails_qty ="";
            }
        else {
              $scope.add_asset = false;
            }
    };

    $scope.qty_check = function(){
        var sum =parseInt(0);
        for (i = 0; i < $scope.choices.length; i++) {
            sum = parseInt(sum) + parseInt($scope.choices[i].grninwarddetails_qty);
            var tot = i;
        }
        if(sum != $scope.total_qty){
            $scope.choices = [];
            $scope.add_asset = false;
        }
        $('.modal').css('overflow-y', 'auto');
    }

<!--    Save the Data from Asset id selection-->

    $scope.Save_asset_id_selection = function() {

       var asst_ids = [];
       var asst_id = '';

       for(i=0;i<$scope.asset_id_adjusted.length;i++){
        if ($scope.asset_id_adjusted[i].astid_ischecked == true){
             asst_id = $scope.asset_id_adjusted[i].assetid_gid;
             asst_ids.push(asst_id);
             $scope.all_asst_ids.push(asst_id);

        }
       }

       $scope.choices[$scope.asst_id_qty_index].asset_id_qty_data = asst_ids;

       modalhide('quantitymodal_assetid');


    }

<!--Save the Data from qty pop-->
    $scope.Sve = function() {
<!--         Assign the split data to main data-->
         for(i=0;i<$scope.invoice_asset.length;i++){
             if(i == $scope.split_indexdata){
             $scope.invoice_asset[i].split_data = $scope.choices;
             }
         }

        var sum =parseInt(0);
      for (i = 0; i < $scope.choices.length; i++) {
            sum = parseInt(sum) + parseInt($scope.choices[i].grninwarddetails_qty);
            }
        if(sum == $scope.total_qty){
            success_toast();
<!--            var c = $scope.color_var-->
<!--            $scope.invoice_asset[c].color = "blue";-->
<!--            $scope.split_qty_full = $.merge($scope.split_qty_full,$scope.choices);-->

            modalhide('quantitymodal');
            $('.modal').css('overflow-y', 'auto');
         }
        else if(sum != $scope.total_qty){
                $scope.enable_update = true;
                modalhide('quantitymodal');
                $('.modal').css('overflow-y', 'auto');
<!--                above hide newly added-->
        }
      }

    $scope.no_split_qty = function(i,capdate){
        if ($scope.option_mode == "Regular") {
            var datas_asset = {
                    "Invoice_Gid": ($scope.invoice_asset[i].invoiceheader_gid).toString(),
                    "Invoice_Detail_Gid": ($scope.invoice_asset[i].invoicedetails_gid).toString(),
                    "Supplier_Gid": ($scope.invoice_asset[i].supplier_gid).toString(),
                    "Product_Gid": ($scope.invoice_asset[i].product_gid).toString(),
                    "Asset_Asset_SubCat_Gid": ($scope.invoice_asset[i].selectedItem.assetcat_gid).toString(),
                    "Asset_Qty": ($scope.invoice_asset[i].invoicedetail_qty).toString(),
                    "Unit_Price": $scope.invoice_asset[i].invoicedetails_unitprice,
                    "Asset_Value": (check_radio(i)).toString(),
                    "Captilisation_Type":"A",
                    "Location_Gid": ($scope.location_name).toString(),
                    "CP_Date": capdate,
                    "CWIP_Gid":$scope.invoice_asset[i].cwipasset_gid,
                    "BS_NO":($scope.bs_no).toString(),
                    "CC_NO":($scope.cc_no).toString(),
                };
            $scope.asset.push(datas_asset);
        }
        else{
            var datas_asset = {
                    "Invoice_Gid": ($scope.invoice_asset[i].invoiceheader_gid).toString(),
                    "Invoice_Detail_Gid": ($scope.invoice_asset[i].invoicedetails_gid).toString(),
                    "Supplier_Gid": ($scope.invoice_asset[i].supplier_gid).toString(),
                    "Product_Gid": ($scope.invoice_asset[i].product_gid).toString(),
                    "Asset_Asset_SubCat_Gid": ($scope.invoice_asset[i].selectedItem.assetcat_gid).toString(),
                    "Asset_Qty": ($scope.invoice_asset[i].invoicedetail_qty).toString(),
                    "Unit_Price": ($scope.invoice_asset[i].invoicedetails_unitprice).toString(),
                    "Asset_Value": (check_radio(i)).toString(),
                    "Captilisation_Type":"C",
                    "Location_Gid": ($scope.cwip_group_id).toString(),
                    "CP_Date": capdate,
                    "CWIP_Gid":$scope.invoice_asset[i].cwipasset_gid,
                };
            $scope.asset.push(datas_asset);
        }
    }

<!--Asset New Capitilization New - 2020-->
 $scope.Save = function(entity) {
  if($scope.newary.length>0){
 if($scope.newary[0].selectedapcat== null){
 alert('Please fill Expense Details')
 return false;
 }if($scope.newary[0].selectedsubcat== null){
 alert('Please fill Expense Details')
 return false;
 }
 }
  $scope.enable_update = true;

  if ($scope.selected_assetgroup != undefined ){
     $scope.assetgroup_gid = $scope.selected_assetgroup.assetgroup_gid;
  }
  else
  {
   $scope.assetgroup_gid = 0;
  }

  $scope.asset = [];
  $scope.FA_Clreance_Gids = [];
  var FA_Clreance_Gid = 0;
  for (i = 0; i < $scope.invoice_asset.length; i++) {
    if ($scope.invoice_asset[i].isChecked) {


<!--       alert($scope.invoice_asset[i].product_gid);-->

        var d = new Date($scope.invoice_asset[i].cap_date);
         var capdate = d.getFullYear() + "-" + ("0" + (d.getMonth() + 1)).slice(-2) + "-" + ("0" + d.getDate()).slice(-2);
           if ($scope.invoice_asset[i].split_data == undefined){
              $scope.invoice_asset[i].split_data = [];
           }

<!--           alert(JSON.stringify($scope.invoice_asset));-->

<!--           Values from Normal and Revised is coming-->
                if (isany_apportion_checked == 'N'){
                      var Asset_Value = ($scope.invoice_asset[i].invoicedetails_unitprice).toString();
                 }
                 else if (isany_apportion_checked == 'Y') {
                     var Asset_Value = ($scope.invoice_asset[i].invoicedetails_Revised_unitprice).toString();
                 }

                 if ($scope.radio_item == 'BUC' || $scope.radio_item == 'CWIP' ){
<!--                     var Asset_Value = $scope.finalamt;-->
                 }

           <!--             This is used to update the Fa Clearance queue-->
<!--             FA_Clreance_Gid = ($scope.invoice_asset[i].faclringdetails_gid);-->
<!--             $scope.FA_Clreance_Gids.push(FA_Clreance_Gid);-->

         if ($scope.invoice_asset[i].split_data.length != 0  ) {
<!--             alert(JSON.stringify($scope.invoice_asset[i].split_data));-->

             for (j=0;j < $scope.invoice_asset[i].split_data.length;j++){

                 var datas_asset = {
                "FAClearnceHeader_Gid": ($scope.invoice_asset[i].faclringheader_gid).toString(),
                "FAClearnceDetails_Gid": ($scope.invoice_asset[i].faclringdetails_gid).toString(),
                "Product_Gid": ($scope.invoice_asset[i].selected_product_gid).toString(),
                "QTY": ($scope.invoice_asset[i].split_data[j].grninwarddetails_qty).toString(),
                "Asset_Value": Asset_Value,
                "Branch_Gid":($scope.invoice_asset[i].split_data[j].selectedbr.branch_gid).toString(),
                "Asset_SubCat_Gid": ($scope.invoice_asset[i].selectedItem.assetcat_gid).toString(),
                "CP_Date": capdate,
                "Location_Gid": ($scope.invoice_asset[i].split_data[j].location_name.assetlocation_gid).toString(),
                "BS_NO":($scope.invoice_asset[i].split_data[j].bs.bs_no).toString(),
                "CC_NO":($scope.invoice_asset[i].split_data[j].cc.cc_no).toString(),
                "Asset_Id_Qty":$scope.invoice_asset[i].split_data[j].asset_id_qty_data,
                };
                $scope.asset.push(datas_asset);
             }
         }
         else {
<!--            alert('No Split Data');-->
            var datas_asset = {
            "FAClearnceHeader_Gid": ($scope.invoice_asset[i].faclringheader_gid).toString(),
            "FAClearnceDetails_Gid": ($scope.invoice_asset[i].faclringdetails_gid).toString(),
            "Product_Gid": ($scope.invoice_asset[i].selected_product_gid).toString(),
            "QTY": ($scope.invoice_asset[i].faclringdetails_qty).toString(),
            "Asset_Value": Asset_Value,
            "Branch_Gid": ($scope.invoice_asset[i].branch_gid).toString(),
            "Asset_SubCat_Gid": ($scope.invoice_asset[i].selectedItem.assetcat_gid).toString(),
            "CP_Date": capdate,
            "Location_Gid": $scope.selectedloc.assetlocation_gid,
            "BS_NO":$scope.selectedbs.bs_no,
            "CC_NO":$scope.selectedcc.cc_no,
            };
            $scope.asset.push(datas_asset);

         }


    }
    else if ($scope.invoice_asset[i].isChecked_apportion || $scope.radio_item == 'BUC' || $scope.radio_item == 'CWIP' ) {
       <!--             This is used to update the Fa Clearance queue-->
             FA_Clreance_Gid = ($scope.invoice_asset[i].faclringdetails_gid);
             $scope.FA_Clreance_Gids.push(FA_Clreance_Gid);

    }


    if ($scope.option_mode == "BUC") {
            var idname = 'file_cwip' + i;

                 var v = 'file' + i;
                 }
                 if ($scope.option_mode == "Regular"){
            var idname = 'file' + i;
                 var v = 'file' + i;
                 }
                 if ($scope.option_mode == "CWIP"){
                 var idname = 'file_cwip' + i;
                 var v = 'file' + i;
                 }

     var d = $scope.invoice_asset[i].faclringdetails_gid;
        var file_img_length = document.getElementById(v).files.length;

        if(file_img_length!=0){
            for(l=0;l<file_img_length;l++){
                var no = l.toString()+"_"+d.toString()
                var file_img = document.getElementById(v).files[l];
                var file_name=file_img.name;
                $scope.imgs.append('file'+no, file_img);
                $scope.imgs.append('name', file_name);
            }
        }



  }

<!--  Final Combined Data will come Here-->
<!--  Frame Data to Call service-->
    $scope.status = {};
    $scope.expense_data =[];

    var details = {
                "Doc_Type":$scope.radio_item,
                "AssetGroup_Gid":$scope.assetgroup_gid,
                "FA_ClearanceDetail_Gids":$scope.FA_Clreance_Gids,
                "MarkedUpRatio":$scope.invoice_asset[0].faclringdetails_markedup_ratio,
                "Actual_Capitalize_Amount":$scope.invoice_totalamt,
                "ASSET": $scope.asset
            };

          $scope.expense_data = check_expense();
            if( $scope.expense_data == false){
                return false;
            }
            else if( $scope.expense_data == true){
                $scope.expense_data =[];
            }

     var save_data = {
            "Params": {
                "DETAILS": details,
                "CHANGE": unique($scope.newary),
                "STATUS": $scope.status,
                }
            };
        var final_data = {
            params :{
                "Sub_Type": "TEMP",
                "Action": "INSERT",
                "Type": "ASSET_MAKER",
                "Group": "FA_ASSET_MAKE",
                "Employee_Gid": employgid,
                "json": save_data,
            }
           };

        var myJSON = JSON.stringify(final_data);
        $scope.imgs.append('data', myJSON);
        var asset_save = newservice.assets_save($scope.imgs);
        $scope.loading_popup();
        asset_save.then(function(res) {
            $scope.set_update = res.data.MESSAGE;
            if($scope.set_update == 'SUCCESS' ){
                  success_toast();
                  $window.location.href = "fa_assetadd";
            }
            else{
                alert($scope.set_update);
            }
        }).finally($scope.endloading);

 }

<!-- Asset Captilization - Save-->
    $scope.SaveZ = function(entity) {

        $scope.enable_update = true;
        angular.forEach($scope.invoice_asset, function(item1) {
           if(item1.invoicedetails_unitprice == undefined ){
<!--                   item1.invoicedetails_unitprice = item1.invoicedetails_totalamt;-->
                     alert('Error Occured Contact Admin.');
<!--                   Note here Jul 7 2020-->
            }
       });
        $scope.asset = [];
        $scope.file = [];
        for (i = 0; i < $scope.invoice_asset.length; i++) {
            if ($scope.invoice_asset[i].isChecked) {

                var d = new Date($scope.invoice_asset[i].cap_date);
                var capdate = d.getFullYear() + "-" + ("0" + (d.getMonth() + 1)).slice(-2) + "-" + ("0" + d.getDate()).slice(-2);
                    if( $scope.choices.length == 0){
                        $scope.no_split_qty(i,capdate);
                    }
                    else if( $scope.choices.length != 0){
                        if($scope.choices[i].invoicedetails_gid == $scope.invoice_asset[i].invoicedetails_gid ){
                            $scope.source_qty = $scope.choices;
                            if($scope.source_qty[i].invoicedetails_gid == $scope.invoice_asset[i].invoicedetails_gid){
                                for (j = 0; j < $scope.source_qty.length; j++) {
                                      if ($scope.source_qty[j].cwipck == true) {
                                            var datas_asset = {
                                            "Invoice_Gid": ($scope.invoice_asset[i].invoiceheader_gid).toString(),
                                            "Invoice_Detail_Gid": ($scope.invoice_asset[i].invoicedetails_gid).toString(),
                                            "Supplier_Gid": ($scope.invoice_asset[i].supplier_gid).toString(),
                                            "Product_Gid": ($scope.invoice_asset[i].product_gid).toString(),
                                            "Asset_Asset_SubCat_Gid": ($scope.invoice_asset[i].selectedItem.assetcat_gid).toString(),
                                            "Asset_Qty": ($scope.source_qty[j].grninwarddetails_qty).toString(),
                                            "Unit_Price": ($scope.invoice_asset[i].invoicedetails_unitprice).toString(),
                                            "Asset_Value": (check_radio(i)).toString(),
                                            "Captilisation_Type":"C",
                                            "Location_Gid": ($scope.source_qty[j].cwip_group.cwipgroup_gid).toString(),
                                            "CP_Date": capdate,
                                            "CWIP_Gid":$scope.invoice_asset[i].cwipasset_gid,
                                            };
                                            $scope.asset.push(datas_asset);
                                        }
                                      else if ($scope.source_qty[j].cwipck == false || $scope.source_qty[j].cwipck == undefined){
                                            var datas_asset = {
                                                "Invoice_Gid": ($scope.invoice_asset[i].invoiceheader_gid).toString(),
                                                "Invoice_Detail_Gid": ($scope.invoice_asset[i].invoicedetails_gid).toString(),
                                                "Supplier_Gid": ($scope.invoice_asset[i].supplier_gid).toString(),
                                                "Product_Gid": ($scope.invoice_asset[i].product_gid).toString(),
                                                "Asset_Asset_SubCat_Gid": ($scope.invoice_asset[i].selectedItem.assetcat_gid).toString(),
                                                "Asset_Qty": ($scope.source_qty[j].grninwarddetails_qty).toString(),
                                                "Unit_Price": ($scope.invoice_asset[i].invoicedetails_unitprice).toString(),
                                                "Asset_Value": (check_radio(i)).toString(),
                                                "Captilisation_Type":"A",
                                                "Location_Gid": ($scope.source_qty[j].location_name.assetlocation_gid).toString(),
                                                "CP_Date": capdate,
                                                "CWIP_Gid":$scope.invoice_asset[i].cwipasset_gid,
                                                "BS_NO":($scope.source_qty[j].bs.bs_no).toString(),
                                                "CC_NO":($scope.source_qty[j].cc.cc_no).toString(),

                                            };
                                            $scope.asset.push(datas_asset);
                                        }
                                }
                            }
                            else if($scope.choices[i].invoicedetails_gid != $scope.invoice_asset[i].invoicedetails_gid){
                                        $scope.no_split_qty(i,capdate);
                            }
                        }
                        else if( $scope.choices[i].invoicedetails_gid == undefined){
                            $scope.no_split_qty(i,capdate);
                        }
                    }
                baseimg(i);
                }
            }
            $scope.expense_data = check_expense();
            if( $scope.expense_data == false){
                return false;
            }
            else if( $scope.expense_data == true){
                $scope.expense_data =[];
            }

            $scope.Cwip_Gid = [];
            if( $scope.singleasset == true){
                angular.forEach($scope.asset, function(item1) {
                    $scope.Cwip_Gid.push(item1.CWIP_Gid)
               });
                $scope.status = {
                    "MakeAs_Single_Assert":"Y",
                    "CWIP_Gids":$scope.Cwip_Gid
                };
            }
            else{
                $scope.status = {};
            }
            var details = {
                "ASSET": $scope.asset
            };

            var save_data = {
            "Params": {
                "DETAILS": details,
                "CHANGE": $scope.expense_data,
                "STATUS": $scope.status,
                }
            };
        var final_data = {
            params :{
                "Sub_Type": "TEMP",
                "Action": "INSERT",
                "Type": "ASSET_MAKER",
                "Group": "FA_ASSET_MAKE",
                "Employee_Gid": employgid,
                "json": save_data,
            }
        }
        var myJSON = JSON.stringify(final_data);
        $scope.imgs.append('data', myJSON);
        var asset_save = newservice.assets_save($scope.imgs);
        $scope.loading_popup();
        asset_save.then(function(res) {
            $scope.set_update = res.data.MESSAGE;
            if($scope.set_update == 'SUCCESS' ){
                  success_toast();
                  $window.location.href = "fa_assetadd";
            }
            else{
                alert($scope.set_update);
            }

        }).finally($scope.endloading);
    }


    function check_expense() {
        $scope.temp_data = [];

<!--        below invoice_totalamts  changed from remainamount by ramesh OCt 10-->
        if($scope.selectedapcat != undefined && $scope.selectedsubcat != undefined && $scope.glno != undefined && $scope.invoice_remainamt != undefined){
            var exp_data ={
                "Debit_Gid":$scope.debit_gid,
                "Category_Gid":$scope.selectedapcat.category_gid,
                "SubCategory_Gid":$scope.selectedsubcat.subcategory_gid,
                "GL_No":$scope.glno,
                "Amount":$scope.invoice_totalamts
            };
            $scope.temp_data.push(exp_data);
            return $scope.temp_data;
        }
<!--        else if($scope.invoice_remainamt != undefined || $scope.selectedapcat != undefined || $scope.selectedsubcat != undefined || $scope.glno){-->
<!--            alert("Expense Data Is Missing");-->
<!--            return false;-->
<!--        }-->
        else if($scope.selectedapcat == undefined && $scope.selectedsubcat == undefined && $scope.glno == undefined && $scope.invoice_remainamt == undefined){
            return true;
        }
    }


    function locpop() {
        var branch = {
            "Params": {
                "FILTER": {
                    "Reftable_Gid":$scope.invoice_branchgid,
                },
            }
        }
        var get_drops = newservice.drop_locat(branch);
        get_drops.then(function(result) {

            $scope.main = result.data.DATA;
            $scope.get_drop_location = $scope.main;
        });
    }


<!--    On Br Change in Split POP-->

    function locpop_split() {
       var branch = {
            "Params": {
                "FILTER": {
                    "Reftable_Gid":$scope.invoice_branchgid,
                },
            }
        }
        var get_drops = newservice.drop_locat(branch);
        get_drops.then(function(result) {

            $scope.main = result.data.DATA;
            $scope.get_drop_location = $scope.main;
        });
    }

    <!--    Asset Group in BUC-->
    function load_assetgroup() {
        var data = {
            "Type": "Asset_Group"
        }
        $scope.mainz = [];
        var get_drop_asset_grp = newservice.get_common_drop_assetgrp(data);
        get_drop_asset_grp.then(function(result) {
            $scope.mainz = result.data.DATA;
            $scope.get_asset_group = $scope.mainz;

            for(i=0;i<$scope.get_asset_group.length;i++){
             $scope.get_asset_group[i].assetgroup_no =  $scope.get_asset_group[i].assetgroup_no.toString();
            }

        });
    }

    <!--     Buc asset grp srch   -->
     $scope.assetgroup_search = asstgroupsearch;
        function asstgroupsearch(query) {
            var result = $filter('filter')($scope.get_asset_group, {
                'assetgroup_no' : query
            });
        return result;
    }

<!--    Asset ID in BUC-->
    function load_assetid(ast_grp_gid) {
        var data = {
            "Type": "Asset_Id",
            "Ast_Grp_Gid":ast_grp_gid
        }
        $scope.mainz = [];
        var get_drop_asset_grp = newservice.get_common_drop_assetgrp(data);
        get_drop_asset_grp.then(function(result) {
            $scope.mainz = result.data.DATA;
            $scope.get_asset_id = $scope.mainz;

            for(i=0;i<$scope.get_asset_id.length;i++){
             $scope.get_asset_id[i].assetdetails_id =  $scope.get_asset_id[i].assetdetails_id.toString();
            }
            var get_drop = newservice.asset_cat_buc($scope.get_asset_id[0].assetdetails_subcat)
                get_drop.then(function(result) {
                    $scope.main = result.data.DATA;
                    $scope.get_drop_data = $scope.main;

                    if (result.data.MESSAGE == 'NOT_FOUND'){
                       error_toast(not_found_asstcat,time_toast);
                    }
                    else{
                            $scope.cat_selected = true;
<!--                        $scope.invoice_asset[0].searchcat = $scope.get_drop_data[0].assetcat_subcatname;-->
<!--                        $scope.invoice_asset[0].selectedItem = $scope.get_drop_data[0];-->
                        angular.forEach($scope.invoice_asset, function(item1) {
                            item1.searchcat = $scope.get_drop_data[0].assetcat_subcatname;
                            item1.selectedItem = $scope.get_drop_data[0];
                        });
                    }

            });

            var get_drop_branch = newservice.asset_branch_buc($scope.get_asset_id[0].assetdetails_branchgid)
                get_drop_branch.then(function(result) {
                    $scope.main = result.data.DATA;
                    $scope.get_drop_brdata = $scope.main;

                    if (result.data.MESSAGE == 'NOT_FOUND'){
                       error_toast(not_found_asstcat,time_toast);
                    }
                    else{
                        $scope.selected_br = $scope.get_drop_brdata[0];
                        $scope.searchbr= $scope.selected_br.branch_name;
                        $scope.branch_change_capitalize($scope.selected_br);
                    }
            });


        });
    }

    <!--     Buc asset id srch   -->
     $scope.assetid_search = asstidsearch;
        function asstidsearch(query) {
            var result = $filter('filter')($scope.get_asset_id, {
                'assetdetails_id' : query
            });
        return result;
    }



<!--    Branch Alter-->
loaddata_br(0,30);
    $scope.set_branch = [];
    function loaddata_br(x,y) {
     var data = {
        params: {
                "Branch_name": $scope.searchbranch,
                "Limits": x + "," + y,
            }
        }
     var get_brn = newservice.drop_brch(data);
           get_brn.then(function(result) {
            $scope.maintble = result.data.DATA;
            $scope.set_branch = $scope.maintble;
            for (var i = 0; i < 1; i++) {
                dta = {
                    "branch_gid": -1,
                    "branch_name": "LOAD MORE.....",
                }
                $scope.set_branch.push(dta);
            }

         });
         }

         $scope.querySearchs_br = gotobranch;
        function gotobranch(query) {
         $scope.searchbranch = query;
         loaddata(0, 30);
            var result = $filter('filter')($scope.set_branch, {
                'branch_name': query
            });
            return result;
        }

<!--Branch alter Ends-->

<!--Branch on Split starts-->
loaddata_br_split(0,30);
    $scope.set_branch = [];
    function loaddata_br_split(x,y) {
     var data = {
        params: {
                "Branch_name": $scope.searchbranch,
                "Limits": x + "," + y,
            }
        }
     var get_brn = newservice.drop_brch(data);
           get_brn.then(function(result) {
            $scope.maintble = result.data.DATA;
            $scope.set_branch = $scope.maintble;
            for (var i = 0; i < 1; i++) {
                dta = {
                    "branch_gid": -1,
                    "branch_name": "LOAD MORE.....",
                }
                $scope.set_branch.push(dta);
            }

         });
         }

         $scope.querySearchs_br_split = gotobranch;
        function gotobranch(query) {
         $scope.searchbranch = query;
         loaddata(0, 30);
            var result = $filter('filter')($scope.set_branch, {
                'branch_name': query
            });
            return result;
        }


<!--Branch On Split Ends-->

    <!--    Asset Subsequent in BUC-->
    function load_assetsubsequent() {

     $scope.get_asset_subsequent = [{"value": "E",
					     "label":"Existing",
					    },
					    {"value": "N",
					     "label":"New",
					    },
					    ]

    }


    <!--     Buc Subsequent search grp srch   -->
     $scope.assetsubsequent_search = asst_subsequent_search;
        function asst_subsequent_search(query) {
            var result = $filter('filter')($scope.get_asset_subsequent, {
                'label' : query
            });
        return result;
    }

    $scope.searchbranch = "";
    loadbr_data(0,30);
    $scope.set_branch = [];
    function loadbr_data(x,y) {
     var data = {
        params: {
                "Branch_name": $scope.searchbranch,
                "Limits": x + "," + y,
            }
        }
     var get_brn = newservice.drop_brch(data);
           get_brn.then(function(result) {
            $scope.maintble = result.data.DATA;
            $scope.set_branch = $scope.maintble;
            for (var i = 0; i < 1; i++) {
                dta = {
                    "branch_gid": -1,
                    "branch_name": "LOAD MORE.....",
                }
                $scope.set_branch.push(dta);
            }

         });
     }
    $scope.querySearchbr = gotobranch;
        function gotobranch(query) {
         $scope.searchbranch = query;
         loadbr_data(0, 30);
            var result = $filter('filter')($scope.set_branch, {
                'branch_name': query
            });
            return result;
        }

        $scope.branch_change = function(branch_select) {
        $scope.count = 0;
        var ite = branch_select.branch_gid;
        if (ite > 0) {
            $scope.set_branch = $filter('filter')($scope.set_branch, {
                'branch_name': branch_select.branch_name
            });
        } else {
            $scope.count++;
            $scope.loadcount = $scope.count * 60
            for (i = 0; i <= $scope.loadcount; i++) {
                if ($scope.loadcount == i) {
                    loadbr_data(0, i)
                }
            }
        }
    }


<!--&lt;!&ndash;    AP Cat &ndash;&gt;-->
<!--loaddata_APCat(0,30);-->
<!--    $scope.set_branch = [];-->
<!--    function loaddata_APCat(x,y) {-->
<!--     var data = {-->
<!--        params: {-->
<!--                "ApCat_name": $scope.searchapcat,-->
<!--                "Limits": x + "," + y,-->
<!--            }-->
<!--        }-->
<!--     var get_brn = newservice.drop_ApCat(data);-->
<!--           get_brn.then(function(result) {-->
<!--            $scope.maintble = result.data.DATA;-->
<!--            $scope.set_branch = $scope.maintble;-->
<!--            for (var i = 0; i < 1; i++) {-->
<!--                dta = {-->
<!--                    "branch_gid": -1,-->
<!--                    "branch_name": "LOAD MORE.....",-->
<!--                }-->
<!--                $scope.set_branch.push(dta);-->
<!--            }-->

<!--         });-->
<!--         }-->

<!--         $scope.querySearchs_br = gotobranch;-->
<!--        function gotobranch(query) {-->
<!--         $scope.searchapcat = query;-->
<!--         loaddata(0, 30);-->
<!--            var result = $filter('filter')($scope.set_branch, {-->
<!--                'branch_name': query-->
<!--            });-->
<!--            return result;-->
<!--        }-->

<!--&lt;!&ndash;AP Cat Ends&ndash;&gt;-->

    $scope.location_pop = function(location) {
        var model = modalshow('locationpopup');
    }

    $scope.location_pop = function(location) {
        var model = modalshow('locationpopup');
    }

    $scope.update = function(location) {
        var floor = {
            "Params": {
                "DETAILS": {
                    "Ref_Gid": "67",
                    "RefTable_Gid": $scope.as_brch.branch_gid,
                    "Location_Name": $scope.as_loc,
                    "Location_Floor": $scope.as_flr,
                    "Remarks": $scope.as_rmks,
                },
            }
        }
        save_location(floor);
    };

    function save_location(floor) {
        var floor_data = newservice.drop_floor(floor, employgid);
        floor_data.then(function(result) {

            $scope.set_loc = result.data.MESSAGE;
            if($scope.set_loc == 'SUCCESS' ){
                  success_toast();
                  modalhide('locationpopup');
                  $scope.as_brch = "";
                  $scope.as_loc = "";
                  $scope.as_flr = "";
                  $scope.as_rmks = "";
                  locpop();

            }
            else{
                alert($scope.set_update);
            }
        }).finally($scope.endloading);
    }

<!--     Product in POP Summary-->
   load_product();
     function load_product(){
         var data = {
           "Params": {
                "FILTER": {},
               }
         }
          var detaildata = {
           "Group": "FA_ASSET_CATEGORY",
           "Type": "ASSETPDCT",
           "Sub_Type": "IS_ASSET",
           "json": data,
       }
        var get_drop = newservice.get_pdct_drop(detaildata)
        get_drop.then(function(result) {
            $scope.main = result.data.DATA;
            $scope.asset_product = $scope.main;
        });
    }


<!--    function load_product(){-->
<!--        var data = {-->
<!--            "Type": "Product"-->
<!--        }-->
<!--        var get_drop = newservice.get_common_drop(data)-->
<!--        get_drop.then(function(result) {-->
<!--            $scope.main = result.data.DATA;-->
<!--            $scope.asset_product = $scope.main;-->
<!--        });-->
<!--    }-->


    $scope.prodsearch = gotoprod;

        function gotoprod(query) {
            var result = $filter('filter')($scope.prodcatgory, {
                'prod_cat_data': query
            });
            return result;
        }

    product_typedata();

    function product_typedata(){
            var maindtata = {
                    "Params": {
                        "FILTER": {
                        },
                        "CLASSIFICATION": {
                            "Entity_Gid": $scope.entity_gid
                        }
                    }
                }
                var p_s = {
                    Group: "GET_ALL_PRODUCT",
                    Type: "PRODUCT_CAT",
                    Sub_Type: "PROD_SERVICE",
                    data: maindtata
                }
                var get_category = newservice.productorservices(p_s)
                get_category.then(function(result) {

                    $scope.prodcatgory = result.data.DATA;
                }, function(err) {
                    alert('No data!.');
                }).finally();
        }



function product_typedata_filter(i,e){
            var maindtata = {
                    "Params": {
                        "FILTER": {
                        "Prod_Gid":e
                        },
                        "CLASSIFICATION": {
                            "Entity_Gid": $scope.entity_gid
                        }
                    }
                }
                var p_s = {
                    Group: "GET_ALL_PRODUCT",
                    Type: "PRODUCT_CLASSIFICATION",
                    Sub_Type: "DDL",
                    data: maindtata
                }
                var get_category = newservice.productorservices(p_s)
                get_category.then(function(result) {
                    prodcatgory = result.data.DATA;
                    $scope.invoice_asset[i].searchTex1 = prodcatgory[0].Pdct_Classification
                }, function(err) {
                    alert('No data!.');
                }).finally();
        }



     $scope.product_search = pdctsearch;
        function pdctsearch(query) {
            var result = $filter('filter')($scope.asset_product, {
                'product_name': query
            });
        return result;
    }

    loadapcat();
    function loadapcat(){
        var data = {
            "Type": "AP_Category"
        }

        var get_drop = newservice.get_common_drop(data)
        get_drop.then(function(result) {
            $scope.main = result.data.DATA;
            $scope.ap_category_exp = $scope.main;
        });
    }
    $scope.apcatsearch_exp = gotoapcat_exp;
        function gotoapcat_exp(query) {
            var result = $filter('filter')($scope.ap_category_exp, {
                'category_name': query
            });
        return result;
    }


    $scope.apsubcatchange_exp = function(v,i){

    $scope.newary[i].GL_No = v.subcategory_glno;
    $scope.newary[i].SubCategory_Gid = v.subcategory_gid;

    }
    $scope.nodata_subcat = true;
    $scope.apcatchange_exp = function(v,i){

    $scope.newary[i].Category_Gid = v.category_gid
        var data = {
            "Type": "AP_Subcategory",
            "Categorygid":v.category_gid,

        }
        var get_drop_exp = newservice.get_common_drop(data)
        get_drop_exp.then(function(result) {
            $scope.main_exp = result.data.DATA;
            $scope.ap_subacatgory_exp = $scope.main_exp;
            $scope.nodata_subcat = false;
        });
    }
    $scope.apsubcatsearch_exp = gotoapsubcat_exp;
        function gotoapsubcat_exp(query) {
            var result = $filter('filter')($scope.ap_subacatgory_exp, {
                'subcategory_name': query
            });
        return result;
    }



<!--    Capitalize ap cat sub cat-->

    loadapcat_capitalize();
    function loadapcat_capitalize(){
        var data = {
            "Type": "AP_Category_Astcat"
        }

        var get_drop = newservice.get_common_drop(data)
        get_drop.then(function(result) {
            $scope.main = result.data.DATA;
            $scope.ap_category = $scope.main;
        });
    }
    $scope.apcatsearch_capitalize = gotoapcat;
        function gotoapcat(query) {
            var result = $filter('filter')($scope.ap_category, {
                'category_name': query
            });
        return result;
    }

    $scope.apsubcatchange = function(v){
        $scope.glno = v.subcategory_glno;
    }
    $scope.nodata_subcat = true;
    $scope.apcatchange_capitalize = function(v){
        var data = {
            "Type": "AP_Subcategory",
            "Categorygid":v.category_gid,

        }
        var get_drop = newservice.get_common_drop(data)
        get_drop.then(function(result) {
            $scope.main = result.data.DATA;
            $scope.ap_subacatgory = $scope.main;
            $scope.nodata_subcat = false;
        });
    }
    $scope.apsubcatsearch = gotoapsubcat;
        function gotoapsubcat(query) {
            var result = $filter('filter')($scope.ap_subacatgory, {
                'subcategory_name': query
            });
        return result;
    }



}]);

app.service('newservice', function($http) {
    this.asset_detail = function(data) {

        var response = $http.post(Appname + "/asset_details/", {
            params: {
                "Sub_Type": "FA_CLEARANCE",
                "Type": "SUMMARY",
                "Group": "FA_INVOICE_DETAILS",
                "json": data,
            }
        });
        return response;
    }
    this.cwip_detail = function(data) {
        var response = $http.post(Appname + "/asset_details/", {
            params: {
                "Sub_Type": "SUMMARY",
                "Type": "CWIP_DETAILS",
                "Group": "FA_ASSET_TRAN_SUMMARY",
                "json": data,
            }
        });
        return response;
    }
    this.invoice_filter = function(data) {
        var response = $http.post(Appname + "/asset_details/", {
            params: {
                "Sub_Type": "FA_CLEARANCEDETAILS",
                "Type": "SUMMARY",
                "Group": "FA_INVOICE_DETAILS",
                "json": data,
            }
        });
        return response;
    }

<!--    Adjusted qty Asset id below-->

    this.adjusted_asset_id = function(data) {
        var response = $http.post(Appname + "/asset_details/", {
            params: {
                "Sub_Type": "QTYADJUSTED_POP",
                "Type": "ASSET_ID",
                "Group": "FA_INVOICE_DETAILS",
                "json": data,
            }
        });
        return response;
    }

    this.cwip_filter = function(data) {
        var response = $http.post(Appname + "/asset_details/", {
            params: {
                "Sub_Type": "DETAILS",
                "Type": "CWIP_DETAILS",
                "Group": "FA_ASSET_TRAN_SUMMARY",
                "json": data,
            }
        });
        return response;
    }
    this.drop_data = function(entity) {
        var response = $http.post(Appname + "/drop_data/", {
        params: {
               "Entity_Gid": entity,
            }
        });
        return response;
    }
    this.drop_cc = function(entity,bsgid) {
        var response = $http.post(Appname + "/data_cc/", {
        params: {
               "Entity_Gid": entity,
               "Bs_gid": bsgid,
            }
        });
        return response;
    }
    this.drop_bs = function(entity) {
        var response = $http.post(Appname + "/data_bs/", {
        params: {
               "Entity_Gid": entity,
            }
        });
        return response;
    }
    this.cwipgrp_data = function(checked_radio) {
        var response = $http.post(Appname + "/cwip_group_get/", {
        params: {
               "Entity_Gid": "",
               "Doc_type":checked_radio,
            }
        });
        return response;
    }

    this.assets_save = function(save_data) {
        var respons = $http.post(Appname + "/save_asset/",
        save_data,{
            transformRequest: angular.identity,
            headers: {
                'Content-Type': undefined
            }
        });
        return respons;
    }
     this.assets_sve = function(sve_data,employgid) {
        var respons = $http.post(Appname + "/save_asset/", {
            params: {
                "Sub_Type": "TEMP",
                "Action": "INSERT",
                "Type": "ASSET_MAKER",
                "Group": "FA_ASSET_MAKE",
                "Employee_Gid": employgid,
                "json": sve_data,
            }
        });
        return respons;
    }

    this.drop_data_cat = function(data) {
        var respons = $http.post(Appname + "/fa_category_get/", {
            params: {
                "Sub_Type": "PRODUCT",
                "Type": "ASSETCAT",
                "Group": "FA_ASSET_CATEGORY",
                "json": data,
            }
        });
        return respons;
    }


    this.imageup = function(custid) {
        var respons = $http.post(Appname + "/imageconvert/",
        custid,{
                transformRequest: angular.identity,
                headers: {
                    'Content-Type': undefined
                }
            }
        );
        return respons;
    }

    this.drop_locat = function(branch, employgid) {
        var respons = $http.post(Appname + "/branch_details/", {
            params: {
                "Group": "FA_LOCATION_GET",
                "Type": "FA_LOCATION",
                "Sub_Type": "DDL",
                "json": branch,
            }
        });
        return respons;
    }

    this.drop_floor = function(floor, employgid) {
        var respons = $http.post(Appname + "/save_location/", {
            params: {
                "Group": "FA_LOCATION_SET",
                "Type": "FA_LOCATION",
                "Sub_Type": "FA_LOCATION",
                "Action": "INSERT",
                "Employee_Gid": employgid,
                "json": floor,
            }
        });
        return respons;

    }
    this.drop_brch = function(data) {
        var response = $http.post(Appname + "/get_branch/", data);
        return response;
    }

    this.cwip_set_grp = function(params) {
        var respons = $http.post(Appname + "/fa_category/",params);
        return respons;
    }

    this.get_pdct_drop = function(detaildata) {
       var response = $http.post(Appname + "/fa_category/", detaildata);
       return response;
     }

    this.get_common_drop = function(data) {
        var response = $http.post(Appname + "/commondata_get/",data);
        return response;
    }

    this.get_common_drop_assetgrp = function(data) {
        var response = $http.post(Appname + "/commondata_get/",data);
        return response;
    }

    this.productorservices = function(P_S) {
        var response = $http.post(Appname + "/productorservice/", P_S);
        return response;
    }

    this.check_bucket_capitalize = function(bucket_name) {
      var response = $http.post(Appname + "/commondata_get/",{
         "Type":"Check_Bucket_Capitalized",
         "Bucket_Name":bucket_name,
      });
      return response;
    }

    this.asset_cat_buc = function(ap_subcat_gid) {
      var response = $http.post(Appname + "/commondata_get/",{
         "Type":"Asst_cat_BUC",
         "Ap_SubCat_Gid":ap_subcat_gid,
      });
      return response;
    }

     this.asset_branch_buc = function(asset_branch_gid) {
          var response = $http.post(Appname + "/commondata_get/",{
             "Type":"Asset_Branch",
             "Asset_Branch_Gid":asset_branch_gid,
          });
          return response;
     }


<!--    Save Move to grp-->

   this.set_move2grp = function(save_data,employgid) {
        var response = $http.post(Appname + "/writeoff_summary/", {
            params: {
                "Sub_Type": "INITIAL",
                "Type": "FACLEARANCE_GRP",
                "Group": "FA_ASSET_CLEARANCE",
                "Action": "UPDATE",
                "Employee_Gid": employgid,
                "json": save_data,
            }
        });
        return response;
    }

});






</script>
{% endblock %}
