{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %} Document Inward {% endblock %}
{% block content %}
{% csrf_token %}
<script src="{% static 'Scripts/Common/barcode_generate.js' %}"></script>
<link href="{% static 'Content/font-awesome-4.1.0.css' %}" rel="stylesheet">
<!--<link href="{% static 'Content/roboto:400,300.css' %}" rel="stylesheet">-->
<link href="{% static 'Content/robotofonttext400300.css' %}" rel="stylesheet">
<link href="{% static 'Content/textangular.css' %}" rel="stylesheet">
<script src="{% static 'Scripts/Core/textAngular-rangy.js' %}"></script>
<script src="{% static 'Scripts/Core/textAngular-sanitize.js' %}"></script>
<script src="{% static 'Scripts/Core/textAngular.js' %}"></script>
{% verbatim %}
<div class="maincontent">
    <div ng-app="Appsmry" ng-controller="Ctrlsmry" class="container container1" ng-cloak>
        <div class="row">
            <div class="row-header col-lg-12 col-sm-12">
                <h4>Document Inward </h4>
            </div>
        </div>
        <div ui-view class="fade-in-up" ng-init="User='{{users}}' ">
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="col-md-1">
                    <div class="col-md-1">
                        <input type="checkbox" id="myCheckECF" ng-model="ECFcheckboxModel.value">
                        <strong id="text1">ECF Entry</strong></div>
                </div>
                <div class="col-md-3" ng-hide="!ECFcheckboxModel.value">
                    <md-input-container class="md-block inputcontainer">
                        <label>ECF Number</label>
                        <input ng-model="ECF_number" maxlength="64" required/>
                    </md-input-container>
                </div>

                <div class="col-lg-3 col-sm-3 col-md-3" ng-hide="!ECFcheckboxModel.value">
                    <md-button class="md-fab md-mini md-primary custbutton" id="btn_create" type="submit"
                               ng-click="add_ECF(ECF_number)">
                        <md-icon>add</md-icon>
                        <md-tooltip>Add & Continue</md-tooltip>
                    </md-button>
                </div>
            </div>
        </div>
        <form role="form" name="inwardentry_valid">
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-2">
                        <md-input-container class="md-block inputcontainer">
                            <label> Type</label>
                            <md-select ng-disabled="ECFcheckboxModel.value" ng-model="selectedtype">
                                <md-option ng-repeat="x in channelddl" ng-value="x.metadata_value"
                                           ng-click="typeclick(x.metadata_value)">{{ x.metadata_value }}
                                </md-option>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div class="col-md-1">
                            <span class="editlink material-icons"
                                  ng-click="view_supplier()">
                                  arrow_upward
                            </span>Supplier
                    </div>
                    <div class="col-md-2">
                        <md-input-container class="md-block inputcontainer" ng-hide="ECFcheckboxModel.value">
                            <label>Supplier Name</label>
                            <input ng-model="supplier_data.supplier_branchname" ng-disabled="true" maxlength="16"/>
                        </md-input-container>

                        <md-input-container class="md-block inputcontainer" ng-hide="!ECFcheckboxModel.value">
                            <label>Supplier Name</label>
                            <input ng-model="ECFsupplier_data" ng-disabled="true" maxlength="16"/>
                        </md-input-container>
                    </div>
                    <div class="col-md-2">
                        <md-input-container class="md-block inputcontainer" ng-hide="true">
                            <label>Supplier State</label>
                            <md-select ng-model="selectedstate" ng-disabled="true">
                                <md-option ng-repeat="x in stateddl"
                                           ng-selected="supplstate_gid == x.state_gid" ng-value="x.state_gid">{{
                                    x.state_name }}
                                </md-option>
                            </md-select>
                        </md-input-container>
                    </div>

                    <!--                    <div class="col-md-1" ng-hide="ppx_hide">-->
                    <!--                        <input type="checkbox" id="onwardinvoice"-->
                    <!--                               ng-model="Is_onward" ng-true-value="1"-->
                    <!--                               ng-false-value="0"-->
                    <!--                        >-->
                    <!--                        <strong id="onwardinvoic">ON-WARDINVOICE</strong></div>-->
                    <!--                    <div class="col-md-1" ng-hide="ppx_hide">-->
                    <!--                        <input type="checkbox" id="Amort"-->
                    <!--                               ng-model="Is_amort" ng-true-value="1"-->
                    <!--                               ng-false-value="0"-->
                    <!--                        >-->
                    <!--                        <strong id="amortc">AMORT</strong></div>-->
                    <!--                    <div class="col-md-1" ng-hide="ppx_hide">-->
                    <!--                        <input type="checkbox" id="captalise"-->
                    <!--                               ng-model="Is_captalized" ng-true-value="1"-->
                    <!--                               ng-false-value="0"-->
                    <!--                        >-->
                    <!--                        <strong id="captalisec">capitalized</strong></div>-->
                    <div class="col-md-1" ng-hide="ppx_hide">
                        <input type="checkbox" id="myCheck"
                               ng-model="checkboxModel.value" ng-change="validate_gst(checkboxModel.value)">
                        <strong id="text">GST Applicable</strong></div>
                    <!--                    <div class="col-md-1" ng-hide="ppx_hide">-->
                    <!--                        <input type="checkbox" id="rcm"-->
                    <!--                               ng-model="Is_rcm" ng-true-value="1"-->
                    <!--                               ng-false-value="0"-->
                    <!--                        >-->
                    <!--                        <strong id="rcmsec">RCM</strong></div>-->

                    <div class="col-md-3">
                        <md-input-container ng-disabled="ECFcheckboxModel.value" class="md-block inputcontainer"
                                            ng-hide="!checkboxModel.value">
                            <label>Supplier GST No</label>
                            <input ng-model="gstno" ng-disabled="true" maxlength="32"/>
                        </md-input-container>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Invoice Date</label>
                            <md-datepicker ng-disabled="ECFcheckboxModel.value" md-hide-icons="calendar"
                                           ng-model="to_date"
                                           md-hide-icons="calendar" ng-click="date"
                                           ng-change="validate_date(to_date)"
                                           md-max-date="minDate" formatDate></md-datepicker>
                        </md-input-container>
                        </md-input-container>
                    </div>
                    <div class="col-md-3" ng-hide="ppx_hide">
                        <md-input-container class="md-block inputcontainer">
                            <label>Invoice Number</label>
                            <input ng-disabled="ECFcheckboxModel.value" ng-model="invoicenum"
                                   maxlength="16"/>
                        </md-input-container>
                    </div>
                    <!--                    no-special-char-->
                    <!--                    my-special-char-->
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label> Amount</label>
                            <input ng-disabled="ECFcheckboxModel.value" ng-model="invoiceamount"
                                   ng-pattern="/^[0-9,.]/"
                                   ng-change="amount_check(invoiceamount,invoicetaxamount)" valid-number
                                   maxlength="16"/>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Taxable Amount</label>
                            <input ng-model="invoicetaxamount"
                                   ng-disabled="ECFcheckboxModel.value"
                                   ng-pattern="/^[0-9,.]/"
                                   ng-change="amount_check(invoiceamount,invoicetaxamount)"
                                   valid-number
                                   maxlength="16"/>
                        </md-input-container>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-3">
                        <md-autocomplete ng-disabled="ECFcheckboxModel.value"
                                         md-clear-button="true"
                                         md-floating-label="Employee"
                                         md-item-text="item.employee_name"
                                         md-items="item in getemployee_srch(searchemp)"
                                         md-menu-class="md-virtual-repeat-container"
                                         md-min-length=0
                                         md-no-cache="true"
                                         md-search-text="searchemp"
                                         md-selected-item="selectedemp"
                                         md-selected-item-change="employee_change(item)"
                                         ng-disabled="Customer_disab"
                                         ng-init="count=0">
                            <md-item-template>
                                <span md-highlight-text="searchTex"> {{item.employee_name}} - {{item.employee_code}} </span>
                            </md-item-template>
                            <md-not-found>
                                No Employee matching "{{searchTex}}" were found.
                            </md-not-found>
                        </md-autocomplete>
                        <!--                        <md-input-container class="md-block inputcontainer">-->
                        <!--                            <label>Employee Name</label>-->

                        <!--                            <md-select ng-model="Emp_gid"-->
                        <!--                                       required-->
                        <!--                                       ng-disabled="ECFcheckboxModel.value" md-on-close="clearSearchTerm()"-->
                        <!--                                       data-md-container-class="selectdemoSelectHeader">-->
                        <!--                                <md-select-header class="demo-select-header">-->
                        <!--                                    <input ng-model="searchTermemp" type="search"-->
                        <!--                                           placeholder="Search for a Employee Name.."-->
                        <!--                                           class="demo-header-searchbox md-text"-->
                        <!--                                           onkeydown="mdSelectOnKeyDownOverride(event)">-->
                        <!--                                </md-select-header>-->
                        <!--                                <md-optgroup label="Employee Name">-->
                        <!--                                    <md-option ng-value="emp.employee_gid"-->
                        <!--                                               ng-selected="ecf_employeegid == emp.employee_gid"-->
                        <!--                                               ng-repeat="emp in employee |-->
                        <!--              filter:searchTermemp">{{emp.employee_name}}-->
                        <!--                                    </md-option>-->
                        <!--                                </md-optgroup>-->
                        <!--                            </md-select>-->
                        <!--                        </md-input-container>-->
                    </div>
                    <div class="col-md-3" ng-hide="true">
                        <!--<md-input-container class="md-block inputcontainer" ng-hide="!checkboxModel.value">-->
                        <!--                        <md-input-container class="md-block inputcontainer">-->
                        <!--                            <label>Branch</label>-->
                        <!--                            <md-select ng-model="selectedsource" ng-disabled="ECFcheckboxModel.value">-->
                        <!--                                <md-option ng-repeat="x in soourcedata" ng-value="x.branch_gid"-->
                        <!--                                           ng-selected="ecf_branchgid == x.branch_gid"-->
                        <!--                                           ng-click="sourceclick(x)">{{ x.branch_name }}-->
                        <!--                                </md-option>-->
                        <!--                            </md-select>-->
                        <!--                        </md-input-container>-->
                    </div>
                    <div class="col-md-3">
                        <md-autocomplete
                                ng-disabled="ECFcheckboxModel.value"
                                md-clear-button="true" md-floating-label="Choose Branch"
                                md-input-maxlength=126
                                md-item-text="item.branch_detail"
                                md-items="item in soourcedata(searchbrancheName)"
                                md-selected-item-change="branchNameChanged(item)"
                                md-min-length=0 md-search-text="searchbrancheName"
                                ng-model="itemss" md-no-cache="true" size="5"
                                md-selected-item="item.branch_detail">
                            <md-item-template>
                                <span md-highlight-text="searchbrancheName"> {{item.branch_detail}}</span>
                            </md-item-template>
                            <md-not-found>
                                No Branch Name matching "{{search Branch Name}}"
                                were
                                found.
                            </md-not-found>
                        </md-autocomplete>
                    </div>

                    <!--<div class="col-md-3">-->
                    <!--<md-input-container class="md-block inputcontainer" ng-hide="!checkboxModel.value">-->
                    <!--<label>GST No</label>-->
                    <!--<input ng-model="gstno" maxlength="16"/>-->
                    <!--</md-input-container>-->
                    <!--</div>-->

                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer" ng-disabled="true">
                            <!--ng-hide="!checkboxModel.value">-->
                            <label>Branch GST No</label>
                            <input ng-model="dest_gstno" ng-disabled="true" maxlength="16"/>
                        </md-input-container>
                    </div>
                    <!--                    <div class="col-md-1" ng-hide="ppx_hide">-->
                    <!--                        <input type="checkbox"-->
                    <!--                               ng-model="checkbox_due.value">-->
                    <!--                        <strong>Due Adjustment</strong>-->
                    <!--                    </div>-->
                    <div ng-show="ppx_hide">
                        <div class="col-md-2">
                            <md-input-container class="md-block inputcontainer">
                                <label>Payment For</label>
                                <md-select ng-model="Advance_incr" ng-disabled="ECFcheckboxModel.value">
                                    <md-option ng-repeat="x in ppx_empsupp_data"
                                               ng-value="x.value">{{
                                        x.name }}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Bar Code</label>
                            <input ng-model="Bar_code" maxlength="16" required no-special-char/>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>RMU Code</label>
                            <input ng-model="Rmu_code" maxlength="16" ng-disabled="true" no-special-char/>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label> Is Original Invoice</label>
                            <md-select ng-model="is_original_invoice" ng-required="true">
                                <md-option ng-repeat="x in invoice_original_list" ng-value="x.value">{{ x.type }}
                                </md-option>
                            </md-select>
                        </md-input-container>
                    </div>

                    <div class="col-md-2" ng-show="po_hide">
                        <md-input-container class="md-block inputcontainer">
                            <label>PPX_PO Number</label>
                            <input ng-model="pono"
                                   ng-init="pono =0"
                                   ng-change="amount_check(ECF.invoiceamount,ECF.invoicetaxamount)"

                                   required/>
                        </md-input-container>
                    </div>

                    <div class="col-md-3" ng-show="po_hide">
                        <md-autocomplete
                                md-clear-button="true"
                                md-floating-label="Choose Advance Type"
                                md-item-text="item.metadata_value"
                                md-items="item in get_advance_type(search_advance)"
                                md-menu-class="md-virtual-repeat-container"
                                md-min-length=0
                                md-no-cache="true"
                                md-search-text="search_advance"
                                md-selected-item="selected_advance"
                                md-selected-item-change="change_advance_type(item.metadata_gid)"
                                ng-init="count=0">
                            <md-item-template>
                                <span md-highlight-text="search_commodity"> {{item.metadata_value}} </span>
                            </md-item-template>
                            <md-not-found>
                                No advance type matching "{{search_commodity}}" were found.
                            </md-not-found>

                        </md-autocomplete>

                    </div>

                    <div ng-show="pmd_show">
                        <div class="col-md-2">
                            <md-input-container class="md-block inputcontainer">
                                <label>PMD Location</label>
                                <md-select ng-model="location" ng-disabled="ECFcheckboxModel.value">
                                    <md-option ng-repeat="x in pmd_summary_data"
                                               ng-value="x.pmdbranch_gid">{{
                                        x.pmdbranch_location }}
                                    </md-option>
                                </md-select>
                            </md-input-container>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-10">
                        <md-input-container class="md-block inputcontainer">
                            <label>Purpose</label>
                            <input ng-disabled="ECFcheckboxModel.value" ng-model="remarks"
                                   maxlength="80" my-special-char required/>
                        </md-input-container>
                    </div>
                </div>
            </div>
            <!--            my-special-char-->
            <div class="row">
                <div class="col-lg-12">
                    <div class="col-md-2"></div>
                    <div class="col-md-3" style="margin-top: 20px;">
                        <input class="ng-isolate-scope" file-model="files"
                               fileinput="file" id="file" multiple type="file"
                               onchange="angular.element(this).scope().imageUpload(event)"/>
                    </div>
                    <div class="col-md-2" style="margin-top: 35px;" ng-show="image_visible=='true'">
                        <button type="button" class="btn btn-info" ng-click="view_images_popup()">View Images
                        </button>
                    </div>
                    <div class="col-md-2" style="bottom:0px;color:green"
                         ng-show="ECFcheckboxModel.value && invoiceheader_gid!='0'">
                        <h3><span class="editlink material-icons" style="color:#D64CB4;"
                                  ng-click="view_attached_file()">arrow_upward
                            </span>
                        </h3>View Attached File
                    </div>
                    <div class="col-md-2" ng-show="ECFcheckboxModel.value && invoiceheader_gid!='0'">
                        <h3>
                            <span class="editlink material-icons" style="color:blue;"
                                  ng-click="view_note_file()">arrow_upward
                            </span>
                        </h3>View Notes
                    </div>
                    <div class="col-md-3 pull-right">
                        <md-button type="submit" class="md-raised md-primary" id="btn_create"
                                   ng-click="add_continue()">
                            Add
                        </md-button>
                        <md-button type="submit" class="md-raised " id="btn_create"
                                   ng-click="close_click()" href="Invoicesummary">
                            Close
                        </md-button>


                    </div>
                </div>
                <div class="col-lg-12">
                    <h3>Invoice Count:<span ng-bind="myText"/></h3></div>
            </div>
        </form>

        <div class="row table-responsive">
            <div class="col-md-12 col-lg-12 col-sm-12">
                <table class="table table-striped table-bordered table-condensed table-hover md-primary">
                    <thead class="header">
                    <tr>
                        <th>S.No</th>
                        <th>CR No</th>
                        <th>Invoice Type</th>
                        <th>Supplier Name</th>
                        <th>Employee Name</th>
                        <th>Invoice No</th>
                        <th>Invoice Date</th>
                        <th>Invoice Amount</th>
                        <th>RMU Code</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="dtl in CR_data">
                        <td>
                            <center>{{((currentPage-1)*itemsPerPage)+$index+1}}</center>
                        </td>
                        <td> {{dtl.invoiceheader_crno}}</td>

                        <td>{{dtl.invoiceheader_invoicetype}}</td>
                        <td>{{dtl.supplier_branchname}}</td>
                        <td>{{dtl.employee_name}}</td>
                        <td>{{dtl.invoiceheader_invoiceno}}</td>
                        <td>{{dtl.invoiceheader_invoicedate | date:'dd-MMM-yyyy'}}</td>
                        <td>{{dtl.invoiceheader_amount}}</td>
                        <td>{{dtl.invoiceheader_rmubarcode}}</td>


                    </tr>
                    </tbody>
                </table>
                <div class="row ">
                    <div class="col-lg-12 col-sm-12 text-right">
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="view_supplier" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document" style="width:70%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabel">
                            Find Supplier
                            <button type="button" class="close" data-dismiss="modal" ng-click="close_pr_popup()"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="body">
                        <form class="modal-body popup-body" name="supplier" novalidate>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-3">
                                        <md-input-container class="md-block inputcontainer">
                                            <label> Supplier GST Number</label>
                                            <input ng-model="search_supplier_gstno"/>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-3">
                                        <md-input-container class="md-block inputcontainer">
                                            <label> Supplier Code</label>
                                            <input ng-model="search_supplier_code"/>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-3">
                                        <md-input-container class="md-block inputcontainer">
                                            <label>PAN Number</label>
                                            <input ng-model="pan_number"/>
                                        </md-input-container>
                                    </div>
                                    <div class="col-md-1">
                                        <md-button class="md-fab md-mini md-primary custbutton"
                                                   ng-click="search_supplier()">
                                            <md-icon>search</md-icon>
                                            <md-tooltip>Search</md-tooltip>
                                        </md-button>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-6">
                                        <md-autocomplete
                                                md-clear-button="true" md-floating-label="Choose Supplier"
                                                md-input-maxlength=126
                                                md-item-text="itempn.supplier_branchname"
                                                md-items="itempn in getSupplierName(searchSuplierName)"
                                                md-selected-item-change="supplierNameChanged(itempn)"
                                                md-min-length=0 md-search-text="searchSuplierName"
                                                ng-model="itempn" md-no-cache="true" size="5"
                                                md-selected-item="itempn.supplier_name">
                                            <md-item-template>
                                                <span md-highlight-text="searchSuplierName"> {{itempn.supplier_branchname}}</span>
                                            </md-item-template>
                                            <md-not-found>
                                                No Supplier Name matching "{{search Supplier Name}}"
                                                were
                                                found.
                                            </md-not-found>
                                        </md-autocomplete>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-5">
                                        <div class="row">
                                            <span><h4 style="color:green;">Supplier Name:<span style="color:black">  {{supplier_data.supplier_branchname}}</span></h4></span>
                                        </div>
                                        <div class="row">
                                            <span><h4 style="color:green;">Supplier Code:<span style="color:black">  {{supplier_data.Supplier_code}}</span></h4></span>
                                        </div>
                                        <div class="row">
                                            <span><h4 style="color:green;">Supplier GST Number:<span
                                                    style="color:black">  {{supplier_data.supplier_gstno}}</span></h4></span>
                                        </div>
                                        <div class="row">
                                            <span><h4 style="color:green;">Supplier PAN Number:<span
                                                    style="color:black">  {{supplier_data.supplier_panno}}</span></h4></span>
                                        </div>
                                    </div>
                                    <div class="col-md-6">

                                        <div class="row">
                                            <span><h4 style="color:green;">Address:<span style="color:black;">  {{supplier_data.address_1}}</span></h4></span>
                                        </div>
                                        <div class="row">
                                            <span><h4 style="color:green;">City:<span style="color:black;">  {{supplier_data.City_Name}}</span></h4></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-4"></div>
                                    <div class="col-md-2">
                                        <md-button class="md-raised md-warn" value="close"
                                                   ng-click="clear_supplier()"
                                                   aria-label="Close">Clear
                                        </md-button>
                                    </div>
                                    <div class="col-md-2">
                                        <md-button class="md-raised custbutton" value="close"
                                                   aria-label="Close" data-dismiss="modal">OK
                                        </md-button>
                                    </div>
                                </div>
                            </div>
                        </form>

                    </div>

                </div>
            </div>
        </div>

        <div class="modal fade" id="view_images" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document" style="width:90%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabels2">
                            ALL IMAGES
                            <button type="button" class="close" data-dismiss="modal"
                                    ng-click="close_pr_popup()"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="body">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="center" ng-show="file_path.length=='0'">
                                    <h3>No Attached File</h3>
                                </div>
                                <div class="col-md-offset-10" ng-show="file_path.length!='0'">
                                    <span class="editlink" ng-click="remove_all_files()">
                                    <span class="material-icons removelink">delete</span>
                                <md-tooltip>Remove All</md-tooltip>
                                </span>
                                    <span>Remove All</span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div ng-repeat="files in file_path">
                                    <div class="col-md-10">
                                        <h5 style="color:blue">{{files.file_name}}</h5>
                                        <img src="{{files.file}}" alt="{{files}}" ng-hide="files.extension=='pdf'"
                                             class="myimage img-responsive thumbnail">

                                        <object width="870px" height="500px" ng-show="files.extension=='pdf'"
                                                data="{{files.file}}" class="internal">
                                            <embed src="{{files.file}}"/>
                                            <br/>
                                        </object>
                                        <hr/>
                                    </div>
                                    <div class="col-md-1" style="margin-top:200px;">
                                        <span class="editlink" ng-click="delete_one_file($index,files.file_name)">
                                        <span class="material-icons removelink">delete</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-offset-6">
                                <md-button class="md-raised md-warn" value="close" data-dismiss="modal"
                                           aria-label="Close">OK
                                </md-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="view_attached_file" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document" style="width:70%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabelss">
                            Attached File
                            <button type="button" class="close" data-dismiss="modal"
                                    ng-click="close_pr_popup()"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="body">
                        <div class="row table-responsive">
                            <div class="col-md-12 col-lg-12 col-sm-12">
                                <div class="row table-responsive">
                                    <div class="col-md-12 col-lg-12 col-sm-12">
                                        <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                               md-progress="deferred">
                                            <thead class="header">
                                            <tr>
                                                <th>S.No</th>
                                                <th>Fine Name</th>
                                                <th>View File</th>
                                                <th>Download File</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            <tr align="center"
                                                ng-repeat="file in ecf_all_files.slice(((currentPages-1)*itemsPerPages),((currentPages)*itemsPerPages)) | filter:search:strict">
                                                <td>{{((currentPages-1)*itemsPerPages)+$index+1}}
                                                </td>
                                                <td align="left">{{file.file_name}}</td>
                                                <td><span class="editlink material-icons"
                                                          ng-click="view_file(file)">insert_photo
                                                        </span>
                                                </td>
                                                <td>
                                                    <md-button class="md-icon-button md-primary" aria-label="Settings"
                                                               href="common_s3_file_download?filename={{file.file_name}}">
                                                        <md-icon>get_app</md-icon>
                                                        <md-tooltip>Download File</md-tooltip>
                                                    </md-button>
                                                </td>
                                            </tr>
                                            </tbody>
                                            <tfoot>
                                            <tr align="center">
                                                <td colspan="3">
                                                    <ul uib-pagination
                                                        total-items="ecf_all_files.length"
                                                        ng-model="currentPages"
                                                        max-size="maxSizes"
                                                        class="pagination-sm"
                                                        boundary-links="true"
                                                        items-per-page="itemsPerPages"></ul>
                                                </td>
                                                <td colspan="2">
                                                    Total Count:{{ecf_all_files.length}}
                                                </td>
                                            </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-offset-6">
                                <md-button class="md-raised md-warn" value="close" data-dismiss="modal"
                                           aria-label="Close">Cancel
                                </md-button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="show_file" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document" style="width:90%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="view_files">
                            {{url_data[0].file_name}}
                            <button type="button" class="close" data-dismiss="modal"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <br/>
                    <div class="body">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="col-md-12" align="center">
                                    <img src="{{url_datas[0].file_path}}"
                                         alt="{{url_datas[0].file_name}}"
                                         class="img-thumbnail"
                                         align="center"
                                         ng-show="extension!='pdf'">
                                    <hr/>
                                </div>
                                <iframe src="{{pdf_file_url_path}}" frameborder="0"
                                        height="600px" width="97%" ng-show="extension=='pdf'"></iframe>

                            </div>
                            <div class="row">
                                <div class="col-md-offset-6">
                                    <md-button class="md-raised md-warn" value="close" data-dismiss="modal"
                                               aria-label="Close">Cancel
                                    </md-button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" data-backdrop="static"
             data-keyboard="false" id="viewnotepad" role="dialog" style="height:auto;width:100%">
            <div class="modal-dialog modal-lg modal-style" style="width:1200px" role="document">
                <div class="modal-content">
                    <div class="header">
                        <div class="modal-header popup-header">
                            <h5 class="modal-title" id="exampleModalLabelsss">
                                <strong> Note Pad</strong>
                                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </h5>
                        </div>
                    </div>
                    <div class="body">
                        <div class="modal-body popup-body">
                            <div class="row table-responsive">
                                <div class="col-md-12 col-lg-12 col-sm-12">
                                    <div text-angular="text-angular" id="con" name="htmlcontent"
                                         ng-focus="displaynamechng('content_flag')"
                                         ng-model="htmlcontent">

                                    </div>
                                </div>


                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 text-center">
                            <md-button class="md-raised" data-dismiss="modal">Back
                                <md-tooltip>close</md-tooltip>
                            </md-button>
                        </div>
                    </div>

                </div>
            </div>
        </div>


    </div>
</div>
{% endverbatim %}
<style>.ovh { overflow: hidden; }</style>
<script>
var myApp = angular.module('Appsmry', ['ngMaterial', 'ui.bootstrap', 'AppCommon','textAngular'])
    .config(function($httpProvider) {
        $httpProvider.defaults.xsrfCookieName = 'csrftoken';
        $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
    });

    myApp.directive('mySpecialChar', function() {
     function link(scope, elem, attrs, ngModel) {
          ngModel.$parsers.push(function(viewValue) {
            //var reg = /^[`~\^&*()_+ ={}0-9a-zA-Z!@#$%^&*()_+-=|[\]\\:;<>?./\s]*$/;
            var reg = /^[0-9a-zA-Z ]*$/;
            // if view values matches regexp, update model value
            if (viewValue.match(reg)) {
              return viewValue;
            }
            // keep the model value as it is
            var transformedValue = ngModel.$modelValue;
            ngModel.$setViewValue(transformedValue);
            ngModel.$render();
            return transformedValue;
          });
      }

      return {
          restrict: 'A',
          require: 'ngModel',
          link: link
      };
  });


myApp.controller('Ctrlsmry', ['$scope', 'invoiceService', '$filter', '$mdDateLocale', '$window', '$mdDialog', '$http','$q','$sce',
    function($scope, invoiceService, $filter, $mdDateLocale, $window, $mdDialog,$http,$q,$sce) {


        var detail = JSON.parse(sessionStorage.getItem('today'));
        $scope.advance_gid=0;
        if(detail==null){
              alert("Session Expired")
        var flush = invoiceService.flush();
        }
        var td = detail.date;
        var employee_gid = detail.employee_gid;
        var branch_gid=detail.branch_gid;
        if(employee_gid==undefined || employee_gid==0){
          alert("Session Expired")
            var flush = invoiceService.flush();
        }

        $scope.location = 0;
        $scope.currentPage = 1;
        $scope.maxSize = 3;
        $scope.itemsPerPage = 10;
        $scope.note_key="";

        $scope.currentPages = 1;
        $scope.maxSizes = 3;
        $scope.itemsPerPages = 10;
        $scope.is_original_invoice="";

      //  $scope.to_date = new Date();

        $mdDateLocale.formatDate = function(date) {
            return $filter('date')($scope.to_date, "dd-MMM-yyyy");
        };

        $scope.ls_followup_date = new Date();
      //  $scope.to_date = new Date();

        $scope.minDate = new Date(
            $scope.ls_followup_date.getFullYear(),
            $scope.ls_followup_date.getMonth(),
            $scope.ls_followup_date.getDate()
        );

        $scope.maxDate = new Date(
            $scope.ls_followup_date.getFullYear(),
            $scope.ls_followup_date.getMonth() - 12,
            $scope.ls_followup_date.getDate() - 1
        );


         $scope.maxDates = new Date(
            $scope.ls_followup_date.getFullYear(),
            $scope.ls_followup_date.getMonth() - 6,
            $scope.ls_followup_date.getDate() - 1
        );

        $scope.validate_date=function(date){
            if(date<$scope.maxDates){
                alert("Invoice date is greater than six months");
            }

        }


        $scope.loading = function() {
            $mdDialog.show({
                templateUrl: 'loaderSpinner',
                parent: angular.element(document.body),
                clickOutsideToClose: false
            });
        };

        $scope.loading_view_attached_file = function() {
            $mdDialog.show({
                templateUrl: 'loaderSpinner',
                parent: angular.element(document.getElementById('view_attached_file')),
                clickOutsideToClose: false
            });
        };

        $scope.endloading = function() {
            $mdDialog.hide();
        };
         $scope.invoice_original_list=[{"type":"YES","value":"Y"},{"type":"NO","value":"N"}];

        $scope.pmd_show = false;

        $scope.selectedtype = '';
        $scope.Is_onward = 0;
        $scope.Is_amort = 0;
        $scope.Is_captalized = 0;
        $scope.Is_rcm = 0;
        $scope.invoicenum = '';
        $scope.supplier_data = '';
        $scope.selectedstate = 0;
        $scope.invoiceamount = '';
        $scope.invoicetaxamount = 0;
        $scope.pono = 0;
        $scope.gstno = '';
        $scope.CR_data = [];
        $scope.selectedsource = 0
        $scope.checkboxModel = {
            value: false,
        };
        $scope.checkbox_due = {
            value: false,
        };

        $scope.ECFcheckboxModel = {
            value: false,
        };

        $scope.Advance_incr = " ";

        $scope.ppx_empsupp_data = [{
            name: "Employee",
            value: "E",
        }, {
            name: "Supplier",
            value: "S",
        }]

       $scope.amount_check = function(invamt,taxamt){

           if(invamt == undefined){
              invamt = 0
           }; if(taxamt == undefined){
              taxamt = 0
           };

         if(parseFloat(taxamt) > parseFloat(invamt) ){
           $scope.invoicetaxamount = 0;
         }

       }

   $scope.view_supplier=function(){
            modalshow('view_supplier');
        }

<!--        var suppdata = invoiceService.getsupplierdata_sup(0);-->
<!--        suppdata.then(function(result) {-->

<!--            console.log(result.data.DATA)-->
<!--          //  $scope.data.push.apply($scope.data, result.data.DATA);// $scope.records.concat(response.data.items);-->
<!--           $scope.invoicesupplier_list = result.data.DATA;-->
<!--           //  console.log($scope.POsupplier_list);-->
<!--          })-->

<!--        var employee = invoiceService.getemployee();-->
<!--        employee.then(function(result) {-->
<!--                var employee_data = JSON.parse(result.data)-->
<!--                $scope.employee = employee_data;-->
<!--            },-->
<!--            function(err) {-->
<!--                alert('No data!.');-->
<!--            }).finally($scope.endloading);-->

        var sttddl = invoiceService.getstateddl()
        sttddl.then(function(result) {
                $scope.stateddl = [];
                $scope.stateddl = JSON.parse(result.data);

            },
            function() {
                alert('no data');
            });

        $scope.typeclick = function(type) {
               $scope.po_hide = false;

            if (type == "ADVANCE" || type == "EMP Claim") {
              if(type == "ADVANCE"){
                  $scope.ppx_hide = true;
                  $scope.invoicenum = "PPX-no";
                  $scope.Is_onward = 0;
                  $scope.Is_amort = 0;
                  $scope.Is_captalized = 0;
                  $scope.Is_rcm = 0;
                 $scope.po_hide = true;

               }
            } else if ( type == "EMP Claim")  {
                $scope.invoicenum = "PPX-no";
                $scope.ppx_hide = false;
               $scope.Is_onward = 0;
               $scope.Is_amort = 0;
               $scope.Is_captalized = 0;
               $scope.Is_rcm = 0;
            }else{
                $scope.ppx_hide = false;
            }
        }

        function selecteddate() {
            var d = $scope.to_date;
            var curr_date = d.getDate();
            var curr_month = d.getMonth();
            curr_month++;
            var curr_year = d.getFullYear();
            $scope.Service_date = curr_year + "-" + curr_month + "-" + curr_date;
        }

        $scope.AP = [];
        $scope.Inward = [];
        var count = 0;

        var Inward_detail = JSON.parse(sessionStorage.getItem('inwarddtl'));

        $scope.inwarddetails_gid = Inward_detail.inwarddetails_gid;
        $scope.doctype = Inward_detail.doc_type;

        if ($scope.doctype === 'Invoicea') {
            var channel = invoiceService.ddl('invoiceheader', 'invoicetype');
            channel.then(function(result) {
                    var channel_data = JSON.parse(result.data)

                    $scope.channelddl = $filter('filter')(channel_data, function(value) {
                        return value.metadata_value === "Non PO" || value.metadata_value === "PO";
                    });
                },
                function(err) {
                    alert('No data!.');
                }).finally();
        } else {
            var channel = invoiceService.ddl('invoiceheader', 'invoicetype');
            channel.then(function(result) {
                    var channel_data = JSON.parse(result.data)
                        //  $scope.channelddl = channel_data;
                    $scope.channelddl =channel_data;
                     <!--$filter('filter')(channel_data, function(value) {-->
                        <!--return value.metadata_value === $scope.doctype;-->
                    <!--});-->
                },
                function(err) {
                    alert('No data!.');
                }).finally();
        }

        if ($scope.doctype == 'ADVANCE') {
            $scope.ppx_hide = !$scope.ppx_hide;
            $scope.invoicenum = "PPX-no";
        }

        window.mdSelectOnKeyDownOverride = function(event) {
            event.stopPropagation();
        };

        crsummary()

        function amount_toinr(amount) {
            var x = amount;
            x = x.toString();
            var afterPoint = '';
            if (x.indexOf('.') > 0)
                afterPoint = x.substring(x.indexOf('.'), x.length);
            x = Math.floor(x);
            x = x.toString();
            var lastThree = x.substring(x.length - 3);
            var otherNumbers = x.substring(0, x.length - 3);
            if (otherNumbers != '')
                lastThree = ',' + lastThree;
            var res = otherNumbers.replace(/\B(?=(\d{2})+(?!\d))/g, ",") + lastThree + afterPoint;
            return res;

        }

        function crsummary() {

            var get_CR = invoiceService.invoiceget($scope.inwarddetails_gid);
            get_CR.then(function(result) {
<!--                $scope.loading();-->
                var CR_data = result.data;
                $scope.CR_data = CR_data;
                if(result.data.MESSAGE=="ERROR_OCCURED"){
                        alert(JSON.stringify(result.data.DATA));
                        $scope.CR_data =[];
                }
                $scope.pageLength = $scope.CR_data.length;

                $scope.myText = $scope.CR_data.length + "/" + Inward_detail.noofpockets;

                angular.forEach($scope.CR_data, function(value, key) {
                    var inramount = amount_toinr($scope.CR_data[key].invoiceheader_amount)
                    $scope.CR_data[key].invoiceheader_amount = inramount
                })

                if ($scope.CR_data.length == Inward_detail.noofpockets) {
                    alert("Data Inserted Successfully")
<!--                    $window.location.href = "Invoicesummary";-->
                }
            }).finally($scope.endloading);

        }

        function APjson_set() {

            if ($scope.Emp_gid == undefined || $scope.Emp_gid == '') {
                $scope.Emp_gid = 0;
            }
            if ($scope.supplier_data.supplier_gid == undefined || $scope.supplier_data.supplier_gid == '') {
                var supgid = 0;
            } else {
                var supgid = $scope.supplier_data.supplier_gid;
            }
            if($scope.Is_onward == 0){    $scope.Is_onward_value = 'N'        }else{  $scope.Is_onward_value = 'Y'     }
            if($scope.Is_amort == 0){    $scope.Is_amort_value = 'N'        }else{  $scope.Is_amort_value = 'Y'     }
            if($scope.Is_captalized == 0){    $scope.Is_captalized_value = 'N'        }else{  $scope.Is_captalized_value = 'Y'     }
            if($scope.Is_rcm == 0){    $scope.Is_rcm_value = 'N'        }else{  $scope.Is_rcm_value = 'Y'     }
            if(  $scope.ECF_check == 'Y'){                var supgid =$scope.ecf_suppliergid; }
            if($scope.Advance_incr == '' ){$scope.Advance_incr = 'S';}
            $scope.AP.push({
                "Invoice_Type": $scope.selectedtype,
                "Supplier_gid": supgid,
                "Sup_state_gid": $scope.selectedstate,
                "Inwarddetails_gid": $scope.inwarddetails_gid,
                "Is_GST": $scope.gst_check,
                "Invoice_Date": $scope.Service_date,
                "Invoice_No": $scope.invoicenum,
                "Invoice_Tot_Amount": $scope.invoiceamount,
                "Supplier_GST_No": $scope.gst_number,
                "Header_Status": "NEW",
                "Reprocessed": "",
                "Remark": $scope.remarks,
                "Employee_gid": $scope.Emp_gid,
                "GROUP": "INWARD",
                "branch_gid":$scope.selectedsource,
                "IS_ECF": $scope.ECF_check,
                "ECF_NO": $scope.ecf_number,
                "BAR_CODE": $scope.Bar_code,
                "RMU_CODE": "",
                "BANK_CODE": $scope.bank_code,
                "Due_Adjustment": $scope.deu_check,
                "Advance_incr" : $scope.Advance_incr,
                "Is_onward" : $scope.Is_onward_value,
                "Is_amort" : $scope.Is_amort_value,
                "Is_captalized" : $scope.Is_captalized_value,
                "Is_rcm" : $scope.Is_rcm_value,
                "invoicetaxamount" : $scope.invoicetaxamount,
                "Pono" : $scope.pono,
                "Advance_type":$scope.advance_gid,
                "location":$scope.location,
                 "Is_original_invoice":$scope.is_original_invoice,

            })

        }

        $scope.file_path="";
        $scope.file_count=0;
        $scope.file_stored_data=[];
        $scope.number_of_message=1;
        $scope.loaddata = function(file_img,img, callback) {
            debugger;
                var deferred = $q.defer();
                var promise = deferred.promise;
                promise.then(function() {
                    var file_img_length = document.getElementById('file').files.length;
                    if(file_img_length!=0){
                        for(l=0;l<file_img_length;l++){
                            var file_img = document.getElementById('file').files[l];
                            var file_name=file_img.name;
                            $scope.new_file_name=file_img.name;
                            $scope.duplicate_images=1;
                            var imgs = new FormData();
                            imgs.append('file', file_img);
                            imgs.append('name', file_name);
                            for(var p=0;p<$scope.deleted_files.length;p++){
                                $scope.temp_file_names=$scope.deleted_files[p].file_names;
                                if($scope.new_file_name==$scope.temp_file_names){
                                    $scope.duplicate_images=0;
                                    $scope.file_count=$scope.file_count+1;
                                }
                            }
                            if(file_img!=undefined&&$scope.duplicate_images==1){
                              $scope.loading();
                                 var upload = invoiceService.save_files(imgs);
                                 upload.then(function(result) {
                                    $scope.all_datas= result.data;
                                    if($scope.all_datas.status=="SUCCESS"){
                                    $scope.file_count=$scope.file_count+1;
                                    $scope.file_status=1;
                                    $scope.file_stored_data.push($scope.all_datas);
                                    }
                                    else{
                                        $scope.file_status=2;
                                    }
                                    callback();
                                }).finally($scope.endloading);
                            }
                            else{
                                $scope.file_status=0;
                                callback();
                            }
                        }
                    }
                     else{
                           if($scope.invoiceheader_gid!=0){
                                $scope.file_status=1;
                                $scope.endloading();
                                callback();
                                $scope.endloading();
                            }
                            else{
                                alert("Please Attache File...");
                                $scope.endloading();
                        }

                     }
                }).then(function() {
                    // callback();
                });
                deferred.resolve();

        };
        $scope.file_status=0;

        $scope.add_continue = function() {
        debugger;
             if($scope.selectedtype == "Non PO" || $scope.selectedtype == "PO"){
                 if($scope.checkboxModel.value == false){
                    if($scope.invoiceamount !== $scope.invoicetaxamount){
                         alert("check whether invoice has gst Applicability");
                         return false;
                    }
                }
             }
            var upload_file_length = document.getElementById('file').files.length;
            if(upload_file_length!=0 || $scope.ECFcheckboxModel.value==true){
                if ($scope.CR_data.length >= Inward_detail.noofpockets) {
                    alert("Invoice Count Exceeds");
                    return false;
                }

                var invcnumber = $scope.invoicenum;
                $scope.no_chk = $filter('filter')($scope.Inward, {
                    Product_slno: invcnumber
                }, true);

                if ($scope.no_chk.length > 0) {
                    alert("Invoice No Already Inserted")
                    return false;
                }

                if ($scope.selectedtype !== '' && $scope.selectedsource !== 0 && $scope.selectedsource !== undefined && $scope.Emp_gid !== undefined && $scope.Emp_gid !== ''&& $scope.invoicenum !== '' && $scope.invoiceamount !== '') { // && $scope.invoicenum !== '' && $scope.supplier_data !== '' && $scope.selectedstate !== '' && $scope.invoiceamount !== '' && $scope.supplier_data !== undefined) {

                    if ($scope.checkboxModel.value == true) {
                        $scope.gst_check = 'Y';
                        if ($scope.gstno !== '') {
                            $scope.gst_number = $scope.gstno;
                        } else {
<!--                           if($scope.selectedtype !== 'IMPREST'){-->
<!--                            alert("Please Enter GST No");-->
<!--                            return false;-->
<!--                           }-->
                        }
                    } else {
                        $scope.gst_check = 'N';
                        $scope.gst_number = '';

                    }
                    if($scope.is_original_invoice==""){
                        alert("Select Is Original Invoice");
                        return false;
                    }

                    if ($scope.ECFcheckboxModel.value == true) {
                        $scope.ECF_check = 'Y';
                        if ($scope.ecf_number !== '') {

                        } else {
                            alert("Please Enter ECF No");
                            return false;
                        }
                    } else {
                        $scope.ECF_check = 'N';
                        $scope.ecf_number = "";

                    }
                    if ($scope.checkbox_due.value == true) {
                        $scope.deu_check = 'Y';
                    }else{
                        $scope.deu_check = 'N';
                    }
                    selecteddate();

                    $scope.Inward.push({
                        sno: 1,
                        Invoice_Type: $scope.selectedtype,
                        Supplier_name: $scope.supplier_data.supplier_name,
                        Invoice_No: $scope.invoicenum,
                        Invoice_Tot_Amount: $scope.invoiceamount,
                        Invoice_Date: $scope.to_date

                    })

                    APjson_set();

                    var header_json = {
                        HEADER: $scope.AP
                    }
                    console.log($scope.AP)
                    count = $scope.CR_data.length + 1;
                    $scope.myText = count + "/" + Inward_detail.noofpockets;

                    //SAKTHIVEL ADDED

                    var file_img = document.getElementById('file').files[0];
                    $scope.list_of_files= document.getElementById('file').files.length;
                    var img = new FormData();
                    var UPLOAD_FILE="";

                    if(file_img!=undefined){
                        $scope.file_status=0;
                        var file_name=file_img.name;

                        var filename = file_img.name;
                        var index = filename.lastIndexOf(".");
                        $scope.strsubstring = filename.substring(index, filename.length);

                        img.append('file', file_img);
                        img.append('name', filename);
                    }
                    debugger;
                    $scope.loaddata(file_img,img, function() {
                        if($scope.file_status==1&&$scope.file_count==$scope.list_of_files){
                            header_json.HEADER[0].file_data=$scope.file_stored_data;
                            $scope.loading();

                            var save_service = invoiceService.invoiceset(header_json);
                            save_service.then(function(result) {

                                $scope.AP = [];
                                if (result.data == 'SUCCESS' || result.data == 'INVOICE ALREADY EXISTS.') {
                                    $scope.remove_all_files();
                                    if (result.data == 'INVOICE ALREADY EXISTS.') {
                                          alert('INVOICE ALREADY EXISTS.');
                                    }

                                    crsummary()

                                }
                                 else if(result.data=="Email_Not_Send") {
                                    crsummary();
                                    alert("Email Not Send...");
                                }
                                else if(result.data.MESSAGE=="ERROR_OCCURED"){
                                    alert(JSON.stringify(result.data));
                                }
                                else{
                                    alert(JSON.stringify(result.data));
                                }
                            },
                            function(err) {
                                alert('Not Updated!.');
                            }).finally($scope.endloading);
                        }
                        else if($scope.file_status==2){
                            alert("File Upload Failed");
                         }
                        else if($scope.file_status==0 && $scope.file_path.length==0 && $scope.number_of_message==1){
                            alert("Please Attach File");
                            $scope.deleted_files=[];
                            $scope.number_of_message=$scope.number_of_message+1;
                            $scope.endloading();
                        }
                    });
debugger;
                    $scope.selectedtype = "";
                    $scope.invoicenum = "";

                     $scope.ecf_suppliergid = 0
                     $scope.ecf_employeegid = 0
                     $scope.ecf_branchgid = 0
                    $scope.invoiceamount = "";

                    $scope.remarks = "";
                    $scope.checkboxModel.value = false;
                    $scope.checkbox_due.value = false;

                    $scope.selectedsource = 0;
                    $scope.dest_gstno = "";
                    $scope.bank_code = "";
                     $scope.Rmu_code = "";
                   $scope.bank_code = "";
                   $scope.Advance_incr = " ";
                  $scope.searchbrancheName = "";
                  $scope.location = 0;
                  $scope.searchemp=  "";
                  $scope.is_original_invoice="";
                  $scope.pmd_show = false;

                  //Already commented

                   //$scope.supplier_data = "";
                    //$scope.selectedstate = "";
                    // $scope.supplstate_gid = 0
                     // $scope.Emp_gid = "";
                     // $scope.gstno = "";

                } else {
                    alert("Fill The Required Fields")

                }
            }
            else{
                alert("Please Attach File");
            }
        }



        $scope.add_ECF  = function(ecfnumber) {
        debugger;
                       $scope.po_hide = false;

            $scope.ppx_hide = true;
            $scope.invoiceheader_gid=0;
            debugger;

            var summary = invoiceService.getmakerservice("ECF_HEADERGET",ecfnumber);
            summary.then(function(result) {
            if(result.data.length == 0){
             alert("Enter Valid ECF-NO")
            }
                $scope.selectedtype = result.data[0].invoiceheader_invoicetype;
                $scope.note_key= result.data[0].invoiceheader_notename;
                if ($scope.selectedtype == "ADVANCE" || $scope.selectedtype == "PO"|| $scope.selectedtype == "PETTYCASH" || $scope.selectedtype == "EMP Claim"|| $scope.selectedtype == "TCF"  ) {
                   if($scope.selectedtype == "ADVANCE" ){var suplid = 0;
                             $scope.ppx_empsupp_data = [{
                                name: "Employee",
                                value: "E",
                            }, {
                                name: "Supplier",
                                value: "S",
                            }];
                            $scope.Advance_incr =  result.data[0].invoiceheader_ppx;
                               //  $scope.ppx_hide = true;
                              $scope.po_hide = true;

                   }else if ($scope.selectedtype == "PETTYCASH"){var suplid = 0;
                             $scope.ppx_empsupp_data = [{
                                name: "Employee",
                                value: "E",
                            }, {
                                name: "PETTYCASH",
                                value: "I",
                            }];
                                $scope.Advance_incr =  result.data[0].invoiceheader_ppx;

                                 $scope.ppx_hide = true;
                   }else if ($scope.selectedtype == "PO"){var suplid = 0;
                             $scope.ppx_empsupp_data = [{
                                name: "Employee",
                                value: "E",
                            }, {
                                name: "Supplier",
                                value: "S",
                            }];
                                $scope.Advance_incr =  result.data[0].invoiceheader_ppx;
                            <!--alert(result.data[0].invoiceheader_ppx)-->
                                 $scope.ppx_hide = true;
                   }else {
                                var suplid = 0;
                             $scope.ppx_empsupp_data = [{
                                name: "Employee",
                                value: "E",
                            }, {
                                name: "PETTYCASH",
                                value: "I",
                            }];
                                $scope.Advance_incr =  result.data[0].invoiceheader_ppx;

                   }
               }else{
                            $scope.ppx_empsupp_data = [{
                                name: "Employee",
                                value: "E",
                            }, {
                                name: "PETTYCASH",
                                value: "I",
                            }, {
                                name: "Supplier",
                                value: " ",
                            }];
                                $scope.Advance_incr =  result.data[0].invoiceheader_ppx;

               }
                           $scope.pmd_show = false;

              //  $scope.selectedtype ="PO";
                $scope.invoicenum = result.data[0].invoiceheader_invoiceno;
                $scope.invoiceheader_gid = result.data[0].invoiceheader_gid;
              //  $scope.to_date = result.data[0].invoiceheader_invoicedate;
                $scope.ecf_suppliergid = result.data[0].invoiceheader_suppliergid;
                $scope.to_date = new Date(result.data[0].invoiceheader_invoicedate);
                $scope.supplstate_gid = result.data[0].invoiceheader_supplierstategid;
                $scope.invoiceamount = result.data[0].invoiceheader_amount;
                $scope.invoicetaxamount = result.data[0].invoiceheader_taxableamt;
                $scope.supplierclick($scope.ecf_suppliergid);
                $scope.remarks = result.data[0].invoiceheader_remarks;
                $scope.ecf_branchgid = result.data[0].invoiceheader_branchgid;
                $scope.selectedsource = result.data[0].invoiceheader_branchgid;
                $scope.selected_advance = result.data[0].metadata_value;
                $scope.advance_gid = result.data[0].invoiceheader_advancetype;
              $scope.dest_gstno = result.data[0].branch_metadatavalue;
              $scope.searchbrancheName = result.data[0].branch_name;
              $scope.pono = result.data[0].invoiceheader_ponumber;
              $scope.location = result.data[0].invoiceheader_pmdgid;

              if(result.data[0].branch_code == '1360'){
                 var datas={"action":'GET',"type":"PMD_SUMMARY","filter":{}};

                    var pmd_summary = invoiceService.pmd_get(datas);
                     pmd_summary.then(function(result) {
                           $scope.pmd_show = true;
                            $scope.pmd_summary_data =result.data;
                            $scope.pmd_summary_data_filter =result.data;
                            if(result.data.MESSAGE=="ERROR_OCCURED"){
                                alert(JSON.stringify(result.data));
                            }
                            if($scope.currentPage==1){
                                $scope.Total_Row=$scope.pmd_summary_data[0].Total_Row;
                            }
                            console.log($scope.pmd_summary_data);
                        },
                        function(err) {
                            alert("No Data");
                }).finally($scope.endloading);
              }


<!--                var ecfbranchData = $filter('filter')($scope.soourcedata, {-->
<!--                                                 branch_gid: $scope.ecf_branchgid-->
<!--                                    });-->

<!--                                  var destgst_data = JSON.parse(ecfbranchData[0].branchdetail);-->
<!--                                  $scope.dest_gstno = destgst_data[0].branch_metadatavalue;-->
                 if(result.data[0].invoiceheader_gst == 'Y'){$scope.checkboxModel.value = true;
                                 $scope.ecf_branchgid = result.data[0].invoiceheader_branchgid;

<!--                                 var ecfbranchData = $filter('filter')($scope.soourcedata, {-->
<!--                                                 branch_gid: $scope.ecf_branchgid-->
<!--                                    });-->

<!--                                  var destgst_data = JSON.parse(ecfbranchData[0].branchdetail);-->
<!--                                  $scope.dest_gstno = destgst_data[0].branch_metadatavalue;-->

                    }else{

                    $scope.checkboxModel.value = false;

                    }
                $scope.ecf_employeegid = result.data[0].invoiceheader_employeegid;
                     $scope.searchemp= result.data[0].employee_name;

                     $scope.ECFsupplier_data= result.data[0].supplier_branchname;
                $scope.Emp_gid = result.data[0].invoiceheader_employeegid;
                $scope.ecf_number = result.data[0].invoiceheader_crno;
             //   $scope.supplier_data.supplier_gid = $scope.ecf_suppliergid;
               $scope.Rmu_code = '1';
               $scope.Bar_code = '1';


                },
                function(err) {
                    alert('No data!.');
                }).finally($scope.endloading);



        }


<!--        var resaondata = invoiceService.getentitydata();-->
<!--                 resaondata.then(function(result) {-->
<!--            $scope.soourcedata = result.data.DATA-->


<!--        })-->


            $scope.soourcedata = function(query) {

            var datas={params:{"type":"Mode","Sub_Type":"Summary_new",
                               "FILTER":{"Limit_Start":0,"Limit_End":30,"branch_name":"","branch_detail":query,
                                            "branch_code":""},"CLASSIFICATION":{"Entity_Gid":[0]}}};

                         return $http.post(Appname + '/classificationdata_get/' , datas).then(function(data) {

                            var final_values=data.data.DATA;
                            console.log(final_values);
                            return final_values;
                          });


        }




       $scope.sourceclick = function(value) {

      var branchData = $filter('filter')(JSON.parse(value.branchdetail), {
                metadata_value: "GSTNO"
            });
        $scope.dest_gstno = "";
        $scope.dest_gstno = branchData[0].branch_metadatavalue;

        $scope.bank_code = value.branch_stdcode

      }

      $scope.supplierclick = function (supplier_gid){

         var suppdata = invoiceService.getsupplierdata(supplier_gid);
                 suppdata.then(function(result) {

              $scope.supplstate_gid = result.data.DATA[0].address_state_gid;
              $scope.gstno = result.data.DATA[0].taxdetails_taxno;

         })

      }

       $scope.get_advance_type= function(searchText) {
            var senddatas={"filter":{"Table_name": "gal_mst_tmetadata", "Column_1": "metadata_value,metadata_gid",
             "Column_2": "", "Where_Common": "metadata", "Where_Primary": "columnname",
              "Primary_Value": "invoiceheader_advancetype", "Order_by": "columnname"}};
            return $http.post(Appname + '/ap_all_table_values_get/' , senddatas).then(function(data) {
                return data.data.DATA;
              });
        };


//supplier

<!--        $scope.getSupplierName = Change_Supplier_Name;-->
<!--        function Change_Supplier_Name(query) {-->
<!--            $scope.search_supplier_name=query;-->
<!--            load_supplier(0,30);-->
<!--           var result = $filter('filter')($scope.supplier_list_copy, {-->
<!--           'supplier_name': query-->
<!--             });-->
<!--           return result;-->
<!--        }-->
        $scope.getSupplierName = function(query) {
            var datas={"Params":{"Group":"GET_EMP_DATA","Type":"SUPPLIER","Sub_Type":"SUPPLIER_ALL",
                         "FILTER":{"supplier_branchname" :$scope.searchSuplierName,
                         "Supplier_code":$scope.search_supplier_code,
                         "Supplier_gstno":$scope.search_supplier_gstno,"Pan_Number":$scope.pan_number},"Limit": 0 + "," + 30,}};

                         return $http.post(Appname + '/Get_Supplier/' , datas).then(function(data) {

                            var final_values=data.data.DATA;
                            console.log(final_values);
                            return final_values;
                          });
        }
        $scope.count = 0;

        $scope.branchNameChanged = function (branch){
           if(branch != undefined){

              $scope.selectedsource  =branch.branch_gid;
              $scope.sourceclick(branch);

             if(branch.branch_code == '1360'){
               var datas={"action":'GET',"type":"PMD_SUMMARY","filter":{}};

                var pmd_summary = invoiceService.pmd_get(datas);
                 pmd_summary.then(function(result) {
                       $scope.pmd_show = true;
                        $scope.pmd_summary_data =result.data;
                        $scope.pmd_summary_data_filter =result.data;
                        if(result.data.MESSAGE=="ERROR_OCCURED"){
                            alert(JSON.stringify(result.data));
                        }
                        if($scope.currentPage==1){
                            $scope.Total_Row=$scope.pmd_summary_data[0].Total_Row;
                        }
                        console.log($scope.pmd_summary_data);
                    },
                    function(err) {
                        alert("No Data");
                }).finally($scope.endloading);
             }else{
                                 $scope.pmd_show = false;
              }



           }else{

            $scope.selectedsource  = 0;

           }
        }

        $scope.supplier_gst="N";
        $scope.supplierNameChanged=function(supplier){


            if (supplier.supplier_gid > 0) {
                $scope.supplier_data=supplier;
                $scope.supplier_name=supplier.supplier_branchname;
                $scope.supplierclick(supplier.supplier_gid);
                $scope.supplier_gst=supplier.supplier_gstapplicable;
            }
            else
            {
                $scope.supplier_name="";
                $scope.supplier_data="";
                $scope.count++;
                $scope.loadcount = $scope.count * 60;
                for (i = 0; i <= $scope.loadcount; i++) {
                    if ($scope.loadcount == i) {
                        load_supplier(0, i)
                    }
                }
            }

        };

        $scope.validate_gst=function(value){
            if($scope.supplier_gst=="N"){
                $scope.checkboxModel.value=false;
                alert("GST is not applicable for this supplier");
            }
        }


<!--        load_supplier(0, 30);-->
<!--        $scope.search_supplier=function(){-->
<!--            load_supplier(0,30);-->
<!--        }-->
<!--        function load_supplier(x,y){-->
<!--            var datas={"Params":{"Group":"GET_EMP_DATA","Type":"SUPPLIER","Sub_Type":"SUPPLIER_ALL",-->
<!--                         "FILTER":{"Supplier_name" :$scope.search_supplier_name,-->
<!--                         "Supplier_code":$scope.search_supplier_code,-->
<!--                         "Supplier_gstno":$scope.search_supplier_gstno},"Limit": x + "," + y,}};-->


<!--            var supplier = invoiceService.get_supplier_details(datas);-->
<!--                supplier.then(function(result) {-->
<!--                debugger;-->
<!--                 var res = result.data.DATA;-->
<!--                 $scope.supplier_list=res;-->
<!--                 $scope.supplier_list_copy=res;-->
<!--                 console.log($scope.supplier_list);-->
<!--                 for (var i = 0; i < 1; i++) {-->
<!--                dta = {-->
<!--                    "supplier_display_name": "",-->
<!--                    "supplier_gid": -1,-->
<!--                    "supplier_landmark": '',-->
<!--                    "supplier_name": "LOAD MORE.....",-->
<!--                }-->
<!--                $scope.supplier_list.push(dta);-->
<!--            }-->
<!--                 }, function(err) {-->
<!--                  alert(res);-->
<!--             }).finally();-->

<!--        }-->
        $scope.clear_supplier=function(){
            $scope.supplier_name="";
            $scope.supplier_gid=0;
            $scope.searchSuplierName="";
            $scope.search_supplier_code="";
            $scope.search_supplier_gstno="";
        }

// employee


<!--        get_data_emp(1, 30);-->
<!--        function get_data_emp(x,y){-->
<!--            var data = {-->
<!--                params: {-->
<!--                    "Group": "GET_EMP_DATA",-->
<!--                    "Limit" : x + "," + y,-->
<!--                    "Type": "EMPLOYEE",-->
<!--                    "Sub_Type": "EMPLOYEE_ALL",-->
<!--                    "json" : {-->
<!--                        "Params": {-->
<!--                                "FILTER": {-->
<!--                                    "Employee_name":$scope.srchname,-->
<!--                                },-->
<!--                            }-->
<!--                        }-->
<!--                    }-->
<!--                }-->
<!--            var employee = invoiceService.getemployee(data);-->
<!--            employee.then(function(result) {-->
<!--                    $scope.main = result.data.DATA;-->
<!--                    $scope.employee = $scope.main;-->
<!--                    for (var i = 0; i < 1; i++) {-->
<!--                        dta = {-->
<!--                            "employee_gid": -1,-->
<!--                            "employee_name": "LOAD MORE.....",-->
<!--                        }-->
<!--                        $scope.employee.push(dta);-->
<!--                    }-->
<!--              });-->
<!--        }-->

<!--        $scope.getemployee_srch = gotocust;-->
<!--        function gotocust(query) {-->
<!--            $scope.srchname = query;-->
<!--            get_data_emp(1, 30);-->
<!--            var result = $filter('filter')($scope.employee, {-->
<!--                'employee_name': query-->
<!--            });-->
<!--            return result;-->
<!--        }-->
           $scope.getemployee_srch= function(searchText) {

            var datas = {
                params: {
                    "Group": "GET_EMP_DATA",
                    "Limit" : 0 + "," + 30,
                    "Type": "EMPLOYEE",
                    "Sub_Type": "EMPLOYEE_ALL",
                    "json" : {
                        "Params": {
                                "FILTER": {
                                    "Employee_name":searchText,
                                },
                            }
                        }
                    }
                }
            return $http.post(Appname + '/employee_mst_data/' , datas).then(function(data) {
            console.log(data.data);
                return data.data.DATA;
              });
          };



        $scope.counts = 0;
        $scope.employee_change =function(emp){

            if (emp.employee_gid > 0) {
                $scope.Emp_gid=emp.employee_gid;
                $scope.employee_name=emp.employee_name;
                $scope.employee_gid = emp.employee_gid;

            }
            else
            {
                $scope.employee_name="";
                $scope.counts++;
                $scope.loadcounts = $scope.counts * 60;
                for (i = 0; i <= $scope.loadcounts; i++) {
                    if ($scope.loadcounts == i) {
                        get_data_emp(0, i)
                    }
                }
            }

        }

        $scope.stepsModel=[];
        $scope.image_visible="false";

        $scope.imageUpload = function(event){
        debugger;
        $scope.stepsModel=[];
        $scope.filenames = [];
        $scope.image_visible ="true";
             var files = event.target.files; //FileList object
             for (var i = 0; i < files.length; i++) {
                 var file = files[i];
                     var reader = new FileReader();
                     reader.onload = $scope.imageIsLoaded;
                     reader.readAsDataURL(file);
                     $scope.filenames.push(file.name);
             }
        }
        $scope.sttepsModel_Last=[];
        $scope.imageIsLoaded = function(e){
            $scope.$apply(function() {
                $scope.stepsModel.push(e.target.result);
            });
            $scope.sttepsModel_Last=[];
            for(var k=0;k<$scope.filenames.length;k++){
                $scope.extension_1=$scope.filenames[k].substr($scope.filenames[k].lastIndexOf('.')+1);
                $scope.sttepsModel_Last.push({"file":$scope.stepsModel[k],"file_name":$scope.filenames[k],"extension":$scope.extension_1});
            }
        }

        $scope.view_images_popup=function(){

<!--            $scope.file_path = $scope.stepsModel;-->
            $scope.file_path = $scope.sttepsModel_Last;
            console.log($scope.file_path);
            console.log($scope.sttepsModel_Last);
            modalshow('view_images');

        }

        $scope.deleted_files=[];
        $scope.delete_one_file=function(index,file_name){
            debugger;
            $scope.file_imglength = document.getElementById('file').files.length;
            for(i=0;i<$scope.file_imglength;i++){
                if(i==index){
                    $scope.file_path.splice(i, 1);
<!--                    var file_img = document.getElementById('file').files[i];-->
<!--                    var file_name=file_img.name;-->
                    $scope.deleted_files.push({"file_names":file_name});
                }
            }
            if($scope.file_path.length==0){
                $scope.remove_all_files();
            }
        }


        $scope.remove_all_files=function(){
            $scope.file_path=[];
            $scope.deleted_files=[];
            elmn = angular.element( document.getElementById( 'file' ).files);
            elmn.remove();
            angular.element("input[type='file']").val(null);
            $scope.image_visible="false";
        }


        $scope.invoiceheader_gid=0;
        $scope.view_attached_file=function(){
        debugger;
        if($scope.invoiceheader_gid!=0){
            var datas={params:{"action":"GET","type":"FILE_DETAIL",
                "filter":{"file_reftablegid":$scope.invoiceheader_gid,"ref_name":"ECF_INVOICE"}}};
             $scope.loading();
             var ecf_file_data = invoiceService.get_approval_summary(datas);
             ecf_file_data.then(function(result) {

                    $scope.ecf_all_files = result.data;
                     modalshow('view_attached_file');

             },
             function(err) {
                alert('No data!.');
             }).finally($scope.endloading);
         }
         else{
            alert("No Header Gid");
         }

     }

     $scope.clear_emp=function(){
     $scope.emp_code;
     }


     $scope.view_file=function(file_list){
        debugger;
        debugger;
        var datas={"file_data":[file_list]};
         $scope.loading_view_attached_file();
         var generated_urls = invoiceService.get_generated_url_data(datas);
         generated_urls.then(function(result) {
                $scope.url_datas = result.data;
                $scope.file_url_path=$scope.url_datas[0].file_path;
                var final_file_name=$scope.url_datas[0].file_name;
                $scope.extension=final_file_name.substr(final_file_name.lastIndexOf('.')+1);
                if($scope.extension=="pdf"){
                    complete_url ='http://docs.google.com/gview?url=' + encodeURIComponent($scope.file_url_path) + '&embedded=true';
                    $scope.pdf_file_url_path = $sce.trustAsResourceUrl(complete_url);
                }
                 modalshow('show_file');
         },
         function(err) {
            alert('No data!.');
         }).finally($scope.endloading);
     }

     $scope.trustAsHtml = function(html) {
      return $sce.trustAsHtml(html);
    }


     $scope.change_advance_type =function(metadata_gid){
               $scope.advance_gid = metadata_gid;

     }

     $scope.view_note_file=function(){
        debugger;
        if($scope.note_key=="" || $scope.note_key==null){
            alert("No Notes");
        }
        else{
            var data = {"Filename":$scope.note_key}
                $scope.loading();
                var getdept_name = invoiceService.get_file_read(data)
                getdept_name.then(function(result) {
                $scope.htmlcontent = result.data.file_path
                 modalshow('viewnotepad');
                }, function(err) {
                    alert('No data!.');
                }).finally($scope.endloading);
        }
    }


}]);


myApp.service("invoiceService", function ($http,$filter) {
    this.pmd_get=function(data){
        var response=$http.post(Appname+"/get_pmd_data/",data);
        return response;
    }

    this.getdropdown = function (tablename) {
        var responsee = $http.post(Appname+"/Dropdown_detail_ap/",{params:{"tablename":tablename,"gid":0,"name":''}});
        return responsee;
    }

    this.getstateddl = function (d) {
        var response = $http.get(Appname+"/stateddl/");
        return response;

    }

<!--       this.getemployee=function(){-->
<!--        var response=$http.get(Appname+"/empddl/");-->
<!--        return response;-->
<!--     }-->

     this.getemployee=function(data){
        var response=$http.post(Appname+"/employee_mst_data/",data);
        return response;
     }

     this.ddl=function(tablename,columnname){
            var response=$http.get(Appname+"/get_custdata/",{params:{"tablename":tablename,"columnname":columnname}});
            return response;
     }

     this.invoiceset=function(headerjson){
        var response=$http.post(Appname+"/Invoiceheader_set/",{params:{"action":"INSERT","type":"INVOICE_HEADER","header_json":headerjson,"debit_json":{},"detail_json":{},"status_json":{}}});
        return response;
     }

     this.invoiceget=function(inwarddetail_gid){
        var response=$http.post(Appname+"/APInvoice_get/",{params:{"action":"INVOICE_MAKER","ponumber":"","supplier_gid":1,"inwarddetail_gid":inwarddetail_gid,"inwardheader_gid":0,"status":""}});
        return response;
     }

     this.getentitydata = function () {
        var response=$http.post(Appname+"/classificationdata_get/",{params:{"type":"Mode","Sub_Type":"Summary",
                               "FILTER":{},"CLASSIFICATION":{"Entity_Gid":[0]}}});
        return response;
    }

    this.getsupplierdata = function (supp_gid) {
        var response=$http.post(Appname+"/supplierdata_get/",{params:{"type":"Suppplier","Sub_Type":"GSTNO",
                               "FILTER":{"Supplier_gid":supp_gid},"CLASSIFICATION":{"Entity_Gid":[0]}}});
        return response;
    }
    this.getmakerservice = function (action,ecfno) {
        var response=$http.post(Appname+"/ECFInvoice_get/",{params:{"action":action,"ecfnumber":ecfno,"supplier_gid":0,"inwarddetail_gid":0,"inwardheader_gid":0,"status":"NEW,REPROCESS"}});
        return response;
    }
<!--        this.getsupplierdata_sup = function (supp_gid) {-->
<!--        var response=$http.post(Appname+"/supplierdata_get/",{params:{"type":"Suppplier","Sub_Type":"DROPDOWN",-->
<!--                               "FILTER":{"Supplier_gid":supp_gid},"CLASSIFICATION":{"Entity_Gid":[0]}}});-->
<!--        return response;-->
<!--    }-->
    this.get_supplier_details = function (data) {
        var response=$http.post(Appname+"/Get_Supplier/",data);
        return response;
     }


    this.save_files=function(img){
              var response=$http.post(Appname+"/fileUploadS3/",img,
                   {
                     transformRequest: angular.identity,
                     headers: {
                        'Content-Type': undefined
                     }
                   }
              );
              return response;
    }


    this.get_approval_summary=function(data){
        var response=$http.post(Appname+"/get_onward_data/",data);
        return response;
    }

    this.get_generated_url_data=function(data){
        var response=$http.post(Appname+"/common_s3_file_url_generate/",data);
        return response;
    }

    this.get_file_read = function (data) {
        var response = $http.post(Appname + "/common_read_file/", data);
        return response;
    }






});


































































</script>
{% endblock %}