{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %} Electricity Details {% endblock %}
{% block content %}
{% csrf_token %}
{% verbatim %}
<div class="maincontent">
    <div ng-app="Appprcreate" ng-controller="Ctrlprcreate" class="container container1" ng-cloak>
        <div class="row">
            <div class="row-header col-lg-12 col-sm-12">
                <h4>{{alldatas}} Electricity Details</h4>
            </div>
        </div>
        <div class="modal fade" id="view_supplier" tabindex="-1" role="dialog" data-backdrop="static"
             data-keyboard="false" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document" style="width:70%">
                <div class="modal-content">
                    <div class="modal-header popup-header">
                        <h5 class="modal-title" id="exampleModalLabel">
                            Find Premises
                            <button type="button" class="close" data-dismiss="modal" ng-click="close_pr_popup()"
                                    aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </h5>
                    </div>
                    <div class="body">
                        <form class="modal-body popup-body" name="supplier" novalidate>

                            <div class="row">

                                <div class="col-md-12" ng-show="shwfrCODO">
                                    <div class="col-md-4">

                                        <md-autocomplete
                                                md-clear-button="true" md-floating-label="Choose Branch"
                                                md-input-maxlength=126
                                                md-item-text="item.branch_detail"
                                                md-items="item in soourcedata(searchbrancheName)"
                                                md-selected-item-change="branchnameget(pr.branch_gid,pr)"
                                                md-min-length=0 md-search-text="searchbrancheName"
                                                ng-model="itemss" md-no-cache="true" size="5"
                                                md-selected-item="pr.branch_gid">
                                            <md-item-template>
                                                <span md-highlight-text="searchbrancheName"> {{item.branch_detail}}</span>
                                            </md-item-template>
                                            <md-not-found>
                                                No Branch Name matching "{{search Branch Name}}"
                                                were
                                                found.
                                            </md-not-found>
                                        </md-autocomplete>

                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="body">

                                        <div class="row table-responsive">
                                            <div class="col-md-12 col-lg-12 col-sm-12">
                                                <table class="table table-striped table-bordered table-condensed table-hover md-primary"
                                                       md-progress="deferred">
                                                    <thead class="header">
                                                    <tr style="text-align:center">
                                                        <th>S.No</th>
                                                        <th>Premises Code</th>
                                                        <th>Premises Name</th>
                                                        <th>Occupancy Type</th>
                                                        <th>OwnerShip</th>
                                                        <th>Address Line 1</th>
                                                        <th>Address Line 2</th>
                                                        <th>Address Line 3</th>
                                                        <th>City Name</th>
                                                        <th>District Name</th>
                                                        <th>State Name</th>
                                                        <th>Pincode</th>
                                                        <th>Action</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tr ng-repeat="sums in maintable">
                                                        <td>
                                                            <center>{{((currentPage-1)*itemsPerPage)+$index+1}}
                                                            </center>
                                                        </td>

                                                        <td> {{sums.premises_code}}</td>
                                                        <td> {{sums.premises_name}}</td>
                                                        <td> {{sums.Occupancy}}</td>
                                                        <td> {{sums.ownership}}</td>
                                                        <td> {{sums.address_1}}</td>
                                                        <td> {{sums.address_2}}</td>
                                                        <td> {{sums.address_3}}</td>
                                                        <td> {{sums.City_Name}}</td>
                                                        <td> {{sums.district_name}}</td>
                                                        <td> {{sums.state_name}}</td>
                                                        <td> {{sums.address_pincode}}</td>
                                                        <td>
                                                            <input type="checkbox"
                                                                   ng-click="selectEntity($index,sums)"
                                                                   ng-model="sums.ischecked">
                                                        </td>
                                                    </tr>
                                                    </tbody>
                                                    <tfoot>
                                                    <tr>

                                                        <td colspan="12">
                                                            <ul uib-pagination total-items="Total_Length"
                                                                ng-model="currentPage"
                                                                max-size="maxSize" ng-change="pageChanged()"
                                                                class="pagination-sm"
                                                                boundary-links="true"
                                                                items-per-page="itemsPerPage"></ul>
                                                        </td>
                                                    </tr>
                                                    </tfoot>
                                                </table>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <!--                                    <div class="col-md-3">-->
                            <!--                                         <md-autocomplete md-clear-button="true"  md-floating-label="Premises Name"-->
                            <!--                        md-item-text="item.premises_name" md-items="item in premisesname_search(branchddl_)" md-min-length=0-->
                            <!--                        md-no-cache="true" md-search-text="branchddl_" md-selected-item="premises_data"-->
                            <!--                        md-selected-item-change="branchnamet(premises_data)" required>-->
                            <!--                        <md-item-template>-->
                            <!--                            <span md-highlight-text="branchddl_"> {{item.premises_name}} </span>-->
                            <!--                        </md-item-template>-->
                            <!--                        <md-not-found>-->
                            <!--                            Not found.-->
                            <!--                        </md-not-found>-->
                            <!--                    </md-autocomplete>-->

                            <!--                                    </div>-->
                            <!--                                          <div class="col-md-1">-->
                            <!--                                        <md-button class="md-fab md-mini md-primary custbutton"-->
                            <!--                                                   ng-click="getSupplierName()">-->
                            <!--                                            <md-icon>search</md-icon>-->
                            <!--                                            <md-tooltip>Search</md-tooltip>-->
                            <!--                                        </md-button>-->
                            <!--                                    </div>-->
                            <!--                                </div>-->
                            <!--                            </div>-->
                            <!--                            <div class="row">-->
                            <!--                                <div class="col-md-12">-->
                            <!--                                    <div class="col-md-5">-->
                            <!--                                        <div class="row">-->
                            <!--                                            <span>-->
                            <!--                                                <h4 style="color:green;">Address Line 1:<span style="color:black">-->
                            <!--                                                        {{address_1}}</span></h4>-->
                            <!--                                            </span>-->
                            <!--                                        </div>-->
                            <!--                                        <div class="row">-->
                            <!--                                            <span>-->
                            <!--                                                <h4 style="color:green;">Address Line 2:<span style="color:black">-->
                            <!--                                                        {{address_2}}</span></h4>-->
                            <!--                                            </span>-->
                            <!--                                        </div>-->
                            <!--                                        <div class="row">-->
                            <!--                                            <span>-->
                            <!--                                                <h4 style="color:green;">Address Line 3:<span style="color:black">-->
                            <!--                                                        {{address_3}}</span></h4>-->
                            <!--                                            </span>-->
                            <!--                                        </div>-->
                            <!--                                        <div class="row">-->
                            <!--                                            <span>-->
                            <!--                                                <h4 style="color:green;">City:<span style="color:black">-->
                            <!--                                                        {{City_Name}}</span></h4>-->
                            <!--                                            </span>-->
                            <!--                                        </div>-->
                            <!--                                    </div>-->
                            <!--                                    <div class="col-md-6">-->

                            <!--                                        <div class="row">-->
                            <!--                                            <span>-->
                            <!--                                                <h4 style="color:green;">District:<span style="color:black;">-->
                            <!--                                                        {{district_name}}</span></h4>-->
                            <!--                                            </span>-->
                            <!--                                        </div>-->
                            <!--                                        <div class="row">-->
                            <!--                                            <span>-->
                            <!--                                                <h4 style="color:green;">State Name:<span style="color:black;">-->
                            <!--                                                        {{state_name}}</span></h4>-->
                            <!--                                            </span>-->
                            <!--                                            <span>-->
                            <!--                                                <h4 style="color:green;">Pincode:<span style="color:black;">-->
                            <!--                                                        {{address_pincode}}</span></h4>-->
                            <!--                                            </span>-->
                            <!--                                        </div>-->
                            <!--                                    </div>-->
                            <!--                                </div>-->
                            <!--                            </div>-->

                            <div class="row">
                                <div class="col-md-2 col-md-offset-4">
                                    <md-button class="md-raised md-warn" value="close" ng-click="clear_supplier()"
                                               aria-label="Close">Clear
                                    </md-button>
                                </div>
                                <div class="col-md-2">
                                    <md-button class="md-raised custbutton" value="close" aria-label="OK"
                                               data-dismiss="modal">OK
                                    </md-button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <form name="ebform">
            <div class="col-md-12">
                <div class="col-md-3">
                    <!--                    <md-autocomplete-->
                    <!--                            md-clear-button="true" md-floating-label="State"-->
                    <!--                            md-input-maxlength=126-->
                    <!--                            md-item-text="item.value"-->
                    <!--                            md-items="item in get_data(searchdata_)"-->
                    <!--                            md-min-length=0 md-search-text="searchdata_"-->
                    <!--                            md-no-cache="true" size="5"-->
                    <!--                            md-selected-item="selected_data_state" required>-->
                    <!--                        <md-item-template>-->
                    <!--                            <span md-highlight-text="searchdata_"> {{item.value}}</span>-->
                    <!--                        </md-item-template>-->
                    <!--                        <md-not-found>-->
                    <!--                            No State Name matching "{{searchdata_}}"-->
                    <!--                            were-->
                    <!--                            found.-->
                    <!--                        </md-not-found>-->
                    <!--                    </md-autocomplete>-->

                    <md-input-container class="md-block inputcontainer">
                        <label>State Name</label>
                        <input ng-model="selected_data_state" ng-disabled="true" required/>
                    </md-input-container>
                </div>
                <div class="col-md-3">
                    <md-autocomplete
                            md-clear-button="true" md-floating-label="Electricity Board"
                            autocomplete="off"
                            md-input-maxlength=126
                            md-item-text="item.value"
                            md-items="item in get_data_eb(searchdata)"
                            md-selected-item-change="changed_data(item.value)"
                            md-min-length=0 md-search-text="searchdata"
                            md-no-cache="true" size="5"
                            md-selected-item="selected_data_electricity" required>
                        <md-item-template>
                            <span md-highlight-text="searchdata"> {{item.value}}</span>
                        </md-item-template>
                        <md-not-found>
                            No Electricity Board Name matching "{{searchdata}}"
                            were
                            found.
                        </md-not-found>
                    </md-autocomplete>
                </div>
                <div class="col-md-3">
                    <md-autocomplete
                            md-clear-button="true" md-floating-label="Region"
                            autocomplete="off"
                            md-input-maxlength=126
                            md-item-text="item.data"
                            md-items="item in get_data_region(searchdata_region)"
                            md-min-length=0 md-search-text="searchdata_region"
                            md-no-cache="true" size="5"
                            md-selected-item="selected_data_region" required>
                        <md-item-template>
                            <span md-highlight-text="searchdata_region"> {{item.data}}</span>
                        </md-item-template>
                        <md-not-found>
                            No Region matching "{{searchdata_region}}"
                            were
                            found.
                        </md-not-found>
                    </md-autocomplete>
                </div>
                <div class="col-md-2">

                    <md-input-container class="md-block inputcontainer">
                        <label>Premises Name</label>
                        <input ng-model="premises_name" ng-disabled="true" required/>
                    </md-input-container>
                </div>
                <div class="col-md-1" style="bottom:-20px">
                    <span class="editlink material-icons" ng-click="view_premises()">arrow_upward</span>
                </div>

            </div>
            <div class="col-md-12">

                <div class="col-md-3">
                    <!--                    <md-autocomplete-->
                    <!--                            md-clear-button="true" md-floating-label="Occupancy Type"-->
                    <!--                            md-input-maxlength=126-->
                    <!--                            md-item-text="item.value"-->
                    <!--                            md-items="item in getoccupancy(search)"-->
                    <!--                            md-selected-item-change="changed_occupncy(item.value)"-->
                    <!--                            md-min-length=0 md-search-text="search"-->
                    <!--                            md-no-cache="true" size="5"-->
                    <!--                            md-selected-item="selected_data_occupancy" required>-->
                    <!--                        <md-item-template>-->
                    <!--                            <span md-highlight-text="search"> {{item.value}}</span>-->
                    <!--                        </md-item-template>-->
                    <!--                        <md-not-found>-->
                    <!--                            No Occupancy Type matching "{{search}}"-->
                    <!--                            were-->
                    <!--                            found.-->
                    <!--                        </md-not-found>-->
                    <!--                    </md-autocomplete>-->
                    <md-input-container class="md-block inputcontainer">
                        <label>Occupancy Type</label>
                        <input ng-model="selected_data_occupancy" ng-disabled="true"/>
                    </md-input-container>
                </div>
                <div class="col-md-3" ng-show="shwoccname">
                    <md-input-container class="md-block inputcontainer">
                        <label>Premises Type</label>
                        <input ng-model="occupancy_name" ng-disabled="true"/>
                    </md-input-container>
                </div>
                <div class="col-md-3" ng-show="shwbranch">
                    <md-autocomplete ng-disabled="true" md-floating-label="Branch Name"
                                     md-input-maxlength=126 md-item-text="item.branch_name"
                                     md-items="item in getbranch(searchText1)" md-min-length=0
                                     md-no-cache="true"
                                     md-search-text="searchText1" md-selected-item="branch_name"
                                     md-selected-item-change="ACselectchange(item)">
                        <md-item-template>
                            <td md-highlight-text="searchText1">
                                {{item.branch_name}}-{{item.branch_code}}
                            </td>
                        </md-item-template>
                        <md-not-found>
                            No found.
                        </md-not-found>
                    </md-autocomplete>
                </div>
                <div class="col-md-3">
                    <md-input-container class="md-block inputcontainer">
                        <label>Contact Person</label>
                        <input ng-model="contact_name"/>
                    </md-input-container>
                </div>
                <div class="col-md-3">
                    <md-input-container class="md-block inputcontainer">
                        <label>Contact No</label>
                        <input ng-model="contact_no" minlength="10" maxlength="10" numbers-only required/>
                    </md-input-container>
                </div>
            </div>
            <div class="col-md-12">

                <div class="col-md-3">
                    <md-input-container class="md-block inputcontainer">
                        <label>Consumer No</label>
                        <input ng-model="consumer_no" ng-disabled="disablcons" ng-change="validateconsumer(consumer_no)"
                               required/>
                    </md-input-container>
                </div>
                <div class="col-md-1" style="margin-top:23px">
                    <div class="btn-group" id="statusa" data-toggle="buttons">
                        <label ng-class="newcls_" ng-click="clk_btnvalidate('Y')" title="click to Validate Consumer No">
                            <input type="radio" checked="checked" ng-model="selected_activ">VALIDATE</label>
                    </div>
                </div>
                <div class="col-md-3">
                    <md-input-container class="md-block inputcontainer">
                        <label>Consumer Name</label>
                        <input ng-disabled="true" ng-model="consumer_name"/>
                    </md-input-container>
                </div>
                <div class="col-md-3">
                    <md-autocomplete
                            md-clear-button="true" md-floating-label="Billing Cycle"
                            md-input-maxlength=126
                            md-item-text="item.data"
                            md-items="item in get_data_cycle(searchdatacycl)"
                            md-selected-item-change="changed_data(item.value)"
                            md-min-length=0 md-search-text="searchdatacycl"
                            md-no-cache="true" size="5"
                            md-selected-item="selected_data_cycle" required>
                        <md-item-template>
                            <span md-highlight-text="searchdatacycl"> {{item.data}}</span>
                        </md-item-template>
                        <md-not-found>
                            No billing cycle matching "{{searchdatacycl}}"
                            were
                            found.
                        </md-not-found>
                    </md-autocomplete>
                </div>
                <div class="col-md-2">
                    <md-input-container class="md-block inputcontainer">
                        <label>Site ID</label>
                        <input ng-model="site_id"/>
                    </md-input-container>
                </div>
            </div>
            <div class="col-md-12">
                <div class="col-md-2">
                    <md-input-container class="md-block inputcontainer">
                        <label>Remarks</label>
                        <input ng-model="remarks"/>
                    </md-input-container>
                </div>
                <div class="col-md-3" style="margin-top:23px">
                    <div class="btn-group" id="statusa" data-toggle="buttons">
                        <label ng-class="newcls" ng-click="clkbtn('Y')" title="click to active">
                            <input type="radio" checked="checked" ng-model="selected_active" required>ACTIVE</label>
                        <label ng-class="newcls1" ng-click="clkbtn('N')" title="click to deactive">
                            <input type="radio" checked="checked" ng-model="selected_active">DEACTIVE</label>
                    </div>
                </div>
            </div>


            <div class="col-md-12">
                <div class="col-md-3">
                </div>
                <div class="col-md-1">
                </div>
                <div class="col-md-3" style="margin-right:-55px">
                    <md-button
                            class="md-raised custbutton" class="btn btn-secondary" ng-click="save_ebdetails()"
                            ng-disabled="ebform.$invalid" ng-show="shwsubmit">Submit
                        <md-tooltip>Submit</md-tooltip>
                    </md-button>
                    <md-button ng-click="update_ebdetails()" ng-disabled="ebform.$invalid" ng-show="shwupdate"
                               class="btn btn-info custbutton">Update
                        <md-tooltip>Update</md-tooltip>
                    </md-button>
                    <md-button ng-click="aprve_ebdetails()" ng-show="shwaprvl"
                               class="btn btn-info custbutton">Approve
                        <md-tooltip>Approve</md-tooltip>
                    </md-button>
                    <md-button ng-click="reject_ebdetails()" ng-show="shwaprvl"
                               class="btn btn-info custbutton">Reject
                        <md-tooltip>Reject</md-tooltip>
                    </md-button>
                </div>
                <div class="col-md-4" class="align-left">
                    <md-button ng-click="close_click()"
                               class="btn btn-info custbutton">Close
                        <md-tooltip>Close</md-tooltip>
                    </md-button>
                </div>
            </div>
        </form>
    </div>
</div>

{% endverbatim %}
<style>
.btn-default.btn-on.active{background-color: #5BB75B;color: white;}
.btn-default.btn-off.active{background-color: #DA4F49;color: white;}
.btn-default.btn-off.active{background-color: #DA4F49;color: white;}

.btn-default.btn-on-1.active{background-color: #006FFC;color: white;}
.btn-default.btn-off-1.active{background-color: #DA4F49;color: white;}

.btn-default.btn-on-2.active{background-color: #00D590;color: white;}
.btn-default.btn-off-2.active{background-color: #A7A7A7;color: white;}

.btn-default.btn-on-3.active{color: #5BB75B;font-weight:bolder;}
.btn-default.btn-off-3.active{color: #DA4F49;font-weight:bolder;}

.btn-default.btn-on-4.active{background-color: #006FFC;color: #5BB75B;}
.btn-default.btn-off-4.active{background-color: #DA4F49;color: #DA4F49;}





</style>


<script>
    var myApp = angular.module('Appprcreate', ['ngMaterial', 'ui.bootstrap', 'ngMessages', 'AppCommon']).config(
        function (
            $httpProvider) {
            $httpProvider.defaults.xsrfCookieName = 'csrftoken';
            $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
        });


    myApp.controller('Ctrlprcreate', ['$scope', '$http', 'orderByFilter', 'Serviceprcreate', '$mdDialog', '$element',
        '$filter', '$window', 'SerCommon', '$timeout','$q','$interval',
        function ($scope, $http, orderBy, Serviceprcreate, $mdDialog, $element, $filter, $window, SerCommon,
            $timeout,$q,$interval) {
            $scope.currentPage = 1;
            $scope.maxSize = 3;
            $scope.itemsPerPage = 10;


            $scope.alldatas = 'Add';

            $scope.loading = function () {
                $mdDialog.show({
                    templateUrl: 'loaderSpinner',
                    parent: angular.element(document.body),
                    clickOutsideToClose: false
                });
            };
            $scope.endloading = function () {
                $mdDialog.hide();
            };



            var detail = JSON.parse(sessionStorage.getItem('today'));
        $scope.entity_gid = detail.entity_gid;
        $scope.employee_gid = detail.employee_gid;
        $scope.branch_name = detail.branch_code;
        $scope.branch_gid = detail.branch_gid;
        $scope.shwoccname = true;

        var data={"branch_gid":$scope.branch_gid
              }
                var data_int = {
                "Action":'State_Get',
                "data":data,
                "classification":{"Entity_Gid":$scope.entity_gid,
                "Create_By": $scope.employee_gid}
                }

                var get_purchase = Serviceprcreate.getsmrydata(data_int)
                get_purchase.then(function (result) {

                 $scope.selected_data_state = result.data[0].state_name;
                }).finally($scope.endloading);

        $scope.changed_occupncy  = function(e){
            if(e == 'BRANCH'){
            $scope.shwbranch = true;
            $scope.shwoccname = false;
            }
            else{
            $scope.shwbranch = false;
            $scope.shwoccname = true;
            }
        }
        $scope.close_click = function(){
        debugger;
        if(only_create!= null){
        $window.location.href = "ebdetails_co_dosmry";
        return false;
        }
        if(mainsmrydatas.status == "CO DO"){
            $window.location.href = "ebdetails_co_dosmry";
            return false;
        }
        if(mainsmrydatas.status == "QUERY_ALL"){
            $window.location.href = "ebdetails_querysmry";
            return false;
        }
        if(mainsmrydatas.status == "MAKER"){
            $window.location.href = "ebdetails_smry";
            return false;
        }

        if(mainsmrydatas.status == "TRANSACTION"){
            $window.location.href = "ebdetails_paymentsmry";
            return false;
        }
        if(mainsmrydatas.status == "APPROVER"){
            $window.location.href = "ebdetailsaprvl_smry";
            return false;
        }
         if(mainsmrydatas.status == "CODOAPPROVER"){
            $window.location.href = "ebdetails_co_do_aprvlsmry";
            return false;
        }
         if(mainsmrydatas.status == "CAUTION"){
            $window.location.href = "ebdetailsquery_paymtsmry";
            return false;
        }
        else{
        $window.location.href = "ebdetails_mstrtotxn";
        }

        }
         $scope.view_premises=function(){

        var data={"premises_controloffice":$scope.branch_gid
              }
                var data_int = {
                "Action":'Premises_Get',
                "data":data,
                "classification":{"Entity_Gid":$scope.entity_gid,
                "Create_By": $scope.employee_gid}
                }

                var get_purchase = Serviceprcreate.getsmrydata(data_int)
                get_purchase.then(function (result) {

                 $scope.maintable = result.data;

                    if ($scope.currentPage == 1 && $scope.maintable.length != 0) {
                    $scope.Total_Length = $scope.maintable[0].Total_Row;
                    }
                    if ($scope.maintable.length == 0) {
                        $scope.currentPage == 1;
                        $scope.Total_Length = 0;
                    }



                }).finally($scope.endloading);
  modalshow('view_supplier');


        }


        $scope.view_premise=function(){

        var data={"premises_controloffice":$scope.branch_gid_DD
              }
                var data_int = {
                "Action":'Premises_Get',
                "data":data,
                "classification":{"Entity_Gid":$scope.entity_gid,
                "Create_By": $scope.employee_gid}
                }

                var get_purchase = Serviceprcreate.getsmrydata(data_int)
                get_purchase.then(function (result) {

                 $scope.maintable = result.data;

                    if ($scope.currentPage == 1 && $scope.maintable.length != 0) {
                    $scope.Total_Length = $scope.maintable[0].Total_Row;
                    }
                    if ($scope.maintable.length == 0) {
                        $scope.currentPage == 1;
                        $scope.Total_Length = 0;
                    }



                }).finally($scope.endloading);
  modalshow('view_supplier');


        }


            $scope.soourcedata = function(query) {
            var datas={params:{"type":"Mode","Sub_Type":"Summary_new",
                               "FILTER":{"Limit_Start":0,"Limit_End":30,"branch_name":"","branch_detail":query,
                                            "branch_code":""},"CLASSIFICATION":{"Entity_Gid":[0]}}};
                         return $http.post(Appname + '/classificationdata_get/' , datas).then(function(data) {
                            var final_values=data.data.DATA;
                            console.log(final_values);
                            return final_values;
                          });
        }

        $scope.selectEntity = function(position,e){
debugger;
        angular.forEach($scope.maintable, function(e, index) {
        if (position != index)
          e.ischecked = false;
        });

        $scope.premises_name = e.premises_name;
        $scope.selected_data_occupancy = e.Occupancy;
        $scope.premises_gid = e.premises_gid;
        $scope.Occupancy_gid = e.Occupancy_gid;
        $scope.occupancy_name = e.ownership;
        }
               $scope.branchnamet = function (e) {
               $scope.premises_name = e.premises_name;
                $scope.address_1 = e.address_1;
                $scope.address_2 = e.address_2;
                $scope.address_3 = e.address_3;
                $scope.address_pincode = e.address_pincode;
                $scope.district_name = e.district_name;
                $scope.state_name = e.state_name;
                $scope.City_Name = e.City_Name;

            }

            $scope.clear_supplier = function(){

               $scope.searchbrancheName ="";
              $scope.premises_name = "";
        $scope.selected_data_occupancy ="";
        $scope.premises_gid = "";
        $scope.Occupancy_gid = "";
        $scope.occupancy_name = "";
                modalhide('view_supplier');


            }



$scope.clk_btnvalidate = function(e){

if ($scope.contact_no==undefined){
$scope.newcls_ = "btn btn-default btn-on btn-xs";
alert('Please Provide Valid Mobile Number to Validate')
$scope.consumer_name ="";
return false;

}
if($scope.contact_no.length !=10){
$scope.newcls_ = "btn btn-default btn-on btn-xs";
alert('Please Provide Valid Mobile Number to Validate');
$scope.consumer_name ="";
return false;
}
$scope.loading();
    if(e=='Y'){
    $scope.newcls_ = "btn btn-default btn-on btn-xs active";
    }

var data={
    "MobileNo": $scope.contact_no,
    "BankCode": "PGMKVB",
    "ConsumerNo": $scope.consumer_no
          }
var data={
data:data
}
    var checkpan=Serviceprcreate.check_consumerdetails(data)
    checkpan.then(function(result){
    if(result.data.STATUS != "I"){
    $scope.consumer_name=result.data.CNAME;
    $scope.endloading();
}
else{
alert(result.data.MININFO)
$scope.consumer_name ="";
}
    }).finally($scope.endloading),
        function(err) {
            alert('no data');
        }
        }



        $scope.validateconsumer = function(e){

        $scope.newcls_ = "btn btn-default btn-on btn-xs";
        $scope.consumer_name = "";


        }

    $scope.newcls = "btn btn-default btn-on btn-xs";
    $scope.newcls_ = "btn btn-default btn-on btn-xs";
    $scope.newcls1 = "btn btn-default btn-off btn-xs"


            $scope.branchnameget = function(e){
debugger;
$scope.branch_gid_DD = e.branch_gid;
$scope.branch_gid = e.branch_gid;
$scope.branch_name = e.branch_code;
$scope.view_premise();
}

$scope.premisesname_search = Change_Cate_Nam;
            function Change_Cate_Nam(query) {
               var result = $filter('filter')($scope.maintable, {
               'premises_name': query
                 });
               return result;
       }


            $scope.getbranch= function goto(query) {
                       data = {
                    "Table_name": "gal_mst_tbranch",
                    "Column_1": "branch_gid,branch_code,branch_name",
                    "Column_2": "",
                    "Where_Common": "branch",
                    "Where_Primary": "code",
                    "Primary_Value": "",
                    "Search_Column_Name": query,
                    "Limits": 0 + "," + 30,
                    "Order_by": "gid"
                }

                return $http.post(Appname + "/prodget/", {
                        "data": data,
                        "Action": ''
                    })
                    .then(function (result) {
                        if (result.data.MESSAGE == "FOUND") {
                            $scope.brncode = result.data.DATA;
                        } else {
                            $scope.brncode = [];
                        }
                        return $scope.brncode;
                    });
            }
$scope.state_array = [{
        value: 'Tamil Nadu',
        data: 'Tamil Nadu'
    }]

    $scope.occupancy_array = [{
        value: 'ATM',
        data: 'ATM'
    },{
        value: 'Branch',
        data: 'Branch'
    },{
        value: 'Staff Quarters',
        data: 'Staff Quarters'
    }]

    $scope.cycle_array = [{
        value: '1 Month',
        data: '1 Month'
    },{
        value: '2 Months',
        data: '2 Months'
    },{
        value: '3 Months',
        data: '3 Months'
    },{
        value: '4 Months',
        data: '4 Months'
    },{
        value: '5 Months',
        data: '5 Months'
    },{
        value: '6 Months',
        data: '6 Months'
    }]






    $scope.clkbtn = function(e){
    $scope.selected_active = e;

    if(e=='Y'){
    $scope.newcls = "btn btn-default btn-on btn-xs active";
    $scope.newcls1 = "btn btn-default btn-off btn-xs"
    }
    if(e=='N'){
    $scope.newcls = "btn btn-default btn-on btn-xs";
    $scope.newcls1 = "btn btn-default btn-off btn-xs active"
    }

    }



 $scope.get_data = Change_Cate_Name;
            function Change_Cate_Name(query) {
               var result = $filter('filter')($scope.state_array, {
               'value': query
                 });
               return result;
       }

$scope.getoccupancy = Change_occupancy_Name;
            function Change_occupancy_Name(query) {
               var result = $filter('filter')($scope.occupancy_array, {
               'value': query
                 });
               return result;
       }



 $scope.get_data_cycle = Change_Cate_cycle;
            function Change_Cate_cycle(query) {
               var result = $filter('filter')($scope.cycle_array, {
               'value': query
                 });
               return result;
       }





    $scope.eboard_variety = [{
        value: 'TNEB',
        data: 'TNEB'
    }]

    $scope.get_data_eb = Change_Cate_eb;
            function Change_Cate_eb(query) {
               var result = $filter('filter')($scope.eboard_variety, {
               'value': query
                 });
               return result;
    }

   $scope.get_data_region = Change_Cate_region;
    function Change_Cate_region(query) {
       var result = $filter('filter')($scope.region_variety, {
       'data': query
         });
       return result;
    }


    $scope.region_variety = [
    {
        value: '1',
        data: 'CHENNAI NORTH'
    },
    {
        value: '2',
        data: 'VILLUPURAM'
    },
    {
        value: '3',
        data: 'COIMBATORE'
    },{
        value: '4',
        data: 'ERODE'
    },{
        value: '5',
        data: 'MADURAI'
    },{
        value: '6',
        data: 'TRICHY'
    },{
        value: '7',
        data: 'THIRUNELVELI'
    },{
        value: '8',
        data: 'VELLORE'
    },
    {
        value: '9',
        data: 'CHENNAI SOUTH'
    }]

    $scope.disablcons = false;

$scope.contact_name = 'BRANCH HEAD / (BOM)';
    var mainsmrydatas=JSON.parse(sessionStorage.getItem('fulldata'));
    if (mainsmrydatas != null){
    if(mainsmrydatas.ebconsumer_status == "Submitted" && mainsmrydatas.status =="APPROVER"){
    $scope.shwaprvl = true;
    }
     if(mainsmrydatas.ebconsumer_status == "Submitted" && mainsmrydatas.status =="CODOAPPROVER"){
    $scope.shwaprvl = true;
    }
    if(mainsmrydatas.ebconsumer_status == "Modified" && mainsmrydatas.status =="APPROVER"){
    $scope.shwaprvl = true;
    }
    if(mainsmrydatas.ebconsumer_status == "Resubmitted"  && mainsmrydatas.status =="APPROVER"){

    $scope.shwaprvl = true;
    }
     if(mainsmrydatas.ebconsumer_status == "Resubmitted"  && mainsmrydatas.status =="CODOAPPROVER"){

    $scope.shwaprvl = true;
    }
    if(mainsmrydatas.ebconsumer_status == "Submitted"  && mainsmrydatas.status =="MAKER"){
<!--     $scope.shwupdate = true;-->
     $scope.userstatus = 'Modified';
     $scope.action = 'UPDATE';
     $scope.alldatas = 'Update';
    }
      if(mainsmrydatas.ebconsumer_status == "Modified"  && mainsmrydatas.status =="MAKER"){
<!--     $scope.shwupdate = true;-->
     $scope.userstatus = 'Modified';
     $scope.action = 'UPDATE';
     $scope.alldatas = 'Update';
    }
    if(mainsmrydatas.ebconsumer_status == "Rejected"  && mainsmrydatas.status =="MAKER"){
     $scope.shwupdate = true;
     $scope.userstatus = 'Resubmitted';
     $scope.action = 'After_Approval';
     $scope.alldatas = 'Update';
    }
    if(mainsmrydatas.ebconsumer_status == "Resubmitted"  && mainsmrydatas.status =="MAKER"){
<!--     $scope.shwupdate = true;-->
     $scope.userstatus = 'Resubmitted';
     $scope.action = 'UPDATE';
     $scope.alldatas = 'Update';
    }
     if(mainsmrydatas.ebconsumer_status == "Approved"  && mainsmrydatas.status =="MAKER"){
     $scope.shwupdate = true;
     $scope.userstatus = 'Resubmitted';
     $scope.action = 'After_Approval';
     $scope.alldatas = 'View';
     $scope.disablcons = true;
    }
    if(mainsmrydatas.ebconsumer_status == "Submitted"  && mainsmrydatas.status =="CO DO"){
     $scope.shwupdate = true;
     $scope.userstatus = 'Modified';
     $scope.shwfrCODO = true;
     $scope.action = 'UPDATE';
     $scope.alldatas = 'Update';
    }
      if(mainsmrydatas.ebconsumer_status == "Modified"  && mainsmrydatas.status =="CO DO"){
     $scope.shwupdate = true;
     $scope.userstatus = 'Modified';
     $scope.shwfrCODO = true;
     $scope.action = 'UPDATE';
     $scope.alldatas = 'Update';
    }
    if(mainsmrydatas.ebconsumer_status == "Rejected"  && mainsmrydatas.status =="CO DO"){
     $scope.shwupdate = true;
     $scope.userstatus = 'Resubmitted';
     $scope.shwfrCODO = true;
     $scope.action = 'After_Approval';
     $scope.alldatas = 'Update';
    }
    if(mainsmrydatas.ebconsumer_status == "Resubmitted"  && mainsmrydatas.status =="CO DO"){
     $scope.shwupdate = true;
     $scope.userstatus = 'Resubmitted';
     $scope.shwfrCODO = true;
     $scope.action = 'UPDATE';
     $scope.alldatas = 'Update';
    }
     if(mainsmrydatas.ebconsumer_status == "Approved"  && mainsmrydatas.status =="CO DO"){
     $scope.shwupdate = true;
     $scope.userstatus = 'Resubmitted';
     $scope.action = 'After_Approval';
     $scope.shwfrCODO = true;
     $scope.alldatas = 'View';
     $scope.disablcons = true;
    }
    if(mainsmrydatas.status =="TRANSACTION"){
     $scope.alldatas = 'View';
     $scope.disablcons = true;
    }
    if(mainsmrydatas.status =="QUERY_ALL"){
     $scope.alldatas = 'Add';
     $scope.disablcons = true;
    }

    $scope.consumer_name = mainsmrydatas.ebconsumer_name;
    $scope.branch_name = mainsmrydatas.branch_name;
     $scope.selected_data_region = mainsmrydatas.region_name;
     $scope.consumer_no = mainsmrydatas.ebconsumer_no;
     $scope.site_id = mainsmrydatas.ebconsumer_siteid;
     $scope.selected_data_state = mainsmrydatas.ebconsumer_state;
     $scope.selected_data_electricity = mainsmrydatas.ebconsumer_board;
     $scope.selected_data_occupancy = mainsmrydatas.Occupancy;
     $scope.occupancy_name = mainsmrydatas.ownership;
     if($scope.occupancy_name == ""){
        $scope.shwbranch = true;
        $scope.shwoccname = false;
             } else{
        $scope.shwoccname = true;
        $scope.shwbranch = false;
             }
     $scope.branch_name = mainsmrydatas.ebconsumer_occupancycode;
     $scope.contact_name =  mainsmrydatas.ebconsumer_personname;
     $scope.contact_no = mainsmrydatas.ebconsumer_contactno;
     $scope.remarks= mainsmrydatas.ebconsumer_remarks;
     $scope.premises_name = mainsmrydatas.premises_name;
     $scope.selected_active = mainsmrydatas.ebconsumer_makerisactive;
     $scope.selected_data_cycle = mainsmrydatas.ebconsumer_billingcycle;
     $scope.ebconsumer_gid = mainsmrydatas.ebconsumer_gid;
     $scope.clkbtn($scope.selected_active)

}
 else{
var only_create=JSON.parse(sessionStorage.getItem('create_data'));
if(only_create != null){
$scope.shwfrCODO = true;
    $scope.shwsubmit = true;
}
else{
$scope.shwsubmit = true;
}
    }

    $scope.save_ebdetails = function(){

    var data = {
    "ebconsumer_name":$scope.consumer_name,
    "ebconsumer_branchgid": $scope.branch_gid,
    "ebconsumer_regioncode":$scope.selected_data_region.value,
    "ebconsumer_no": $scope.consumer_no,
    "ebconsumer_state": $scope.selected_data_state,
    "ebconsumer_board": $scope.selected_data_electricity.value,
    "ebconsumer_personname": $scope.contact_name,
    "ebconsumer_occupancy" : $scope.selected_data_occupancy,
    "ebconsumer_occupancyname" : $scope.occupancy_name,
    "ebconsumer_occupancycode" : $scope.branch_name,
    "ebconsumer_contactno": $scope.contact_no,
    "ebconsumer_remarks": $scope.remarks,
    "ebconsumer_premisesname": $scope.premises_name,
    "ebconsumer_billingcycle": $scope.selected_data_cycle.value,
    "ebconsumer_status": "Submitted",
    "ebconsumer_makerisactive": $scope.selected_active,
    "ebconsumer_premises_gid"  :$scope.premises_gid,
    "ebconsumer_occupancygid"  :$scope.Occupancy_gid,
    "ebconsumer_siteid" : $scope.site_id

    }
    var data_int = {
    "Action":'INSERT',
    "data":data,
    "classification":{"Entity_Gid":$scope.entity_gid,"Create_By":$scope.employee_gid},
    }


            var collection_save = Serviceprcreate.setcollection(data_int)
            collection_save.then(function(result) {
                    var sechedule_ref = result.data[0];
                    if (sechedule_ref == 'SUCCESS' && only_create!= null) {
                        alert("Inserted Successfully")
                        $window.location.href = "ebdetails_co_dosmry";

                    }
                    else if (sechedule_ref == 'SUCCESS' && only_create== null) {
                        alert("Inserted Successfully")
                        $window.location.href = "ebdetails_smry";

                     }else {
                        alert(sechedule_ref);
                    }
                },
                function() {
                    alert("Data Not Inserted!.");
                });


        }



 $scope.aprve_ebdetails = function(){

    var data = {
    "ebconsumer_status": "Approved",
    "ebconsumer_gid":$scope.ebconsumer_gid,
    "remark":""
    }
    var data_int = {
    "Action":'Approval',
    "data":data,
    "classification":{"Entity_Gid":$scope.entity_gid,"Create_By":$scope.employee_gid},
    }


            var collection_save = Serviceprcreate.setcollection(data_int)
            collection_save.then(function(result) {
                    var sechedule_ref = result.data[0];
                    if (sechedule_ref == 'SUCCESS') {
                        alert("Approved Successfully")
                        $window.location.href = "ebdetailsaprvl_smry";

                    } else {
                        alert(sechedule_ref);
                    }
                },
                function() {
                    alert("Data Not Inserted!.");
                });


        }


 $scope.update_ebdetails = function(){

    var data = {
    "ebconsumer_status": $scope.userstatus,
    "ebconsumer_gid":$scope.ebconsumer_gid,
    "ebconsumer_name":$scope.consumer_name,
    "ebconsumer_branchgid": $scope.branch_gid,
    "ebconsumer_regioncode":$scope.selected_data_region.value,
    "ebconsumer_no": $scope.consumer_no,
    "ebconsumer_state": $scope.selected_data_state,
    "ebconsumer_board": $scope.selected_data_electricity.value,
    "ebconsumer_personname": $scope.contact_name,
    "ebconsumer_occupancy" : $scope.selected_data_occupancy,
    "ebconsumer_occupancyname" : $scope.occupancy_name,
    "ebconsumer_occupancycode" : $scope.branch_name,
    "ebconsumer_contactno": $scope.contact_no,
    "ebconsumer_remarks": $scope.remarks,
    "ebconsumer_premisesname": $scope.premises_name,
    "ebconsumer_billingcycle": $scope.selected_data_cycle.value,
    "ebconsumer_makerisactive": $scope.selected_active,
    "ebconsumer_premises_gid"  :$scope.premises_gid,
    "ebconsumer_occupancygid"  :$scope.Occupancy_gid,
    "ebconsumer_siteid" : $scope.site_id
    }
    var data_int = {
    "Action":$scope.action,
    "data":data,
    "classification":{"Entity_Gid":$scope.entity_gid,"Create_By":$scope.employee_gid}
    }
            var collection_save = Serviceprcreate.setcollection(data_int)
            collection_save.then(function(result) {
                    var sechedule_ref = result.data[0];
                    if (sechedule_ref == 'SUCCESS') {
                        alert("Updated Successfully")
                        $window.location.href = "ebdetailsaprvl_smry";
                    } else {
                        alert(sechedule_ref);
                    }
                },
                function() {
                    alert("Data Not Inserted!.");
                });
        }


 $scope.reject_ebdetails = function(){
    var data = {
    "ebconsumer_status": "Rejected",
    "ebconsumer_gid":$scope.ebconsumer_gid,
    "remark":""
    }
    var data_int = {
    "Action":'Approval',
    "data":data,
    "classification":{"Entity_Gid":$scope.entity_gid,"Create_By":$scope.employee_gid},
    }
            var collection_save = Serviceprcreate.setcollection(data_int)
            collection_save.then(function(result) {
                    var sechedule_ref = result.data[0];
                    if (sechedule_ref == 'SUCCESS') {
                        alert("Rejected Successfully")
                        $window.location.href = "ebdetailsaprvl_smry";

                    } else {
                        alert(sechedule_ref);
                    }
                },
                function() {
                    alert("Data Not Inserted!.");
                });


        }









}


    ]);
    myApp.service("Serviceprcreate", function ($http) {
        //Draft data

                this.setcollection = function(data) {
            var response = $http.post(Appname + "/ebdatainsert/", data);
            return response;
        }
            this.check_consumerdetails = function(get_data) {
        var response = $http.post(Appname + "/ebconsumerdata_validate/", get_data);
        return response;
    }

           this.getsmrydata = function(data) {
            var response = $http.post(Appname + "/eb_mainsmry/", data);
            return response;
        }

    });









</script>
{% endblock %}