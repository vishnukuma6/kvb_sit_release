{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %}Profile Details{% endblock %}
{% block content %}
{% verbatim %}

<div class="maincontent">
    <div class="container container1" ng-app="Appreview" ng-controller="Ctrlreview" ng-cloak>
        <div class="row">
            <div>
                <md-content>
                    <md-tabs md-dynamic-height md-stretch-tabs>
                        <md-tab ng-class="{ active: isSet(1) }"
                                ng-click="setTab(1)" label="Create Supplier">
                        </md-tab>
                        <md-tab label="Profile" ng-click="setTab(12)">
                            <md-tabs  md-dynamic-height md-stretch-tabs style="padding-left: 5em;">
                                <md-tab ng-class="{ active: isSet(12) }"
                                ng-click="setTab(12)" label="Profile Basic">
                                </md-tab>
                                <md-tab ng-class="{ active: isSet(8) }"
                                ng-click="setTab(8)" label="Profile Product">
                                </md-tab>
                                <md-tab ng-class="{ active: isSet(9) }"
                                ng-click="setTab(9)" label="Profile Branch">
                                </md-tab>
                                <md-tab ng-class="{ active: isSet(10) }"
                                ng-click="setTab(10)" label="Profile Client">
                                </md-tab>
                                <md-tab ng-class="{ active: isSet(11) }"
                                ng-click="setTab(11)" label="Profile Contract">
                                </md-tab>

                            </md-tabs>
                        </md-tab>
                        <md-tab ng-class="{ active: isSet(2) }"
                                ng-click="setTab(2)" label="Tax Details">
                        </md-tab>
                        <md-tab ng-class="{ active: isSet(6) }"
                                ng-click="setTab(6)" label="Payment Details">
                        </md-tab>
                        <md-tab ng-class="{ active: isSet(3) }"
                                ng-click="setTab(3)" label="Document Group">
                        </md-tab>
                        <md-tab ng-class="{ active: isSet(5) }"
                                ng-click="setTab(5)" label="Activity">
                        </md-tab>

                    </md-tabs>
                </md-content>
            </div>
        </div>

        <div ng-show="isSet(1)">
            <div class="row">
                <div class="row-header col-lg-12 col-sm-12">
                    <h4><strong>Supplier Details</strong></h4>
                </div>
            </div>
            <div name="formfill" role="form" class="row">
                <div class="col-md-12">
                    <div class="row">
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Supplier Code</label>
                                <input id="text" maxlength="16" ng-disabled="editdisabled"
                                       ng-model="Partner.partnercode" ng-change="Partner.partnercode = (Partner.partnercode | uppercase)"
                                       autocomplete="off"
                                       required>
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Supplier Name </label>
                                <input type="text" maxlength="128" ng-model="Partner.partnername" ng-change="Partner.partnername = (Partner.partnername | uppercase)"
                                       autocomplete="off" readonly
                                       required>
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Supplier Pan No </label>
                                <input type="text" maxlength="16" ng-model="Partner.partnerpan" ng-change="Partner.partnerpan = (Partner.partnerpan | uppercase)" autocomplete="off"
                                       required readonly>
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label> Company Reg. No</label>
                                <input type="text" maxlength="128" ng-model="Partner.companyregno" ng-change="Partner.companyregno = (Partner.companyregno | uppercase)" autocomplete="off"
                                       required readonly>
                            </md-input-container>
                        </div>

                    </div>
                    <div class="row">
                         <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label> Composite Vendor</label>
                                <input type="text" maxlength="128" ng-model="Partner.compositevendor" autocomplete="off"
                                       required readonly>
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label> Customer Category</label>
                                 <input type="text" maxlength="128" ng-model="Partner.custcategory_name" autocomplete="off"
                                       required readonly>

                            </md-input-container>
                        </div>
                         <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Supplier Group</label>
                                <input type="text" maxlength="128" ng-model="Partner.partnergroup" ng-change="Partner.companyregno = (Partner.companyregno | uppercase)" autocomplete="off"
                                       required readonly>

                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Supplier Classification</label>
                                <input type="text" maxlength="128" ng-model="Partner.classification" ng-change="Partner.companyregno = (Partner.companyregno | uppercase)" autocomplete="off"
                                       required readonly>
                            </md-input-container>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label >Supplier Type</label>
                                <input type="text" maxlength="128" ng-model="Partner.partnertype" ng-change="Partner.companyregno = (Partner.companyregno | uppercase)" autocomplete="off"
                                       required readonly>
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Website   -  {{getmstapprovaldata.partner_web}}</label>
                                <input type="text" maxlength="128" ng-model="Partner.website" autocomplete="off"
                                       required readonly>
                            </md-input-container>
                        </div>
                        <div class="col-md-3"  layout="row" style="margin-top:30px">
                            <label>ActiveContractType</label>
                            <md-radio-group   layout="row" ng-model="Partner.activecontractype" disabled="true">
                            <md-radio-button value="Yes" class="md-primary" >Yes</md-radio-button>
                            <md-radio-button value="No">No </md-radio-button>
                            </md-radio-group>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Reason for no contract</label>
                                <input type="text" maxlength="128" no-special-char ng-model="Partner.reasonfornocontract" autocomplete="off"
                                       required readonly>
                            </md-input-container>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Organization Type   -  {{getmstapprovaldata.partner_orgtype}}</label>
                                 <input type="text" maxlength="128" ng-model="Partner.organizationtype" autocomplete="off"
                                       required readonly>
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Contract From   -  {{getmstapprovaldata.partner_contractdatefrom | date:'dd-MMM-yyyy'}}</label>
                                <input type="text" maxlength="128" ng-model="Partner.contractfrom | date:'dd-MMM-yyyy'" autocomplete="off"
                                       required readonly>

                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Contract To   -  {{getmstapprovaldata.partner_contractdateto | date:'dd-MMM-yyyy'}}</label>
                                 <input type="text" maxlength="128" ng-model="Partner.contractto | date:'dd-MMM-yyyy'" autocomplete="off"
                                       required readonly>
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                             <md-input-container class="md-block inputcontainer">
                                <label>RM Name   - {{getmstapprovaldata.employee_name}}</label>
                                 <input type="text" maxlength="128" ng-model="selectedemp" autocomplete="off"
                                       required readonly>
                            </md-input-container>

                        </div>

                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label  >Renewal Date</label>
                                 <input type="text" maxlength="128" ng-model="Partner.renewaltype | date:'dd-MMM-yyyy'" autocomplete="off"
                                       required readonly>

                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Approx Spend(Rs)</label>
                                <input type="number" ng-model="Partner.approxspend" required readonly>
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Actual Spend(Rs)</label>
                                <input type="number" ng-model="Partner.actualspend" required readonly>
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Remarks</label>
                                <input type="text" maxlength="128" ng-model="Partner.remarks" autocomplete="off"
                                       required readonly>
                            </md-input-container>
                        </div>
                    </div>
                    <div class="row">

                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <laberl>Director/Supplier Count</laberl>
                                <input type="number" ng-model="Partner.nodirector"
                                       aria-label='Enter Partner Count' autocomplete="off"
                                       required readonly>
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <laberl>Name of Director   -  {{getmstapprovaldata.partner_code}}</laberl>
                                <input type="text" maxlength="128" ng-model="directorName"
                                       aria-label='Enter Director name' autocomplete="off"
                                       required readonly>
                            </md-input-container>
                        </div>

                        <div class="col-md-3">

                        </div>

                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <!--CREATE A TABLE-->
                            <table class="table table-striped table-bordered table-condensed table-hover md-primary">
                                <thead class="header">
                                <tr>
                                    <th colspan="2">Director</th>
                                </tr>
                                </thead>
                                <tr ng-repeat="directorName1 in directorarray">
                                    <td ng-show="showedit"><label>{{directorName1}}</label></td>
                                    <td ng-show="addshow"><label>{{directorName1}}</label></td>
                                     <td align="center"><a href="" ng-click="Director_delete($index)"
                                                 ></a>
                            </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="row">
                            <div ng-include="'Partner_Address'"></div>
                        </div>
                        <div class="row">
                             <div ng-include="'Partner_Contact'"></div>
                        </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div ng-show="isSet(2)">
            <div ng-include="'atma_Approval_Taxdetails_Page'">Tax</div>
        </div>

        <div ng-show="isSet(3)">

            <div ng-include="'atma_Approval_Attachmentdetails_Page'">Add Attachment</div>

        </div>

        <div ng-show="isSet(5)">
            <div ng-include="'atma_Approval_ActivityDetails_Page'">Add Activity</div>
        </div>

        <!-- ENDOF <div class="row" ng-show="isSet3)"> -->
        <div ng-show="isSet(6)">
            <div ng-include="'atma_Approval_Paymentdetails_Page'">Payment Details</div>
        </div>  <!-- ENDOF <div class="row" ng-show="isSet(6)"> -->

        <div ng-show="isSet(7)">
            <div ng-include="'atma_profilepage'">Profile</div>
        </div>

<!--        Start Profile Details Page-->
        <div ng-show="isSet(8)">
            <div ng-include="'atma_Approval_ProfileProduct'">Profile Product</div>
        </div>
        <div ng-show="isSet(9)">
            <div ng-include="'atma_Approval_ProfileBranch_Page'">Profile Branch</div>
        </div>
        <div ng-show="isSet(10)">
            <div ng-include="'atma_Approval_ProfileClient_Page'">Profile Client</div>
        </div>
        <div ng-show="isSet(11)">
            <div ng-include="'atma_Approval_ProfileContract_Page'">Profile Contract</div>
        </div>
        <div ng-show="isSet(12)">
            <div ng-include="'atma_Approval_ProfileBasic_Page'">Profile Basic</div>
        </div>
        <div ng-show="isSet(13)">
            <div ng-include="'atma_Approval_ActivityDetails_Summary'">Create Activity Details</div>
        </div>
        <div ng-show="isSets(14)">
            <div ng-include="'atma_Approval_Catalogcreation'" ng-show="qwe">Create Activity Details</div>
        </div>
<!--End Profile Details Page-->


               <div class="row  text-left" ng-show="buttonhide">
            <form role="form" name="prapprovel">
                <div class="col-lg-3 col-sm-3 ">
                    <md-input-container class="md-block inputcontainer">
                        <label>Reject Remarks</label>
                        <input id="premarks" maxlength="256" ng-model="approvelreject" ng-change="approvelremark=''" required/>
                    </md-input-container>

                </div>

            </form>

             <div class="col-lg-3 col-sm-3 ">
                    <md-input-container class="md-block inputcontainer">
                        <label>Approval Remarks</label>
                        <input id="prremarksapp" maxlength="256" ng-model="approvelremark"  ng-change="approvelreject=''"  required/>
                    </md-input-container>
                </div>
            <div class="col-lg-6 col-sm-6">
                <md-button type="button" value="Close" class="btn btn-secondary" ng-click="CloseRMApproval()">Close
                </md-button>
                <md-button type="button" value="Reject" ng-click="approvedfor_RM('Reject',approvelreject)" class="md-raised md-warn"
                           ng-disabled="prapprovel.$invalid" ng-hide="hide">Reject
                </md-button>
                <md-button type="button" value="Approve" ng-click="approvedfor_RM('Approve',approvelremark)"
                           ng-disabled="prapprovel.$valid" class="md-raised md-primary" ng-hide="hide">Approve
                </md-button>
            </div>

        </div>

        <div class="row  text-left" class="ng-cloak" ng-show="overallbuttons">
     <div class="col-lg-3 col-sm-3" >
            <md-input-container class="md-block inputcontainer">
                <label> Remarks</label>
                <input id="prdeactremarks" value="Deactivate"
                       maxlength="256" ng-model="deactivationremark"
                       ng-disabled="deactivation_remarks"
                       ng-change="terminationremark=''" />
            </md-input-container>
        </div>


    <div class="col-lg-6 col-sm-6 text-right">
         <md-button class="md-raised"  type="button"  value="Close" ng-click="cancel_viewdata()">Close</md-button>

        <md-button type="button" value="activate" ng-click="activate_click(Partner)"
                            class="md-raised md-primary" ng-show="activate_btn">Activate
        </md-button>
        <md-button type="button" value="deactivate" ng-click="activate_click(Partner)"
                            class="md-raised md-primary" ng-show="deactivate_btn">Deactivate
        </md-button>
        <md-button type="button" value="terminate" ng-click="activate_click(Partner)"
                            class="md-raised md-primary" ng-show="terminate_btn">Terminate
        </md-button>
        <md-button type="button" value="terminate" ng-click="activate_click(Partner)"
                            class="md-raised md-primary" ng-show="modification_btn">Enable To Edit
        </md-button>
        

    </div>
</div>

        <div ng-include="'atma_addpayment'">Payment View</div>
    </div> <!-- endof <div class="container container1" ng-app="Appreview" ng-controller="Ctrlreview"> -->
</div> <!--endof <div class="maincontent"> -->
{% endverbatim %}

<script>
    var app_review = angular.module('Appreview', ['ngMaterial', 'ui.bootstrap', 'AppCommon', 'ngMessages'])
        .config(function($httpProvider) {
            $httpProvider.defaults.xsrfCookieName = 'csrftoken';
            $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
        });

app_review.run(function($mdDateLocale, $filter) {
    $mdDateLocale.formatDate = function(date) {
        return $filter('date')(date, "dd-MMM-yyyy");
    };
})

app_review.directive('fileModel', ['$parse', function($parse) {
    return {
        restrict: 'A',
        link: function(scope, element, attrs) {
            element.bind('change', function() {
                $parse(attrs.fileModel).assign(scope, element[0].files)
                scope.$apply();
            });
        }
    };
}]);

app_review.directive("fileinput", [function() {
    return {
        scope: {
            fileinput: "=",
            filepreview: "="
        },
        link: function(scope, element, attributes) {
            element.bind("change", function(changeEvent) {
                scope.fileinput = changeEvent.target.files[0];
                var reader = new FileReader();
                reader.onload = function(loadEvent) {
                    scope.$apply(function() {
                        scope.filepreview = loadEvent.target.result;
                    });
                }
                reader.readAsDataURL(scope.fileinput);
            });
        }
    }
}]);

app_review.controller('Ctrlreview', function($scope, $rootScope, $filter, $mdDialog, Servicedrctsale,$http,
    SerCommon, $element, $window, $location) {
    $element.find('input').on('keydown', function(ev) {
        ev.stopPropagation();
    });

    var detail = JSON.parse(sessionStorage.getItem('today'));
    $scope.employgid = detail.employee_gid1;
    $scope.entity_gid = detail.entity_gid;
    $scope.create_by = detail.employee_gid;
    $scope.updtdis = true;
    $scope.currentPage = 1;
    $scope.currentPages = 1;
    $scope.maxSizes = 3;
    $scope.add = [];
    $scope.Partner = [];
    $scope.Activityadd=[];
    $scope.Attachment=[];
    $scope.itemsPerPage = 10;
    $scope.gf = true;
    $scope.maxDate = new Date();

    $scope.ActivitycurrentPage = 1;
    $scope.ActivitymaxSize = 3;
    $scope.ActivityitemsPerPage = 10;

    $scope.actdet_itemsPerPage = 5;
    $scope.actdet_currentPage = 1;

    $scope.catalog_itemsPerPage = 5;
    $scope.catalog_currentPage = 1;

    $scope.header = [];

    $scope.gotodocname = gotodocname1;
    $scope.showedit = false;
    $scope.showadd = false;

<!--    $scope.paymodename = paymodename;-->
<!--    $scope.bank_name = bankgid;-->
    $scope.branch_name = bankbranchnames;
<!--    $scope.paymodebankacctype = gotopartneracctype;-->

    $scope.one="gg";
<!--    $scope.gottaxdetails=gottaxdetails;-->
    $scope.gottaxrate=gottaxratedetails;
    $scope.gotisexcempted=gotisexcempted;


    $scope.state_clk1 = function(state_gid, type) {

            $scope.client_stategid=state_gid;
            var distddl = Servicedrctsale.getdistddl(state_gid)
            distddl.then(function(result) {
                        $scope.adistrictddl = JSON.parse(result.data);

                }),
                function() {
                    alert('No data!.');
                };
        };

    $scope.district_clk1 = function(district_gid, type) {

        if(type == "address"){
        $scope.client_districtgid=district_gid;
        }else{
         $scope.client_districtgid="";
        }
            var ctyddl = Servicedrctsale.getcityddl(district_gid)
            ctyddl.then(function(result) {
                    if (type == 'address') {
                        $scope.acity1 = [];
                        $scope.acity1 = JSON.parse(result.data);
                    } else {
                        $scope.city1 = [];
                        $scope.city1 = JSON.parse(result.data);
                    }
                }),
                function() {
                    alert('No data!.');
                };
        };



    $scope.showpopup = function() {

        modalshow('mdl_present11');
    }

    $scope.loading = function() {
        $mdDialog.show({
            templateUrl: 'loaderSpinner',
            parent: angular.element(document.body),
            clickOutsideToClose: false
        });
    };
    $scope.endloading = function() {
        $mdDialog.hide();
    };

    $scope.Director_delete = function(index){
         //alert(index);
         $scope.directorarray.splice(index, 1);
         $scope.Partner.nodirector=$scope.Partner.nodirector-1;
    }
    //alert(sessionStorage.getItem('partner_summary_session'));

    if (sessionStorage.getItem('partner_summary_session') != null)
     {
        var partner_detail = JSON.parse(sessionStorage.getItem('partner_summary_session'));
        $scope.a=JSON.stringify(partner_detail);
        //alert($scope.a);
        $scope.partner_gid = partner_detail.partnerdata.partner_gid;
        $scope.update = partner_detail.view;

        if($scope.partner_gid > 0)
        {
        $scope.editdisabled = true;
        $scope.Partner = [];
        $scope.Partner.partnercode =  partner_detail.partnerdata.partner_code;
        $scope.Partner.partnername =  partner_detail.partnerdata.partner_name;
        $scope.Partner.partnerpan= partner_detail.partnerdata.partner_panno;
        $scope.Partner.companyregno= partner_detail.partnerdata.partner_compregno;
        $scope.Partner.custcategorygid= partner_detail.partnerdata.partner_custcategorygid;
        $scope.Partner.partnertype=partner_detail.partnerdata.partner_type;
        $scope.Partner.partnergroup=partner_detail.partnerdata.partner_group;
        $scope.Partner.custcategory_name=partner_detail.partnerdata.custcategory_name;
        $scope.Partner.classification=partner_detail.partnerdata.partner_Classification;
        $scope.Partner.website=partner_detail.partnerdata.partner_web;
        $scope.Partner.activecontractype=partner_detail.partnerdata.partner_activecontract;
        $scope.Partner.reasonfornocontract=partner_detail.partnerdata.partner_reason_no_contract;
        $scope.Partner.organizationtype=partner_detail.partnerdata.partner_orgtype;
        $scope.Partner.contractfrom=partner_detail.partnerdata.partner_contractdatefrom;
        $scope.Partner.contractto=partner_detail.partnerdata.partner_contractdateto;
        $scope.Partner.renewaltype=partner_detail.partnerdata.partner_renewdate;
        $scope.Partner.approxspend=partner_detail.partnerdata.partner_aproxspend;
        $scope.Partner.actualspend=partner_detail.partnerdata.partner_actualspend;
        $scope.Partner.remarks=partner_detail.partnerdata.partner_remarks;
        $scope.Partner.nodirector=partner_detail.partnerdata.partner_noofdir;
        $scope.selectedemp=partner_detail.partnerdata.employee_name;
        $scope.Partner.compositevendor=partner_detail.partnerdata.partner_compositevendor;
        $scope.Partner.custcategory_name1=partner_detail.partnerdata.custcategory_name;
        $scope.maintable_partnergid=partner_detail.partnerdata.main_partner_gid;
        $scope.Partner_status=partner_detail.partnerdata.partner_status;
        $scope.Partner_requestfor=partner_detail.partnerdata.partner_requestfor;
        $scope.Partner_statuse=partner_detail.view;
         $scope.add.addline11=partner_detail.partnerdata.address_1;
            $scope.add.addline211=partner_detail.partnerdata.address_2;
            $scope.add.pincode111=partner_detail.partnerdata.address_pincode;
            $scope.add.addline311=partner_detail.partnerdata.address_3;
            $scope.add.addselectedstate11=partner_detail.partnerdata.address_state_gid;
            $scope.state_clk1($scope.add.addselectedstate11,'address');
            $scope.add.addselecteddistrict11 = partner_detail.partnerdata.address_district_gid;
            //alert($scope.add.addselecteddistrict11);
            $scope.district_clk1(partner_detail.partnerdata.address_district_gid,'address');
            $scope.add.addselectedcity11=partner_detail.partnerdata.address_city_gid;
            $scope.add.cntcttype11=partner_detail.partnerdata.Contact_contacttype_gid;
            $scope.add.prsnname11=partner_detail.partnerdata.Contact_personname;
            $scope.add.dsgntn11=partner_detail.partnerdata.Contact_designation_gid;
            $scope.add.lndlne11=partner_detail.partnerdata.Contact_landline;
            $scope.add.lndlne211=partner_detail.partnerdata.Contact_landline2;
            $scope.add.mobno11=partner_detail.partnerdata.Contact_mobileno;
            $scope.add.mobno211=partner_detail.partnerdata.Contact_mobileno2;
            $scope.add.mailid11=partner_detail.partnerdata.Contact_email;
            if (partner_detail.partnerdata.Contact_DOB==null)  {
                $scope.add.dobb11=null;
            }else
            {
                $scope.add.dobb11=new Date(partner_detail.partnerdata.Contact_DOB);
            }
            if (partner_detail.partnerdata.Contact_WD==null)
            {
                $scope.add.weddy11=null;
            }
            else
            {
                $scope.add.weddy11=new Date(partner_detail.partnerdata.Contact_WD);
            }


       //alert($scope.Partner_statuse);
        getdirector_data($scope.partner_gid);
        }
     }
     if (partner_detail.partnerdata.partner_contractdatefrom){

                $scope.Partner.contractfrom =  formatStringDate(new Date(partner_detail.partnerdata.partner_contractdatefrom), 'yyyy-mm-dd');
             }
             else
             {
                $scope.Partner.contractfrom= null;
             }
             if (partner_detail.partnerdata.partner_contractdateto){
                $scope.Partner.contractto =  formatStringDate(new Date(partner_detail.partnerdata.partner_contractdateto), 'yyyy-mm-dd');
             }
             else
             {
                $scope.Partner.contractto= null;
             }
     if($scope.Partner_status == "APPROVED"){
     $scope.msttable="Mst";
     $scope.catalog_get="APPROVED";
     }else{
     $scope.msttable="";
     $scope.catalog_get="Draft";
     }

     if($scope.Partner_statuse=="ACTIVATION"){
     $scope.overallbuttons=true;
     $scope.activate_btn=true;
     $scope.buttonhide=false;
     $scope.partner_status_change="PENDING-RM";
     $scope.activation_status="Partner_Activate";
     }
     else if($scope.Partner_statuse=="DEACTIVATION"){
     $scope.overallbuttons=true;
     $scope.deactivate_btn=true;
     $scope.buttonhide=false;
     $scope.partner_status_change="PENDING-RM";
     $scope.activation_status="Partner_Deactivate";
     }
     else if($scope.Partner_statuse=="TERMINATION"){
     $scope.overallbuttons=true;
     $scope.terminate_btn=true;
     $scope.buttonhide=false;
     $scope.partner_status_change="PENDING-RM";
     $scope.activation_status="Partner_Deactivate";
     }
     else if($scope.Partner_statuse=="MODIFICATION"){
     $scope.overallbuttons=true;
     $scope.modification_btn=true;
     $scope.buttonhide=false;
     $scope.partner_status_change="DRAFT";
     $scope.activation_status="Partner_Deactivate";
     }
     else if($scope.Partner_statuse=="RENEWAL PROCESS"){
     $scope.overallbuttons=true;
     $scope.modification_btn=true;
     $scope.buttonhide=false;
     $scope.partner_status_change="DRAFT";
     $scope.activation_status="Partner_Deactivate";
     }

     else{
      $scope.overallbuttons=false;
     $scope.terminate_btn=false;
     $scope.buttonhide=true;
     }
$scope.activate_click=function(){

    var data={
        "Params":{
            "Filter":{
                "Partner_Gid":$scope.partner_gid,
                "Partner_Status": $scope.partner_status_change,
                "Partner_Requestfor":$scope.Partner_statuse,
                "Tran_Remarks":$scope.deactivationremark,
            },
            "Classification":{
            "Entity_Gid": $scope.entity_gid

            },
        },
        "Group":"Activation_Request",
        "Action":"Approval_To_Draft_Set",
    }
    var changereaquest_activation=Servicedrctsale.updateactivation(data)
    changereaquest_activation.then(function(result){
    $scope.changerequest_ans=result.data;
    //alert(JSON.stringify( $scope.changerequest_ans));
    if( $scope.changerequest_ans == "SUCCESS"){
        if($scope.Partner_statuse=="TERMINATION"){
            alert("TERMINATE REQUEST SUCCESS");
            $window.location.href = 'AtmaPartnerTerminationRequest';
        }
        else if($scope.Partner_statuse=="DEACTIVATION"){
            alert("DEACTIVATION REQUEST SUCCESS");
            $window.location.href = 'AtmaPartnerDeactivationRequest';
        }
        else if($scope.Partner_statuse=="ACTIVATION"){
            alert("ACTIVATION REQUEST SUCCESS");
            $window.location.href = 'AtmaPartnerActivationRequest';
        }
        else if($scope.Partner_statuse=="MODIFICATION"){
            alert("ENABLE TO EDIT SUCCESS");
            $window.location.href = 'ATMA_PartnerSummary';
        }
        else if($scope.Partner_statuse=="RENEWAL PROCESS"){
            alert("ENABLE TO EDIT SUCCESS");
            $window.location.href = 'ATMA_PartnerSummary';
        }

    }
    else{
    alert(JSON.stringify($scope.changerequest_ans))
        if($scope.Partner_statuse=="TERMINATION"){
            //alert(JSON.stringify($scope.changerequest_ans))
            $window.location.href = 'AtmaPartnerTerminationRequest';
        }
        if($scope.Partner_statuse=="DEACTVATION"){
            //alert(JSON.stringify($scope.changerequest_ans))
            $window.location.href = 'AtmaPartnerDeactivationRequest';
        }
        if($scope.Partner_statuse=="ACTIVATION"){
            //alert(JSON.stringify($scope.changerequest_ans))
            $window.location.href = 'AtmaPartnerActivationRequest';
        }
    }
    })
}
<!--getatma_data();-->
<!--function getatma_data(){-->

<!--        var data = {-->
<!--            "Params": {-->
<!--                "Filter":{-->

<!--                    "Mst_Table":"Mst",-->
<!--                    "Partner_Gid":$scope.maintable_partnergid-->

<!--                },-->
<!--                "Classification": {-->
<!--                    "Entity_Gid": $scope.entity_gid-->
<!--                },-->
<!--                "Group": "ATMASUMMARY",-->
<!--                "Action": "Partner_Get",-->
<!--                "Type": "RMNAME",-->
<!--            }-->
<!--        }-->
<!--        var get_data = Servicedrctsale.get_atma(data)-->
<!--        get_data.then(function(result) {-->
<!--        debugger;-->
<!--            $scope.getmstapprovaldata=result.data.DATA[0];-->
<!--        })-->
<!--    }-->
    function getdirector_data(partnerGid){

        var data = {
            "Params": {
                "Filter":{
                    "Director_Partnergid":partnerGid,
                },
                "Classification": {
                    "Entity_Gid": $scope.entity_gid
                },
                "Group": "ATMASUMMARY",
                "Action": "Directors_Get",
                "Type": "dirname",
            }
        }
        var get_dir_data = Servicedrctsale.get_director(data)
        get_dir_data.then(function(result) {

        $scope.directorarraynew = [];
        $scope.directorarray = [];
        $scope.showedit = true;
            $scope.directorarraynew=result.data.DATA;

            for (var i = 0; i < $scope.directorarraynew.length; i++)
            {
                $scope.directorarray.push($scope.directorarraynew[i].directorName1);
            }

        })
    }

    $scope.tab = 1
    $scope.setTab = function(newTab) {

if(newTab == 2){
gettaxdetails();
}
if(newTab == 6){
getpaymode();
}
if(newTab == 3){
   fn_getattachmentsummary();
}
if(newTab == 5){
loadActivityData();
}
if(newTab == 10){
getclient_details();
}
if(newTab == 11){
getcontractdetails();
}
if(newTab == 9){
getbranchdetails();
}
if(newTab == 12){
getbasicprofiledetails();
loadData_PartnerProfileProduct();
}
        $scope.tab = newTab;
         $scope.qwe=false;

    };

    $scope.isSet = function(tabNum) {
        return $scope.tab === tabNum;
    };

//start

 $scope.Previous_clk=function(e,btn_type){

    $scope.loading();
    $scope.qwe=false;
    $scope.qw1=e.activity_gid;
    $scope.a=$scope.getActivitySummary.length-1;
    $scope.ase=JSON.stringify($scope.getActivitySummary[$scope.a].activity_gid);
    //alert( $scope.ase);
    $scope.ase1=JSON.stringify($scope.getActivitySummary[0].activity_gid);
    if(btn_type=="Previous"){
    if(parseInt($scope.ase1) == $scope.qw1){
    alert("Reach The Minium Count");
    $scope.endloading();
    return false;

    }}
     if(btn_type=="next"){
    if($scope.ase == $scope.qw1){
    alert("Reach The Maximum Count");
     $scope.endloading();
    return false;
    }}
            for (var i = 0; i < $scope.getActivitySummary.length; i++) {
                if ($scope.getActivitySummary[i].activity_gid == $scope.qw1) {
                $scope.arrayindex=i;
                }
            }
    if(btn_type=="Previous"){
        $scope.bind_actdetdata=$scope.getActivitySummary[$scope.arrayindex - 1];
        $scope.act_details=$scope.getActivitySummary[$scope.arrayindex - 1].activity_gid;

    }
    if(btn_type=="next"){
        $scope.bind_actdetdata=$scope.getActivitySummary[$scope.arrayindex + 1];
        $scope.act_details=$scope.getActivitySummary[$scope.arrayindex + 1].activity_gid;
    }
    setTab_Changes();

    }


        $scope.tab = 1;

     $scope.act_details=0;
    $scope.setTab_Change = function(newTab,e) {

    $scope.bind_actdetdata=e;
    //alert(JSON.stringify($scope.bind_actdetdata));
    $scope.act_details=e.activity_gid;
    $scope.act_name_bind=e.activity_name;
    //alert($scope.act_details);
        $scope.tab = newTab;
        setTab_Changes();

    };
//start activity details

 function setTab_Changes(){

     //alert($scope.act_det.act_details);
            var filter = {};
            if ($scope.add.activityname1) {
                filter['Activitydetails_Activitygid'] = $scope.add.activityname1
            } else {
                filter['Activitydetails_Activitygid'] = '';
            }
            if ($scope.add.activitydetailname1) {
                filter['Activitydetails_Name'] = $scope.add.activitydetailname1
            } else {
                filter['Activitydetails_Name'] = '';
            }
            var data = {
                "Params": {
                    "Filter": {
                    "Activitydetails_Activitygid":$scope.act_details,
                    "Mst_Table": $scope.msttable,
                    },
                    "Classification": {
                        "Entity_Gid": $scope.entity_gid
                    }
                }
            }
            var dtamactivity = {
                Group: 'Activity_Details',
                Type: 'Activitydetails_Get',
                data: data
            }
            $scope.getactivity = [];
            var getactivity = Servicedrctsale.getdattamactivity(dtamactivity)
            getactivity.then(function (result) {
                $scope.getactivity = result.data.DATA;
                //alert(JSON.stringify($scope.getactivity));
                $scope.searchactivity_details=$scope.getactivity;
                $scope.pageLength11 = $scope.getactivity.length;
            }, function (err) {
                alert('No data!.');
            }).finally();
        }

        $rootScope.showpopup_actdet = function () {
        $scope.addactivitydetails=true;
        $scope.updateactivitydetails=false;
            $scope.add.activityname= "";
            $scope.add.activitydetailcode= "";
            $scope.add.activitydetailname= "";
            $scope.add.activityremark= "";
            $scope.add.raiser="";
            $scope.add.approvername= "";
            modalshow('addactivitydetailspopup');
        }

        $scope.save_act_details = function (add) {

 if($scope.raiser_employee_gid == $scope.aproval_employee_gid){
 alert("Please Select Raiser and Aproval are Different")
 }else{

            var data = {
                "Params": {
                    "Activitydetails_Activitygid": $scope.act_details,
                    "Activitydetails_Code": add.activitydetailcode,
                    "Activitydetails_Name": add.activitydetailname,
                    "Activitydetails_Remarks": add.activityremark,
                    "Activitydetails_Raisor":$scope.raiser_employee_gid,
                    "Activitydetails_Approver":$scope.aproval_employee_gid,
                },
                "Classification": {
                    "Entity_Gid": $scope.entity_gid,
                    "Create_By": $scope.create_by
                },
            }
            var details = {
                Group: 'Activity_Details',
                Action: 'Insert',
                Type: 'Activity_Details',
                data: data,
            }
            $scope.actdetails = [];
            $scope.loading();

            var set_actdetails = Servicedrctsale.setactdetails(details)
            set_actdetails.then(function (result) {
                    //alert(JSON.stringify(result.data));
                    $scope.actdetails = result.data.MESSAGE;
                    if($scope.actdetails=="SUCCESSFULLY INSERTED"){
                    alert("SUCCESSFULLY INSERTED");
                    modalhide('addactivitydetailspopup');
                    setTab_Changes();
                    }else{
                    alert(JSON.stringify($scope.actdetails));
                     modalshow('addactivitydetailspopup');
                    }
                }),
                function (err) {
                    alert('no data');
                }.finally($scope.endloading());
        }
        }



    function gotoapprover(query) {
            var result = $filter('filter')($scope.approver, {
                'employee_name': query
            });
            return result;
        }

   $scope.raiser_empname=function(e){

$scope.raiser_employee_gid=e.employee_gid;
    }
$scope.Approver_empname=function(e){
$scope.aproval_employee_gid=e.employee_gid;
}
$scope.edit_data = function (prod) {


            $scope.activitydetailsgid=prod.activitydetails_gid;
            $scope.addactivitydetails=false;
            $scope.updateactivitydetails=true;
            $scope.add.activityname= prod.activity_name;
            $scope.add.activitydetailcode= prod.activitydetails_code;
            $scope.add.activitydetailname= prod.activitydetails_name;
            $scope.add.activityremark= prod.activitydetails_remarks;
            $scope.add.raiser=prod.Raisor;
            $scope.add.approvername= prod.Approver;
            modalshow('addactivitydetailspopup');
             }
$scope.update_activitydetails=function(add){

 var data = {
                "Params": {
                    "Activitydetails_Gid":$scope.activitydetailsgid,
                    "Activitydetails_Activitygid": $scope.act_details,
                    "Activitydetails_Code": (add.activitydetailcode).toString(),
                    "Activitydetails_Name": add.activitydetailname,
                    "Activitydetails_Remarks": add.activityremark,
                    "Activitydetails_Raisor":$scope.raiser_employee_gid,
                    "Activitydetails_Approver":$scope.aproval_employee_gid,
                },
                "Classification": {

                    "Update_By": $scope.create_by
                },
            }
            var details = {
                Group: 'Activity_Details_Update',
                Action: 'UPDATE',
                Type: '',
                data: data,
            }
            $scope.actdetails = [];
<!--            $scope.loading();-->
            var update_actdetails = Servicedrctsale.updateactdetails(details)
            update_actdetails.then(function (result) {
                    //alert(JSON.stringify(result.data));
                    $scope.actdetails = result.data;
                    if($scope.actdetails=="SUCCESS"){
                    alert("SUCCESSFULLY UPDATED");
                    modalhide('addactivitydetailspopup');
                    setTab_Changes();
                    }else{
                    alert(JSON.stringify($scope.actdetails));
                     modalshow('addactivitydetailspopup');
                    }
                }),
                function (err) {
                    alert('no data');
                }.finally($scope.endloading());
        }
 $scope.show_activitydetails = function (prod) {


            $scope.activitydetailsgid=prod.activitydetails_gid;
            $scope.addactivitydetails=false;
            $scope.updateactivitydetails=false;
            $scope.add.activityname= prod.activity_name;
            $scope.add.activitydetailcode= prod.activitydetails_code;
            $scope.add.activitydetailname= prod.activitydetails_name;
            $scope.add.activityremark= prod.activitydetails_remarks;
            $scope.add.raiser=prod.Raisor;
            $scope.add.approvername= prod.Approver;
            modalshow('addactivitydetailspopup');
             }
             $scope.search_activity_details=function(e){

            $scope.getactivity = $filter('filter')($scope.searchactivity_details , {

               "activitydetails_name": e.activitydetailname1,
               "activitydetails_code": e.activitydetailcode1,
               "activitydetails_remarks":e.activityremark1

        });
}


//end activity details

//start Catalog


    $scope.setTab_ChangeCatalog = function(newTab,e) {

        $scope.tabs = newTab;
        $scope.qwe=true;
        $scope.activity_detgid=e.activitydetails_gid;
        $scope.activity_detname=e.activitydetails_name;
        getcatalogdetails();


    };

    $scope.isSets = function(tabNum) {
        $scope.tabNums=tabNum;
         if ($scope.tabs === $scope.tabNums){
         return true;
         }
         else{
         return false;
         }
    };


        function getcatalogdetails(){

        var data = {
            "Params": {
                "Filter": {
                "activitydtlpproduct_activitydetailsgid":  $scope.activity_detgid,
                "mpartnerproduct_partner_gid":  $scope.partner_gid,
                "mPartnerProduct_Status":$scope.catalog_get,
                 "Mst_Table":$scope.msttable,
                },
                "Classification": {
                    "Entity_Gid": $scope.entity_gid
                }
            }
        }
        var dtam = {
            Group: 'Catalog_Details',
            Type: 'activitydtlpp_GET',
            data: data
        }
        $scope.getcompaignm = [];
        var getcompaignm = Servicedrctsale.getdattams(dtam)
        getcompaignm.then(function (result) {
            $scope.getcompaignm = result.data.DATA;
            $scope.getcompaignms = result.data.DATA.partner_requestfor;
            //alert(JSON.stringify($scope.getcompaignm));
            //alert(JSON.stringify($scope.getcompaignms));
            $scope.searchcatalog=$scope.getcompaignm;
            $scope.load = $scope.getcompaignm
            $scope.pageLength = $scope.getcompaignm.length;
            $scope.pageLengths = $scope.checkerdetails.length;
        }, function (err) {
            alert('No data!.');
        }).finally();

        }

        $rootScope.showpopup_actdetails = function () {

           $scope.updatecatalog=false;
        $scope.addcatalog=true;
            $scope.add.catalogactivitydetail=$scope.activity_details_name,
            $scope.add.catalogcategory="",
            $scope.add.subcategory="",
            $scope.add.catalogname="",
            $scope.add.catalogspec="",
            $scope.add.catalogsize="",
            $scope.add.catalogremarks="",
            $scope.add.uomgid="",
            $scope.add.catalograte="",
            $scope.add.contractfrom="",
            $scope.add.contractto="",
            $scope.add.unitprice="",
            $scope.add.packingprice="",
            $scope.add.deliverydays="",
            $scope.add.capacitypw="",
            $scope.add.dts="",
            $scope.add.catalog_partner_product_gid="",
            modalshow('addcatalogdetailspopup');
        }



        function subcategoryname(query) {
            var result = $filter('filter')($scope.subcategoryname, {
                'subcategory_name': query
            });
            return result;
        }


        function getproduct_gid(module) {
        var result = $filter('filter')($scope.partner_product, {
            'product_name': module

        });
        return result;
    }

    $scope.partnerprod_gid=function(e){

        $scope.mpartnerproduct_gid=e.product_gid

        }

        $scope.catalog_update=function(add){

        var data = {
                "Params": {
                    "activitydtlpproduct_Gid":$scope.catalogdetails_gid,
                    "activitydtlpproduct_Category": add.catalogcategory,
                    "activitydtlpproduct_SubCategory": add.subcategory,
                    "activitydtlpproduct_Name": add.catalogname,
                    "activitydtlpproduct_Spec": add.catalogspec,
                    "activitydtlpproduct_Size": add.catalogsize,
                    "activitydtlpproduct_Remarks": add.catalogremarks,
                    "activitydtlpproduct_UomGid": (add.uomgid).toString(),
                    "activitydtlpproduct_Rate": add.catalograte,
                    "activitydtlpproduct_ValidFrom": add.contractfrom,
                    "activitydtlpproduct_ValidTo": add.contractto,
                    "mPartnerProduct_Product_Gid":$scope.mpartnerproduct_gid,
                    "mPartnerProduct_UnitPrice":add.unitprice,
                    "mPartnerProduct_PackingPrice":add.packingprice,
                    "mPartnerProduct_DeliveryDays":add.deliverydays,
                    "mPartnerProduct_CapacityPW":add.capacitypw,
                    "mPartnerProduct_DTS":add.dts
                },
                "Classification": {
                    "Update_By": $scope.create_by,
                    "Entity_Gid": $scope.entity_gid,
                },
            }
            var total = {
                Group: 'Catalog_Details_Update',
                Action: 'activitydtlpp_UPDATE',
                Type: 'Catalog Details',
                data: data
            }
            var update_catalog = Servicedrctsale.updatecatalogservice(total)
            update_catalog.then(function (result) {
                    $scope.update_catalog = [];
                    $scope.update_catalog = result.data;
                    if($scope.update_catalog=="SUCCESS"){
                    alert("SUCCESSFULLY UPDATED");
                    modalhide('addcatalogdetailspopup');
                    getcatalogdetails();
                    }else{
                    alert(JSON.stringify($scope.update_catalog));
                    modalshow('addcatalogdetailspopup');
                    //$window.location.href = 'ATMA_PartnerSummary';
                    }
                }),
                function (err) {
                    alert('no data');
                };

        }

         $scope.edit_data_actdet=function(e){

        $scope.updatecatalog=true;
        $scope.addcatalog=false;
                $scope.catalogdetails_gid=e.activitydtlpproduct_gid,
                $scope.add.catalog_partner_product_gid=e.product_name,
                $scope.add.catalogactivitydetail=$scope.activity_details_name,
                $scope.add.catalogcategory=e.activitydtlpproduct_category,
               $scope.add.subcategory=e.activitydtlpproduct_subcategory,
                $scope.add.catalogname=e.activitydtlpproduct_name,
                $scope.add.catalogspec=e.activitydtlpproduct_spec,
                $scope.add.catalogsize=e.activitydtlpproduct_size,
                $scope.add.catalogremarks=e.activitydtlpproduct_remarks,
                $scope.add.uomgid=e.activitydtlpproduct_uomgid,
                $scope.add.catalograte=e.activitydtlpproduct_rate,
                $scope.add.contractfrom=new Date(e.activitydtlpproduct_validfrom),
                $scope.add.contractto=new Date(e.activitydtlpproduct_validto),
                $scope.add.unitprice=e.activitydtlpproduct_rate,
                $scope.add.packingprice=e.mpartnerproduct_packingprice,
                $scope.add.deliverydays=e.mpartnerproduct_deliverydays,
                $scope.add.capacitypw=e.mpartnerproduct_capacitypw,
                $scope.add.dts=e.mpartnerproduct_dts,
                $scope.add.mpartnerproduct_gid=e.activitydtlpproduct_gid,
                modalshow('addcatalogdetailspopup')
        }

         $scope.show_catalog=function(e){

        $scope.updatecatalog=false;
        $scope.addcatalog=false;
                $scope.catalogdetails_gid=e.activitydtlpproduct_gid,
                $scope.add.catalog_partner_product_gid=e.product_name,
                $scope.add.catalogactivitydetail=$scope.activity_details_name,
                $scope.add.catalogcategory=e.activitydtlpproduct_category,
               $scope.add.subcategory=e.activitydtlpproduct_subcategory,
                $scope.add.catalogname=e.activitydtlpproduct_name,
                $scope.add.catalogspec=e.activitydtlpproduct_spec,
                $scope.add.catalogsize=e.activitydtlpproduct_size,
                $scope.add.catalogremarks=e.activitydtlpproduct_remarks,
                $scope.add.uomgid=e.activitydtlpproduct_uomgid,
                $scope.add.catalograte=e.activitydtlpproduct_rate,
                $scope.add.contractfrom=new Date(e.activitydtlpproduct_validfrom),
                $scope.add.contractto=new Date(e.activitydtlpproduct_validto),
                $scope.add.unitprice=e.mpartnerproduct_unitprice,
                $scope.add.packingprice=e.mpartnerproduct_packingprice,
                $scope.add.deliverydays=e.mpartnerproduct_deliverydays,
                $scope.add.capacitypw=e.mpartnerproduct_capacitypw,
                $scope.add.dts=e.mpartnerproduct_dts,
                $scope.add.mpartnerproduct_gid=e.activitydtlpproduct_gid,
                modalshow('addcatalogdetailspopup')
        }


        $scope.gotcatagory= function(searchText) {

             var dat = {
            "Table_name": "ap_mst_tcategory",
            "Column_1": "category_gid,category_name",
            "Column_2": "",
            "Where_Common": "category",
            "Where_Primary": "",
            "Primary_Value": "",
            "Limits": "0,30",
            "Search_Column": searchText,
            "Order_by": "name"
        }
        var partnergroup = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.partnervendor = [];
            return $http.post(Appname + '/prodget/' , partnergroup).then(function(result) {
            console.log(result.data.DATA);
                return result.data.DATA;
              });
          };



        $scope.search_catalog=function(e){

            if(e.catalogcategory1 != undefined && e.catalogcategory1 != null && e.catalogcategory1 !='' )
        {
        var tempvar= e.catalogcategory1.category_name;
        }
        else
        {
        var tempvar='';
        }
            $scope.getcompaignm = $filter('filter')($scope.searchcatalog , {

               "activitydtlpproduct_name":e.catalogname1 == null ||  e.catalogname1 == undefined  || e.catalogname1 == '' ? '' : e.catalogname1,
               "activitydtlpproduct_spec":e.catalogspec1 == null ||  e.catalogspec1 == undefined  || e.catalogspec1 == '' ? '' : e.catalogspec1,
               "activitydtlpproduct_remarks":e.catalogremarks1 == null ||  e.catalogremarks1 == undefined  || e.catalogremarks1 == '' ? '' : e.catalogremarks1,
               "activitydtlpproduct_category":tempvar == null ||  tempvar == undefined  || tempvar == '' ? '' : tempvar


        });


}
//end Catalog
//start maping partner
$scope.assign_catalog=function(e){

var data = {
        "Params": {
        "mPartnerProduct_Gid":e.mpartnerproduct_gid,
        "ActivitydtlpProduct_ActivityDetailsGid":$scope.activity_detgid,
        "mPartnerProduct_Status":"Draft",
         },
         "Classification": {
            "Create_By": $scope.create_by,
            "Entity_Gid":$scope.entity_gid,
         },
    }
    var details = {
        Group: 'CATALOG_ASSIGN',
        Action: 'Assign_Catalog_Insert',
        Type:"",
        data: data,
    }
    var set_assingcatalogdetails = Servicedrctsale.assigncatalogService(details)
    set_assingcatalogdetails.then(function(result) {
        $scope.assign_catalogdetails = result.data.MESSAGE;
        if($scope.assign_catalogdetails == "SUCCESS"){
        alert("Catalog Assgin Successfully");
        getcatalogdetails();
        }
        $scope.searchassigncatalog=$scope.assign_catalogdetails;
        //alert(JSON.stringify($scope.assign_catalogdetails))
    }),
    function(err) {
        alert('no data');
    };
}

//end maping partner


//end

    $scope.directorarray = [];
    $scope.count = 0;
    $scope.submitClicked = false;

    $scope.DirectoraddRow = function(value) {
        $scope.addshow = true;

        if ($scope.directorarray.indexOf($scope.directorName) > -1) {
            alert($scope.directorName + ' already exists');
            return true; //current string is in list
        }

        $scope.count++;
        if (value <= $scope.count) {
            $scope.submitClicked = true;
        }
        $scope.directorarray.push($scope.directorName);
        if (value <= $scope.count) {
            //alert("Director/Partner's count reached.");
        }
    };

     // datepart: 'y', 'm', 'w', 'd', 'h', 'n', 's'
    Date.dateDiff = function(datepart, fromdate, todate)
     {

            datepart = datepart.toLowerCase();
            var diff = todate - fromdate;
            var divideBy = { w:604800000,
                   d:86400000,
                   h:3600000,
                   n:60000,
                   s:1000
            };

        return Math.floor( diff/divideBy[datepart]);
    }

    $scope.save = function(Partner) {
        //alert(JSON.stringify(add))

        if (Partner.partnercode == undefined) {
            alert('Invalid PARTNER CODE')
            return false;
        }
        if (Partner.partnername == undefined) {
            alert('Invalid PARTNER NAME')
            return false;
        }

        $scope.daysdifference=(Date.dateDiff('d', Partner.contractfrom, Partner.contractto));
        if ($scope.daysdifference<= 365)
        {
            alert($scope.daysdifference + ' days.Days between contract from date and to date should be 365 days');
            return false;
        }

        var data = {
            "Params": {
                //"Partner_Code": Partner.partnercode,
                "Partner_Name": Partner.partnername,
                "Partner_Compregno": Partner.companyregno,
                "Partner_Custcategorygid": Partner.custcategorygid,
                "Partner_Classification": Partner.classification,
                "Partner_Type": Partner.partnertype,
                "Partner_Group": Partner.partnergroup,
                "Partner_Web": Partner.website,
                "Partner_Reason_No_Contract": Partner.reasonfornocontract,
                "Partner_Activecontract": Partner.activecontractype,
                "Partner_Contractdatefrom": Partner.contractfrom,
                "Partner_Contractdateto": Partner.contractto,
                "Partner_Aproxspend": Partner.approxspend,
                "Partner_Actualspend": Partner.actualspend,
                "Partner_Orgtype": Partner.organizationtype,
                "Partner_Remarks": Partner.remarks,
                "Partner_Panno": Partner.partnerpan,
                "Partner_Noofdir": Partner.nodirector,
                "Partner_Status": "Draft",
                "Partner_Renewdate": Partner.renewaltype,
                "Partner_Rmname": $scope.selectedemp.employee_gid,
                "Partner_Gid": $scope.partner_gid,
                "Create_By": $scope.create_by,
            },
            "Classification": {
                "DirectorName": $scope.directorarray,
                "Entity_Gid": $scope.entity_gid,
                "Update_By":detail.employee_gid,
            },
        }
        var total = {
            Group: 'Header Details',
            Action:$scope.update ,
            Type: 'Header Details',
            data: data
        }
        var set_header = Servicedrctsale.partnerheader_set(total)
        set_header.then(function(result) {
                $scope.header = [];
                $scope.header = result.data.MESSAGE;
                alert(JSON.stringify($scope.header));

                if (result.data.MESSAGE == 'SUCCESS') {
                $window.location.href = 'ATMA_PartnerSummary';
                }
            }),
            function(err) {
                alert('no data');
            };
    }

    function gotopartner(query) {
        var result = $filter('filter')($scope.partner1, {
            'metadata_gid': query
        });
        return result;
    }



    function gotoorgpartner(query) {
        var result = $filter('filter')($scope.organizationtype, {
            'partner_gid': query
        });
        return result;
    }

    $scope.changepartnertype=function()
    {

        //alert('HAi');
         if ( $scope.Partner.classification=='One Time' )
         {$scope.Partner.partnertype='NA';$scope.editdisabledPartnertype=true;}
         else
         {$scope.editdisabledPartnertype=false;}
    }



     //PAYMENTSTART

    $scope.paymodename= function(searchText) {

             var dat = {
            "Table_name": "gal_mst_tpaymode",
            "Column_1": "paymode_gid,paymode_code,Paymode_name",
            "Column_2": "",
            "Where_Common": "paymode",
            "Where_Primary": "paymode_gid",
            "Primary_Value": "",
            "Limits": "0,30",
            "Search_Column": searchText,
            "Order_by": "code"
        }
        var partnergroup = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.partnervendor = [];
            return $http.post(Appname + '/prodget/' , partnergroup).then(function(result) {
            console.log(result.data.DATA);
                return result.data.DATA;
              });
          };
<!--bank branch-->
$scope.bank_name= function(searchText) {

             var dat = {
            "Table_name": "gal_mst_tbank",
            "Column_1": "bank_gid,bank_code,bank_name",
            "Column_2": "",
            "Where_Common": "bank",
            "Where_Primary": "bank_gid",
            "Primary_Value": "",
            "Limits": "0,30",
            "Search_Column": searchText,
            "Order_by": "code"
        }
        var partnergroup = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.partnervendor = [];
            return $http.post(Appname + '/prodget/' , partnergroup).then(function(result) {
            console.log(result.data.DATA);
                return result.data.DATA;
              });
          };








    $scope.partnerbank = [];
    $scope.searchDetails = function() {

     getpaymode();
<!--    $scope.search_accno=s.accno;-->
<!--    $scope.search_bname=s.beneficiaryname;-->
<!--    $scope.search_ifsc=s.ngmifsc;-->
<!--    $scope.search_acctype=s.payacctype.metadata_value;-->

    }
    $scope.addpaymentpagepopup = function() {

        $scope.paymode_cheque=true;
		$scope.addpay = true;
		$scope.editpay = false;
		$scope.inactivepay = false;
		$scope.pay.paymode_paymodedata="";
		$scope.pay.bank_paymodedata="";
		$scope.pay.bankbranch_paymodedata="";
		$scope.pay.acctype_paymodedata="";
		$scope.pay.accnumber_paymodedata="";
		$scope.pay.bname_paymodedata="";
		$scope.pay.paymentremarks="";
			modalshow('mdl_present');
		}

		$scope.ngpamodetype=function(e){

		if(e==undefined){
            getpaymode();
		}
		$scope.payment_paymode=e.paymode_gid;
		$scope.payment_paymode_name=e.Paymode_name;
        $scope.approval_payment_alldetails = $filter('filter')($scope.payment_search , {
               "Paymode_name": $scope.payment_paymode_name

        });
		}
		$scope.searchngbank=function(e){

		 if(e == undefined){
        $scope.paysearch.ngbranchw ='';
            }
        if(e.bank_name != undefined && e.bank_name != null && e.bank_name !='' )
        {
        var paytemp2=e.bank_name;
       $scope.paytemp21=e.bank_name;
        }
    else
        {
        var paytemp2='';
        $scope.paytemp21='';
        }

        $scope.paybank = e.bank_gid;

       //
       $scope.bid = e.bank_gid;
       var paymode = {
           "Table_name": "gal_mst_tbankbranch",
           "Column_1": "bankbranch_gid,bankbranch_name",
           "Column_2": "",
           "Where_Common": "bankbranch",
           "Where_Primary": "bank_gid",
           "Primary_Value": $scope.paybank,
           "Order_by": "name"
       }
       var paymodeval = {
           Action: "",
           Entity_Gid: $scope.entity_gid,
           data: paymode
       }
       $scope.partnerpaymodebranch = [];
       var getpymodebranchval = Servicedrctsale.getpaymodebranchdata(paymodeval)
       getpymodebranchval.then(function(result) {
           $scope.partnerpaymodebranch = result.data.DATA;
           //alert(JSON.stringify($scope.partnerpaymodebranch))
       }, function(err) {
           alert('No data!.');
       }).finally();

        $scope.approval_payment_alldetails = $filter('filter')($scope.payment_search , {

               "bank_name": paytemp2 == null || paytemp2 == undefined || paytemp2 == '' ? '' : paytemp2

        });
   }

$scope.paysearch = [];


    function getpaymode() {


        if ($scope.payment_paymode){
            $scope.payname = $scope.payment_paymode;
        } else {
            $scope.payname = '';
        }
        if ($scope.paybank) {
            $scope.paybank = $scope.paybank;
        } else {
            $scope.paybank = '';
        }
        if ($scope.paysearch.ngbranchw) {
            $scope.pay_branch = $scope.paysearch.ngbranchw.bankbranch_gid;
        } else {
            $scope.pay_branch = '';
        }
        if ($scope.paysearch.ngmifsc) {
            $scope.pay_ifsc = $scope.paysearch.ngmifsc;
        }
        else{
        $scope.pay_ifsc = "";
        }
        if ($scope.paysearch.payacctype) {
            $scope.pay_type = $scope.paysearch.payacctype.metadata_value;
        } else {
            $scope.pay_type = '';
        }
        if ($scope.paysearch.accno) {
            $scope.pay_accno = $scope.paysearch.accno;
        } else {
            $scope.pay_accno = '';
        }
        if ($scope.paysearch.beneficiaryname) {
            $scope.pay_beneficiaryname = $scope.paysearch.beneficiaryname;
        } else {
            $scope.pay_beneficiaryname = '';
        }

        var data = {
            "Params": {
                "Filter": {
                    "Paymode_Gid": $scope.payname,
                    "Payment_Partnergid": $scope.partner_gid,
                    "Bank_Gid": $scope.paybank,
                    "Bankbranch_Gid": $scope.pay_branch,
                    "Bankbranch_Ifsccode": $scope.pay_ifsc,
                    "Payment_Acctype": $scope.pay_type,
                    "Payment_Accnumber": $scope.pay_accno,
                    "Payment_Benificiaryname": $scope.pay_beneficiaryname,
                    "Mst_Table": $scope.msttable,
                },
                "Classification": {
                    Entity_Gid: $scope.entity_gid,
                },
                "Group": "ATMAPAYMENTSUMMARY",
                "Action": "Payment_Get",

            }
        }
        var get_data = Servicedrctsale.get_atmapayment(data)
        get_data.then(function(result) {
            $scope.approval_payment_alldetails = result.data.DATA;
            $scope.payment_search=$scope.approval_payment_alldetails
            //console.log($scope.alldetails)
            //alert(JSON.stringify($scope.approval_payment_alldetails))
        })

    }
    $scope.showpaymentview=function(){

    modalshow('approvaltaxpopup');
    }

    $scope.change_payment=function(a){

        if(a.payacctype != undefined && a.payacctype != null && a.payacctype !='' )
        {
        var paytemp4=a.payacctype.metadata_value;
        }
    else
        {
        var paytemp4='';
        }
        if(a.ngpaymode != undefined && a.ngpaymode != null && a.ngpaymode !='' )
        {
        var paytemp1=a.ngpaymode.Paymode_name;
        }
    else
        {
        var paytemp1='';
        }
         if(a.ngbranchw != undefined && a.ngbranchw != null && a.ngbranchw !='' )
        {
        var paytemp3=a.ngbranchw.bankbranch_name;
        }
    else
        {
        var paytemp3='';
        }

        $scope.approval_payment_alldetails = $filter('filter')($scope.payment_search , {
             "bankbranch_ifsccode": a.ngmifsc == null ||  a.ngmifsc == undefined ||  a.ngmifsc == '' ? '' :  a.ngmifsc,
               "payment_accnumber": a.accno == null ||  a.accno == undefined ||  a.accno == '' ? '' :  a.accno,
               "payment_benificiaryname": a.beneficiaryname == null || a.beneficiaryname == undefined || a.beneficiaryname == '' ? '' : a.beneficiaryname ,
               "payment_acctype": paytemp4 == null || paytemp4 == undefined || paytemp4 == '' ? '' : paytemp4 ,
               "Paymode_name": paytemp1 == null || paytemp1 == undefined || paytemp1 == '' ? '' : paytemp1 ,
               "bankbranch_name": paytemp3 == null || paytemp3 == undefined || paytemp3 == '' ? '' : paytemp3 ,
               "bank_name": $scope.paytemp21 == null || $scope.paytemp21 == undefined || $scope.paytemp21 == '' ? '' : $scope.paytemp21 ,
        });
    }

    function bankbranchnames(module) {
        var result = $filter('filter')($scope.branchdetails, {
            'bankbranch_name': module

        });
        return result;
    }
    $scope.ngbank = function(e) {

        if(e == undefined)
        {
       $scope.pay.bankbranch_paymodedata='';
        }
       $scope.bid = e.bank_gid;
       var paymode = {
           "Table_name": "gal_mst_tbankbranch",
           "Column_1": "bankbranch_gid,bankbranch_name",
           "Column_2": "",
           "Where_Common": "bankbranch",
           "Where_Primary": "bank_gid",
           "Primary_Value": $scope.bid,
           "Order_by": "name"
       }
       var paymodeval = {
           Action: "",
           Entity_Gid: $scope.entity_gid,
           data: paymode
       }
       $scope.partnerpaymodebranch = [];
       var getpymodebranchval = Servicedrctsale.getpaymodebranchdata(paymodeval)
       getpymodebranchval.then(function(result) {UPDATE
           $scope.partnerpaymodebranch = result.data.DATA;
           //alert(JSON.stringify($scope.partnerpaymodebranch))
       }, function(err) {
           alert('No data!.');
       }).finally();
   }

   bankbranchgid();
   function bankbranchgid(query) {
       var result = $filter('filter')($scope.partnerpaymodebranch, {
           'bankbranch_name': query
       });
       return result;
   }
   $scope.branch_name = bankbranchgid;

   $scope.payngbank = function(e) {
        //
        $scope.bid = e.bank_gid;
        var data = {
            "Params": {
                "Type": "BranchGet",
                "bank_gid": $scope.bid,
            }
        }
        $scope.branchdetails=[];
        var getbranchdata = Servicedrctsale.getbranchdetails(data)
        getbranchdata.then(function(result) {
            $scope.branchdetails = result.data;
            //alert(JSON.stringify($scope.branchdetails))
        })
    }
 $scope.branchdetails=[];


<!--    paymentaccounttype();-->


$scope.paymodebankacctype= function(searchText) {

             var dat = {
            "Table_name": "gal_mst_tmetadata",
            "Column_1": "metadata_gid,metadata_value",
            "Column_2": "",
            "Where_Common": "metadata",
            "Where_Primary": "columnname",
            "Primary_Value": "payment_acctype",
            "Limits": "0,30",
            "Search_Column": searchText,
            "Order_by": "value"
        }
        var partnergroup = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.partnervendor = [];
            return $http.post(Appname + '/prodget/' , partnergroup).then(function(result) {
            console.log(result.data.DATA);
                return result.data.DATA;
              });
          };



    $scope.payngpamodetype = function(e) {

        $scope.paymode_name=e.Paymode_name;
        $scope.payid = e.paymode_gid
        if(e.Paymode_name=="CHEQUE"){
         $scope.paymode_cheque=false;

         $scope.bid=0;
         $scope.bbranchgid=0;
        }
        else{
        $scope.paymode_cheque=true;
        }
    }

    $scope.payngbranch1 = function(e) {
        $scope.bbranchgid = e.bankbranch_gid
    }
    $scope.addpaymode = function(r) {
    if($scope.paymode_name=="CHEQUE"){
    $scope.acc_paymode=0;
    $scope.pay_acc_num=0;
    }else{
     $scope.acc_paymode=r.acctype_paymodedata.metadata_value;
     $scope.pay_acc_num=r.accnumber_paymodedata;
    }

        var data =
        {
            "Params": {
                    "Filter": {
                    "Payment_Partner_Gid": $scope.partner_gid,
                    "Payment_Paymodegid":$scope.payid,
                    "Payment_Bankgid":$scope.bid,
                    "Payment_Bankbranchgid": $scope.bbranchgid,
                    "Payment_Acctype":$scope.acc_paymode,
                    "Payment_Accnumber":$scope.pay_acc_num,
                    "Payment_Benificiaryname":r.bname_paymodedata,
                    "Payment_Remarks":r.paymentremarks,
                    "Create_By": $scope.create_by
                     },
                     "Classification":{
                    "Entity_Gid": $scope.entity_gid
                     },
            "Group": "PAYMODESUMMARY",
            "Action": "INSERT",
                    }
        }
        var get_data = Servicedrctsale.Paymentaddheader(data)
        get_data.then(function(result) {
        //alert(JSON.stringify(result.data));
            if (result.data == "SUCCESS") {
                alert("Inserted successfully!.");
                getpaymode();
                $scope.pngpaymode = "",
                    $scope.pay.paymode_paymodedata = "",
                    $scope.pay.bank_paymodedata = "",
                    $scope.pay.bankbranch_paymodedata = "",
                    $scope.pay.acctype_paymodedata = "",
                    $scope.pay.accnumber_paymodedata = "",
                    $scope.pay.bname_paymodedata = "",
                    $scope.pay.paymentremarks = "",
                    modalhide('mdl_present');
            } else {
                alert(result.data);
            }

        })

    }

    $scope.closedetail = function() {
        $scope.pngpaymode = "";
        $scope.pngbankw = "";
        $scope.pngbranchw = "";
        $scope.ppayacctype = "";
        $scope.ppayaccno = "";
        $scope.ppaybeneficiaryname = "";
        $scope.ppayremarks = "";
    }

    $rootScope.showview = function(ev) {
        $scope.loading();
        modalshow('atma_paymentview_page')
        $scope.paymodepop = ev.Paymode_name
        $scope.bankpop = ev.bank_name
        $scope.branchpop = ev.bankbranch_name
        $scope.ifscpop = ev.bankbranch_ifsccode
        $scope.acctpop = ev.payment_acctype
        $scope.accnpop = ev.payment_accnumber
        $scope.benipop = ev.payment_benificiaryname
        $scope.endloading();
    }
$scope.addpay = true;
$scope.pay=[];
    $scope.paymentedit_show=function(payment){

    if(payment.Paymode_name=="CHEQUE"){
    $scope.paymode_cheque=false;

   }
    $scope.payeditid=payment.payment_gid,
    $scope.pay.paymode_paymodedata=payment.Paymode_name,
    $scope.pay.bank_paymodedata=payment.bank_name,
    $scope.pay.bankbranch_paymodedata=payment.bankbranch_name,
    $scope.pay.acctype_paymodedata=payment.payment_acctype,
    $scope.pay.accnumber_paymodedata=payment.payment_accnumber,
    $scope.pay.bname_paymodedata=payment.payment_benificiaryname,
    $scope.pay.paymentremarks=payment.payment_remarks,
    modalshow('mdl_present')
    $scope.addpay = false;
    $scope.editpay = true;
    $scope.inactivepay = true;
    var data =
        {
            "Params": {
                    "Filter": {
                    "Payment_Gid": payment.main_payment_gid,
                    "Payment_Partnergid": $scope.partner_gid,
                    "Mst_Table":"Mst"

                     },
                     "Classification":{
                    "Entity_Gid": $scope.entity_gid
                     },
            "Group": "ATMAPAYMENTSUMMARY",
            "Action": "Payment_Get",
                    }
        }

   var get_data = Servicedrctsale.get_atmapayment(data)
        get_data.then(function(result) {
            $scope.approval_mst_payment_alldetails = result.data.DATA[0];
            $scope.payment_search=$scope.approval_payment_alldetails
            //console.log($scope.alldetails)
            //alert(JSON.stringify($scope.approval_mst_payment_alldetails))
        })
    }
    $scope.updatepaymode=function(e){

    var data =
        {
            "Params": {
                    "Filter": {
                    "Payment_Gid": $scope.payeditid,
                    "Payment_Partner_Gid": $scope.partner_gid,
                    "Payment_Paymodegid": $scope.payid,
                    "Payment_Bankgid": $scope.bid,
                    "Payment_Bankbranchgid": $scope.bbranchgid,
                    "Payment_Acctype":e.acctype_paymodedata.metadata_value,
                    "Payment_Accnumber": $scope.pay.accnumber_paymodedata,
                    "Payment_Benificiaryname": $scope.pay.bname_paymodedata,
                    "Payment_Remarks": $scope.pay.paymentremarks,

                     },
                     "Classification":{
                    "Entity_Gid": $scope.entity_gid
                     },
            "Group": "UPDATEPAYMODESUMMARY",
            "Action": "UPDATE",
                    }
        }
        var get_data = Servicedrctsale.Paymentaddheader(data)
        get_data.then(function(result) {

            if (result.data == "SUCCESS") {
                alert("SUCCESSFULLY UPDATED!.");
                getpaymode();
                    modalhide('mdl_present');
            } else {
                alert("Data not Update")
            }
        })
    }

<!--        $scope.change_payment=function(a){-->

<!--        if(a.payacctype != undefined && a.payacctype != null && a.payacctype !='' )-->
<!--        {-->
<!--        var paytemp4=a.payacctype.metadata_value;-->
<!--        }-->
<!--    else-->
<!--        {-->
<!--        var paytemp4='';-->
<!--        }-->
<!--        if(a.ngbranchw != undefined && a.ngbranchw != null && a.ngbranchw !='' )-->
<!--        {-->
<!--        var paytemp3=a.ngbranchw.bankbranch_name;-->
<!--        }-->
<!--    else-->
<!--        {-->
<!--        var paytemp3='';-->
<!--        }-->
<!--        if(a.Paymode_name != undefined && a.Paymode_name != null && a.Paymode_name !='' )-->
<!--        {-->
<!--        var paytemp1=a.Paymode_name.Paymode_name;-->
<!--        }-->
<!--    else-->
<!--        {-->
<!--        var paytemp1='';-->
<!--        }-->
<!--        $scope.payment_alldetails = $filter('filter')($scope.payment_search , {-->
<!--               "bankbranch_ifsccode": a.ngmifsc == null ||  a.ngmifsc == undefined ||  a.ngmifsc == '' ? '' :  a.ngmifsc,-->
<!--               "payment_accnumber": a.accno == null ||  a.accno == undefined ||  a.accno == '' ? '' :  a.accno,-->
<!--               "payment_benificiaryname": a.beneficiaryname == null || a.beneficiaryname == undefined || a.beneficiaryname == '' ? '' : a.beneficiaryname ,-->
<!--               "Paymode_name": paytemp1 == null || paytemp1 == undefined || paytemp1 == '' ? '' : paytemp1 ,-->
<!--               "bankbranch_name": paytemp3 == null || paytemp3 == undefined || paytemp3 == '' ? '' : paytemp3 ,-->
<!--               "payment_acctype": paytemp4 == null || paytemp4 == undefined || paytemp4 == '' ? '' : paytemp4 ,-->
<!--               "bank_name": $scope.paytemp21 == null || $scope.paytemp21 == undefined || $scope.paytemp21 == '' ? '' : $scope.paytemp21 ,-->

<!--        });-->
<!--    }-->
    //PAYMENTEND

    //ATTACHMENTSTART


    $scope.dd_DocumentGroup= function(searchText) {

             var dat = {
            "Table_name": "atma_mst_tdocgroup",
            "Column_1": "docgroup_gid,docgroup_name",
            "Column_2": "",
            "Where_Common": "docgroup",
            "Where_Primary": "isparent",
            "Primary_Value": "Y",
            "Limits": "0,30",
            "Search_Column": searchText,
            "Order_by": "name"
        }
        var partnergroup = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.partnervendor = [];
            return $http.post(Appname + '/prodget/' , partnergroup).then(function(result) {
            console.log(result.data.DATA);
                return result.data.DATA;
              });
          };




    function gotodocname1(query) {
        var result = $filter('filter')($scope.docname, {
            'docgroup_name': query
        });
        return result;
    }

    $scope.ngdocgrop = function(e)
    {

    if(e != undefined && e != null && e !='' )
        {
        var attachtemp=e.docgroup_name;
        $scope.atachs=e.docgroup_name;
        }
    else
        {
        var attachtemp='';
        $scope.atachs='';
        }
        $scope.dgid = e.docgroup_gid;
        var dat = {
            "Table_name": "atma_mst_tdocgroup",
            "Column_1": "docgroup_gid,docgroup_name,docgroup_parentgid",
            "Column_2": "",
            "Where_Common": "docgroup",
            "Where_Primary": "parentgid",
            "Primary_Value": $scope.dgid,
            "Order_by": "name"
        }
        var pdocname = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.docname = [];
        var getdocname = Servicedrctsale.getdocnamedata(pdocname)
        getdocname.then(function(result) {
            $scope.docname = result.data.DATA;
            //alert(JSON.stringify($scope.docname))
        }, function(err) {
            alert('No data!.');
        }).finally();

         $scope.getattachmentsummary=$filter('filter')($scope.searchgetattachmentsummary,{
    "docgroup_name":  attachtemp == null || attachtemp == undefined || attachtemp == '' ? '' : attachtemp ,
    "Document_Name":  $scope.attachtemp121 == null || $scope.attachtemp121 == undefined || $scope.attachtemp121 == '' ? '' : $scope.attachtemp121 ,

    })
    }
     $scope.docname = [];

    function reconname_attachment(item) {
        var fileExtension = '.' + item.split('.').pop();
        $scope.recon_name = "ATTACH_" + new Date().getTime() + fileExtension;
    };

    $scope.Attachmentsave = function(Attachment)
    {

        if ($scope.Attachment.file == undefined) {
            alert("Fill the File field!.");
            return false;
        }
        $scope.attachmentfilename = $scope.Attachment.file.name;
        if ($scope.Attachment.selectedItem_documentname) {
            $scope.DocumentGid = $scope.Attachment.selectedItem_documentname.docgroup_gid;
        } else {
            $scope.DocumentGid = '';
        }
        if ($scope.Attachment.file !== undefined) {
            var excl = new FormData();
            reconname_attachment($scope.attachmentfilename);
            excl.append('file', $scope.Attachment.file);
            excl.append('name', $scope.recon_name);
            excl.append('Group', 'Document_Group');
            excl.append('Action','Insert');
            excl.append('Type', 'Document_Group');
            excl.append('Documents_Partnergid', $scope.partner_gid);
            excl.append('Documents_Docgroupgid', $scope.DocumentGid);
            excl.append('Documents_Period', 'one time');
            excl.append('Description', $scope.Attachment.description);
            excl.append('File_Name', $scope.recon_name);
            excl.append('File_Path', "home/bala");
            excl.append('Entity_Gid', $scope.entity_gid);
            excl.append('Create_By', $scope.create_by);
            loadexclAttacment(excl);
        }
    }
    function loadexclAttacment(excl)
    {

        $scope.loading();
        var overalldtl = Servicedrctsale.setdocgrp(excl);
        overalldtl.then(function(res) {
            var hosmr = [];
            $scope.hosmr = res.data.MESSAGE;
            alert("File Saved Successfully!.");
            fn_getattachmentsummary();
        }).finally($scope.endloading);
    }
   $scope.Search_in_Attachment = function()
    {
        fn_getattachmentsummary();
    }



   function fn_getattachmentsummary()
   {


        if ($scope.Attachment.selectedItem_documentgroup) {
            $scope.DocgroupGid = $scope.Attachment.selectedItem_documentgroup.docgroup_gid;
        } else {
            $scope.DocgroupGid = '';
        }

        if ($scope.Attachment.selectedItem_documentname) {
            $scope.DocumentGid = $scope.Attachment.selectedItem_documentname.docgroup_gid;
        } else {
            $scope.DocumentGid = '';
        }

        var data = {
            "Params": {
                "Filter":   {

                    "Documents_Partnergid": $scope.partner_gid,
                    "Mst_Table": $scope.msttable,

                            },
                "Classification":   {
                    "Entity_Gid": $scope.entity_gid
                                    }
                    }
                    }
        var dtam = {
            Group: 'Document_Group',
            Type: 'Document_Get',
            data: data
        }

        var getattachmentsummary1 = Servicedrctsale.get_attachmentsummary(dtam)
        getattachmentsummary1.then(function(result)
        {
           $scope.getattachmentsummary = result.data.DATA;
           $scope.searchgetattachmentsummary =$scope.getattachmentsummary;
        }, function(err)
        {
           alert('No data!.');
        }).finally();
   }

   $scope.searchdocumentname=function(e){

if(e != undefined && e != null && e !='' )
        {
        var attachtemp1=e.docgroup_name;
        $scope.attachtemp121=e.docgroup_name;
        }
    else
        {
        var attachtemp1='';
         $scope.attachtemp121='';
        }
 $scope.getattachmentsummary=$filter('filter')($scope.searchgetattachmentsummary,{
    "Document_Name":  attachtemp1 == null || attachtemp1 == undefined || attachtemp1 == '' ? '' : attachtemp1 ,
    "docgroup_name":  $scope.atachs == null || $scope.atachs == undefined || $scope.atachs == '' ? '' : $scope.atachs ,

    })

}

   $scope.viewtadetails_nameclick=function(e){

   $scope.images=e.file_path

   }
   $scope.attachmentapproval_viewpage=function(e){

   modalshow('attachmentapproval_viewpopup');
    $scope.docgid=e.documents_gid,
        $scope.attachfile=false;
        $scope.Attachment.docgroup_name=e.docgroup_name,
        $scope.Attachment.Document_Name=e.Document_Name,
        $scope.Attachment.file_name=e.file_name,
        $scope.Attachment.documents_remarks=e.documents_remarks,
        $scope.documnet_filepath=e.file_path

   }

   //attachment edit
    $scope.edit_attachment=function(e)
    {

        $scope.docgid=e.documents_gid
        $scope.attachfile=false;
        $scope.Attachment.docgroup_name=e.docgroup_name,
        $scope.Attachment.Document_Name=e.Document_Name,
        $scope.Attachment.file_name=e.file_name,
        $scope.Attachment.documents_remarks=e.documents_remarks
    }
    $scope.attachfileupdate=function(){
        $scope.attachfile=true;
    }
    $scope.updateattachment=function(){

        if ($scope.Attachment.fileEdit !== undefined) {
            $scope.attachmentfilename = $scope.Attachment.fileEdit.name;
            var excl = new FormData();
            reconname_attachment($scope.attachmentfilename);
            excl.append('file', $scope.Attachment.fileEdit);
            excl.append('name', $scope.recon_name);
            excl.append('Group', 'Document_Update');
            excl.append('Action','UPDATE');
            excl.append('Type', 'Document_Group');
            excl.append('Documents_Gid',$scope.docgid );
            excl.append('Documents_Docgroupgid', $scope.DocumentGid);
            excl.append('Documents_Period', 'one time');
            excl.append('Description', $scope.Attachment.documents_remarks);
            excl.append('File_Name', $scope.recon_name);
            excl.append('File_Path', "home/bala");
            Attachment_Update(excl);
        }else{
                var excl = new FormData();
                $scope.attachmentfilename=$scope.Attachment.file_name;
                reconname_attachment($scope.attachmentfilename);
                excl.append('file','');
                excl.append('name', '');
                excl.append('Group', 'Document_Updatenofile');
                excl.append('Action','UPDATE');
                excl.append('Type', 'Document_Group');
                excl.append('Documents_Gid',$scope.docgid );
                excl.append('Documents_Docgroupgid', $scope.DocumentGid);
                excl.append('Documents_Period', 'one time');
                excl.append('Description', $scope.Attachment.documents_remarks);
                excl.append('File_Name', $scope.recon_name);
                excl.append('File_Path', "home/bala");
                Attachment_Update(excl);
        }
    }

	function Attachment_Update(excl) {

			$scope.loading();
			var overalldtl = Servicedrctsale.updateattachmentdetails(excl);
			overalldtl.then(function(res) {
				var hosmr = [];
				$scope.hosmr = res.data;
				alert(JSON.stringify( $scope.hosmr));
				if ($scope.hosmr == "SUCCESSFULLY UPDATED") {
					alert("SUCCESSFULLY UPDATED!.");

					fn_getattachmentsummary();
                      modelhide('myModal')

				} else {
					alert($scope.hosmr);

				}
			}).finally($scope.endloading);
		}
	//ATTACHMENTEND

//TAXSTART

    $scope.change_tax=function(e){

        if(e.ngsstaxtype != undefined && e.ngsstaxtype != null && e.ngsstaxtype !='' )
        {
        var temp= e.ngsstaxtype.tax_type;
        }
        else
        {
        var temp='';
        }
        $scope.get_tax_details = $filter('filter')($scope.searchtaxdetails , {
               "taxdetails_taxno": e.ngmptaxno == null || e.ngmptaxno == undefined || e.ngmptaxno == '' ? '' : e.ngmptaxno ,
               "tax_type": temp == null ||  temp == undefined  || temp == '' ? '' : temp
        });
}


    $scope.updatetaxdetailsmode=function(e){

    $scope.ad=$scope.add_tax.fdate;
    $scope.ads=$scope.add_tax.tdate;
    $scope.updatetax_fromdate = formatStringDate($scope.ad, 'yyyy-mm-dd');
    $scope.updatetax_todate = formatStringDate($scope.ads, 'yyyy-mm-dd');
    if($scope.add_tax.ngisexcem.metadata_value){
        $scope.isexcem=$scope.add_tax.ngisexcem.metadata_value
    }else{
        $scope.isexcem=$scope.add_tax.ngisexcem
    }
    if($scope.hg == undefined){
        $scope.add_tax.ngpsMSME="";
    }
   if($scope.add_tax.ngpsMSME.metadata_value){
        $scope.add_tax.ngpsMSME = $scope.add_tax.ngpsMSME.metadata_value
   }
   else{
        $scope.add_tax.ngpsMSME = $scope.add_tax.ngpsMSME
   }
   if( $scope.trgid){
        $scope.ngistaxrategid=$scope.trgid;
   }else{
        $scope.ngistaxrategid=$scope.add_tax.ngistaxrategid;
   }
   if(  $scope.trat){
        $scope.ngistaxrate=  $scope.trat;
   }else{
        $scope.ngistaxrate=$scope.add_tax.ngistaxrate;
   }
   if( $scope.tgd){
        $scope.tax_gids= $scope.tgd;
    }else{
        $scope.tax_gids= $scope.tax_gid;
    }
  if( $scope.isexcem=="NO"){
        var excl = new FormData();
            $scope.name="";
            reconname($scope.name);
            excl.append('file',$scope.add_tax.file);
            excl.append('name', '');
            excl.append('Group', 'TAXINSERTSUMMARYEXEMPTEDUPDATENO');
            excl.append('Action','TAX_UPDATE');
            excl.append('Tax_Gid',     $scope.tax_gids);
            excl.append('TaxDetails_Gid',$scope.add_tax.taxgid);
            excl.append('TaxDetails_Partner_Gid',$scope.partner_gid);
            excl.append('TaxDetails_Partner_Code',$scope.Partner.partnercode);
            excl.append('TaxDetails_Partner_Type','S');
            excl.append('TaxDetails_Is_MSME', $scope.add_tax.ngpsMSME);
            excl.append('TaxDetails_TaxNo', $scope.add_tax.ngmtaxno);
            excl.append('TaxSubDetails_TaxRate_Gid', $scope.ngistaxrategid);
            excl.append('TaxSubDetails_TaxRate',$scope.ngistaxrate);
            excl.append('TaxSubDetails_IsExcempted', $scope.idsd);
            excl.append('TaxSubDetails_ExcemFrom',  $scope.updatetax_fromdate);
            excl.append('TaxSubDetails_ExcemTo', $scope.updatetax_todate);
            excl.append('TaxSubDetails_ExcemthroSold', $scope.add_tax.ngthrosold);
            excl.append('TaxSubDetails_ExcemRate', "");
            excl.append('FileName', "");
            excl.append('Create_By', $scope.create_by);
            loadexcl_updatetax(excl);
  }
if( $scope.isexcem=="YES"){
        if ($scope.add_tax.file !== undefined) {
            $scope.name = $scope.add_tax.file.name;
            var excl = new FormData();
            reconname($scope.name);
            excl.append('file',$scope.add_tax.file);
            excl.append('name', $scope.recon_name);
            excl.append('Group', 'TAXINSERTSUMMARYEXEMPTEDUPDATEYES');
            excl.append('Action','TAX_UPDATE');
            excl.append('TaxDetails_Gid',$scope.add_tax.taxgid);
            excl.append('TaxDetails_Partner_Gid',$scope.partner_gid);
            excl.append('TaxDetails_Partner_Code',$scope.Partner.partnercode);
            excl.append('TaxDetails_Partner_Type','S');
            excl.append('TaxDetails_Is_MSME', $scope.add_tax.ngpsMSME);
            excl.append('Tax_Gid',$scope.tax_gids);
            excl.append('TaxDetails_TaxNo', $scope.add_tax.ngmtaxno);
            excl.append('TaxSubDetails_TaxRate_Gid', $scope.ngistaxrategid);
            excl.append('TaxSubDetails_TaxRate', $scope.ngistaxrate);
            excl.append('TaxSubDetails_IsExcempted', $scope.idsd);
            excl.append('TaxSubDetails_ExcemFrom', $scope.updatetax_fromdate);
            excl.append('TaxSubDetails_ExcemTo',  $scope.updatetax_todate);
            excl.append('TaxSubDetails_ExcemthroSold',$scope.add_tax.ngthrosold);
            excl.append('TaxSubDetails_ExcemRate',  $scope.add_tax.ngmtaxExempted);
            excl.append('File_Name', $scope.recon_name);
            excl.append('Create_By', $scope.create_by);
            loadexcl_updatetax(excl);
        }
        else
        {
            var excl = new FormData();
            $scope.name="";
            reconname($scope.name);
            excl.append('Group', 'TAXINSERTSUMMARYEXEMPTEDUPDATEYESNOFILE');
            excl.append('Action','TAX_UPDATE');
            excl.append('TaxDetails_Gid',$scope.add_tax.taxgid);
            excl.append('TaxDetails_Partner_Gid',$scope.partner_gid);
            excl.append('TaxDetails_Partner_Code',$scope.Partner.partnercode);
            excl.append('TaxDetails_Partner_Type','S');
            excl.append('name', $scope.recon_name);
            excl.append('TaxDetails_Is_MSME', $scope.add_tax.ngpsMSME);
            excl.append('Tax_Gid',$scope.tax_gids);
            excl.append('TaxDetails_TaxNo', $scope.add_tax.ngmtaxno);
            excl.append('TaxSubDetails_TaxRate_Gid', $scope.ngistaxrategid);
            excl.append('TaxSubDetails_TaxRate',$scope.ngistaxrate);
            excl.append('TaxSubDetails_IsExcempted', $scope.idsd);
            excl.append('TaxSubDetails_ExcemFrom', $scope.updatetax_fromdate);
            excl.append('TaxSubDetails_ExcemTo',  $scope.updatetax_todate);
            excl.append('TaxSubDetails_ExcemthroSold',$scope.add_tax.ngthrosold);
            excl.append('TaxSubDetails_ExcemRate',  $scope.add_tax.ngmtaxExempted);
            excl.append('File_Name',e.tax_filename);
            excl.append('FilePath',   $scope.add_tax.file_path);
            excl.append('Create_By', $scope.create_by);
            loadexcl_updatetax(excl);
        }
}
}
    function loadexcl_updatetax(excl) {
        var tax_update = Servicedrctsale.taxupdate_details(excl);
        tax_update.then(function(res) {
            var hosmr = [];
            $scope.hosmr = res.data;
            alert(JSON.stringify($scope.hosmr));
            if($scope.hosmr == "SUCCESS"){
                    alert("SUCCESSFULLY UPDATED!")
                modalhide('taxdetailsmodal');
                gettaxdetails();
            }else {
                alert(JSON.stringify($scope.hosmr));
            }
        })
    }

<!--    function gottaxdetails(query) {-->
<!--        var result = $filter('filter')($scope.tax, {-->
<!--            'tax_type': query-->
<!--        });-->
<!--        return result;-->
<!--    }-->

      function gottaxratedetails(query) {
        var result = $filter('filter')($scope.taxrate, {
            'taxrate_rate': query
        });
        return result;
    }

    $scope.addtaxpagepopup=function(){
    modalshow('taxdetailspopupid');
    }


    $scope.gottaxdetails = function(query){
        var data = {
            "Params": {
                "Group": "GETTAXTYPE",
                "Action": "TaxType_Get",
            }
        }
    return $http.post(Appname + '/atma_gettaxdetails/' , data).then(function(result) {
          console.log(result.data.DATA);
              return result.data.DATA;
            });
          }


    $scope.ngctaxtype=function(e)
    {

        $scope.tgd=e.tax_type_gid
        var a=e.tax_type_gid.split('-').pop();
        var dat = {
            "Table_name": "gal_mst_ttaxrate",
            "Column_1": "taxrate_gid,taxrate_rate,taxrate_subtax_gid",
            "Column_2": "",
            "Where_Common": "taxrate",
            "Where_Primary": "subtax_gid",
            "Primary_Value": a,
            "Order_by": "gid"
        }
        var ppartnertaxrate = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.taxrate=[];
        var getpartnertaxrate = Servicedrctsale.gettaxreateedata(ppartnertaxrate)
        getpartnertaxrate.then(function (result) {

            $scope.taxrate = (result.data.DATA);

            alert(JSON.stringify( $scope.taxrate))
        },
        function (err) {
            alert('No data!.');
        }).finally();
    }

    function gotisexcempted(query){
    var result=$filter('filter')($scope.metaisexcempted,{
    'metadata_value':query
    });
    return result;
    }



    function isexcempted(){
        var dat = {
            "Table_name": "gal_mst_tmetadata",
            "Column_1": "metadata_value",
            "Column_2": "",
            "Where_Common": "metadata",
            "Where_Primary": "columnname",
            "Primary_Value": "taxsubdetails_isexcempted",
            "Order_by": "value"
        }
        var ppartnerisexcempted = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.metaisexcempted=[];
        var getpartnerisexcempted = Servicedrctsale.getisexcempteddata(ppartnerisexcempted)
        getpartnerisexcempted.then(function (result) {

            $scope. metaisexcempted= result.data.DATA;
            //alert(JSON.stringify( $scope.metaisexcempted))
        },
        function (err) {
            alert('No data!.');
        }).finally();
    }

    taxdisabled();

    function taxdisabled(){

    }
    $scope.ngcMSME=function(e){

    $scope.hg=e;
    $scope.ngpsMSME=e.metadata_value;

    }

    if($scope.ones=="YES"){
    $scope.taxexce=true;
    }

    $scope.ngcngtaxrate=function(e){

    $scope.trgid=e.taxrate_gid
    $scope.trat=e.taxrate_rate

    }

function reconname(item) {
        var fileExtension = '.' + item.split('.').pop();
        $scope.recon_name = "TDS-TAXDETAILS" + new Date().getTime();
    };

    $scope.addtaxdetailsmode=function(e){

        if ($scope.add_tax.fdate) {
            $scope.fromdate = formatStringDate($scope.add_tax.fdate, 'yyyy-mm-dd');
        }
        else {
            $scope.fromdate = '';
        }
        if ($scope.add_tax.tdate) {
            $scope.todate = formatStringDate($scope.add_tax.tdate, 'yyyy-mm-dd');
        }
        else {
            $scope.todate = '';
        }
        if ($scope.add_tax.ngthrosold) {
            $scope.throsold = $scope.add_tax.ngthrosold;
        }
        else {
            $scope.throsold = '';
        }
        if ($scope.add_tax.ngmtaxExempted) {
            $scope.taxExempted = $scope.add_tax.ngmtaxExempted;
        }
        else {
            $scope.taxExempted = '';
        }

        if($scope.idsd=="Y"){

        if ($scope.add_tax.file == undefined) {
            alert("Fill the tax File field!.");
            return false;
        }

        $scope.name = $scope.add_tax.file.name;

        if ($scope.file !== undefined) {
            var excl = new FormData();
            reconname($scope.name);
            excl.append('file',$scope.add_tax.file);
            excl.append('name', $scope.recon_name);
            excl.append('Group', 'TAXINSERTSUMMARYEXEMPTEDYES');
            excl.append('Action','TAX_INSERT');
            excl.append('Tax_Gid', $scope.tgd);
            excl.append('TaxDetails_Partner_Gid',$scope.partner_gid);
            excl.append('TaxDetails_Partner_Code',$scope.Partner.partnercode);
            excl.append('TaxDetails_Partner_Type','S');
            excl.append('TaxDetails_TaxNo', $scope.add_tax.ngmtaxno);
            excl.append('TaxDetails_Is_MSME',  $scope.ngpsMSME);
            excl.append('TaxSubDetails_TaxRate_Gid', $scope.trgid);
            excl.append('TaxSubDetails_TaxRate', $scope.trat);
            excl.append('TaxSubDetails_IsExcempted', $scope.idsd);
            excl.append('TaxSubDetails_ExcemFrom', $scope.fromdate);
            excl.append('TaxSubDetails_ExcemTo', $scope.todate);
            excl.append('TaxSubDetails_ExcemthroSold', $scope.throsold);
            excl.append('TaxSubDetails_ExcemRate', $scope.taxExempted);
            excl.append('FileName', $scope.recon_name);
            excl.append('Create_By', $scope.create_by);
            loadexclTax(excl);
        }}else{
            var excl = new FormData();
            $scope.name="";
            reconname($scope.name);
            excl.append('file','');
            excl.append('name', '');
            excl.append('Group', 'TAXINSERTSUMMARYEXEMPTEDNO');
            excl.append('Action','TAX_INSERT');
            excl.append('Tax_Gid', $scope.tgd);
            excl.append('TaxDetails_Partner_Gid',$scope.partner_gid);
            excl.append('TaxDetails_Partner_Code',$scope.Partner.partnercode);
            excl.append('TaxDetails_Partner_Type','S');
            excl.append('TaxDetails_TaxNo', $scope.add_tax.ngmtaxno);
            excl.append('TaxSubDetails_TaxRate_Gid', $scope.trgid);
            excl.append('TaxDetails_Is_MSME',  $scope.ngpsMSME);
            excl.append('TaxSubDetails_TaxRate', $scope.trat);
            excl.append('TaxSubDetails_IsExcempted', $scope.idsd);
            excl.append('TaxSubDetails_ExcemFrom',$scope.fromdate);
            excl.append('TaxSubDetails_ExcemTo', $scope.todate);
            excl.append('TaxSubDetails_ExcemthroSold', $scope.throsold);
            excl.append('TaxSubDetails_ExcemRate',$scope.taxExempted);
            excl.append('FileName', "");
            excl.append('Create_By', $scope.create_by);
            loadexclTax(excl);

        }
     }
     $scope.gottaxmsmedetails= function(searchText) {

             var dat = {
            "Table_name": "gal_mst_tmetadata",
            "Column_1": "metadata_gid,metadata_value",
            "Column_2": "",
            "Where_Common": "metadata",
            "Where_Primary": "columnname",
            "Primary_Value": "taxdetails_ismsme",
            "Limits": "0,30",
            "Search_Column": searchText,
            "Order_by": "value"
        }
        var partnergroup = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.partnervendor = [];
            return $http.post(Appname + '/prodget/' , partnergroup).then(function(result) {
            console.log(result.data.DATA);
                return result.data.DATA;
              });
          };


function loadexclTax(excl) {

        $scope.loading();

        var overalldtl = Servicedrctsale.taxinsert(excl);
        overalldtl.then(function(res) {
            var hosmr = [];
            $scope.hosmr = res.data;

            if ($scope.hosmr == "SUCCESSFULLY INSERTED") {
                alert("SUCCESSFULLY INSERTED!")
                $scope.add_tax.ngpsMSME='',
                $scope.add_tax.ngstaxtype='',
                $scope.add_tax.ngmtaxno='',
                $scope.add_tax.ngistaxrate='',
                $scope.add_tax.ngisexcem='',
                $scope.add_tax.fdate='',
                $scope.add_tax.tdate='',
                $scope.add_tax.ngmtaxExempted='',
                $scope.add_tax.ngthrosold='',
                $scope.file=''
                modalhide('taxdetailsmodal');
                gettaxdetails();

            } else {
                alert(JSON.stringify($scope.hosmr));

            }
        }).finally($scope.endloading);
    }
$scope.show_taxdetails=function(e){
   //alert(JSON.stringify($scope.showform));
   $scope.tax_gid=e.taxdetails_tax_gid +' '+ '-'+' '+e.taxdetails_subtax_gid;
   $scope.addtax=false;
   $scope.taxupdate=false;
   $scope.tdsview=e.tax_type.split("-");
   $scope.tdsview1=$scope.tdsview[0];
   if(e.taxsubdetails_isexcempted=="NO" && $scope.tdsview1=="TDS " ){
    $scope.tax_show_data=true;
    }
    else{
    $scope.tax_show_data=false;
    }
   if(e.taxsubdetails_isexcempted=="YES"){
   $scope.showform = true;
   $scope.tax_show_data=true;
   $scope.idsd="Y"
   }
   else{
   $scope.idsd="N";
   $scope.showform = false;
   //$scope.tax_show_data = false;
   }
   $scope.add_tax.taxgid=e.taxdetails_gid;
    $scope.add_tax.branch=e.partnerbranch_name,
   $scope.add_tax.ngpsMSME=e.taxdetails_ismsme;
   $scope.add_tax.ngstaxtype=e.tax_type;
   $scope.add_tax.file_path=e.file_path;
   $scope.add_tax.tax_filename=e.file_name;
   $scope.add_tax.ngmtaxno=e.taxdetails_taxno;
   $scope.add_tax.ngistaxrate=e.taxsubdetails_taxrate;
   $scope.add_tax.ngistaxrategid=e.taxsubdetails_taxrate_gid;
   $scope.add_tax.ngisexcem=e.taxsubdetails_isexcempted;
   if (e.taxsubdetails_excemfrom==null)  {
                $scope.add_tax.fdate=null;
            }else
            {
                $scope.add_tax.fdate=new Date(e.taxsubdetails_excemfrom);
            }
   if (e.taxsubdetails_excemto==null)  {
                $scope.add_tax.tdate=null;
            }else
            {
                $scope.add_tax.tdate=new Date(e.taxsubdetails_excemto);
            }
   //$scope.add_tax.fdate=new Date(e.taxsubdetails_excemfrom);
   //$scope.add_tax.tdate=new Date(e.taxsubdetails_excemto);
   $scope.add_tax.ngmtaxExempted=e.taxsubdetails_excemrate;
   $scope.add_tax.ngthrosold=e.taxsubdetails_excemthrosold;
   $scope.file=e.taxsubdetails_isexcempted;
   modalshow('taxdetailsmodal');
   }
$scope.add_tax=[];
$scope.TaxsearchDetails=function(d){

    $scope.as=$scope.add_tax.ngmptaxno;
    gettaxdetails();
}

   //$scope.shwpdfs = false;
   $scope.show_tax_pdfview = function(d){

    modalshow('tax_viewpdfpopup');
   //$scope.shwpdfs = true;
   $scope.pdfurls = d.file_path;
   $scope.pdf_filenames = d.file_name;

   }

      $scope.showattachment = function(e){

    modalshow('viewpdfpopup');
   $scope.shwpdf = true;
   $scope.pdfurl = e.file_path;
   $scope.pdf_filename = e.file_name;

   }



function gettaxdetails()
    {

        if ($scope.add_tax.ngsstaxtype) {
            $scope.ttaxid = $scope.add_tax.ngsstaxtype.tax_type_gid;
        }
        else {
            $scope.ttaxid = '';
        }
        if ($scope.add_tax.ngmptaxno) {
            $scope.ttaxno = $scope.add_tax.ngmptaxno;
        }
        else {
             $scope.ttaxno = '';
        }

        var data = {
            "Params": {
                "Filter":{
                "Tax_Gid":$scope.ttaxid,
                "TaxDetails_TaxNo":$scope.ttaxno,
                "TaxDetails_Partner_gid":($scope.partner_gid).toString(),
                "TaxDetails_Partner_Code":$scope.Partner.partnercode,
                "Mst_Table": $scope.msttable,
                },
                "Classification": {
                "Entity_Gid":$scope.entity_gid
                },
                "Group": "ATMATAXSUMMARY",
                "Action": "Tax_Details_Get",

            }
        }
        var get_data = Servicedrctsale.get_atmataxdetails(data)
        get_data.then(function(result) {
            $scope.get_tax_details=result.data.DATA;
            $scope.searchtaxdetails= $scope.get_tax_details;
            //console.log($scope.alldetails)
            //alert(JSON.stringify($scope.alldetails))
        })

    }


    $rootScope.showvtaxdetails = function(ev) {
    $scope.loading();

    modalshow('atma_taxview_page');
    $scope.paymodepop=ev.taxdetails_ismsme
    $scope.bankpop=ev.tax_type
    $scope.branchpop=ev.taxdetails_taxno
    $scope.ifscpop=ev.taxsubdetails_taxrate
    $scope.acctpop=ev.taxsubdetails_isexcempted

    $scope.endloading();

    }

    //TAXEND

    //ACTIVITYSTART

$scope.search_activity=function(a){

if(a.Searchselectedemp != undefined && a.Searchselectedemp != null && a.Searchselectedemp !='' )
        {
        var activitytemp=a.Searchselectedemp.employee_name;
        }
    else
        {
        var activitytemp='';
        }
        $scope.getActivitySummary = $filter('filter')($scope.searchActivitySummary , {
               "employee_name": activitytemp == null || activitytemp == undefined || activitytemp == '' ? '' : activitytemp,
                "activity_name": a.Search_activityname == null ||  a.Search_activityname == undefined ||  a.Search_activityname == '' ? '' :  a.Search_activityname,

        });

}


    $scope.activitydetailshref=function(e){

        var atmaactivity =
        {
            partnerdata: e,
            view: "dfg"
        };
    sessionStorage.setItem('activity_details_gid', JSON.stringify(atmaactivity));
    $window.location.href="atma_Approval_ActivityDetails_Summary";
    //alert(e);
    }

    $scope.gotoactivity = gotoactivity;
    $scope.showpopup_Activity = function() {
    $scope.addactivityButton = true;
    $scope.editactivityButton = false;

        $scope.Activityadd.actgid="";
        $scope.Activityadd.activitycode="";
        $scope.Activityadd.activitytype="";
        $scope.Activityadd.activityname="";
        $scope.Activityadd.description="";
        $scope.Activityadd.activitystartdate="";
        $scope.Activityadd.activityenddate="";
        $scope.Activityadd.projectedcontract="";
        $scope.Activityadd.actrm="";
        $scope.Activityadd.fidelityinsurance="";
        $scope.Activityadd.bidding="";
        $scope.Activityadd.reason="";
        $scope.Activityadd.ngactgrp="";
        $scope.add.prsnname="";
        $scope.add.dsgntn="";
        $scope.add.lndlne="";
        $scope.add.lndlne2="";
        $scope.add.mobno="";
        $scope.add.mobno2="";
        $scope.add.mailid="";
        $scope.add.dobb="";
        $scope.add.weddy="";
        $scope.add.cntcttype="";
       modalshow('Activity_showpopup');
   }


    function gotoactivity(query) {
        var result = $filter('filter')($scope.act, {
            'metadata_value': query
        });
        return result;
    }

    var custgrpddl = Servicedrctsale.getcustgrp()
        custgrpddl.then(function(result) {
        //
                $scope.conttype = [];
                $scope.conttype = JSON.parse(result.data);
            }),
            function() {
                alert('No data!.');
            };
    function loaddata1() {
           $scope.designationdetails == [];
           var rolegrouplist = Servicedrctsale.getdesg();
           rolegrouplist.then(function(rolegrouplist) {
                   $scope.designationdetails = JSON.parse(rolegrouplist.data);
               }, function(err) {
                   alert('No data!.');
               })
               .finally();
   };
       loaddata1();



   $scope.activityapproval_viewpage=function(e){

        $scope.Activityadd=[];
        $scope.addactivityButton = false;
        $scope.editactivityButton = true;
        modalshow('Activity_showpopup');
        if(e.activity_bidding=="Y"){
        $scope.Activityadd.fidelityinsurance="YES";
        }else{
         $scope.Activityadd.fidelityinsurance="NO";
        }
        if(e.activity_bidding=="Y"){
        $scope.Activityadd.bidding="YES";
        }else{
         $scope.Activityadd.bidding="NO";
        }
        $scope.Activityadd.actgid=e.activity_gid;
        $scope.Activityadd.activitycode=e.activity_code;
        $scope.Activityadd.activitytype=e.activity_type;
        $scope.Activityadd.activityname=e.activity_name;
        $scope.Activityadd.description=e.activity_desc;
        $scope.Activityadd.activitystartdate=e.activity_startdate;
        $scope.Activityadd.activityenddate=e.activity_enddate;
        $scope.Activityadd.projectedcontract=e.activity_projectedspend;
        $scope.Activityadd.actrm=e.employee_name;
        $scope.Activityadd.reason=e.activity_reason;
        $scope.Activityadd.ngactgrp=e.activity_status;
        $scope.add.prsnname=e.Contact_personname;
        $scope.add.dsgntn=e.designation_name;
        $scope.add.lndlne=e.Contact_landline;
        $scope.add.lndlne2=e.Contact_landline2;
        $scope.add.mobno=e.Contact_mobileno;
        $scope.add.mobno2=e.Contact_mobileno2;
        $scope.add.mailid=e.Contact_email;
        $scope.add.cntcttype=e.contacttype_Name;
        $scope.add.dobb=new Date(e.Contact_DOB);
        $scope.add.weddy=new Date(e.Contact_WD);
        var data = {
           "Params": {
               "Filter": {
               "Activity_Partnergid":$scope.maintable_partnergid,
               "Mst_Table":"Mst",
               "Activity_Main_Gid":e.main_activity_gid,
               },
               "Classification":
               {
                   "Entity_Gid": $scope.entity_gid,
               },
           }
       }
       var dtam = {
           Group: 'Activity_Group',
           Type: 'Activity_Get',
           data: data
       }

       var getmstActivitySummary = Servicedrctsale.getdattam(dtam)
       getmstActivitySummary.then(function(result) {

           $scope.getmstActivitySummary = result.data.DATA[0];

           //alert(JSON.stringify($scope.getmstActivitySummary))

       }, function(err) {
           alert('No data!.');
       }).finally();
   }
    //to Save edited data
   $scope.activitysummaryedit=function(){

       var data = {
           "Params": {
               "Activity_Gid": $scope.Activityadd.actgid,
               "Activity_Partnergid":$scope.partner_gid,
               "Activity_PartnerCode":$scope.Partner.partnercode,
               "Activity_Type": $scope.Activityadd.activitytype,
               "Activity_Name": $scope.Activityadd.activityname,
               "Activity_Desc": $scope.Activityadd.description,
               "Activity_Code":$scope.Activityadd.activitycode,
               "Activity_StartDate":formatStringDate($scope.Activityadd.activitystartdate, 'yyyy-mm-dd'),
               "Activity_EndDate":formatStringDate($scope.Activityadd.activityenddate, 'yyyy-mm-dd'),
               "Activity_ProjectedSpend": ($scope.Activityadd.projectedcontract).toString(),
               "Activity_rm":$scope.Activityadd.actrm.employee_gid,
               "Activity_FidiInsur":$scope.Activityadd.fidelityinsurance,
               "Activity_Bidding":$scope.Activityadd.bidding,
               "Activity_Reason":$scope.Activityadd.reason,
               "Activity_Status": $scope.Activityadd.ngactgrp,
               "Contact_ContactType_Gid": $scope.add.cntcttype,
               "Contact_PersonName": $scope.add.prsnname,
               "Contact_Designation_Gid":$scope.add.dsgntn,
               "Contact_LandLine":$scope.add.lndlne,
               "Contact_LandLine2":$scope.add.lndlne2,
               "Contact_MobileNo":$scope.add.mobno,
               "Contact_MobileNo2":$scope. add.mobno,
               "Contact_Email":$scope.add.mailid,
               "Contact_DOB":$scope. add.dobb,
               "Contact_WD":$scope.add.weddy
           },
           "Classification": {
               "Update_By": $scope.entity_gid,
           },
       }
       var details = {
           Group: 'Activity_UPDATE',
           Action: 'ACTIVITY_UPDATE',
           Type:'ACTIVITY_UPDATE',
           data: data,
       }
       var update_actgrp = Servicedrctsale.updateactgrp(details)
       update_actgrp.then(function(result) {
               $scope.actupdate_group = result.data.MESSAGE;
               if($scope.actupdate_group=="SUCCESS"){
               alert($scope.actupdate_group);
                modalhide('Activity_showpopup');
                loadActivityData();
               }

           }),
           function(err) {
               alert('no data');
           };
   }

$scope.searchActivitydata=function(){
    loadActivityData();
}

function loadActivityData() {

    var filter={};
       if ($scope.Activityadd.Search_activitytype) {
           filter['Activity_Type'] = $scope.Activityadd.Search_activitytype
       } else {
           filter['Activity_Type'] = '';
       }
       if ($scope.Activityadd.Search_activityname) {
           filter['Activity_Name'] = $scope.Activityadd.Search_activityname
       } else {
           filter['Activity_Name'] = '';
       }
       if ($scope.Activityadd.Search_description) {
           filter['Activity_Desc'] = $scope.Activityadd.Search_description
       } else {
           filter['Activity_Desc'] = '';
       }
       if ($scope.Activityadd.Searchselectedemp) {
           filter['Activity_Rm'] = $scope.Activityadd.Searchselectedemp.employee_gid
       } else {
          filter['Activity_Rm']= '';
       }
       filter['Activity_Partnergid']= $scope.partner_gid,
        filter['Mst_Table']= $scope.msttable

       var data = {
           "Params": {
               "Filter": filter,
               "Classification":
               {
                   "Entity_Gid": $scope.entity_gid,
                   "Create_By":detail.employee_gid,
               }
           }
       }
       var dtam = {
           Group: 'Activity_Group',
           Type: 'Activity_Get',
           data: data
       }
       $scope.getActivitySummary = [];
       var getActivitySummary = Servicedrctsale.getdattam(dtam)
       getActivitySummary.then(function(result) {

           //alert(JSON.stringify(result.data));
           $scope.getActivitySummary = result.data.DATA;
           $scope.searchactivity=$scope.getActivitySummary;
           //alert(JSON.stringify($scope.getActivitySummary))
           //$scope.load = $scope.getActivitySummary
           //$scope.pageLength = $scope.getActivitySummary.length;
       }, function(err) {
           alert('No data!.');
       }).finally();
   }
$scope.search_activity=function(e){

if(e.Search_activitytype=="S"){
$scope.searchacttype="Service"
}else{
$scope.searchacttype="Product"
}
        $scope.getActivitySummary = $filter('filter')($scope.searchactivity , {
               "activity_name": e.Search_activityname,
               "activity_desc": e.Search_description,
               "employee_name": e.Searchselectedemp.employee_name,
               "activity_type":$scope.searchacttype

        });
}

$scope.activitysummarysave = function(Activityadd) {

       var data = {
           "Params": {
               "Activity_Partnergid":$scope.partner_gid,
               "Activity_PartnerCode":$scope.Partner.partnercode,
               "Activity_Type": Activityadd.activitytype,
               "Activity_Name": Activityadd.activityname,
               "Activity_Desc": Activityadd.description,
               "Activity_Code": Activityadd.activitycode,
               "Activity_StartDate": Activityadd.activitystartdate,
               "Activity_EndDate": Activityadd.activityenddate,
               "Activity_ProjectedSpend": Activityadd.projectedcontract,
               "Activity_rm": $scope.Activityadd.actrm.employee_gid,
               "Activity_FidiInsur": Activityadd.fidelityinsurance,
               "Activity_Bidding": Activityadd.bidding,
               "Activity_Reason": Activityadd.reason,
               "Activity_Status": Activityadd.ngactgrp.metadata_value,
               "Create_By": $scope.create_by,
               "Contact_ContactType_Gid": $scope.add.cntcttype,
               "Contact_PersonName": $scope.add.prsnname,
               "Contact_Designation_Gid": $scope.add.dsgntn,
               "Contact_LandLine": $scope.add.lndlne,
               "Contact_LandLine2": $scope.add.lndlne2,
               "Contact_MobileNo": $scope.add.mobno,
               "Contact_MobileNo2": $scope.add.mobno2,
               "Contact_Email": $scope.add.mailid,
               "Contact_DOB": $scope.add.dobb,
               "Contact_WD": $scope.add.weddy
           },
           "Classification": {
               "Update_By":detail.employee_gid,
               "Entity_Gid": $scope.entity_gid,
           },
       }
       var details = {
           Group: 'Activity_ADD',
           Action: 'Activity_Insert',
           Type: 'Activity_Group',
           data: data,
       }
       var set_actgrp = Servicedrctsale.ActivityaddService(details)
       set_actgrp.then(function(result) {
               $scope.actgroup = result.data.MESSAGE;
               //alert(JSON.stringify($scope.actgroup));
               if($scope.actgroup =="SUCCESS"){
               alert(JSON.stringify($scope.actgroup));
              // $scope.activityform.$setPristine();
               modalhide('Activity_showpopup');
               loadActivityData();
               }
               else{
               alert(JSON.stringify($scope.actgroup))
               }
           }),
           function(err) {
               alert('no data');
           };
   }
//ACTIVITYEND

//ClientDetails Start Page...!
$scope.addclient=[];
$scope.ClientDetailspopup=function(){

  $scope.clientsubmit=true;
        $scope.clientupdate=false;
$scope.add.name="",
$scope.add.addline="",
$scope.add.addline2="",
$scope.add.addline3="",
$scope.add.addselectedstate="",
$scope.add.addselecteddistrict="",
$scope.add.addselectedcity="",
$scope.add.pincode1="",
modalshow('ClientAddPopup')

}
var eaddrsttddl = Servicedrctsale.getstateddl()
        eaddrsttddl.then(function(result) {
                $scope.stateddl = [];
                $scope.stateddl = JSON.parse(result.data);
            }),
            function() {
                alert('No data!.');
            };
$scope.state_clk = function(state_gid, type) {

            $scope.client_stategid=state_gid;

            var distddl = Servicedrctsale.getdistddl(state_gid)
            distddl.then(function(result) {


                        $scope.adistrictddl = JSON.parse(result.data);

                }),
                function() {
                    alert('No data!.');
                };
        };

        $scope.district_clk = function(district_gid, type) {

        if(type == "address"){
        $scope.client_districtgid=district_gid;
        }else{
         $scope.client_districtgid="";
        }
            var ctyddl = Servicedrctsale.getcityddl(district_gid)
            ctyddl.then(function(result) {
                    if (type == 'address') {
                        $scope.acity1 = [];
                        $scope.acity1 = JSON.parse(result.data);
                    } else {
                        $scope.city1 = [];
                        $scope.city1 = JSON.parse(result.data);
                    }
                }),
                function() {
                    alert('No data!.');
                };
        };
$scope.pinchange = function(pincode, type) {

            var pincd = Servicedrctsale.getpincodeall(pincode)
            pincd.then(function(result) {
                    if (type == 'address') {
                        var apincde = [];
                        apincde = JSON.parse(result.data);
                        $scope.add.addselectedstate = apincde[0].city_state_gid;
                        $scope.state_clk($scope.add.addselectedstate, 'address');
                        $scope.add.addselecteddistrict = apincde[0].pincode_district_gid;
                        $scope.district_clk($scope.add.addselecteddistrict, 'address');
                        $scope.add.addselectedcity = apincde[0].pincode_City_gid;
                        $scope.add.pincode1 = apincde[0].pincode_no;
                    }
                }),
                function() {
                    alert('No data!.');
                };
        };


$scope.city_clk = function(city_gid, type) {

            $scope.client_citygid=city_gid;
            var pincd = Servicedrctsale.getpincode(city_gid)
            pincd.then(function(result) {
                    if (type == 'address') {
                        var apincde = [];
                        apincde = JSON.parse(result.data);
                        $scope.add.pincode1 = apincde[0].pincode_no;
                    } else {
                        var pincde = [];
                        pincde = JSON.parse(result.data);
                        $scope.pcode = pincde[0].pincode_no;
                    }
                }),
                function() {
                    alert('No data!.');
                };
        };

        $scope.addclientdetails=function(e){

        if(e==undefined){
        $scope.client_addline="";
        $scope.client_addline2="";
        $scope.client_addline3="";
        }else{
         $scope.client_addline=e.addline;
        $scope.client_addline2=e.addline2;
        $scope.client_addline3=e.addline3;
        }

            var data = {
                "Params": {
                    "Partnerclient_Partnergid": $scope.partner_gid,
                    "Address_1":$scope.client_addline,
                    "Address_2": $scope.client_addline2,
                   "Address_3": $scope.client_addline3,
                   "Address_Pincode": e.pincode1,
                   "Address_District_gid": $scope.client_districtgid,
                   "Address_City_gid": $scope.client_citygid,
                   "Address_State_gid": $scope.client_stategid,
                   "Partnerclient_Name": e.name,

                },
                "Classification": {
                    "Create_By":detail.employee_gid,
                    "Entity_Gid": $scope.entity_gid,
                },
            }
            var details = {
               Group: 'ClientDetails_ADD',
               Action: 'INSERT',
               Type:"",
               data: data,
            }
                var set_clientdetails = Servicedrctsale.clientaddService(details)
                set_clientdetails.then(function(result) {
                    $scope.clientgroup = result.data.MESSAGE;
                    if( $scope.clientgroup=="SUCCESS"){
                    alert("SUCCESSFULLY INSERTED");
                    modalhide('ClientAddPopup');
                    $scope.add.name="",
                    $scope.add.addline="",
                    $scope.add.addline2="",
                    $scope.add.addline3="",
                    $scope.add.addselectedstate="",
                    $scope.add.addselecteddistrict="",
                    $scope.add.addselectedcity="",
                    $scope.add.pincode1="",
                    getclient_details();

                    }
                    else{
                    alert(JSON.stringify($scope.clientgroup));
                     modalshow('ClientAddPopup')
                    }


                }),
            function(err) {
                alert('no data');
            };
        }

        function getclient_details(){
        var data = {
                "Params": {
                     "Partnerclient_Partnergid":$scope.partner_gid,
                     "Mst_Table": $scope.msttable,
                },
                "Classification": {
                    "Entity_Gid": $scope.entity_gid,
                },
            }
            var details = {
               Group: 'ClientDetails_GET',
               Action: 'Partnerclient_Get',
               Type:"",
               data: data,
            }
                var get_tmp_clientdetails = Servicedrctsale.clientgetService(details)
                get_tmp_clientdetails.then(function(result) {
                    $scope.tmp_clientgetgroup = result.data.DATA;
                    $scope.clientgropename=$scope.tmp_clientgetgroup;
                    //alert(JSON.stringify($scope.tmp_clientgetgroup));

                }),
            function(err) {
                alert('no data');
            };

        }
        $scope.change_clientname=function(e){

        $scope.tmp_clientgetgroup = $filter('filter')($scope.clientgropename , {
               "partnerclient_name": e.name

        });
        }




    $scope.clientapproval_viewpage=function(e){

    modalshow('ClientAddPopup');
    $scope.clientgid=e.partnerclient_gid,
            $scope.add.name=e.partnerclient_name,
            $scope.add.addline=e.address_1,
            $scope.add.addline2=e.address_2,
            $scope.add.addline3=e.address_3,
            $scope.add.addselectedstate=e.state_name,
            $scope.state_clk(e.address_state_gid,'address');
            $scope.add.addselecteddistrict = e.district_name;
            $scope.district_clk(e.address_district_gid,'address')
            $scope.add.addselectedcity=e.City_Name,
            $scope.add.pincode1=e.address_pincode

            var data = {
                "Params": {
                     "main_PartnerClient_Gid":e.main_partnerclient_gid,
                     "Mst_Table":"Mst"
                },
                "Classification": {
                    "Entity_Gid": $scope.entity_gid,
                },
            }
            var details = {
               Group: 'ClientDetails_GET',
               Action: 'Partnerclient_Get',
               Type:"",
               data: data,
            }
                var get_mst_clientdetails = Servicedrctsale.clientgetService(details)
                get_mst_clientdetails.then(function(result) {
                    $scope.clientgetgroup = result.data.DATA[0];
                    //$scope.clientgropename=$scope.clientgetgroup;
                    //alert(JSON.stringify($scope.clientgetgroup));

                }),
            function(err) {
                alert('no data');
            };


    }

//ClientDetails End Page...!

//ContractDetails Start Page...!
$scope.addcontract=[];
$scope.addcontractpagepopup=function(){
$scope.addcontracts=true;
 $scope.editcontract=false;
 $scope.truefalse =false,
  $scope.addcontract.code="",
 $scope.addcontract.name="",
 $scope.addcontract.service="",
 $scope.addcontract.remarks="",
 modalshow('ContractAddPopup')

}
$scope.updatecontract=function(e){

    var data = {
        "Params": {
            "Partnercontractor_Gid":$scope.partnercontractgid,
             "Partnercontractor_Name":$scope.addcontract.name,
             "Partnercontractor_Service":$scope.addcontract.service,
            "Partnercontractor_Remarks":$scope.addcontract.remarks,

                },
                "Classification": {
                   "Update_By":$scope.create_by,
                },
        }
            var details = {
               Group: 'ContractDetails_Update',
               Action: 'UPDATE',
               Type:"",
               data: data,
            }
                var update_contractdetails = Servicedrctsale.contractupdateService(details)
                update_contractdetails.then(function(result) {
                    $scope.contractgroup = result.data;

                    if($scope.contractgroup=="SUCCESS"){
                    alert("SUCCESSFULLY UPDATED");
                    getcontractdetails();
                    modalhide('ContractAddPopup')
                    }else{
                    alert("SUCCESSFULLY NOT UPDATED");
                    modalshow('ContractAddPopup')
                    }



                }),
            function(err) {
                alert('no data');
            };

}


function getcontractdetails(){

        var data = {
                "Params": {
                    "Partnercontractor_Partnergid":$scope.partner_gid,
                    "Mst_Table": $scope.msttable,
                },
                "Classification": {

                    "Entity_Gid": $scope.entity_gid,
                },
        }
        var details = {
               Group: 'ContractDetails_GET',
               Action: 'Partnercontractor_Get',
               Type:"",
               data: data,
        }
                var GET_contractdetails = Servicedrctsale.contractgetService(details)
                GET_contractdetails.then(function(result) {
                    $scope.contractgetgroup = result.data.DATA;
                    $scope.searchcontractdetails=$scope.contractgetgroup;
                    //alert(JSON.stringify($scope.contractgetgroup))


                }),
            function(err) {
                alert('no data');
            };

}

$scope.contractchange=function(e){

        $scope.contractgetgroup = $filter('filter')($scope.searchcontractdetails , {
               "partnercontractor_code": e.code,
               "partnercontractor_name": e.name,
               "partnercontractor_service": e.service,
               "partnercontractor_remarks": e.remarks

        });
        }

 $scope.contractapproval_viewpage=function(e){

 $scope.partnercontractgid=e.partnercontractor_gid;
 $scope.addcontracts=false;
 $scope.editcontract=true;
  $scope.truefalse = true;
 $scope.addcontract.code=e.partnercontractor_code;
 $scope.addcontract.name=e.partnercontractor_name;
 $scope.addcontract.service=e.partnercontractor_service;
 $scope.addcontract.remarks=e.partnercontractor_remarks;
 modalshow('ContractAddPopup')

 var data = {
                "Params": {
                    "main_PartnerContractor_Gid":e.partnercontractor_partnergid,
                    "Mst_Table":"Mst"
                },
                "Classification": {

                    "Entity_Gid": $scope.entity_gid,
                },
        }
        var details = {
               Group: 'ContractDetails_GET',
               Action: 'Partnercontractor_Get',
               Type:"",
               data: data,
        }
                var GET_contractdetails = Servicedrctsale.contractgetService(details)
                GET_contractdetails.then(function(result) {
                    $scope.mst_contractgetgroup = result.data.DATA[0];
                    //$scope.searchcontractdetails=$scope.contractgetgroup;
                    //alert(JSON.stringify($scope.mst_contractgetgroup))


                }),
            function(err) {
                alert('no data');
            };

 }
//ContractDetails End Page...!

//Branch Details Start Page...!
$scope.addbranchpagepopup=function(){
$scope.showbranchsubmit=true;
$scope.showbranchupdate=false;
 $scope.add.addline="";
                    $scope.add.addline2="";
                    $scope.add.pincode1="";
                    $scope.add.addline3="";
                    $scope.add.addselectedstate="";
                    $scope.add.addselecteddistrict="";
                    $scope.add.addselectedcity="";
                    $scope.add.cntcttype="";
                    $scope.add.prsnname="";
                    $scope.add.dsgntn="";
                    $scope.add.lndlne="";
                    $scope.add.lndlne2="";
                    $scope.add.mobno="";
                    $scope.add.mobno2="";
                    $scope.add.mailid="";
                    $scope.add.dobb="";
                    $scope.add.weddy="";
                    $scope.add.branchcode="";
                    $scope.add.branchname="";
                    $scope.add.branchremarks="";
modalshow('BranchAddPopup')
}
$scope.addbranchdetails=function(){

 var data = {
                "Params": {
                    "Address_1":$scope.add.addline,
                    "Address_2":$scope.add.addline2,
                    "Address_Pincode":$scope.add.pincode1,
                    "Address_3":$scope.add.addline3,
                    "Address_State_Gid":$scope.client_stategid,
                    "Address_District_Gid":$scope.client_districtgid,
                    "Address_City_Gid": $scope.client_citygid,
                    "Contact_ContactType_Gid": $scope.add.cntcttype,
                    "Contact_PersonName":$scope.add.prsnname,
                    "Contact_Designation_Gid":$scope.add.dsgntn,
                    "Contact_LandLine": $scope.add.lndlne,
                    "Contact_LandLine2":$scope.add.lndlne2,
                    "Contact_MobileNo": $scope.add.mobno,
                    "Contact_MobileNo2":$scope.add.mobno2,
                    "Contact_Email": $scope.add.mailid,
                    "Contact_DOB":$scope.add.dobb,
                    "Contact_WD":$scope.add.weddy,
                    "PartnerBranch_Code":$scope.add.branchcode,
                    "PartnerBranch_Name":$scope.add.branchname,
                    "PartnerBranch_Remarks":$scope.add.branchremarks,

                },
                "Classification": {
                   "Entity_Gid":$scope.entity_gid,
                   "Create_By":$scope.create_by,
                },
        }
            var details = {
               Group: 'BranchDetails_Set',
               Action: 'Atma_Branch_Insert',
               Type:"",
               data: data,
            }
                var set_branchdetails = Servicedrctsale.branchsetService(details)
                set_branchdetails.then(function(result) {
                    $scope.branchgetgroup = result.data.MESSAGE;

                    if($scope.branchgetgroup=="SUCCESS"){
                    alert("SUCCESSFULLY INSERTED");
                    $scope.add.addline="";
                    $scope.add.addline2="";
                    $scope.add.pincode1="";
                    $scope.add.addline3="";
                    $scope.add.addselectedstate="";
                    $scope.add.addselecteddistrict="";
                    $scope.add.addselectedcity="";
                    $scope.add.cntcttype="";
                    $scope.add.prsnname="";
                    $scope.add.dsgntn="";
                    $scope.add.lndlne="";
                    $scope.add.lndlne2="";
                    $scope.add.mobno="";
                    $scope.add.mobno2="";
                    $scope.add.mailid="";
                    $scope.add.dobb="";
                    $scope.add.weddy="";
                    $scope.add.branchcode="";
                    $scope.add.branchname="";
                    $scope.add.branchremarks="";
                    modalhide('BranchAddPopup')
                    getbranchdetails();
                    }else{
                    alert($scope.branchgetgroup);
                    getbranchdetails();
                    modalshow('BranchAddPopup')
                    }
                }),
            function(err) {
                alert('no data');
            };

}


function getbranchdetails(){

        var data = {
                "Params": {
                    "Branch_PartnerGid":$scope.partner_gid,
                    "Mst_Table": $scope.msttable,
                },
                "Classification": {

                    "Entity_Gid": $scope.entity_gid,
                },
        }
        var details = {
               Group: 'BranchDetails_GET',
               Action: 'Atma_Branch_Get',
               Type:"",
               data: data,
        }
                var GET_branchdetails = Servicedrctsale.branchgetService(details)
                GET_branchdetails.then(function(result) {
                    $scope.branchgetgroup = result.data.DATA;
                    $scope.searchbranchdetails=$scope.branchgetgroup;
                    //alert(JSON.stringify($scope.branchgetgroup))

                }),
            function(err) {
                alert('no data');
            };

}


$scope.change_branch=function(e){

        $scope.branchgetgroup = $filter('filter')($scope.searchbranchdetails , {
               "partnerbranch_code": e.code,
               "partnerbranch_name": e.name

        });
}
$scope.branchapproval_viewpage=function(e){

$scope.showbranchsubmit=false;
$scope.showbranchupdate=true;
        $scope.partnerbranch_Gid=e.partnerbranch_gid;
        $scope.add.addline=e.address_1;
        $scope.add.addline2=e.address_2;
        $scope.add.pincode1=e.address_pincode;
        $scope.add.addline3=e.address_3;
        //$scope.add.addselectedstate=e.address_state_gid;
        $scope.add.addselectedstate=e.state_name,
        $scope.state_clk(e.address_state_gid,'address');
        $scope.add.addselecteddistrict = e.district_name;
        $scope.district_clk(e.address_district_gid,'address'),
         $scope.add.addselectedcity=e.City_Name,
        $scope.add.cntcttype=e.contacttype_Name;
        $scope.add.prsnname=e.Contact_personname;
        $scope.add.dsgntn=e.designation_name;
        $scope.add.lndlne=e.Contact_landline;
        $scope.add.lndlne2=e.Contact_landline2;
        $scope.add.mobno=e.Contact_mobileno;
        $scope.add.mobno2=e.Contact_mobileno2;
        $scope.add.mailid=e.Contact_email;
        $scope.add.dobb=e.Contact_DOB;
        $scope.add.weddy=e.Contact_WD;
        $scope.add.branchcode=e.partnerbranch_code;
        $scope.add.branchname=e.partnerbranch_name;
        $scope.add.branchremarks=e.partnerbranch_remarks;
        $scope.add.creditlimitdays=e.partnerbranch_creditperiod;
        $scope.add.creditterms=e.partnerbranch_paymentterms;
        $scope.add.branc_gstno=e.partnerbranch_gstno;
        $scope.add.branchpanno=e.partnerbranch_panno;
        modalshow('BranchAddPopup');
        var data = {
                        "Params": {
                    "main_PartnerBranch_Gid":e.main_partnerbranch_gid,
                    "Mst_Table":"Mst",
                },
                "Classification": {

                    "Entity_Gid": $scope.entity_gid,
                },
        }
        var details = {
               Group: 'BranchDetails_GET',
               Action: 'Atma_Branch_Get',
               Type:"",
               data: data,
        }
                var mst_GET_branchdetails = Servicedrctsale.branchgetService(details)
                mst_GET_branchdetails.then(function(result) {
                    $scope.mst_branchgetgroup = result.data.DATA[0];
                    //$scope.searchbranchdetails=$scope.branchgetgroup;
                    //alert(JSON.stringify($scope.mst_branchgetgroup))

                }),
            function(err) {
                alert('no data');
            };
}
$scope.updatebranchdetails=function(e){

if( $scope.client_stategid){
    $scope.update_branchstategid= $scope.client_stategid;
    }
    else{
      $scope.update_branchstategid=$scope.add.addselectedstate;
    }
    if( $scope.client_districtgid){
    $scope.update_branchdistrictgid= $scope.client_districtgid;
    }
    else{
       $scope.update_branchdistrictgid=$scope.add.addselecteddistrict
    }
    if($scope.client_citygid){
     $scope.update_branchcitygid=  $scope.client_citygid
    }
    else{
    $scope.update_branchcitygid=  $scope.add.addselectedcity
    }
     $scope.update_branchdobdate = formatStringDate( $scope.add.dobb, 'yyyy-mm-dd');
     $scope.update_branch_wddate = formatStringDate( $scope.add.weddy, 'yyyy-mm-dd');
var data = {
                "Params": {
                    "PartnerBranch_Gid":$scope.partnerbranch_Gid,
                    "Address_1":e.addline,
                    "Address_2":e.addline2,
                    "Address_PinCode":e.pincode1,
                    "Address_3":e.addline3,
                    "Address_State_Gid":$scope.update_branchstategid,
                    "Address_District_Gid":$scope.update_branchdistrictgid,
                    "Address_City_Gid": $scope.update_branchcitygid,
                    "PartnerBranch_Code":$scope.add.branchcode,
                    "PartnerBranch_Name":$scope.add.branchname,
                    "PartnerBranch_Remarks":$scope.add.branchremarks,
                    "Contact_ContactType_Gid": $scope.add.cntcttype,
                   "Contact_PersonName": $scope.add.prsnname,
                   "Contact_Designation_Gid": $scope.add.dsgntn,
                   "Contact_LandLine": $scope.add.lndlne,
                   "Contact_LandLine2": $scope.add.lndlne2,
                   "Contact_MobileNo": $scope.add.mobno,
                   "Contact_MobileNo2": $scope.add.mobno2,
                   "Contact_Email": $scope.add.mailid,
                   "Contact_DOB": $scope.update_branchdobdate,
                   "Contact_WD":$scope.update_branch_wddate

                },
                "Classification": {
                   "Update_By":$scope.create_by,
                },
        }
            var details = {
               Group: 'BranchDetails_Update',
               Action: 'BRANCH_UPDATE',
               Type:"",
               data: data,
            }
                var update_branchdetails = Servicedrctsale.branchupdateService(details)
                update_branchdetails.then(function(result) {
                    $scope.branchupdategroup = result.data;
                    if($scope.branchupdategroup=="SUCCESS"){
                    alert("SUCCESSFULLY UPDATED");
                    modalhide('BranchAddPopup')
                    getbranchdetails();
                    }else{
                    alert(JSON.stringify($scope.branchupdategroup));
                    getbranchdetails();
                    modalshow('BranchAddPopup')
                    }
                }),
            function(err) {
                alert('no data');
            };


}

//Branch Details End Page...!
//Basic Profile Details Start Page...!
$scope.basicprofile=[];
$scope.change_basicprofile=function(e){

$scope.employeeparmanentcount=parseInt(e.partnerprofile_noofempper);
$scope.employeetemporarycount=parseInt(e.partnerprofile_noofemptmp);
$scope.basicprofile.partnerprofile_totemp=parseInt($scope.employeeparmanentcount) + parseInt($scope.employeetemporarycount);
}

$scope.addbasicprofile=function(e){

var data = {
                "Params": {
                    "Partnerprofile_Partnergid":$scope.partner_gid,
                    "Partnerprofile_Noofyears":($scope.basicprofile.partnerprofile_noofyears).toString(),
                    "Partnerprofile_Associateyears":($scope.basicprofile.partnerprofile_associateyears).toString(),
                    "Partnerprofile_Awarddetails":($scope.basicprofile.partnerprofile_awarddetails).toString(),
                    "Partnerprofile_Noofempper":($scope.basicprofile.partnerprofile_noofempper).toString(),
                    "Partnerprofile_Noofemptmp":($scope.basicprofile.partnerprofile_noofemptmp).toString(),
                    "Partnerprofile_Totemp": ($scope.basicprofile.partnerprofile_totemp).toString(),
                    "Partnerprofile_Branchcount": ($scope.basicprofile.partnerprofile_branchcount).toString(),
                    "Partnerprofile_Factorycount":($scope.basicprofile.partnerprofile_factorycount).toString(),
                    "Partnerprofile_Remarks":($scope.basicprofile.partnerprofile_remarks).toString(),
                     "Mst_Table": $scope.msttable,

                },
                "Classification": {
                   "Entity_Gid":$scope.entity_gid,
                   "Create_By":$scope.create_by,
                },
        }
            var details = {
               Group: 'BasicProfile_Set',
               Action: '',
               Type:"",
               data: data,
            }
                var set_basicprofiledetails = Servicedrctsale.basicprofilesetService(details)
                set_basicprofiledetails.then(function(result) {
                    $scope.basicprofilesetgroup = result.data.MESSAGE;
                    alert(JSON.stringify($scope.basicprofilesetgroup))
                    if($scope.basicprofilesetgroup=="SUCCESSFULLY UPDATED"){
                    getbasicprofiledetails();
                    }
                }),
            function(err) {
                alert('no data');
            };

}

function getbasicprofiledetails(){

var data = {
                "Params": {
                    "Partnerprofile_Partnergid":$scope.partner_gid,
                    "Mst_Table": $scope.msttable,
                },
                "Classification": {
                   "Entity_Gid":$scope.entity_gid,
                },
        }
            var details = {
               Group: 'Partnerprofile_Get',
               Action: 'Partnerprofile_Get',
               Type:"",
               data: data,
            }
                var get_basicprofiledetails = Servicedrctsale.basicprofilegetService(details)
                get_basicprofiledetails.then(function(result) {
                //alert(result.data.DATA[0].partnerprofile_gid)
                    $scope.basicprofile = result.data.DATA[0];
                    //alert( $scope.basicprofile.partnerprofile_gid)
                    //alert(JSON.stringify($scope.basicprofile))
                }),
            function(err) {
                alert('no data');
            };

}
//alert($scope.Partner_status_update);
//Basic Profile Details End Page...!
$scope.approvedfor_RM=function(status,remarks){
if(status=="Approve"){
if($scope.Partner_status=="PENDING-CHECKER"){
$scope.rolegroupname="VMU HEAD"
$scope.Partner_status_update="PENDING-HEAD"
$scope.Partner_status_action="VMU_To_VMUH_Update"
$scope.Partner_status_group="RM_To_VMU_Update"
}
else if($scope.Partner_status=="PENDING-HEAD"){
if($scope.Partner_requestfor=="MODIFICATION"){
$scope.Partner_status_update="APPROVED"
alert($scope.Partner_status_update);
}if($scope.Partner_requestfor=="ONBOARD"){
$scope.Partner_status_update="APPROVED"
}if($scope.Partner_requestfor=="DEACTIVATION"){
$scope.Partner_status_update="DEACTIVATED"
}
if($scope.Partner_requestfor=="ACTIVATION"){
$scope.Partner_status_update="APPROVED"
}
if($scope.Partner_requestfor=="TERMINATION"){
$scope.Partner_status_update="TERMINATED"
}
if($scope.Partner_requestfor=="RENEWAL PROCESS"){
$scope.Partner_status_update="APPROVED"
}
$scope.Partner_status_action="Pending_To_Approval_Insert"
$scope.Partner_status_group="APPROVED_GROUP"

}
else if($scope.Partner_status=="PENDING-RM"){
$scope.rolegroupname="VMU CHECKER"
$scope.Partner_status_update="PENDING-CHECKER"
$scope.Partner_status_action="RM_To_VMU_Update"
$scope.Partner_status_group="RM_To_VMU_Update"
}
}
else{
if($scope.Partner_status=="PENDING-CHECKER"){
$scope.rolegroupname="VMU HEAD"
$scope.Partner_status_update="REJECTED"
$scope.Partner_status_action="VMU_To_VMUH_Update"
$scope.Partner_status_group="RM_To_VMU_Update"
}
else if($scope.Partner_status=="PENDING-HEAD"){
if($scope.Partner_requestfor=="MODIFICATION"){
$scope.Partner_status_update="REJECTED"
alert($scope.Partner_status_update);
}if($scope.Partner_requestfor=="ONBOARD"){
$scope.Partner_status_update="REJECTED"
}if($scope.Partner_requestfor=="DEACTIVATION"){
$scope.Partner_status_update="REJECTED"
}
if($scope.Partner_requestfor=="ACTIVATION"){
$scope.Partner_status_update="REJECTED"
}
if($scope.Partner_requestfor=="TERMINATION"){
$scope.Partner_status_update="REJECTED"
}
$scope.Partner_status_action="PENDING_HEAD"
$scope.Partner_status_group="RM_To_VMU_Update"
}
else if($scope.Partner_status=="PENDING-RM"){
$scope.Partner_status_update="REJECTED"
$scope.Partner_status_action="RM_To_VMU_Update"
$scope.Partner_status_group="RM_To_VMU_Update"
}
$scope.Partner_status_update="REJECTED"
}

var data = {
                "Params": {
                "Partner_Gid":$scope.partner_gid,
                "Partner_Status":$scope.Partner_status_update,
                "TRAN_Remarks":remarks,
                "Rolegroup_Name":$scope.rolegroupname

                },
                "Classification": {
                "Create_By":$scope.create_by,
                "Update_By":$scope.create_by,
                "Entity_Gid": $scope.entity_gid,
                "Entity_Detail_Gid": "1"
                },
        }
            var details = {
               Group: $scope.Partner_status_group,
               Action: $scope.Partner_status_action,
               Type:"",
               data: data,
            }
          var update_RM_checkerdetails = Servicedrctsale.RMcheckapprovalService(details)
                update_RM_checkerdetails.then(function(result) {
                    $scope.rmapprovalupdategroup = result.data;
                    if($scope.rmapprovalupdategroup=="SUCCESS"){
                    alert("SUCCESSFULLY UPDATED")
                    $window.location.href = "atma_Approval_Summary_Page";
                    }else{
                    alert(JSON.stringify($scope.rmapprovalupdategroup));
                    //$window.location.href = "atma_PartnerCheckerPage";
                    }


                }),
            function(err) {
                alert('no data');
            };
}


        function loadData_PartnerProfileProduct() {
            var data = {
                "Params": {
                    "Filter": {
                    "PartnerProduct_Gid":$scope.partner_gid,
                     "Mst_Table": $scope.msttable,
                    },
                    "Classification": {
                        "Entity_Gid": $scope.entity_gid
                    }
                }
            }
            var dpart = {
                Group: 'Partner Product',
                Type: 'Atma_Product_Get',
                data: data
            }
            $scope.getprofileproduct = [];
            var getprofileproduct = Servicedrctsale.get_profileproduct(dpart)
            getprofileproduct.then(function(result) {
                //alert(JSON.stringify(result.data));
                //alert('12')
                $scope.getprofileproduct = result.data.DATA;
                //alert(JSON.stringify($scope.getprofileproduct));
                $scope.searchproductprofile = $scope.getprofileproduct;
                $scope.pageLength = $scope.getprofileproduct.length;
            }, function(err) {
                alert('No data!.');
            }).finally();
        }


        $scope.getpartnerproduct_typesrch= function(searchText) {

             var dat = {
            "Table_name": "gal_mst_tmetadata",
            "Column_1": "metadata_gid,metadata_value",
            "Column_2": "",
            "Where_Common": "metadata",
            "Where_Primary": "columnname",
            "Primary_Value": "partnerproduct_type",
            "Limits": "0,30",
            "Search_Column": searchText,
            "Order_by": "value"
        }
        var partnergroup = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: dat
        }
        $scope.partnervendor = [];
            return $http.post(Appname + '/prodget/' , partnergroup).then(function(result) {
            console.log(result.data.DATA);
                return result.data.DATA;
              });
          };



        var data = {
            "Table_name": "gal_mst_tcontacttype",
            "Column_1": "contacttype_gid,contacttype_Name",
            "Column_2": "",
            "Where_Common": "contacttype",
            "Where_Primary": "contacttype_gid",
            "Primary_Value": "",
            "Order_by": "gid"
        }
        var pcont = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: data
        }
        $scope.contacttype = [];
        var getcont = Servicedrctsale.getcontdata(pcont)
        getcont.then(function(result) {
            $scope.contacttype = result.data.DATA;
        }, function(err) {
            alert('No data!.');
        }).finally();

        var datan = {
            "Table_name": "gal_mst_tdesignation",
            "Column_1": "designation_gid,designation_name",
            "Column_2": "",
            "Where_Common": "designation",
            "Where_Primary": "designation_gid",
            "Primary_Value": "",
            "Order_by": "code"
        }
        var pdesig = {
            Action: "",
            Entity_Gid: $scope.entity_gid,
            data: datan
        }
        $scope.product_desig = [];
        var getdesig = Servicedrctsale.getdesigdata(pdesig)
        getdesig.then(function(result) {
            $scope.product_desig = result.data.DATA;
        }, function(err) {
            alert('No data!.');
        }).finally();
        $scope.profileproduct=[];
     $scope.showview_pproduct = function(prof) {

<!--            $scope.disabeld_pproduct=false;-->
<!--            $scope.btnProfileProduct_Save = false;-->
<!--            $scope.btnProfileProduct_Update = false;-->
            $scope.profileproduct.partnerproduct_gid=prof.partnerproduct_gid;
            $scope.profileproduct.contacttype1 = prof.Contact_contacttype_gid;
            $scope.profileproduct.contacttype2 = prof.Contact_contacttype_gid_2;
            $scope.profileproduct.contacttype3 = prof.Contact_contacttype_gid_3;
            $scope.profileproduct.contacttype4 = prof.Contact_contacttype_gid_4;
            $scope.profileproduct.producttype = prof.partnerproduct_type;
            $scope.profileproduct.name = prof.partnerproduct_name;
            $scope.profileproduct.personname1 = prof.Contact_personname;
            $scope.profileproduct.personname2 = prof.Contact_personname_2;
            $scope.profileproduct.personname3 = prof.Contact_personname_3;
            $scope.profileproduct.personname4 = prof.Contact_personname_4;
            $scope.profileproduct.designation1 = prof.Contact_designation_gid;
            $scope.profileproduct.designation2 = prof.Contact_designation_gid_2;
            $scope.profileproduct.designation3 = prof.Contact_designation_gid_3;
            $scope.profileproduct.designation4 = prof.Contact_designation_gid_4;
            $scope.profileproduct.emailid1 = prof.Contact_email;
            $scope.profileproduct.emailid2 = prof.Contact_email_2;
            $scope.profileproduct.emailid3 = prof.Contact_email_3;
            $scope.profileproduct.emailid4 = prof.Contact_email_4;
            $scope.profileproduct.mobilenumber1 = prof.Contact_mobileno;
            $scope.profileproduct.mobilenumber2_1 = prof.Contact_mobileno2;
            $scope.profileproduct.mobilenumber2 = prof.Contact_mobileno_2;
            $scope.profileproduct.mobilenumber2_2 = prof.Contact_mobileno2_2;
            $scope.profileproduct.mobilenumber3 = prof.Contact_mobileno_3;
            $scope.profileproduct.mobilenumber2_3 = prof.Contact_mobileno2_3;
            $scope.profileproduct.mobilenumber4 = prof.Contact_mobileno_4;
            $scope.profileproduct.mobilenumber2_4 = prof.Contact_mobileno2_4;
            $scope.profileproduct.landline1 = prof.Contact_landline;
            $scope.profileproduct.landline2_1 = prof.Contact_landline2;
            $scope.profileproduct.landline2 = prof.Contact_landline_2;
            $scope.profileproduct.landline2_2 = prof.Contact_landline2_2;
            $scope.profileproduct.landline3 = prof.Contact_landline_3;
            $scope.profileproduct.landline2_3 = prof.Contact_landline2_3;
            $scope.profileproduct.landline4 = prof.Contact_landline_4;
            $scope.profileproduct.landline2_4 = prof.Contact_landline2_4;
            $scope.profileproduct.dobb1 = $filter('date')(prof.Contact_DOB, "yyyy-MM-dd");
            $scope.profileproduct.weddy1 = $filter('date')(prof.Contact_WD, "yyyy-MM-dd");
            $scope.profileproduct.dobb2 = $filter('date')(prof.Contact_DOB_2, "yyyy-MM-dd");
            $scope.profileproduct.weddy2 = $filter('date')(prof.Contact_WD_2, "yyyy-MM-dd");
            $scope.profileproduct.dobb3 = $filter('date')(prof.Contact_DOB_3, "yyyy-MM-dd");
            $scope.profileproduct.weddy3 = $filter('date')(prof.Contact_WD_3, "yyyy-MM-dd");
            $scope.profileproduct.dobb4 = $filter('date')(prof.Contact_DOB_4, "yyyy-MM-dd");
            $scope.profileproduct.weddy4 = $filter('date')(prof.Contact_WD_4, "yyyy-MM-dd");
            $scope.profileproduct.Contact_ref_gid = prof.Contact_ref_gid_2;
            $scope.profileproduct.Contact_ref_gid_3 = prof.Contact_ref_gid_2;
            $scope.profileproduct.Contact_ref_gid = prof.Contact_ref_gid_3;
            $scope.profileproduct.Contact_reftable_gid = prof.Contact_ref_gid_4;
            $scope.profileproduct.Contact_reftable_gid_2 = prof.Contact_reftable_gid;
            $scope.profileproduct.Contact_reftable_gid_3 = prof.Contact_reftable_gid_2;
            $scope.profileproduct.Contact_reftable_gid_4 = prof.Contact_reftable_gid_3;
            $scope.profileproduct.Contact_reftable_gid = prof.Contact_reftable_gid_4;
            $scope.profileproduct.contact_reftablecode = prof.contact_reftablecode;
            $scope.profileproduct.contact_reftable_2 = prof.contact_reftablecode_2;
            $scope.profileproduct.contact_reftablecode_3 = prof.contact_reftablecode_3;
            $scope.profileproduct.contact_reftablecode_4 = prof.contact_reftablecode_4;
            $scope.profileproduct.age = prof.partnerproduct_age;
            $scope.profileproduct.partnerproduct_clientcontactgid1 = prof.partnerproduct_clientcontactgid1;
            $scope.profileproduct.partnerproduct_clientcontactgid2 = prof.partnerproduct_clientcontactgid2;
            $scope.profileproduct.partnerproduct_customercontactgid1 = prof.partnerproduct_customercontactgid1;
            $scope.profileproduct.partnerproduct_customercontactgid2 = prof.partnerproduct_customercontactgid2;
            modalshow('popup_product');
        }
$scope.CloseRMApproval=function(){

$window.location.href = "atma_Approval_Summary_Page";
}
$scope.cancel_viewdata=function(){

 var data={
            "Params":{
                "Filter":{
                    "Partner_Gid":$scope.partner_gid,
                    "Partner_Status":"APPROVED",
                },
                "Classification":{

                },
                "Group":"VIEW_TO_CANCEL",
                "Action":"VIEW_TO_CANCEL",
                "Type":"",
            }
        }
        var check_approval_data=Servicedrctsale.cancel_update(data)
        check_approval_data.then(function(result){
            $scope.check_approval_data_msg=result.data;
            $scope.check_approval_data_msgs=result.data.MESSAGE;
            if($scope.check_approval_data_msgs=="SUCCESS"){
            if($scope.Partner_statuse=="ACTIVATION"){
            $window.location.href = 'AtmaPartnerActivationRequest'
            }
            if($scope.Partner_statuse=="DEACTIVATION"){
            $window.location.href = 'AtmaPartnerDeactivationRequest'
            }
            if($scope.Partner_statuse=="TERMINATION"){
            $window.location.href = 'AtmaPartnerTerminationRequest'
            }
            if($scope.Partner_statuse=="MODIFICATION"){
            $window.location.href = 'atma_changerequest_summarypage'
            }
           
            //alert("Data Moved To RM");
            //$window.location.href = 'ATMA_PartnerSummary'

            }else{
            alert(JSON.stringify($scope.check_approval_data_msg))
            //$window.location.href = "AtmaPartnerDeactivationRequest";
            }


        })
}

});

//SERVICESTART

app_review.service("Servicedrctsale", function($http) {
    this.getcontdata = function(pcont) {
        var respons = $http.post(Appname + "/prodget/", pcont);
        return respons;
    }

      this.getdesigdata = function(pdesig) {
        var respons = $http.post(Appname + "/prodget/", pdesig);
        return respons;
    }

//ActivityServiceStart


    this.getcustgrp = function(d) {
            var response = $http.get(Appname + "/get_contctgroup/");
            return response;
        }
    this.getdesg = function() {
            var response = $http.get(Appname + "/desgjson/");
            return response;
        }
       this.getdattam = function(dtam) {
        var respons = $http.post(Appname + "/atma_activity_get/", dtam);
        return respons;
    }
    this.ActivityaddService = function(details) {
       var response = $http.post(Appname + "/atma_activityaddedit/", details);
       return response;
   }
   this.updateactgrp = function(details) {
       var response = $http.post(Appname + "/atma_activityaddedit/", details);
       return response;
   }
//ActivityServiceEnd

//AttachmentServiceStart

    this.getdocnamedata = function(pdocname) {
        var respons = $http.post(Appname + "/prodget/", pdocname);
        return respons;
    }
    this.setdocgrp = function(details) {
        var response = $http.post(Appname + "/atma_attachmentupload/", details, {
            transformRequest: angular.identity,
            headers: {
                'Content-Type': undefined
            }
        });
        return response;
    }
    this.get_attachmentsummary = function(dtam) {
        var respons = $http.post(Appname + "/atma_doc_get/", dtam);
        return respons;
    }
    this.updateattachmentdetails = function(custid) {
			var respons = $http.post(Appname + "/atma_updateattacment_details/",
				custid, {
					transformRequest: angular.identity,
					headers: {
						'Content-Type': undefined
					}
				}
			);
			return respons;
	}
//AttachmentServiceEnd
<!--   this.get_atma = function(get_data) {-->
<!--        var response = $http.post(Appname + "/atma_getdata/", get_data);-->
<!--        return response;-->
<!--    }-->
    this.updateactivation = function(get_data) {
        var response = $http.post(Appname + "/atma_changerequest_activationupdate/", get_data);
        return response;
    }

    this.get_director= function(get_data) {
        var response = $http.post(Appname + "/atma_getdirectordata/", get_data);
        return response;
    }


    this.partnerheader_set = function(total) {
        var response = $http.post(Appname + "/atmaPartnerPayment_Set/", total);
        return response;
    }
    this.atma_fileupload = function(custid) {
        var respons = $http.post(Appname + "/atma_fileuploadurl/",
            custid, {
                transformRequest: angular.identity,
                headers: {
                    'Content-Type': undefined
                }
            }
        );
        return respons;
    }

    //Pament service start.....Pament service start.....Pament service start.....Pament service start.....Pament service start.....Pament service start.....

    this.getpaymodebranchdata = function(data) {
			var respons = $http.post(Appname + "/prodget/", data);
			return respons;
		}
    this.get_atmapayment = function(data) {
        var respons = $http.post(Appname + "/atma_getdata/", data);
        return respons;
    }
    this.getbranchdetails = function(data) {
        var respons = $http.post(Appname + "/atma_branchdetailsdropdown/", data);
        return respons;
    }

    this.Paymentaddheader = function(total) {
        var response = $http.post(Appname + "/atmaPartnerPayment_Set/", total);
        return response;
    }
    //Pament service end.....Pament service end.....Pament service end.....Pament service end.....Pament service end.....Pament service end.....

    //tax services start

<!--    this.gettaxtypedata = function (total) {-->
<!--            var response = $http.post(Appname + "/atma_gettaxdetails/", total);-->
<!--            return response;-->
<!--        }-->
        this.gettaxreateedata = function (data) {
        var respons = $http.post(Appname + "/prodget/", data);
        return respons;
        }
        this.getisexcempteddata = function (data) {
        var respons = $http.post(Appname + "/prodget/", data);
        return respons;
        }

        this.taxinsert = function(details) {
        var response = $http.post(Appname + "/atma_taxdetailsfileupload/", details, {
            transformRequest: angular.identity,
            headers: {
                'Content-Type': undefined
            }
        });
        return response;
        }
        this.taxupdate_details = function(details) {
        var response = $http.post(Appname + "/atma_taxdetailsfileupload/", details, {
            transformRequest: angular.identity,
            headers: {
                'Content-Type': undefined
            }
        });
        return response;
        }
        this.get_atmataxdetails = function (data) {
        var respons = $http.post(Appname + "/atma_gettaxdetails/", data);
        return respons;
        }
        this.getmsmetaxdata = function (data) {
            var respons = $http.post(Appname + "/prodget/", data);
            return respons;
        }
        //tax services end

        //Client Details Start

          this.getstateddl = function(d) {
            var response = $http.get(Appname + "/stateddl/");
            return response;
        }
        this.getpincodeall = function(pincode) {
            var response = $http.get(Appname + "/allpinget/", {
                params: {
                    "pincode": pincode
                }
            });
            return response;
        }

        this.getpincode = function(city_gid) {
            var response = $http.get(Appname + "/pincode/", {
                params: {
                    "city_gid": city_gid
                }
            });
            return response;
        }
        this.getdistddl = function(state_gid) {
            var response = $http.get(Appname + "/districtddl/", {
                params: {
                    "state_gid": state_gid
                }
            });
            return response;
        }
        this.getcityddl = function(district_gid) {
            var response = $http.get(Appname + "/cityddl/", {
                params: {
                    "district_gid": district_gid
                }
            });
            return response;
        }

        this.clientaddService = function(data) {
        var respons = $http.post(Appname + "/atma_SetClientdetails/", data);
        return respons;
    }
    this.clientgetService = function(data) {
        var respons = $http.post(Appname + "/atma_SetClientdetails/", data);
        return respons;
    }
    this.clientupdateService = function(data) {
        var respons = $http.post(Appname + "/atma_SetClientdetails/", data);
        return respons;
    }
        //Client Details End
        //contract Details Srart

    this.contractsetService = function(data) {
        var respons = $http.post(Appname + "/atma_SetContractdetails/", data);
        return respons;
    }
    this.contractgetService = function(data) {
        var respons = $http.post(Appname + "/atma_SetContractdetails/", data);
        return respons;
    }
    this.contractupdateService = function(data) {
        var respons = $http.post(Appname + "/atma_SetContractdetails/", data);
        return respons;
    }
        //contract Details end

        //branch Details start page...!
    this.branchsetService = function(data) {
        var respons = $http.post(Appname + "/atma_SetBranchdetails/", data);
        return respons;
    }
    this.branchgetService = function(data) {
        var respons = $http.post(Appname + "/atma_SetBranchdetails/", data);
        return respons;
    }
    this.branchupdateService = function(data) {
        var respons = $http.post(Appname + "/atma_SetBranchdetails/", data);
        return respons;
    }

        //branch Details end page...!
        //basic profile Details Start page...!
    this.basicprofilesetService = function(data) {
        var respons = $http.post(Appname + "/atma_Setbasicprofildedetails/", data);
        return respons;
    }
    this.basicprofilegetService = function(data) {
        var respons = $http.post(Appname + "/atma_Setbasicprofildedetails/", data);
        return respons;
    }

        //basic profile Details End page...!
        //approval stages Start...!
    this.RMcheckapprovalService = function(data) {
        var respons = $http.post(Appname + "/atma_Approval_Stages/", data);
        return respons;
    }

        //approval stages End...!
        //start basic profile product
        this.get_profileproduct = function(dpart) {
        var respons = $http.post(Appname + "/atma_profileproduct_get/", dpart);
        return respons;
    }
    this.cancel_update = function(get_data) {
        var response = $http.post(Appname + "/atma_ApprovedPartner_Get/", get_data);
        return response;
    }
      this.getrmactivity = function(pact) {
        var respons = $http.post(Appname + "/prodget/", pact);
        return respons;
    }
    //start

    this.getdattamactivity = function (dtamactivity) {
            var respons = $http.post(Appname + "/atma_activitydetailsget/", dtamactivity);
            return respons;
        }
     this.setactdetails = function (details) {
            var response = $http.post(Appname + "/atma_activitydetailsset/", details);
            return response;
        }

        this.updateactdetails = function (dtamactivity) {
            var respons = $http.post(Appname + "/atma_activitydetailsset/", dtamactivity);
            return respons;
        }
        //start catalog
        this.getdattams = function (dtam) {
            var respons = $http.post(Appname + "/atmacatalog_get/", dtam);
            return respons;
        }

        this.partnerproductgidservice = function (dtam) {
            var respons = $http.post(Appname + "/prodget/", dtam);
            return respons;
        }
        this.pcatalog = function (total) {
            var response = $http.post(Appname + "/atmacatalogset/", total);
            return response;
        }
        this.updatecatalogservice = function (dtam) {
            var respons = $http.post(Appname + "/atmacatalogset/", dtam);
            return respons;
        }
    this.assigncatalogService = function(get_data) {
        var response = $http.post(Appname + "/atmacatalogset/", get_data);
        return response;
    }

});

</script>
{% endblock %}
