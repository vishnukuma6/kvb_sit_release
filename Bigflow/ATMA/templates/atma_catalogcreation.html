{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %}Catalog Details{% endblock %}
{% block content %}
{% verbatim %}
<div class="maincontent">
    <div class="container container1" ng-app="Appreview" ng-controller="Ctrlreview">
        <div ng-cloak>
            <div class="row">
                <div class="col-md-12">
                    <div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade"
                         data-backdrop="static"
                         data-keyboard="false" id="addcatalogdetailspopup" role="dialog" tabindex="-1">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header popup-header">
                                    <h5 class="modal-title" id="exampleModalLabel">
                                        Catalog Details
                                        <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </h5>
                                </div>
                                <form name="formfill">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label> Activity Details Name1 </label>
                                                    <input maxlength="11" ng-model="add.catalogactivitydetail"
                                                           type="text" readonly>
                                                </md-input-container>
                                            </div>


                                            <div class="col-md-3">
                                               <md-input-container class="md-block inputcontainer">
                                                   <label> Category </label>
                                                   <md-select md-container-class="popup_select"
                                                              ng-model="add.catalogcategory"
                                                              ng-change="catalogcategorychange(add)">
                                                       <md-option ng-repeat="c in categorydetails"
                                                                  ng-value="c.category_gid ">
                                                           {{
                                                           c.category_name }}
                                                       </md-option>
                                                   </md-select>
                                               </md-input-container>
                                           </div>


<!--                                            <div class="col-md-3">-->
<!--                                                <md-input-container class="md-block inputcontainer">-->
<!--                                                    <label> Category </label>-->
<!--                                                    <md-select md-container-class="popup_select"-->
<!--                                                               ng-model="add.catalogcategory"-->
<!--                                                               ng-change="catalogcategorychange(add)"-->
<!--                                                    onkeydown="mdSelectOnKeyDownOverride(event)">-->
<!--                                                        <md-option ng-repeat="c in categorydetails"-->
<!--                                                                   ng-value="c.category_gid ">-->
<!--                                                            {{-->
<!--                                                            c.category_name }}-->
<!--                                                        </md-option>-->
<!--                                                    </md-select>-->
<!--                                                </md-input-container>-->
<!--                                            </div>-->
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label> Subcategory </label>
                                                    <md-select md-container-class="popup_select"
                                                               ng-model="add.subcategory"
                                                               ng-change="catalogsubcategorychange(add)">
                                                        <md-option ng-repeat="d in subcategorydetails"
                                                                   ng-value="d.subcategory_gid ">{{
                                                            d.subcategory_name }}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label> Name </label>
                                                    <input maxlength="128" ng-model="add.catalogname" type="text">
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label> Catalog specification</label>
                                                    <input ng-model="add.catalogspec" type="text">
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label> Size </label>
                                                    <input ng-model="add.catalogsize" type="text" valid-number autocomplete="off">
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label> Remarks </label>
                                                    <input ng-model="add.catalogremarks" type="text">
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label> UOM Name </label>
                                                    <md-select md-container-class="popup_select" ng-model="add.uomgid">
                                                        <md-option ng-repeat="e in uom" ng-value="e.uom_gid ">{{
                                                            e.uom_name }}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Rate </label>
                                                    <input ng-model="add.catalograte" valid-number type="text"  autocomplete="off">
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label> From Date</label>
                                                    <md-datepicker md-hide-icons="calendar" md-max-date="maxDatee"
                                                                   md-min-date="from_date" md-open-on-focus
                                                                   ng-model="add.contractfrom">
                                                    </md-datepicker>
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label> To Date</label>
                                                    <md-datepicker md-hide-icons="calendar" md-max-date="maxDatee"
                                                                   md-min-date="from_date" md-open-on-focus
                                                                   ng-model="add.contractto">
                                                    </md-datepicker>
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-autocomplete
                                                        md-clear-button="true"
                                                        md-floating-label=" Product Name"
                                                        md-input-maxlength=126
                                                        md-item-text="item.product_name"
                                                        md-items="item in getproduct_gid(searchText)"
                                                        md-min-length=0
                                                        md-no-cache="true"
                                                        md-search-text="searchText"
                                                        md-selected-item="add.catalog_partner_product_gid"
                                                        md-selected-item-change="partnerprod_gid(item)">
                                                    <md-item-template>
                                                        <span md-highlight-text="searchText"> {{item.product_name}} </span>
                                                    </md-item-template>
                                                    <md-not-found>
                                                        No matching "{{searchText}}" were found.
                                                    </md-not-found>
                                                </md-autocomplete>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">

                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label> Packing Price </label>
                                                    <input ng-model="add.packingprice" type="text" autocomplete="off" valid-number>
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label> Delivery Days </label>
                                                    <input ng-model="add.deliverydays" type="text" valid-number autocomplete="off">
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label> Capacity PW </label>
                                                    <input ng-model="add.capacitypw" type="text" valid-number autocomplete="off">
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                 <label>Direct To supplier</label>
                                                <md-radio-group layout="row" ng-model="add.dts"
                                                                style="margin-left:0px;">
                                                    <md-radio-button value="Y" class="md-primary">Yes</md-radio-button>
                                                    <md-radio-button value="N">No</md-radio-button>
                                                </md-radio-group>
                                            </div>
                                        </div>
                                    </div>
<!--                                    <div class="row">-->
<!--                                        <div class="col-md-12">-->
<!--                                            <div class="col-md-6" layout="row" style="margin-top:30px">-->
<!--                                                <label>Direct To supplier</label>-->
<!--                                                <md-radio-group layout="row" ng-model="add.dts"-->
<!--                                                                style="margin-left:20px;">-->
<!--                                                    <md-radio-button value="Y" class="md-primary">Yes</md-radio-button>-->
<!--                                                    <md-radio-button value="N">No</md-radio-button>-->
<!--                                                </md-radio-group>-->
<!--                                            </div>-->
<!--                                        </div>-->
<!--                                    </div>-->

                                    <div class="row">
                                        <div class="col-md-4">
                                        </div>
                                        <div class="col-md-4">
                                            <md-button class="md-raised custbutton" class="btn btn-secondary"
                                                       ng-click="catalog_save(add);" ng-show="addcatalog"
                                                       value="Close">Add
                                            </md-button>
                                            <md-button class="md-raised custbutton" class="btn btn-secondary"
                                                       ng-click="catalog_update(add);" ng-show="updatecatalog"
                                                       value="Close">Update
                                            </md-button>
                                            <md-button aria-label="Close" class="md-raised"
                                                       ng-click="close_fun()" value="close">Close
                                            </md-button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="row-header col-lg-12 col-sm-12">
                            <div class="col-lg-10 col-sm-10">
                                <h4><strong>ATMA Catalog Details</strong></h4>
                            </div>
                        </div>
                    </div>
                    <form name="formfill">
                        <div class="row">
                            <div class="col-md-3">
                                 <md-autocomplete md-clear-button="true"
                                             md-floating-label="Catalog Category"
                                             md-input-maxlength=126
                                             md-item-text="item.category_name"
                                             md-items="item in gotcatagory(searchRM)"
                                             md-min-length=0
                                             md-no-cache="true"
                                             md-search-text="searchRM"
                                             md-selected-item="add1.catalogcategory1"
                                             md-selected-item-change="search_catalog(add1)"
                                             >
                                <md-item-template>
                                    <span md-highlight-text="searchRM">{{item.category_name}}</span>
                                </md-item-template>
                                <md-not-found>
                                    No RM matching "{{searchRM}}" were found.
                                </md-not-found>
                            </md-autocomplete>

                            </div>

                            <div class="col-md-3">

                                <md-input-container class="md-block inputcontainer">
                                    <label> Name </label>
                                    <input maxlength="11" ng-model="add1.catalogname1" type="text"
                                           ng-change="search_catalog(add1)">
                                </md-input-container>
                            </div>
                            <div class="col-md-3">
                                <md-input-container class="md-block inputcontainer">
                                    <label> Catalog Specification</label>
                                    <input ng-model="add1.catalogspec1" type="text" ng-change="search_catalog(add1)">
                                </md-input-container>
                            </div>
                            <div class="col-md-2">
                                <md-input-container class="md-block inputcontainer">
                                    <label> Remarks </label>
                                    <input ng-model="add1.catalogremarks1" type="text" ng-change="search_catalog(add1)">
                                </md-input-container>
                            </div>

                                <div class="col-md-1" ng-show="createpartner">
                                    <md-button class="md-fab md-mini md-primary custbutton" ng-click="showpopup()"
                                               ng-show="hideaddbutton">
                                        <md-icon>add</md-icon>
                                        <md-tooltip>Catalogdetails Popup</md-tooltip>
                                    </md-button>
                                </div>
                        </div>


                    </form>


                    <div class="row table-responsive">
                        <div class="col-md-12 col-lg-12 col-sm-12">
                            <table class="table table-striped table-bordered table-condensed table-hover md-primary">
                                <thead class="header">
                                <tr>
                                    <th>S.No</th>

                                    <th>Activity Details Name</th>
                                    <th>Product Name</th>
                                    <th>Catalog Category</th>
                                    <th>Catalog Subcategory</th>
                                    <th>Catalog Name</th>

                                    <th>Catalog Remarks</th>
                                    <th>Catalog UOM gid</th>
                                    <th>Catalog From</th>
                                    <th>Catalog To</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr
                                        ng-repeat="prod in getcompaignm.slice(((currentPage-1)*itemsPerPage), ((currentPage)*itemsPerPage))  | filter:searchquery ">
                                    <td>
                                        <center>{{((currentPage-1)*itemsPerPage)+$index+1}}</center>
                                    </td>

                                    <td>{{prod.activitydetails_name}}</td>
                                    <td>{{prod.product_name}}</td>
                                    <td>{{prod.category_name}}</td>
                                    <td>{{prod.subcategory_name}}</td>
                                    <td>{{prod.activitydtlpproduct_name}}</td>

                                    <td>{{prod.activitydtlpproduct_remarks}}</td>
                                    <td>{{prod.uom_name}}</td>
                                    <td>{{prod.activitydtlpproduct_validfrom | date:'dd-MMM-yyyy'}}</td>
                                    <td>{{prod.activitydtlpproduct_validto | date:'dd-MMM-yyyy'}}</td>
                                    <td align="center">
                                        <a align="center" class="editlink" ng-click="show_catalog(prod)" title="View">
                                            <i class="material-icons">visibility</i>
                                        </a>
                                        <span align="center" class="editlink" ng-click="edit_data(prod)" ng-show="createpartner"
                                              title="Edit">
                                        <i class="material-icons">edit</i>
                                    </span>
                                    </td>
                                </tr>
                                </tbody>
                                <tfoot>
                                <tr>
                                    <td colspan="9">
                                        <ul boundary-links="true" class="pagination-sm" items-per-page="itemsPerPage"
                                            max-size="maxSize" ng-model="currentPage" total-items="pageLength"
                                            uib-pagination></ul>
                                    </td>
                                    <td colspan="4">
                                        Total Count:{{getcompaignm.length}}
                                    </td>
                                </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                    <div class="row" ng-show="showsubmit">
                        <div class="col-md-4 col-md-offset-4">

                            <md-button class="md-raised" ng-href="atma_activitydetails" value="close">Cancel</md-button>

                        </div>
                    </div>
                </div>
            </div>
            <div class="row" ng-show="showcatalog">
                <div class="col-md-12">
                    <div class="row">
                        <div class="row-header col-lg-12 col-sm-12">
                            <div class="col-lg-10 col-sm-10">
                                <h4><strong>ATMA Assign Catalog Details</strong></h4>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Partner Name</label>
                                <input type="text" ng-model="checker.Partnername" maxlength="64>=1"
                                       ng-change="change_checkerpage(checker)">
                            </md-input-container>
                        </div>
                        <div class="col-md-3">
                            <md-input-container class="md-block inputcontainer">
                                <label>Product Name</label>
                                <input type="text" ng-model="checker.Productname" maxlength="64>=1"
                                       ng-change="change_checkerpage(checker)">
                            </md-input-container>
                        </div>
                    </div>
                    <div class="row table-responsive">
                        <div class="col-md-12 col-lg-12 col-sm-12">
                            <table class="table table-striped table-bordered table-condensed table-hover md-primary">
                                <thead class="header">
                                <tr>
                                    <th>S.No</th>
                                    <th>Partner Name</th>
                                    <th>Product Name</th>
                                    <th>Valid Date From</th>
                                    <th>Valid Date To</th>
                                    <th>Raised By</th>
                                    <th>Partner Status</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr
                                        ng-repeat="emp in checkerdetails.slice(((currentPages-1)*itemsPerPages), ((currentPages)*itemsPerPages))  | filter:searchquery ">
                                    <td>
                                        <center>{{((currentPages-1)*itemsPerPages)+$index+1}}</center>
                                    </td>

                                    <td>{{emp.partner_name}}</td>
                                    <td>{{emp.product_name}}</td>
                                    <td>{{emp.mpartnerproduct_validfrom | date:'dd-MMM-yyyy'}}</td>
                                    <td>{{emp.mpartnerproduct_validto | date:'dd-MMM-yyyy'}}</td>
                                    <td>{{emp.employee_name}}</td>
                                    <td>{{emp.mpartnerproduct_status}}</td>
                                    <td align="center" >
                               <span title="Assign Catalog" ng-click="assign_catalog(emp)" align="center"
                                     class="editlink">
                        <i class="material-icons" style="material-icons.line-height:3px">send</i>
                    </span>
                                    </td>
                                </tr>
                                </tbody>
                                <tfoot>
                                <tr>
                                    <td colspan="6">
                                        <ul boundary-links="true" class="pagination-sm" items-per-page="itemsPerPages"
                                            max-size="maxSize" ng-model="currentPage" total-items="pageLengths"
                                            uib-pagination></ul>
                                    </td>
                                    <td colspan="4">
                                        Total Count:{{checkerdetails.length}}
                                    </td>
                                </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                    </form>
                    <div class="row">
                        <div class="col-md-4 col-md-offset-4">
                            <md-button class="md-raised" ng-href="ATMA_PartnerSummary" value="close">Cancel</md-button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

{% endverbatim %}
<script>
    var app_review = angular.module('Appreview', ['ngMaterial', 'ui.bootstrap', 'AppCommon', 'ngMessages'])
        .config(function ($httpProvider) {
            $httpProvider.defaults.xsrfCookieName = 'csrftoken';
            $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
        });
    app_review.run(function ($mdDateLocale, $filter) {
        $mdDateLocale.formatDate = function (date) {
            return $filter('date')(date, "dd-MMM-yyyy");
        };
    })
    app_review.controller('Ctrlreview', function ($scope, $rootScope, $filter, $mdDialog, Servicedrctsale,
        SerCommon, $element, $window, $location) {
        $element.find('input').on('keydown', function (ev) {
            ev.stopPropagation();
        });
        var detail = JSON.parse(sessionStorage.getItem('today'));
        $scope.employgid = detail.employee_gid1;
        $scope.entity_gid = detail.entity_gid;
        $scope.create_by = detail.employee_gid;
        $scope.updtdis = true;
        $scope.currentPage = 1;
        $scope.maxSize = 3;
        $scope.add = [];
        $scope.itemsPerPage = 10;
        $scope.gf = true;
        $scope.maxDate = new Date();
        $scope.currentPages = 1;
        $scope.maxSize = 3;
        $scope.itemsPerPages = 10;
        $scope.catalog = [];
        $scope.gotcatagory =gotcatagory;
        $scope.getproduct_gid = getproduct_gid;
        $scope.loading = function () {
            $mdDialog.show({
                templateUrl: 'loaderSpinner',
                parent: angular.element(document.body),
                clickOutsideToClose: false
            });
        };
        window.mdSelectOnKeyDownOverride = function (event) {
           event.stopPropagation();
       };


          var partner_detail = JSON.parse(sessionStorage.getItem('partner_summary_session'));
        $scope.partner_gid = partner_detail.partnerdata.partner_gid;
        $scope.requestfor = partner_detail.partnerdata.partner_requestfor;
        //alert( $scope.requestfor);
        var catalog_gid=JSON.parse(sessionStorage.getItem('catalog_details_gid'));
       $scope.summarychecker=[catalog_gid];
       $scope.activity_details_gid=catalog_gid.activitydetails_gid;
       $scope.activity_details_name=catalog_gid.activitydetails_name;
       $scope.activity_partnergid=catalog_gid.activity_partnergid;
       $scope.activity_partnercretaeby=catalog_gid.create_by;
       //$scope.activitydetails_activity_gid=catalog_gid.activitydetails_activitygid;
       //alert($scope.activity_partnergid);
       //alert($scope.activity_partnercretaeby);

       if( $scope.create_by ==  $scope.activity_partnercretaeby){
     //alert("True");
     $scope.createpartner=true;
     }else{
     //alert("False");
     $scope.createpartner=false;
     }

        $scope.endloading = function () {
            $mdDialog.hide();
        };
        $rootScope.showpopup = function () {
           $scope.updatecatalog=false;
        $scope.addcatalog=true;
            $scope.add.catalogactivitydetail=$scope.activity_details_name,
            $scope.add.catalogcategory="",
            $scope.add.subcategory="",
            $scope.add.catalogname="",
            $scope.add.catalogspec="",
            $scope.add.catalogsize="",
            $scope.add.catalogremarks="",
            $scope.add.uomgid="",
            $scope.add.catalograte="",
            $scope.add.contractfrom="",
            $scope.add.contractto="",
            $scope.add.unitprice="",
            $scope.add.packingprice="",
            $scope.add.deliverydays="",
            $scope.add.capacitypw="",
            $scope.add.dts="",
            $scope.add.catalog_partner_product_gid="",
            modalshow('addcatalogdetailspopup');
        }

<!--        $scope.catalogcategorychange=function(e){-->
<!--        -->
<!--        $scope.ccatagory_gid=e. catalogcategory;-->
<!--        }-->
        function categoryname(query) {
            var result = $filter('filter')($scope.categoryname, {
                'category_name': query
            });
            return result;
        }
        var
            datan = {
                "Table_name": "ap_mst_tcategory",
                "Column_1": "category_gid,category_name",
                "Column_2": "",
                "Where_Common": "category",
                "Where_Primary": "",
                "Primary_Value": "",
                "Order_by": "name"
            }
        var
            trans = {
                Action: "",
                Entity_Gid: $scope.entity,
                data: datan
            }
        $scope.categorydetails = [];
        var getcategory = Servicedrctsale.getprodt(trans)
        getcategory.then(function (result) {
            $scope.categorydetails = result.data.DATA;
        }, function (err) {
            // alert('No data!.');
        }).finally();
        function subcategoryname(query) {
            var result = $filter('filter')($scope.subcategoryname, {
                'subcategory_name': query
            });
            return result;
        }

        function gotcatagory(query) {
            var result = $filter('filter')($scope.categorydetails, {
                'category_name': query
            });
            return result;
        }

$scope.close_fun=function(){
var r = confirm("Press Ok to Close This Window");
            if (r == true) {
                //alert("dfgv")
                modalhide('addcatalogdetailspopup');
                }else{
                 modalshow('addcatalogdetailspopup');
                }

}

        //catalogcategorychange();
       $scope.catalogcategorychange=function(e){

            var
                datan = {
                    "Table_name": "ap_mst_tsubcategory",
                    "Column_1": "subcategory_gid,subcategory_name",
                    "Column_2": "",
                    "Where_Common": "subcategory",
                    "Where_Primary": "categorygid",
                    "Primary_Value": e.catalogcategory,
                    "Order_by": "name"
                }
            var
                subtrans = {
                    Action: "",
                    Entity_Gid: $scope.entity,
                    data: datan
                }
            $scope.subcategorydetails = [];
            var getsubcategory = Servicedrctsale.getprodt(subtrans)
            getsubcategory.then(function (result) {
                $scope.subcategorydetails = result.data.DATA;
                //alert(JSON.stringify($scope.subcategorydetails));
            }, function (err) {
                // alert('No data!.');
            }).finally();
        }

        function gotouom(query) {
            var result = $filter('filter')($scope.uomname, {
                'uom_name': query
            });
            return result;
        }
        var
            datan = {
                "Table_name": "gal_mst_tuom",
                "Column_1": "uom_gid,uom_code,uom_name",
                "Column_2": "",
                "Where_Common": "uom",
                "Where_Primary": "",
                "Primary_Value": "",
                "Order_by": "name"
            }
        var
            transuom = {
                Action: "",
                Entity_Gid: $scope.entity,
                data: datan
            }
        var getuom = Servicedrctsale.getprodtuom(transuom)
        getuom.then(function (result) {
            $scope.uom = result.data.DATA;
        }, function (err) {
            alert('No data!.');
        }).finally();
        function gotocatalog(query) {
            var result = $filter('filter')($scope.catlogname, {
                'catalog_name': query
            });
            return result;
        }
        getcatalogdetails();
        function getcatalogdetails(){
        var data = {
            "Params": {
                "Filter": {
                "activitydtlpproduct_activitydetailsgid":  $scope.activity_details_gid,
                "mpartnerproduct_partner_gid":  $scope.partner_gid,
                "mPartnerProduct_Status":"Draft",
                },
                "Classification": {
                    "Entity_Gid": $scope.entity_gid
                }
            }
        }
        var dtam = {
            Group: 'Catalog_Details',
            Type: 'activitydtlpp_GET',
            data: data
        }
        $scope.getcompaignm = [];
        var getcompaignm = Servicedrctsale.getdattam(dtam)
        getcompaignm.then(function (result) {
            $scope.getcompaignm = result.data.DATA;
            $scope.getcompaignms = result.data.DATA.partner_requestfor;
            //alert(JSON.stringify($scope.getcompaignm));
            //alert(JSON.stringify($scope.getcompaignms));
            $scope.searchcatalog=$scope.getcompaignm;
            $scope.load = $scope.getcompaignm
            $scope.pageLength = $scope.getcompaignm.length;
            $scope.pageLengths = $scope.checkerdetails.length;
        }, function (err) {
            alert('No data!.');
        }).finally();

        }

        $scope.search_catalog=function(e){

            if(e.catalogcategory1 != undefined && e.catalogcategory1 != null && e.catalogcategory1 !='' )
        {
        var tempvar= e.catalogcategory1.category_name;
        }
        else
        {
        var tempvar='';
        }
            $scope.getcompaignm = $filter('filter')($scope.searchcatalog , {

               "activitydtlpproduct_name":e.catalogname1 == null ||  e.catalogname1 == undefined  || e.catalogname1 == '' ? '' : e.catalogname1,
               "activitydtlpproduct_spec":e.catalogspec1 == null ||  e.catalogspec1 == undefined  || e.catalogspec1 == '' ? '' : e.catalogspec1,
               "activitydtlpproduct_remarks":e.catalogremarks1 == null ||  e.catalogremarks1 == undefined  || e.catalogremarks1 == '' ? '' : e.catalogremarks1,
               "activitydtlpproduct_category":tempvar == null ||  tempvar == undefined  || tempvar == '' ? '' : tempvar


        });
}


        $scope.showview = function (prod) {


            modalshow('catalogdetails_view_page');
        }
        $scope.catalog_save = function (add) {

            //alert(JSON.stringify(add))
            var data = {
                "Params": {
                    "activitydtlpproduct_ActivityDetailsGid":$scope.activity_details_gid,
                    "activitydtlpproduct_Category": add.catalogcategory,
                    "activitydtlpproduct_SubCategory": add.subcategory,
                    "activitydtlpproduct_Name": add.catalogname,
                    "activitydtlpproduct_Spec": add.catalogspec,
                    "activitydtlpproduct_Size": add.catalogsize,
                    "activitydtlpproduct_Remarks": add.catalogremarks,
                    "activitydtlpproduct_UomGid": (add.uomgid).toString(),
                    "activitydtlpproduct_Rate": add.catalograte,
                    "activitydtlpproduct_ValidFrom": add.contractfrom,
                    "activitydtlpproduct_ValidTo": add.contractto,
                    "mPartnerProduct_UnitPrice": add.catalograte,
                    "mPartnerProduct_PackingPrice": add.packingprice,
                    "mPartnerProduct_DeliveryDays": add.deliverydays,
                    "mPartnerProduct_CapacityPW": add.capacitypw,
                    "mPartnerProduct_DTS": add.dts,
                    "mPartnerProduct_Status":"Draft",
                    "mPartnerProduct_Partner_Gid": $scope.activity_partnergid,
                    "mPartnerProduct_Product_Gid": $scope.mpartnerproduct_gid
                },
                "Classification": {
                    "Create_By": $scope.create_by,
                    "Entity_Gid": $scope.entity_gid,
                },
            }
            var total = {
                Group: 'Catalog Details',
                Action: 'activitydtlpp_INSERT',
                Type: 'Catalog Details',
                data: data
            }
            var set_catalog = Servicedrctsale.pcatalog(total)
            set_catalog.then(function (result) {
                    $scope.catalog = [];
                    $scope.catalog = result.data.MESSAGE;
                    if($scope.catalog=="SUCCESSFULLY INSERTED"){
                    alert("SUCCESSFULLY INSERTED");
                    modalhide('addcatalogdetailspopup');
                    getcatalogdetails();
                    }else{
                    alert(JSON.stringify($scope.catalog));
                    //$window.location.href = 'ATMA_PartnerSummary';
                    }
                }),
                function (err) {
                    alert('no data');
                };
        }
        $scope.catalogsubcategorychange=function(e){

           var datan = {
                "Table_name": "gal_mst_tproduct",
                "Column_1": "product_gid,product_name",
                "Column_2": "",
                "Where_Common": "product",
                "Where_Primary": "subcategory_gid",
                "Primary_Value": "1",
                "Order_by": "gid"
            }
        var total = {
                Action: "Productname",
                Entity_Gid: $scope.entity,
                data: datan
            }
            var get_partnerproduct_gid = Servicedrctsale.partnerproductgidservice(total)
            get_partnerproduct_gid.then(function (result) {
                    $scope.partner_product = [];
                    $scope.partner_product = result.data.DATA;
                   //alert(JSON.stringify($scope.partner_product))
                }),
                function (err) {
                    alert('no data');
                };

        }

        $scope.partnerprod_gid=function(e){

        $scope.mpartnerproduct_gid=e.product_gid

        }
        function getproduct_gid(module) {
        var result = $filter('filter')($scope.partner_product, {
            'product_name': module

        });
        return result;
    }
        $scope.catalog_update=function(add){

        var data = {
                "Params": {
                    "activitydtlpproduct_Gid":$scope.catalogdetails_gid,
                    "activitydtlpproduct_Category": add.catalogcategory,
                    "activitydtlpproduct_SubCategory": add.subcategory,
                    "activitydtlpproduct_Name": add.catalogname,
                    "activitydtlpproduct_Spec": add.catalogspec,
                    "activitydtlpproduct_Size": add.catalogsize,
                    "activitydtlpproduct_Remarks": add.catalogremarks,
                    "activitydtlpproduct_UomGid": (add.uomgid).toString(),
                    "activitydtlpproduct_Rate": add.catalograte,
                    "activitydtlpproduct_ValidFrom": add.contractfrom,
                    "activitydtlpproduct_ValidTo": add.contractto,
                    "mPartnerProduct_Product_Gid":$scope.mpartnerproduct_gid,
                    "mPartnerProduct_UnitPrice":add.unitprice,
                    "mPartnerProduct_PackingPrice":add.packingprice,
                    "mPartnerProduct_DeliveryDays":add.deliverydays,
                    "mPartnerProduct_CapacityPW":add.capacitypw,
                    "mPartnerProduct_DTS":add.dts
                },
                "Classification": {
                    "Update_By": $scope.create_by,
                    "Entity_Gid": $scope.entity_gid,
                },
            }
            var total = {
                Group: 'Catalog_Details_Update',
                Action: 'activitydtlpp_UPDATE',
                Type: 'Catalog Details',
                data: data
            }
            var update_catalog = Servicedrctsale.updatecatalogservice(total)
            update_catalog.then(function (result) {
                    $scope.update_catalog = [];
                    $scope.update_catalog = result.data;
                    if($scope.update_catalog=="SUCCESS"){
                    alert("SUCCESSFULLY UPDATED");
                    modalhide('addcatalogdetailspopup');
                    getcatalogdetails();
                    }else{
                    alert(JSON.stringify($scope.update_catalog));
                    modalshow('addcatalogdetailspopup');
                    //$window.location.href = 'ATMA_PartnerSummary';
                    }
                }),
                function (err) {
                    alert('no data');
                };

        }

        $scope.edit_data_actdet=function(e){

        $scope.updatecatalog=true;
        $scope.addcatalog=false;
                $scope.catalogdetails_gid=e.activitydtlpproduct_gid,
                $scope.add.catalog_partner_product_gid=e.product_name,
                $scope.add.catalogactivitydetail=$scope.activity_details_name,
                $scope.add.catalogcategory=e.activitydtlpproduct_category,
               $scope.add.subcategory=e.activitydtlpproduct_subcategory,
                $scope.add.catalogname=e.activitydtlpproduct_name,
                $scope.add.catalogspec=e.activitydtlpproduct_spec,
                $scope.add.catalogsize=e.activitydtlpproduct_size,
                $scope.add.catalogremarks=e.activitydtlpproduct_remarks,
                $scope.add.uomgid=e.activitydtlpproduct_uomgid,
                $scope.add.catalograte=e.activitydtlpproduct_rate,
                $scope.add.contractfrom=new Date(e.activitydtlpproduct_validfrom),
                $scope.add.contractto=new Date(e.activitydtlpproduct_validto),
                $scope.add.unitprice=e.activitydtlpproduct_rate,
                $scope.add.packingprice=e.mpartnerproduct_packingprice,
                $scope.add.deliverydays=e.mpartnerproduct_deliverydays,
                $scope.add.capacitypw=e.mpartnerproduct_capacitypw,
                $scope.add.dts=e.mpartnerproduct_dts,
                $scope.add.mpartnerproduct_gid=e.activitydtlpproduct_gid,
                modalshow('addcatalogdetailspopup')
        }
        $scope.show_catalog=function(e){

        $scope.updatecatalog=false;
        $scope.addcatalog=false;
                $scope.catalogdetails_gid=e.activitydtlpproduct_gid,
                $scope.add.catalog_partner_product_gid=e.product_name,
                $scope.add.catalogactivitydetail=$scope.activity_details_name,
                $scope.add.catalogcategory=e.activitydtlpproduct_category,
               $scope.add.subcategory=e.activitydtlpproduct_subcategory,
                $scope.add.catalogname=e.activitydtlpproduct_name,
                $scope.add.catalogspec=e.activitydtlpproduct_spec,
                $scope.add.catalogsize=e.activitydtlpproduct_size,
                $scope.add.catalogremarks=e.activitydtlpproduct_remarks,
                $scope.add.uomgid=e.activitydtlpproduct_uomgid,
                $scope.add.catalograte=e.activitydtlpproduct_rate,
                $scope.add.contractfrom=new Date(e.activitydtlpproduct_validfrom),
                $scope.add.contractto=new Date(e.activitydtlpproduct_validto),
                $scope.add.unitprice=e.mpartnerproduct_unitprice,
                $scope.add.packingprice=e.mpartnerproduct_packingprice,
                $scope.add.deliverydays=e.mpartnerproduct_deliverydays,
                $scope.add.capacitypw=e.mpartnerproduct_capacitypw,
                $scope.add.dts=e.mpartnerproduct_dts,
                $scope.add.mpartnerproduct_gid=e.activitydtlpproduct_gid,
                modalshow('addcatalogdetailspopup')
        }
        function catalogactivitydetail(query) {
            var result = $filter('filter')($scope.catactdetail, {
                'activitydetails_name': query
            });
            return result;
        }
        var
            datan = {
                "Table_name": "atma_mst_tactivitydetails",
                "Column_1": "activitydetails_gid,activitydetails_name",
                "Column_2": "",
                "Where_Common": "activitydetails",
                "Where_Primary": "",
                "Primary_Value": "",
                "Order_by": "name"
            }
        var
            transact = {
                Action: "",
                Entity_Gid: $scope.entity,
                data: datan
            }
        $scope.catalogactivitydetails = [];
        var getcatactdetails = Servicedrctsale.getprodtact(transact)
        getcatactdetails.then(function (result) {
            $scope.catalogactivitydetails = result.data.DATA;
        }, function (err) {
            // alert('No data!.');
        }).finally();


         //assgin catalog process
    getPartnerProductCheckerDetails();
function getPartnerProductCheckerDetails(){

    var data = {
        "Params": {
        "Partner_Gid":$scope.activity_partnergid,

         },
         "Classification": {
            "Entity_Gid":$scope.entity_gid,
         },
    }
    var details = {
        Group: 'Checker_Get',
        Action: 'Checker_Get',
        Type:"",
        data: data,
    }
    var get_checkerdetails = Servicedrctsale.checkergetService(details)
    get_checkerdetails.then(function(result) {
        $scope.checkerdetails = result.data.DATA;
        $scope.searchcheckerdetails=$scope.checkerdetails;
        //alert(JSON.stringify($scope.checkerdetails))
    }),
    function(err) {
        alert('no data');
    };
}


$scope.change_checkerpage=function(e){

        $scope.checkerdetails = $filter('filter')($scope.searchcheckerdetails , {
               "partner_name": e.Partnername,
               "product_name": e.Productname

        });
}

$scope.assign_catalog=function(e){

var data = {
        "Params": {
        "mPartnerProduct_Gid":e.mpartnerproduct_gid,
        "ActivitydtlpProduct_ActivityDetailsGid":$scope.activity_details_gid,
        "mPartnerProduct_Status":"Draft",
         },
         "Classification": {
            "Create_By": $scope.create_by,
            "Entity_Gid":$scope.entity_gid,
         },
    }
    var details = {
        Group: 'CATALOG_ASSIGN',
        Action: 'Assign_Catalog_Insert',
        Type:"",
        data: data,
    }
    var set_assingcatalogdetails = Servicedrctsale.assigncatalogService(details)
    set_assingcatalogdetails.then(function(result) {
        $scope.assign_catalogdetails = result.data.MESSAGE;
        if($scope.assign_catalogdetails == "SUCCESS"){
        alert("Catalog Assgin Successfully");
        getcatalogdetails();
        getPartnerProductCheckerDetails();
        }
        $scope.searchassigncatalog=$scope.assign_catalogdetails;
        //alert(JSON.stringify($scope.assign_catalogdetails))
    }),
    function(err) {
        alert('no data');
    };
}

if( $scope.requestfor == "MODIFICATION"){
$scope.showcatalog=true;
$scope.hideaddbutton=false;
$scope.showsubmit=false;
}else{
$scope.showcatalog=false;
$scope.hideaddbutton=true;
$scope.showsubmit=true;
}
    });



    app_review.service("Servicedrctsale", function ($http) {
        this.getprodt = function (trans) {
            var respons = $http.post(Appname + "/prodget/", trans);
            return respons;
        }
        this.getprodtuom = function (transuom) {
            var respons = $http.post(Appname + "/prodget/", transuom);
            return respons;
        }
        this.getprodtact = function (transact) {
            var respons = $http.post(Appname + "/prodget/", transact);
            return respons;
        }
        this.pcatalog = function (total) {
            var response = $http.post(Appname + "/atmacatalogset/", total);
            return response;
        }
        this.getdattam = function (dtam) {
            var respons = $http.post(Appname + "/atmacatalog_get/", dtam);
            return respons;
        }
        this.updatecatalogservice = function (dtam) {
            var respons = $http.post(Appname + "/atmacatalogset/", dtam);
            return respons;
        }
        this.partnerproductgidservice = function (dtam) {
            var respons = $http.post(Appname + "/prodget/", dtam);
            return respons;
        }

         this.checkergetService = function(get_data) {
        var response = $http.post(Appname + "/atma_CheckerDetails/", get_data);
        return response;
    }
   this.assigncatalogService = function(get_data) {
        var response = $http.post(Appname + "/atmacatalogset/", get_data);
        return response;
    }
    });

</script>
{% endblock %}