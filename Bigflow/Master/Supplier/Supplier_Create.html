{% extends 'Shared/mainLayout.html' %}
{% load static from staticfiles %}
{% block title %} Supplier Master {% endblock %}
{% block content %}
{% csrf_token %}
{% verbatim %}
<div class="maincontent">
    <div ng-app="Appsupplierrate" ng-controller="Ctrlsupplierrate" class="container container1">
        <div class="row">
            <div class="row-header col-lg-12 col-sm-12">
                <h4>{{title}} Supplier </h4>
            </div>
        </div>
        <form name="demoForm">
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Supplier Group</label>
                            <md-select ng-model="selectedSupplierGrp" ng-disabled="addressdisabled"
                                ng-click="suppgroupdata(selectedSupplierGrp)" md-on-close="clearSearchTerm()"
                                data-md-container-class="selectdemoSelectHeader">
                                <md-select-header class="demo-select-header">
                                    <input ng-model="ser" type="search" placeholder="Search for a Supplier Group.."
                                        onkeydown="mdSelectOnKeyDownOverride(event)"
                                        class="demo-header-searchbox md-text" required />
                                </md-select-header>
                                <md-optgroup label="Supplier Group">
                                    <md-option ng-value="c" ng-repeat="c in la_cust_grp_ddl |
                                     filter:ser" ng-selected="selectedSupplierGrp_session == c.suppliergroup_gid">
                                        {{c.suppliergroup_name}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>


                    <div class="col-md-1 col-sm-3 col-xs-3 text-center">
                        <md-button class="md-icon-button md-primary" aria-label="Settings"
                            ng-click="modal_open(selectedSupplierGrp)">
                            <md-icon>add</md-icon>
                            <md-tooltip>Add Supplier Group</md-tooltip>
                        </md-button>
                    </div>
                    <div class="col-md-4 col-sm-12 col-xs-12">
                        <md-input-container class="md-block inputcontainer">
                            <label>Supplier Name</label>
                            <input ng-model="name" maxlength="60" ng-pattern="/^([A-Za-z0-9 @&(\[\])-/]){3,}]*$/"
                                capitalize ng-required="true" />
                        </md-input-container>
                    </div>
                    <div class="col-md-3 col-sm-12 col-xs-12">
                        <md-input-container class="md-block inputcontainer">
                            <label>Supplier Capacity</label>
                            <input ng-model="code1" numbers-only maxlength="4" ng-required="true" />
                        </md-input-container>
                    </div>

                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Supplier Branch</label>
                            <input ng-model="supbranch" maxlength="25"  ng-change="Check(supbranch)" required>


                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Supplier GST No</label>
                            <input ng-model="supgst" maxlength="64" capitalize ng-change="Check1(supgst)">

                        </md-input-container>
                    </div>
                </div>



            </div>


            <div class="row">

                <div class="md-accent md-subheader _md ng-scope" role="heading" aria-level="2">
                    <div class="md-subheader-inner">
                        <div class="md-subheader-content">Address</div>
                    </div>
                </div>
            </div>

            <div class="row" layout-xs="column" layout-padding="">
                <div class="col-md-12">
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Address Line 1</label>
                            <input ng-model="adline" capitalize maxlength="128" ng-disabled="addressdisabled"
                                ng-required="true" />
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Address Line 2</label>
                            <input ng-model="adline2" capitalize maxlength="128" ng-disabled="addressdisabled" />
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Address Line 3</label>
                            <input ng-model="adline3" capitalize maxlength="128" ng-disabled="addressdisabled" />
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>State</label>
                            <md-select ng-model="selectedState" ng-change="state_clk(selectedState)"
                                ng-disabled="addressdisabled" md-on-close="clearSearchTerm()"
                                data-md-container-class="selectdemoSelectHeader">
                                <md-select-header class="demo-select-header">
                                    <input ng-model="serchTerm" type="search" placeholder="Search for a State.."
                                        onkeydown="mdSelectOnKeyDownOverride(event)"
                                        class="demo-header-searchbox md-text" />
                                </md-select-header>
                                <md-optgroup label="State">
                                    <md-option ng-value="c.state_gid" ng-repeat="c in stateddl |
                                     filter:serchTerm">{{c.state_name}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>District</label>
                            <md-select ng-model="selecteddistrict" ng-change="district_clk(selecteddistrict)"
                                ng-disabled="addressdisabled" md-on-close="clearSearchTerm()"
                                data-md-container-class="selectdemoSelectHeader">
                                <md-select-header class="demo-select-header">
                                    <input ng-model="sarchTerm" type="search" placeholder="Search for a State.."
                                        onkeydown="mdSelectOnKeyDownOverride(event)"
                                        class="demo-header-searchbox md-text" />
                                </md-select-header>
                                <md-optgroup label="State">
                                    <md-option ng-value="c.district_gid" ng-repeat="c in distritddl |
                                     filter:sarchTerm">{{c.district_name}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>City</label>
                            <md-select ng-model="selectedcity" ng-change="city_clk(selectedcity)"
                                ng-disabled="addressdisabled" md-on-close="clearSearchTerm()"
                                data-md-container-class="selectdemoSelectHeader">
                                <md-select-header class="demo-select-header">
                                    <input ng-model="srchTerm" type="search" placeholder="Search for a City.."
                                        onkeydown="mdSelectOnKeyDownOverride(event)"
                                        class="demo-header-searchbox md-text">
                                </md-select-header>
                                <md-optgroup label="City">
                                    <md-option ng-value="c.city_gid" ng-repeat="c in city1 |
                                     filter:srchTerm">{{c.City_Name}}
                                    </md-option>
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                    <div class="col-md-3">
                        <md-input-container class="md-block inputcontainer">
                            <label>Pincode</label>
                            <input ng-model="pcode" numbers-only ng-pattern="pincodevalidation"
                                ng-blur="pinchange(pcode)" ng-disabled="addressdisabled" ng-required="true" />
                        </md-input-container>
                    </div>
                </div>
            </div>
            <div class="row">
                <div ng-include="'empcntct'">Add Contact</div>
            </div>
            <div class="col-md-4 col-md-offset-4">
                <md-input-container class="md-block inputcontainer">
                    <md-button class="md-raised custbutton" value="save" ng-hide="save" ng-disabled="myForm.$invalid"
                        ng-click="grpsave(add)">
                        save
                    </md-button>
                    <md-button class="md-raised custbutton" value="submit" ng-hide="update" ng-click="grpedit(add)"
                        ng-disabled=" myForm.Name.$invalid  || myForm.Code.$invalid">
                        update
                    </md-button>
                    <md-button class="md-raised" ng-click="cancel()" ng-href="suppliersummary">Cancel</md-button>
                </md-input-container>
            </div>
        </form>

        <!--       Supplier Group Modal pop  -->
        <form name="createform">
            <div class="modal fade" id="supplier_grp_view" tabindex="-1" role="dialog" data-backdrop="static"
                data-keyboard="false" style="height:auto;width:100%" aria-labelledby="exampleModalLabel"
                aria-hidden="true">
                <form name="histroy" novalidate>
                    <div class="modal-dialog modal-lg modal-style" role="document">
                        <div class="modal-content">
                            <div class="header">
                                <div class="modal-header popup-header">
                                    <h5 class="modal-title" id="exampleModalLabel">
                                        <strong>Supplier Group </strong>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </h5>
                                </div>
                            </div>
                            <div class="body">
                                <div class="modal-body popup-body">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="col-lg-6">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Supplier Group Name</label>
                                                    <input ng-model="sggrpname" name="sampl"
                                                        ng-blur="cusgrp_code(grpname)" capitalize maxlength="60"
                                                        ng-pattern="/^([A-Za-z0-9 @&(\[\])-/]){3,}]*$/" required />
                                                </md-input-container>
                                            </div>
                                            <div class="col-lg-1 col-sm-1" ng-if='custgrp_update'>
                                              
                                                    <md-input-container class="md-block inputcontainer">
                                    
                                                        <md-checkbox ng-model="InAct"
                                                                     ng-click="statusofactive(InAct)"  ng-checked="sgstatus">
                                                            Active 
                                                        </md-checkbox>
                                                    </md-input-container>
                                                
                                            </div>


                                            </div>
                                            <div class="col-lg-1 col-sm-1" ng-if='!custgrp_update'>
                                                <md-input-container class="md-block inputcontainer">
                                                    <md-checkbox ng-disabled="true" ng-checked="true"
                                                        aria-label="Disabled checkbox" ng-model="active">
                                                        Active
                                                    </md-checkbox>

                                                </md-input-container>


                                            </div>



                                        </div>
                                    </div>
<!-- main -->
<div ng-if="!custgrp_update2">      
    <md-subheader class="md-accent">Contact</md-subheader>
                                    <div class="row">

                                        <div class="col-md-12">
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Contact Type</label>
                                                    <md-select ng-model="sgcntcttype1" required="true">
                                                        <md-optgroup label="Contact Type">
                                                            <md-option ng-repeat="x in conttype"
                                                                ng-value="x.contacttype_gid"> {{x.contacttype_name}}
                                                            </md-option>
                                                        </md-optgroup>
                                                    </md-select>
                                                </md-input-container>
                                            </div>

                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Contact Person </label>
                                                    <input ng-model="sgpersion" maxlength="64" capitalize
                                                        ng-pattern="/^[a-zA-Z\s]+$/" required>
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Designation</label>
                                                    <md-select ng-model="designation" required="true">
                                                        <md-optgroup label="Designation ">
                                                            <md-option ng-repeat="x in designationdetails"
                                                                ng-value="x.designation_gid"> {{x.designation_name}}
                                                            </md-option>
                                                        </md-optgroup>
                                                    </md-select>
                                                </md-input-container>
                                            </div>

                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Mobile Number</label>
                                                    <input ng-model="sgmobile1" numbers-only maxlength="10"
                                                        minlength="10" ng-pattern="/^[0-9]{10}$/" required>
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Altranate Mobile Number</label>
                                                    <input ng-model="sgmobile2" numbers-only maxlength="10"
                                                        minlength="10" ng-pattern="/^[0-9]{10}$/">
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>LandLine Number</label>
                                                    <input ng-model="sglandlin1" maxlength="12" numbers-only />
                                                </md-input-container>
                                            </div>
                                            <div class="col-md-3">
                                                <md-input-container class="md-block inputcontainer">
                                                    <label>Email ID</label>
                                                    <input ng-model="sgmailid" required maxlength="40"
                                                        ng-pattern="/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/" />
                                                </md-input-container>
                                            </div>
                                        </div>


                                    </div>
                                </div>




                                <div  ng-if="!custgrp_update2" ng-include="'empadrs'">
                                </div>
                            </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <br>
                                        <div class="col-md-6 text-right" ng-if='custgrp_update'>
                                            <md-button class="md-raised custbutton" value="Edit" ng-click="sgrpedit()"
                                                ng-disabled="createform.$invalid">
                                                Update
                                            </md-button>
                                        </div>
                                        <div class="col-md-6 text-right">
                                            <md-button class="md-raised custbutton" value="submit"
                                                ng-click="sggrpsave()" ng-if="!custgrp_update"
                                                ng-disabled="createform.$invalid">
                                                Save
                                            </md-button>
                                        </div>
                                        <div class="col-md-6">
                                            <md-button class="md-raised" value="close" data-dismiss="modal"
                                                aria-label="Close">Cancel
                                            </md-button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </form>
    </div>


</div>
</div>
{% endverbatim %}
<script>
    var app = angular.module('Appsupplierrate', ['ngMaterial', 'ui.bootstrap', 'AppCommon']).config(function (
        $httpProvider) {
        $httpProvider.defaults.xsrfCookieName = 'csrftoken';
        $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
    });




    app.run(function ($mdDateLocale, $filter) {
        $mdDateLocale.formatDate = function (date) {
            return $filter('date')(date, "dd-MMM-yyyy");
        };
    })
    app.controller('Ctrlsupplierrate', ['$scope', 'testService', '$window', '$mdDialog', '$filter', '$http',
        'SerCommon', '$element', '$q',
        function ($scope, testService, $window, $mdDialog, $filter, $http, SerCommon, $element, $q) {
            $scope.update = true;
            var detail = JSON.parse(sessionStorage.getItem('today'));
            $scope.employgid = detail.employee_gid;
            $scope.entity_gid = detail.entity_gid;
            $scope.tdate = convertdate(detail.date);
            // $scope.selectedSupplierGrp = ''
            $scope.current_date = new Date();
            $scope.distritddl = [];
            $scope.disabled = true;
            $scope.loading = function () {
                $mdDialog.show({
                    templateUrl: 'loaderSpinner',
                    parent: angular.element(document.body),
                    clickOutsideToClose: false
                });
            };

            $scope.endloading = function () {
                $mdDialog.hide();
            };
            window.mdSelectOnKeyDownOverride = function (event) {
                event.stopPropagation();
            };
            var sttddl = testService.getstateddl()
            sttddl.then(function (result) {
                    $scope.stateddl = [];
                    $scope.stateddl = JSON.parse(result.data);
                    $scope.locstate = JSON.parse(result.data);
                }),
                function () {
                    alert('no data');
                };


            debugger;
            var lj_data = {
                "Params": {
                    "Details": {},
                    "Classification": {
                        "Entity_Gid": $scope.entity_gid,
                        "Entity_Detail_Gid": 1

                    }

                }
            }
            var jdata = {
                Group: "Supplier_Get",
                Type: "DDL",
                SubType: "SUPPLIER_GROUP",
                data: lj_data

            }
            var cust_grp_ddl = testService.getsupplierrate(jdata)
            cust_grp_ddl.then(function (result) {
                    $scope.la_cust_grp_ddl = result.data.DATA;
                }),
                function () {
                    alert('No Data');
                };

            // $scope.pp=true;
<!--            $scope.Check = function (x) {-->
<!--                var reg = /^![^`~@#$%\^&*()+={}|[\]\\:';"<>?/]*$/;-->
<!--                if (!x.match(reg)) {-->
<!--                    $scope.supbranch = x.substring(0, x.length - 1);-->

<!--                }-->
<!--            };-->
<!--            $scope.Check1 = function (x) {-->
<!--                var reg = /^![^`~@#$%\^&*()+={}|[\]\\:';"<>?/]*$/;-->
<!--                if (!x.match(reg)) {-->
<!--                    $scope.supgst = x.substring(0, x.length - 1);-->

<!--                }-->
<!--            };-->

            $scope.modal_open = function (supp) {
                debugger;
                if (supp != undefined) {
                    var data1 = {
                        "Params": {
                            "Details": {
                                "SupplierGrp_Gid": supp.suppliergroup_gid
                            },
                            "Classification": {
                                "Entity_Gid": $scope.entity_gid,
                                "Entity_Detail_Gid": 1
                            }
                        }
                    }
                    var supgpa = {
                        Group: 'Supplier_Get',
                        Type: 'EDIT_DETAIL',
                        SubType: 'SUPPLIER_GROUP',
                        data: data1
                    }
                    $scope.supgpdt = [];
                    var add = [];
                    var supgpdataddl = testService.getsupplierrate(supgpa)
                    supgpdataddl.then(function (result) {
                            {
                                $scope.supgpdt = result.data.DATA


                                // $scope.add.addline3=$scope.supgpdt[0].address_3
                                $scope.add.addline = $scope.supgpdt[0].address_1
                                $scope.add.addline2 = $scope.supgpdt[0].address_2
                                $scope.add.addline3 = $scope.supgpdt[0].address_3
                                $scope.add.pincode1 = $scope.supgpdt[0].address_pincode
                                $scope.pinchange($scope.supgpdt[0].address_pincode, 'address')
                                $scope.add.addselectedcity = $scope.supgpdt[0].district_gid
                                $scope.designation = $scope.supgpdt[0].contact_designation_gid
                                $scope.sgpersion = $scope.supgpdt[0].contact_personname
                                $scope.sgcntcttype1 = $scope.supgpdt[0].contacttype_gid
                                $scope.sgmobile1 = $scope.supgpdt[0].contact_mobileno
                                $scope.sgmobile2 = $scope.supgpdt[0].contact_mobileno2
                                $scope.sglandlin1 = $scope.supgpdt[0].contact_landline
                                $scope.sgmailid = $scope.supgpdt[0].contact_email
                                $scope.addid = $scope.supgpdt[0].suppliergroup_addgid
                                $scope.concatid = $scope.supgpdt[0].suppliergroup_contactgid
                                $scope.supgpid = $scope.supgpdt[0].suppliergroup_gid

                            }
                        },
                        function () {
                            alert('no data');
                        }).finally();
                    $scope.sggrpname = supp.suppliergroup_name;
                    $scope.custgrp_update = true;
                    $scope.sgstatus=true;





                    $scope.statusofactive = function (a) {
                        debugger;
                        var status = ' '
                        if(confirm('Are yoy sure to clear the records!!?'))
                            {
                            
                                if (a == true) {
                                    $scope.custgrp_update2=true;
                                    status = 'N'
                                    } else {
                                    status = 'Y'
                                    }
                            }
                            else{
                                return false
                            }

                      
                        var data1 = {
                            "parms": {
                                "supplier": {
                                    "SupplierGrp_Gid": $scope.supgpid,
                                    "SupplierGrp_ISActive": status
                                },
                                "classification": {
                                    "Entity_Gid": $scope.entity_gid,
                                    "Create_By": $scope.employgid,
                                    "Entity_Detail_Gid": "1"
                                }
                            }
                        }
                        var sup = {
                            Group: 'Active_INactive_supplier',
                            Action: 'SUPPGRP_STATUS_UPDATE',
                            data: data1
                        }



                        var supgpdataddl = testService.getsupplierrate(sup)
                        supgpdataddl.then(function (result) {
                                if (result.data.MESSAGE == 'SUCCESS') {
                                    // alert('Inserted Successfully');
                                    // $scope.load();
                                    var r=0;
                                    // $scope.loading();
                                } else {
                                    alert(result.data.DATA)
                                }
                            },
                            function () {
                                alert('no data');
                            }).finally();

                    }






                }

                //update supplier group

                $scope.sgrpedit = function () {

                    // if ($scope.sgmobile2 == undefined) {
                    //     $scope.sgmobile2 = ' '
                    // }
                    // if ($scope.add.addline2 == undefined) {
                    //     $scope.add.addline2 = ' '
                    // }
                    // if ($scope.add.addline3 == undefined) {
                    //     $scope.add.addline3 = ' '
                    // }
                    debugger;
                    var data1 = {
                        "Params": {
                            "Supplier": {
                                "SupplierGrp_Name": $scope.sggrpname,
                                "SupplierGrp_Gid": $scope.supgpid
                            },
                            "Address": {

                                "Address_Gid": $scope.addid,

                                "Address1": $scope.add.addline,
                                "Address2": $scope.add.addline2,
                                "Address3": $scope.add.addline3,
                                "Pincode": $scope.add.pincode1,
                                "District_Gid": $scope.add.addselecteddistrict,
                                "City_Gid": $scope.add.addselectedcity,
                                "State_Gid": $scope.add.addselectedstate
                            },
                            "Contact": {
                                "Contact_Gid": $scope.concatid,
                                "Contacttype_Gid": $scope.sgcntcttype1,
                                "Contact_Name": $scope.sgpersion,
                                "Designation_Gid": $scope.designation,
                                "Mobile_No1": $scope.sgmobile1,
                                "Landline_No1": $scope.sglandlin1,
                                "Landline_No2": " ",
                                "Mobile_No2": $scope.sgmobile2,
                                "Email": $scope.sgmailid,
                                "Contact_Dob": "",
                                "Contact_Wd": " "
                            },
                            "Classification": {
                                "Entity_Gid": $scope.entity_gid,
                                "Create_By": $scope.employgid,
                                "Entity_Detail_Gid": "1"
                            }
                        }
                    }
                    var supgpdata = {
                        Group: 'Supplier_Set',
                        Action: 'SUPPLIER_GROUP_UPDATE',
                        value: data1
                    }

                    var supgpdataddl = testService.getsupplierrate(supgpdata)
                    supgpdataddl.then(function (result) {
                            if (result.data.MESSAGE == 'SUCCESS') {
                                alert('Inserted Successfully');
                                $scope.load();
                                $scope.loading();
                            } else {
                                alert(result.data.DATA)
                            }
                        },
                        function () {
                            alert('no data');
                        }).finally();



                }

                var eaddrsttddl = testService.getstateddl()
                eaddrsttddl.then(function (result) {
                        $scope.stateddl = [];
                        $scope.stateddl = JSON.parse(result.data);
                    }),
                    function () {
                        alert('no data');
                    };

                $scope.pinchange = function (pincode, type) {
                    var pincd = testService.getpincodeall(pincode)
                    pincd.then(function (result) {
                            if (type == 'address') {
                                var apincde = [];
                                apincde = JSON.parse(result.data);
                                $scope.add.addselectedstate = apincde[0].city_state_gid;
                                $scope.state_clk($scope.add.addselectedstate, 'address');
                                $scope.add.addselecteddistrict = apincde[0].pincode_district_gid;
                                $scope.district_clk($scope.add.addselecteddistrict, 'address');
                                $scope.add.addselectedcity = apincde[0].pincode_City_gid;
                                $scope.add.pincode1 = apincde[0].pincode_no;
                            }
                        }),
                        function () {
                            alert('no data');
                        };
                };
                modalshow('supplier_grp_view');
                //Save data
                $scope.add = [];
                $scope.sggrpsave = function () {
                    if ($scope.sgmobile2 == undefined) {
                        $scope.sgmobile2 = ' '
                    }
                    if ($scope.add.addline2 == undefined) {
                        $scope.add.addline2 = ' '
                    }
                    if ($scope.add.addline3 == undefined) {
                        $scope.add.addline3 = ' '
                    }

                    var data1 = {
                        "Params": {
                            "Supplier": {
                                "Supplier_Group_Name": $scope.sggrpname
                            },
                            "Address": {

                                "Address1": $scope.add.addline,
                                "Address2": $scope.add.addline2,
                                "Address3": $scope.add.addline3,
                                "Pincode": $scope.add.pincode1,
                                "District_Gid": $scope.add.addselecteddistrict,
                                "City_Gid": $scope.add.addselectedcity,
                                "State_Gid": $scope.add.addselectedstate
                            },
                            "Contact": {
                                "Contacttype_Gid": $scope.sgcntcttype1,
                                "Contact_Name": $scope.sgpersion,
                                "Designation_Gid": $scope.designation,
                                "Mobile_No1": $scope.sgmobile1,
                                "Landline_No1": $scope.sglandlin1,
                                "Landline_No2": " ",
                                "Mobile_No2": $scope.sgmobile2,
                                "Email": $scope.sgmailid,
                                "Contact_Dob": "",
                                "Contact_Wd": " "
                            },
                            "Classification": {
                                "Entity_Gid": $scope.entity_gid,
                                "Create_By": $scope.employgid,
                                "Entity_Detail_Gid": "1"
                            }
                        }
                    }
                    var supgpdata = {
                        Group: 'Supplier_Set',
                        Action: 'SUPPLIER_GROUP_INSERT',
                        value: data1
                    }

                    var supgpdataddl = testService.getsupplierrate(supgpdata)
                    supgpdataddl.then(function (result) {
                            if (result.data.MESSAGE == 'SUCCESS') {
                                alert('Inserted Successfully');
                                $scope.load();
                                $scope.loading();
                            } else {
                                alert(result.data.DATA)
                            }
                        },
                        function () {
                            alert('no data');
                        }).finally();

                }


            }

            $scope.state_clk = function (state_gid, type) {
                var distddl = testService.getdistddl(state_gid)
                distddl.then(function (result) {

                        if (type == 'address') {
                            $scope.adistrictddl = [];
                            $scope.adistrictddl = JSON.parse(result.data);
                        } else {
                            $scope.distritddl = [];
                            $scope.distritddl2 = [];
                            $scope.distritddl2 = JSON.parse(result.data);
                            $scope.distritddl1 = [];
                            $scope.distritddl = JSON.parse(result.data);
                            $scope.distritddl1 = JSON.parse(result.data);
                            for (var i = 0; i < 1; i++) {
                                dta = {
                                    "district_gid": 0,
                                    "district_name": "Add New District",
                                }
                                $scope.distritddl1.push(dta);

                            }
                        }
                    }),

                    function () {
                        alert('no data');
                    };
            };

            $scope.district_clk = function (district_gid, type) {
                var ctyddl = testService.getcityddl(district_gid)
                ctyddl.then(function (result) {
                        if (type == 'address') {
                            $scope.acity1 = [];
                            $scope.acity1 = JSON.parse(result.data);
                        } else {
                            $scope.city1 = [];
                            $scope.city2 = [];
                            $scope.city1 = JSON.parse(result.data);
                            $scope.city2 = JSON.parse(result.data);
                            for (var i = 0; i < 1; i++) {
                                dta = {
                                    "city_gid": 0,
                                    "City_Name": "Add New City",
                                }
                                $scope.city2.push(dta);
                            }
                        }
                    }),
                    function () {
                        alert('no data');
                    };
            };

            $scope.pinchange = function (pincode) {
                var pincd = testService.getpincodeall(pincode)
                pincd.then(function (result) {
                        var apincde = [];
                        apincde = JSON.parse(result.data);
                        $scope.selectedState = apincde[0].city_state_gid;
                        $scope.state_clk($scope.selectedState);
                        $scope.selecteddistrict = apincde[0].pincode_district_gid;
                        $scope.district_clk($scope.selecteddistrict);
                        $scope.selectedcity = apincde[0].pincode_City_gid;
                        $scope.pcode = apincde[0].pincode_no;
                    }),
                    function () {
                        alert('No data!.');
                    };
            };
            var custgrpddl = testService.getcustgrp()
            custgrpddl.then(function (result) {
                    $scope.conttype = [];
                    $scope.conttype = JSON.parse(result.data);
                }),
                function () {
                    alert('No data!.');
                };

            function loaddata1() {
                $scope.designationdetails == [];
                var rolegrouplist = testService.getdesg();
                rolegrouplist.then(function (rolegrouplist) {
                        $scope.designationdetails = JSON.parse(rolegrouplist.data);
                    }, function (err) {
                        alert('No data!.');
                    })
                    .finally();
            };
            loaddata1();
            $scope.city_clk = function (city_gid, type) {
                var pincd = testService.getpincode(city_gid)
                pincd.then(function (result) {
                        if (type == 'address') {

                            var apincde = [];
                            apincde = JSON.parse(result.data);
                            $scope.add.pincode1 = apincde[0].pincode_no;
                        } else {
                            var pincde = [];
                            pincde = JSON.parse(result.data);
                            $scope.pcode = pincde[0].pincode_no;
                        }
                    }),

                    function () {
                        alert('no data');
                    };
            };

            $scope.grpedit = function () {
                if ($scope.add.dobb == undefined || $scope.add.dobb == null) {
                    $scope.add.dobb1 = formatStringDate($scope.current_date, 'yyyy-mm-dd')
                } else {
                    $scope.add.dobb1 = formatStringDate(new Date($scope.add.dobb), 'yyyy-mm-dd')
                }
                var data1 = {
                    "Params": {
                        "Supplier": {
                            "Supplier_Name": $scope.name,
                            "Supplier_Gid": $scope.supplier_gid,
                            "Supplier_Capacity": $scope.code1,
                            "Supplier_Group_Gid": $scope.selectedSupplierGrp.suppliergroup_gid,
                            "Supplier_Branch_Name": $scope.supbranch,
                            "Supplier_GST_No": $scope.supgst
                        },
                        "Address": {
                            "Address_Gid": $scope.address_gid,
                            "Address1": $scope.adline,
                            "Address2": $scope.adline2,
                            "Address3": $scope.adline3,
                            "Pincode": $scope.pcode,
                            "District_Gid": $scope.selecteddistrict,
                            "City_Gid": $scope.selectedcity,
                            "State_Gid": $scope.selectedState
                        },
                        "Contact": {
                            "Contact_Gid": $scope.contact_gid,
                            "Contacttype_Gid": $scope.add.cntcttype,
                            "Contact_Name": $scope.add.prsnname,
                            "Designation_Gid": $scope.add.dsgntn,
                            "Landline_No1": $scope.add.lndlne,
                            "Landline_No2": $scope.add.lndlne2,
                            "Mobile_No1": $scope.add.mobno,
                            "Mobile_No2": $scope.add.mobno2,
                            "Email": $scope.add.mailid,
                            "Contact_Dob": $filter('date')($scope.add.dobb, "yyyy-MM-dd"),
                            "Contact_Wd": $filter('date')($scope.add.weddy, "yyyy-MM-dd")
                        },
                        "Classification": {
                            "Entity_Gid": $scope.entity_gid,
                            "Create_By": $scope.employgid
                        }
                    }
                }
                var kdata = {
                    Group: 'Supplier_Set',
                    Action: 'SUPP_UPDATE',
                    value: data1
                }
                var get_supplierproduct = testService.getsupplierrate(kdata)
                get_supplierproduct.then(function (result) {
                        if (result.data.MESSAGE == 'SUCCESS') {
                            alert(result.data.MESSAGE);
                            $scope.loading();
                            $window.location.href = "suppliersummary";
                        } else {
                            alert(result.data.DATA);
                        }
                    },
                    function () {
                        alert('no data');
                    }).finally();
            }

            $scope.getsupcode = function (n) {
                var params = {
                    "Action": n
                }
                var get_suppliercode = testService.supcode(params)
                get_suppliercode.then(function (result) {
                    $scope.code = result.data;
                })
            }

            $scope.emp = new Date();
            $scope.maxDate = new Date($scope.emp.getFullYear() - 18, $scope.emp.getMonth(), $scope.emp
                .getDate());
            $scope.doj = new Date();
            $scope.maximumDate = new Date($scope.doj.getFullYear(), $scope.doj.getMonth(), $scope.doj
                .getDate());
            $scope.add = [];

            $scope.grpsave = function () {
                debugger;
                var data = {
                    "Params": {
                        "Supplier": {
                            "Supplier_Name": $scope.name,
                            "Supplier_Capacity": $scope.code1,
                            "Supplier_Group_Gid": $scope.selectedSupplierGrp.suppliergroup_gid,
                            "Supplier_Branch_Name": $scope.supbranch,
                            "Supplier_GST_No": $scope.supgst
                        },
                        "Address": {
                            "Address1": $scope.adline,
                            "Address2": $scope.adline2,
                            "Address3": $scope.adline3,
                            "Pincode": $scope.pcode,
                            "District_Gid": $scope.selecteddistrict,
                            "City_Gid": $scope.selectedcity,
                            "State_Gid": $scope.selectedState
                        },
                        "Contact": {
                            "Contacttype_Gid": $scope.add.cntcttype,
                            "Contact_Name": $scope.add.prsnname,
                            "Designation_Gid": $scope.add.dsgntn,
                            "Landline_No1": $scope.add.lndlne,
                            "Landline_No2": $scope.add.lndlne2,
                            "Mobile_No1": $scope.add.mobno,
                            "Mobile_No2": $scope.add.mobno2,
                            "Email": $scope.add.mailid,
                            "Contact_Dob": $filter('date')($scope.add.dobb, "yyyy-MM-dd"),
                            "Contact_Wd": $filter('date')($scope.add.weddy, "yyyy-MM-dd"),
                        },
                        "Classification": {
                            "Entity_Gid": $scope.entity_gid,
                            "Create_By": $scope.employgid
                        }
                    }
                }
                var jdata = {
                    Group: 'Supplier_Set',
                    Action: 'SUPP_INSERT',
                    key: data
                }

                var get_supplierproduct = testService.getsupplierrate(jdata)
                get_supplierproduct.then(function (result) {
                        if (result.data.MESSAGE == 'SUCCESS') {
                            alert('Inserted Successfully');
                            $scope.load();
                            $scope.loading();
                        } else {
                            alert(result.data.DATA)
                        }
                    },
                    function () {
                        alert('no data');
                    }).finally();
            }

            $scope.load = function () {
                $window.location.href = "supplier";
            }
            $scope.callback_data = function (value, callback) {
                var deferred = $q.defer();
                var promise = deferred.promise;
                var cust_grp_ddl = testService.getsupplierrate(jdata)
                cust_grp_ddl.then(function (result) {

                        $scope.la_cust_grp_ddl = result.data.DATA;
                        callback();
                        deferred.resolve();
                    }),
                    function () {
                        alert('No Data');
                    };



            };


            //edit
            if (sessionStorage.getItem('emp_details') != null) {
                debugger;
                $scope.callback_data("", function () {
                    $scope.update = false;
                    $scope.save = true;
                    var employee_detail = JSON.parse(sessionStorage.getItem('emp_details'));
                    $scope.supplier_gid = employee_detail.supt_gid.supplier_gid;
                    $scope.address_gid = employee_detail.supt_gid.address_gid;
                    $scope.contact_gid = employee_detail.supt_gid.contact_gid;
                    $scope.name = employee_detail.supt_gid.supplier_name;
                    $scope.selectedSupplierGrp_session = employee_detail.supt_gid.suppliergroup_gid;
                    $scope.supbranch = employee_detail.supt_gid.supplier_branchname
                    $scope.supgst = employee_detail.supt_gid.supplier_gstno
                    $scope.code1 = employee_detail.supt_gid.supplier_capacity;
                    $scope.adline = employee_detail.supt_gid.address_1;
                    $scope.adline2 = employee_detail.supt_gid.address_2;
                    $scope.adline3 = employee_detail.supt_gid.address_3;
                    $scope.selectedcity = employee_detail.supt_gid.city_name;
                    $scope.selectedState = employee_detail.supt_gid.state_name;
                    $scope.add.cntcttype = employee_detail.supt_gid.contact_contacttype_gid;
                    $scope.add.dsgntn = employee_detail.supt_gid.contact_designation_gid;
                    $scope.add.prsnname = employee_detail.supt_gid.contact_personname;
                    $scope.add.mobno = employee_detail.supt_gid.contact_mobileno;
                    $scope.add.mobno2 = employee_detail.supt_gid.contact_mobileno2;
                    // $scope.add.cntcttype=employee_detail.supt_gid.contact_gid;
                    $scope.add.mailid = employee_detail.supt_gid.contact_email;
                    $scope.add.dobb = employee_detail.supt_gid.contact_Dob;
                    $scope.add.lndlne = employee_detail.supt_gid.contact_landline;
                    $scope.add.lndlne2 = employee_detail.supt_gid.contact_landline2;
                    $scope.pcode = employee_detail.supt_gid.address_pincode;
                    $scope.selectedState = employee_detail.supt_gid.address_state_gid;
                    $scope.state_clk(employee_detail.supt_gid.address_state_gid);
                    $scope.selecteddistrict = employee_detail.supt_gid.address_district_gid;
                    $scope.district_clk(employee_detail.supt_gid.address_district_gid);
                    $scope.selectedcity = employee_detail.supt_gid.address_city_gid;
                    $scope.city_clk(employee_detail.supt_gid.address_city_gid);
                    $scope.add.weddy = employee_detail.supt_gid.contact_Wd;
                    // $scope.add.cntcttype=employee_detail.supt_gid.contact_ref_gid;
                    // $scope.add.cntcttype=employee_detail.supt_gid.contact_reftablecode;
                });
            }
            if ($scope.update) {
                $scope.title = 'Create'
            } else {
                $scope.title = 'Edit'
            }
        }
    ]);
    //service
    app.service("testService", function ($http) {
        this.getsupplierrate = function (data) {
            var response = $http.post(Appname + "/Supplier_Master/", data);
            return response;
        }
        this.getstateddl = function (d) {
            var response = $http.get(Appname + "/stateddl/");
            return response;
        }
        this.getdistddl = function (state_gid) {
            var response = $http.get(Appname + "/districtddl/", {
                params: {
                    "state_gid": state_gid
                }
            });
            return response;
        }
        this.getcityddl = function (district_gid) {
            var response = $http.get(Appname + "/cityddl/", {
                params: {
                    "district_gid": district_gid
                }
            });
            return response;
        }
        this.getpincodeall = function (pincode) {
            var response = $http.get(Appname + "/allpinget/", {
                params: {
                    "pincode": pincode
                }
            });
            return response;
        }
        this.getcustgrp = function (d) {
            var response = $http.get(Appname + "/get_contctgroup/");
            return response;
        }
        //supcode
        this.supcode = function (d) {
            var response = $http.post(Appname + "/suppcode/", d);
            return response;
        }
        this.getdesg = function () {
            var response = $http.get(Appname + "/desgjson/");
            return response;
        }
        this.getpincode = function (city_gid) {
            var response = $http.get(Appname + "/pincode/", {
                params: {
                    "city_gid": city_gid
                }
            });
            return response;
        }
    });
</script>

<style>
    .md-select-menu-container.md-active {
        z-index: 1060;
    }

    .md-autocomplete-suggestions-container {
        z-index: 100000 !important;
        <body>
    }

    .md-dialog-container {
        z-index: 100000 !important;
    }
</style>
{% endblock %}